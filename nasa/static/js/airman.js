// --------------------------------------
// 
//    _  _ _/ .  _  _/ /_ _  _  _        
//   /_|/_ / /|//_  / / //_ /_// /_/     
//   http://activetheory.net     _/      
// 
// --------------------------------------
//   11/22/17 9:54p
// --------------------------------------

window.Global={};window.getURL=function(url,target){if(!target)target="_blank";window.open(url,target)};if(typeof console==="undefined"){window.console={};console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1e3/60)}}()}window.performance=function(){if(window.performance&&window.performance.now)return window.performance;else return Date}();Date.now=Date.now||function(){return+new Date};window.Class=function(_class,_type){var _this=this||window;var _string=_class.toString();var _name=_class.toString().match(/function ([^\(]+)/)[1];var _static=null;if(typeof _type==="function"){_static=_type;_type=null}_type=(_type||"").toLowerCase();_class.prototype.__call=function(){if(this.events)this.events.scope(this)};if(!_type){_this[_name]=_class;_static&&_static()}else{if(_type=="static"){_this[_name]=new _class}else if(_type=="singleton"){_this[_name]=function(){var __this={};var _instance;__this.instance=function(a,b,c){if(!_instance)_instance=new _class(a,b,c);return _instance};return __this}()}}if(this!==window){if(!this.__namespace)this.__namespace=this.constructor.toString().match(/function ([^\(]+)/)[1];this[_name]._namespace=this.__namespace}};window.Inherit=function(child,parent,param){if(typeof param==="undefined")param=child;var p=new parent(param,true);var save={};for(var method in p){child[method]=p[method];save[method]=p[method]}if(child.__call)child.__call();defer(function(){for(method in p){if(child[method]&&save[method]&&child[method]!==save[method]){child["_"+method]=save[method]}}p=save=null;child=parent=param=null})};window.Implement=function(cl,intr){Render.nextFrame(function(){var intrface=new intr;for(var property in intrface){if(typeof cl[property]==="undefined"){throw"Interface Error: Missing Property: "+property+" ::: "+intr}else{var type=typeof intrface[property];if(typeof cl[property]!=type)throw"Interface Error: Property "+property+" is Incorrect Type ::: "+intr}}})};window.Namespace=function(name){if(typeof name==="string")window[name]={Class:window.Class};else name.Class=window.Class};window.Interface=function(display){var name=display.toString().match(/function ([^\(]+)/)[1];Hydra.INTERFACES[name]=display};window.THREAD=false;Class(function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList;this.__useFragment=_useFragment;this._initSelector(_selector,_type,_exists)},()=>{var prototype=HydraObject.prototype;prototype._initSelector=function(_selector,_type,_exists){if(_selector&&typeof _selector!=="string"){this.div=_selector}else{var first=_selector?_selector.charAt(0):null;var name=_selector?_selector.slice(1):null;if(first!="."&&first!="#"){name=_selector;first="."}if(!_exists){this._type=_type||"div";if(this._type=="svg"){this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type);this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")}else{this.div=document.createElement(this._type);if(first){if(first=="#")this.div.id=name;else this.div.className=name}}}else{if(first!="#")throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}}this.div.hydraObject=this};prototype.addChild=prototype.add=function(child){var div=this.div;var createFrag=function(){if(this.__useFragment){if(!this._fragment){this._fragment=document.createDocumentFragment();var _this=this;defer(function(){if(!_this._fragment||!_this.div)return _this._fragment=null;_this.div.appendChild(_this._fragment);_this._fragment=null})}div=this._fragment}};if(child.element&&child.element instanceof HydraObject){createFrag();div.appendChild(child.element.div);this._children.push(child.element);child.element._parent=this;child.element.div.parentNode=this.div}else if(child.div){createFrag();div.appendChild(child.div);this._children.push(child);child._parent=this;child.div.parentNode=this.div}else if(child.nodeName){createFrag();div.appendChild(child);child.parentNode=this.div}return this};prototype.clone=function(){return $(this.div.cloneNode(true))};prototype.create=function(name,type){var $obj=$(name,type);this.addChild($obj);if(this.__root){this.__root.__append[name]=$obj;$obj.__root=this.__root}return $obj};prototype.empty=function(){var child=this._children.start();while(child){if(child&&child.remove)child.remove();child=this._children.next()}this.div.innerHTML="";return this};prototype.parent=function(){return this._parent};prototype.children=function(){return this.div.children?this.div.children:this.div.childNodes};prototype.append=function(callback,params){if(!this.__root){this.__root=this;this.__append={}}return callback.apply(this,params)};prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){};if(!keep)this._children.remove(object)};prototype.remove=prototype.destroy=function(){this.removed=true;var parent=this._parent;if(!!(parent&&!parent.removed&&parent.removeChild))parent.removeChild(this,true);var child=this._children.start();while(child){if(child&&child.remove)child.remove();child=this._children.next()}this._children.destroy();this.div.hydraObject=null;Utils.nullObject(this)}});Class(function Hydra(){var _this=this;var _inter,_pool;var _readyCallbacks=[];this.READY=false;this.HASH=window.location.hash.slice(1);this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||location.hostname.split(".")[0]=="10"||location.hostname.split(".")[0]=="192");(function(){initLoad()}());function initLoad(){if(!document||!window)return setTimeout(initLoad,1);if(window._NODE_||window._GLES_){_this.addEvent="addEventListener";_this.removeEvent="removeEventListener";return setTimeout(loaded,1)}if(window.addEventListener){_this.addEvent="addEventListener";_this.removeEvent="removeEventListener";window.addEventListener("load",loaded,false)}else{_this.addEvent="attachEvent";_this.removeEvent="detachEvent";window.attachEvent("onload",loaded)}}function loaded(){if(window.removeEventListener)window.removeEventListener("load",loaded,false);if(!_readyCallbacks)return;for(var i=0;i<_readyCallbacks.length;i++){_readyCallbacks[i]()}_readyCallbacks=null;_this.READY=true;if(window.Main)Hydra.Main=new window.Main}this.development=function(flag,array){var matchArray=function(prop){if(!array)return false;for(var i=0;i<array.length;i++){if(prop.strpos(array[i]))return true}return false};clearInterval(_inter);if(flag){_inter=setInterval(function(){for(var prop in window){if(prop.strpos("webkit"))continue;var obj=window[prop];if(typeof obj!=="function"&&prop.length>2){if(prop.strpos("_ga")||prop.strpos("_typeface_js")||matchArray(prop))continue;var char1=prop.charAt(0);var char2=prop.charAt(1);if(char1=="_"||char1=="$"){if(char2!==char2.toUpperCase()){console.log(window[prop]);throw"Hydra Warning:: "+prop+" leaking into global scope"}}}}},1e3)}};this.getArguments=function(value){var saved=this.arguments;var args=[];for(var i=1;i<saved.length;i++){if(saved[i]!==null)args.push(saved[i])}return args};this.getClassName=function(obj){return obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]};this.ready=function(callback){if(this.READY)return callback();_readyCallbacks.push(callback)};this.$=function(selector,type,exists){return new HydraObject(selector,type,exists)};this.__triggerReady=function(){loaded()};this.setPageOffset=function(x,y){_this.__offset={x:x,y:y};Stage.css({left:x,top:y,width:Stage.width-x,height:Stage.height-y})};this.INTERFACES={};this.HTML={};this.JSON={};this.SVG={};this.$.fn=HydraObject.prototype;window.$=this.$;window.ready=this.ready},"Static");Hydra.ready(function(){window.__window=$(window);window.__document=$(document);window.__body=$(document.getElementsByTagName("body")[0]);window.Stage=window.Stage?$(window.Stage):__body.create("#Stage");Stage.size("100%");Stage.__useFragment=true;Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth;Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight;(function(){var _time=Date.now();var _last;setTimeout(function(){var list=["hidden","msHidden","webkitHidden"];var hidden,eventName;(function(){for(var key in list){if(document[list[key]]!=="undefined"){hidden=list[key];switch(hidden){case"hidden":eventName="visibilitychange";break;case"msHidden":eventName="msvisibilitychange";break;case"webkitHidden":eventName="webkitvisibilitychange";break}return}}}());if(typeof document[hidden]==="undefined"){if(Device.browser.ie){document.onfocus=onfocus;document.onblur=onblur}else{window.onfocus=onfocus;window.onblur=onblur}}else{document.addEventListener(eventName,function(){var time=Date.now();if(time-_time>10){if(document[hidden]===false)onfocus();else onblur()}_time=time})}},250);function onfocus(){if(_last!="focus")HydraEvents._fireEvent(HydraEvents.BROWSER_FOCUS,{type:"focus"});_last="focus"}function onblur(){if(_last!="blur")HydraEvents._fireEvent(HydraEvents.BROWSER_FOCUS,{type:"blur"});_last="blur"}}());window.onresize=function(){if(!Device.mobile){Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth;Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight;if(Hydra.__offset){Stage.width-=Hydra.__offset.x;Stage.height-=Hydra.__offset.y;Stage.css({width:Stage.width,height:Stage.height})}HydraEvents._fireEvent(HydraEvents.RESIZE)}}});(function(){$.fn.text=function(text){if(typeof text!=="undefined"){if(this.__cacheText!=text)this.div.textContent=text;this.__cacheText=text;return this}else{return this.div.textContent}};$.fn.html=function(text,force){if(text&&!text.strpos("<")&&!force)return this.text(text);if(typeof text!=="undefined"){this.div.innerHTML=text;return this}else{return this.div.innerHTML}};$.fn.hide=function(){this.div.style.display="none";return this};$.fn.show=function(){this.div.style.display="";return this};$.fn.visible=function(){this.div.style.visibility="visible";return this};$.fn.invisible=function(){this.div.style.visibility="hidden";return this};$.fn.setZ=function(z){this.div.style.zIndex=z;return this};$.fn.clearAlpha=function(){this.div.style.opacity="";return this};$.fn.size=function(w,h,noScale){if(typeof w==="string"){if(typeof h==="undefined")h="100%";else if(typeof h!=="string")h=h+"px";this.div.style.width=w;this.div.style.height=h}else{this.div.style.width=w+"px";this.div.style.height=h+"px";if(!noScale)this.div.style.backgroundSize=w+"px "+h+"px"}this.width=w;this.height=h;return this};$.fn.mouseEnabled=function(bool){this.div.style.pointerEvents=bool?"auto":"none";return this};$.fn.fontStyle=function(family,size,color,style){var font={};if(family)font.fontFamily=family;if(size)font.fontSize=size;if(color)font.color=color;if(style)font.fontStyle=style;this.css(font);return this};$.fn.bg=function(src,x,y,repeat){if(!src)return this;if(src.strpos("."))src=Images.getPath(src);if(!src.strpos("."))this.div.style.backgroundColor=src;else this.div.style.backgroundImage="url("+src+")";if(typeof x!=="undefined"){x=typeof x=="number"?x+"px":x;y=typeof y=="number"?y+"px":y;this.div.style.backgroundPosition=x+" "+y}if(repeat){this.div.style.backgroundSize="";this.div.style.backgroundRepeat=repeat}if(x=="cover"||x=="contain"){this.div.style.backgroundSize=x;this.div.style.backgroundPosition=typeof y!="undefined"?y+" "+repeat:"center"}return this};$.fn.center=function(x,y,noPos){var css={};if(typeof x==="undefined"){css.left="50%";css.top="50%";css.marginLeft=-this.width/2;css.marginTop=-this.height/2}else{if(x){css.left="50%";css.marginLeft=-this.width/2}if(y){css.top="50%";css.marginTop=-this.height/2}}if(noPos){delete css.left;delete css.top}this.css(css);return this};$.fn.mask=function(arg,x,y,w,h){this.div.style[CSS.prefix("Mask")]=(arg.strpos(".")?"url("+arg+")":arg)+" no-repeat";this.div.style[CSS.prefix("MaskSize")]="contain";return this};$.fn.blendMode=function(mode,bg){if(bg){this.div.style["background-blend-mode"]=mode}else{this.div.style["mix-blend-mode"]=mode}return this};$.fn.css=function(obj,value){if(typeof value=="boolean"){skip=value;value=null}if(typeof obj!=="object"){if(!value){var style=this.div.style[obj];if(typeof style!=="number"){if(style.strpos("px"))style=Number(style.slice(0,-2));if(obj=="opacity")style=!isNaN(Number(this.div.style.opacity))?Number(this.div.style.opacity):1}if(!style)style=0;return style}else{this.div.style[obj]=value;return this}}TweenManager.clearCSSTween(this);for(var type in obj){var val=obj[type];if(!(typeof val==="string"||typeof val==="number"))continue;if(typeof val!=="string"&&type!="opacity"&&type!="zIndex")val+="px";this.div.style[type]=val}return this};$.fn.transform=function(props){if(this.multiTween&&this.cssTweens&&this._cssTweens.length>1&&this.__transformTime&&Render.TIME-this.__transformTime<15)return;this.__transformTime=Render.TIME;TweenManager.clearCSSTween(this);if(Device.tween.css2d){if(!props){props=this}else{for(var key in props){if(typeof props[key]==="number")this[key]=props[key]}}var transformString;if(!this._matrix){transformString=TweenManager.parseTransform(props)}else{if(this._matrix.type=="matrix2"){this._matrix.setTRS(this.x,this.y,this.rotation,this.scaleX||this.scale,this.scaleY||this.scale)}else{this._matrix.setTRS(this.x,this.y,this.z,this.rotationX,this.rotationY,this.rotationZ,this.scaleX||this.scale,this.scaleY||this.scale,this.scaleZ||this.scale)}transformString=this._matrix.getCSS()}if(this.__transformCache!=transformString){this.div.style[Device.styles.vendorTransform]=transformString;this.__transformCache=transformString}}return this};$.fn.useMatrix3D=function(){this._matrix=new Matrix4;this.x=0;this.y=0;this.z=0;this.rotationX=0;this.rotationY=0;this.rotationZ=0;this.scale=1;return this};$.fn.useMatrix2D=function(){this._matrix=new Matrix2;this.x=0;this.y=0;this.rotation=0;this.scale=1;return this};$.fn.willChange=function(props){if(typeof props==="boolean"){if(props===true)this._willChangeLock=true;else this._willChangeLock=false}else{if(this._willChangeLock)return}var string=typeof props==="string";if((!this._willChange||string)&&typeof props!=="null"){this._willChange=true;this.div.style["will-change"]=string?props:Device.transformProperty+", opacity"}else{this._willChange=false;this.div.style["will-change"]=""}};$.fn.backfaceVisibility=function(visible){if(visible)this.div.style[CSS.prefix("BackfaceVisibility")]="visible";else this.div.style[CSS.prefix("BackfaceVisibility")]="hidden"};$.fn.enable3D=function(perspective,x,y){if(!Device.tween.css3d)return this;this.div.style[CSS.prefix("TransformStyle")]="preserve-3d";if(perspective)this.div.style[CSS.prefix("Perspective")]=perspective+"px";if(typeof x!=="undefined"){x=typeof x==="number"?x+"px":x;y=typeof y==="number"?y+"px":y;this.div.style[CSS.prefix("PerspectiveOrigin")]=x+" "+y}return this};$.fn.disable3D=function(){this.div.style[CSS.prefix("TransformStyle")]="";this.div.style[CSS.prefix("Perspective")]="";return this};$.fn.transformPoint=function(x,y,z){var origin="";if(typeof x!=="undefined")origin+=typeof x==="number"?x+"px ":x+" ";if(typeof y!=="undefined")origin+=typeof y==="number"?y+"px ":y+" ";if(typeof z!=="undefined")origin+=typeof z==="number"?z+"px":z;this.div.style[CSS.prefix("TransformOrigin")]=origin;return this};$.fn.tween=function(props,time,ease,delay,callback,manual){if(typeof delay==="boolean"){manual=delay;delay=0;callback=null}else if(typeof delay==="function"){callback=delay;delay=0}if(typeof callback==="boolean"){manual=callback;callback=null}if(!delay)delay=0;var usePromise=null;if(callback&&callback instanceof Promise){usePromise=callback;callback=callback.resolve}var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween};$.fn.clearTransform=function(){if(typeof this.x==="number")this.x=0;if(typeof this.y==="number")this.y=0;if(typeof this.z==="number")this.z=0;if(typeof this.scale==="number")this.scale=1;if(typeof this.scaleX==="number")this.scaleX=1;if(typeof this.scaleY==="number")this.scaleY=1;if(typeof this.rotation==="number")this.rotation=0;if(typeof this.rotationX==="number")this.rotationX=0;if(typeof this.rotationY==="number")this.rotationY=0;if(typeof this.rotationZ==="number")this.rotationZ=0;if(typeof this.skewX==="number")this.skewX=0;if(typeof this.skewY==="number")this.skewY=0;this.div.style[Device.styles.vendorTransform]="";return this};$.fn.stopTween=function(){if(this._cssTween)this._cssTween.stop();if(this._mathTween)this._mathTween.stop();return this};$.fn.keypress=function(callback){this.div.onkeypress=function(e){e=e||window.event;e.code=e.keyCode?e.keyCode:e.charCode;if(callback)callback(e)}};$.fn.keydown=function(callback){this.div.onkeydown=function(e){e=e||window.event;e.code=e.keyCode;if(callback)callback(e)}};$.fn.keyup=function(callback){this.div.onkeyup=function(e){e=e||window.event;e.code=e.keyCode;if(callback)callback(e)}};$.fn.attr=function(attr,value){if(attr&&value){if(value=="")this.div.removeAttribute(attr);else this.div.setAttribute(attr,value)}else if(attr){return this.div.getAttribute(attr)}return this};$.fn.val=function(value){if(typeof value==="undefined"){return this.div.value}else{this.div.value=value}return this};$.fn.change=function(callback){var _this=this;if(this._type=="select"){this.div.onchange=function(){callback({object:_this,value:_this.div.value||""})}}};$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id);var svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'">'+'<use xlink:href="#'+config.id+'" x="0" y="0" />'+"</svg>";this.html(svgHTML,true)}}());(function(){var windowsPointer=!!window.MSGesture;var translateEvent=function(evt){if(Hydra.addEvent=="attachEvent"){switch(evt){case"click":return"onclick";break;case"mouseover":return"onmouseover";break;case"mouseout":return"onmouseleave";break;case"mousedown":return"onmousedown";break;case"mouseup":return"onmouseup";break;case"mousemove":return"onmousemove";break}}if(windowsPointer){switch(evt){case"touchstart":return"pointerdown";break;case"touchmove":return"MSGestureChange";break;case"touchend":return"pointerup";break}}return evt};$.fn.click=function(callback){var _this=this;function click(e){if(!_this.div)return false;if(Mouse._preventClicks)return false;e.object=_this.div.className=="hit"?_this.parent():_this;e.action="click";if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e);if(Mouse.autoPreventClicks)Mouse.preventClicks()}this.div[Hydra.addEvent](translateEvent("click"),click,true);this.div.style.cursor="pointer";return this};$.fn.hover=function(callback){var _this=this;var _over=false;var _time;function hover(e){if(!_this.div)return false;var time=Date.now();var original=e.toElement||e.relatedTarget;if(_time&&time-_time<5){_time=time;return false}_time=time;e.object=_this.div.className=="hit"?_this.parent():_this;switch(e.type){case"mouseout":e.action="out";break;case"mouseleave":e.action="out";break;default:e.action="over";break}if(_over){if(Mouse._preventClicks)return false;if(e.action=="over")return false;if(e.action=="out"){if(isAChild(_this.div,original))return false}_over=false}else{if(e.action=="out")return false;_over=true}if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e)}function isAChild(div,object){var len=div.children.length-1;for(var i=len;i>-1;i--){if(object==div.children[i])return true}for(i=len;i>-1;i--){if(isAChild(div.children[i],object))return true}}this.div[Hydra.addEvent](translateEvent("mouseover"),hover,true);this.div[Hydra.addEvent](translateEvent("mouseout"),hover,true);return this};$.fn.press=function(callback){var _this=this;function press(e){if(!_this.div)return false;e.object=_this.div.className=="hit"?_this.parent():_this;switch(e.type){case"mousedown":e.action="down";break;default:e.action="up";break}if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e)}this.div[Hydra.addEvent](translateEvent("mousedown"),press,true);this.div[Hydra.addEvent](translateEvent("mouseup"),press,true);return this};$.fn.bind=function(evt,callback){if(!this._events)this._events={};if(windowsPointer&&this==__window){return Stage.bind(evt,callback)}if(evt=="touchstart"){if(!Device.mobile){if(Device.touchCapable)this.bind("mousedown",callback);else evt="mousedown"}}else if(evt=="touchmove"){if(!Device.mobile){if(Device.touchCapable)this.bind("mousemove",callback);else evt="mousemove"}if(windowsPointer&&!this.div.msGesture){this.div.msGesture=new MSGesture;this.div.msGesture.target=this.div}}else if(evt=="touchend"){if(!Device.mobile){if(Device.touchCapable)this.bind("mouseup",callback);else evt="mouseup"}}this._events["bind_"+evt]=this._events["bind_"+evt]||[];var _events=this._events["bind_"+evt];var e={};var target=this.div;e.callback=callback;e.target=this.div;_events.push(e);function touchEvent(e){if(windowsPointer&&target.msGesture&&evt=="touchstart"){target.msGesture.addPointer(e.pointerId)}var touch=Utils.touchEvent(e);if(windowsPointer){var windowsEvt=e;e={};e.x=Number(windowsEvt.pageX||windowsEvt.clientX);e.y=Number(windowsEvt.pageY||windowsEvt.clientY);e.target=windowsEvt.target;e.currentTarget=windowsEvt.currentTarget;e.path=[];var node=e.target;while(node){e.path.push(node);node=node.parentElement||null}e.windowsPointer=true}else{e.x=touch.x;e.y=touch.y}for(var i=0;i<_events.length;i++){var ev=_events[i];if(ev.target==e.currentTarget){ev.callback(e)}}}if(!this._events["fn_"+evt]){this._events["fn_"+evt]=touchEvent;this.div[Hydra.addEvent](translateEvent(evt),touchEvent,true)}return this};$.fn.unbind=function(evt,callback){if(!this._events)this._events={};if(windowsPointer&&this==__window){return Stage.unbind(evt,callback)}if(evt=="touchstart"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mousedown",callback);else evt="mousedown"}}else if(evt=="touchmove"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mousemove",callback);else evt="mousemove"}}else if(evt=="touchend"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mouseup",callback);else evt="mouseup"}}var _events=this._events["bind_"+evt];if(!_events)return this;for(var i=0;i<_events.length;i++){var ev=_events[i];if(ev.callback==callback)_events.splice(i,1)}if(this._events["fn_"+evt]&&!_events.length){this.div[Hydra.removeEvent](translateEvent(evt),this._events["fn_"+evt],Device.mobile?{passive:true}:true);this._events["fn_"+evt]=null}return this};$.fn.interact=function(overCallback,clickCallback){if(!this.hit){this.hit=$(".hit");this.hit.css({width:"100%",height:"100%",zIndex:99999,top:0,left:0,position:"absolute"});this.addChild(this.hit)}if(!Device.mobile)this.hit.hover(overCallback).click(clickCallback);else this.hit.touchClick(overCallback,clickCallback)};$.fn.touchSwipe=function(callback,distance){if(!window.addEventListener)return this;var _this=this;var _distance=distance||75;var _startX,_startY;var _moving=false;var _move={};if(Device.mobile){this.div.addEventListener(translateEvent("touchstart"),touchStart,{passive:true});this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:true});this.div.addEventListener(translateEvent("touchcancel"),touchEnd,{passive:true})}function touchStart(e){var touch=Utils.touchEvent(e);if(!_this.div)return false;if(e.touches.length==1){_startX=touch.x;_startY=touch.y;_moving=true;_this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:true})}}function touchMove(e){if(!_this.div)return false;if(_moving){var touch=Utils.touchEvent(e);var dx=_startX-touch.x;var dy=_startY-touch.y;_move.direction=null;_move.moving=null;_move.x=null;_move.y=null;_move.evt=e;if(Math.abs(dx)>=_distance){touchEnd();if(dx>0){_move.direction="left"}else{_move.direction="right"}}else if(Math.abs(dy)>=_distance){touchEnd();if(dy>0){_move.direction="up"}else{_move.direction="down"}}else{_move.moving=true;_move.x=dx;_move.y=dy}if(callback)callback(_move,e)}}function touchEnd(e){if(!_this.div)return false;_startX=_startY=_moving=false;_this.div.removeEventListener(translateEvent("touchmove"),touchMove)}return this};$.fn.touchClick=function(hover,click){if(!window.addEventListener)return this;var _this=this;var _time,_move;var _start={};var _touch={};if(Device.mobile){this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:true});this.div.addEventListener(translateEvent("touchstart"),touchStart,{passive:true});this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:true})}function touchMove(e){if(!_this.div)return false;_touch=Utils.touchEvent(e);if(Utils.findDistance(_start,_touch)>5){_move=true}else{_move=false}}function setTouch(e){var touch=Utils.touchEvent(e);e.touchX=touch.x;e.touchY=touch.y;_start.x=e.touchX;_start.y=e.touchY}function touchStart(e){if(!_this.div)return false;_time=Date.now();e.action="over";e.object=_this.div.className=="hit"?_this.parent():_this;setTouch(e);if(hover&&!_move)hover(e)}function touchEnd(e){if(!_this.div)return false;var time=Date.now();var clicked=false;e.object=_this.div.className=="hit"?_this.parent():_this;setTouch(e);if(_time&&time-_time<750){if(Mouse._preventClicks)return false;if(click&&!_move){clicked=true;e.action="click";if(click&&!_move)click(e);if(Mouse.autoPreventClicks)Mouse.preventClicks()}}if(hover){e.action="out";if(!Mouse._preventFire)hover(e)}_move=false}return this}}());Class(function MVC(){Inherit(this,Events);var _setters={};var _active={};var _timers=[];this.classes={};function defineSetter(_this,prop){_setters[prop]={};Object.defineProperty(_this,prop,{set:function(v){if(_setters[prop]&&_setters[prop].s)_setters[prop].s.call(_this,v);v=null},get:function(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}this.set=function(prop,callback){if(!_setters[prop])defineSetter(this,prop);_setters[prop].s=callback};this.get=function(prop,callback){if(!_setters[prop])defineSetter(this,prop);_setters[prop].g=callback};this.delayedCall=function(callback,time,params){var _this=this;var timer=Timer.create(function(){if(!_this)return;if(_this.destroy){callback&&callback(params)}_this=callback=null},time||0);_timers.push(timer);if(_timers.length>20)_timers.shift();return timer};this.initClass=function(clss,a,b,c,d,e,f,g){var name=Utils.timestamp();if(window.Hydra)Hydra.arguments=arguments;var child=new clss(a,b,c,d,e,f,g);if(window.Hydra)Hydra.arguments=null;child.parent=this;if(child.destroy){this.classes[name]=child;this.classes[name].__id=name}var lastArg=arguments[arguments.length-1];if(Array.isArray(lastArg)&&lastArg.length==1&&lastArg[0]instanceof HydraObject)lastArg[0].addChild(child);else if(this.element&&lastArg!==null)this.element.addChild(child);return child};this.destroy=function(){if(this.onDestroy)this.onDestroy();if(this.__renderLoop)Render.stop(this.__renderLoop);for(var i in this.classes){var clss=this.classes[i];if(clss&&clss.destroy)clss.destroy()}this.clearTimers&&this.clearTimers();this.classes=null;if(this.events)this.events=this.events.destroy();if(this.element&&this.element.remove)this.element=this.container=this.element.remove();if(this.parent&&this.parent.__destroyChild)this.parent.__destroyChild(this.__id);return Utils.nullObject(this)};this.clearTimers=function(){for(let i=0;i<_timers.length;i++)clearTimeout(_timers[i]);_timers.length=0};this.active=function(name,value,time){if(typeof value!=="undefined"){_active[name]=value;if(time){this.delayedCall(function(){_active[name]=!_active[name]},time)}}else{return _active[name]}};this.wait=function(callback,object,key){var _this=this;let test=()=>{if(!!object[key]){callback();Render.stop(test)}};Render.start(test)};this.__destroyChild=function(name){delete this.classes[name]}});Class(function Model(name){Inherit(this,MVC);var _storage={};var _data=0;var _triggered=0;this.push=function(name,val){_storage[name]=val};this.pull=function(name){return _storage[name]};this.waitForData=this.promiseData=function(num=1){_data+=num};this.fulfillData=this.resolveData=function(){_triggered++;if(_triggered==_data){this.dataReady=true}};this.onReady=function(callback){let promise=Promise.create();if(callback)promise.then(callback);this.wait(()=>promise.resolve(),this,"dataReady");return promise};this.initWithData=function(data){this.STATIC_DATA=data;for(var key in this){var model=this[key];var init=false;for(var i in data){if(i.toLowerCase().replace(/-/g,"")==key.toLowerCase()){init=true;if(model.init)model.init(data[i])}}if(!init&&model.init)model.init()}this.init&&this.init(data)};this.loadData=function(url,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;var _this=this;XHR.get(url+"?"+Utils.timestamp(),function(d){defer(function(){_this.initWithData(d);callback(d)})});return promise};this.Class=function(model){var name=model.toString().match(/function ([^\(]+)/)[1];this[name]=new model}});Class(function View(_child){Inherit(this,MVC);var _resize;var name=Hydra.getClassName(_child);this.element=$("."+name);this.element.__useFragment=true;this.css=function(obj){this.element.css(obj);return this};this.transform=function(obj){this.element.transform(obj||this);return this};this.tween=function(props,time,ease,delay,callback,manual){return this.element.tween(props,time,ease,delay,callback,manual)};this.startRender=function(callback){this.__renderLoop=callback;Render.start(callback)};this.stopRender=function(callback){this.__renderLoop=null;Render.stop(callback)};var inter=Hydra.INTERFACES[name]||Hydra.INTERFACES[name+"UI"];if(inter){this.ui={};var params=Hydra.getArguments();params.push(_child);_resize=this.element.append(inter,params);var append=this.element.__append;for(var key in append)this.ui[key]=append[key];if(_resize){this.resize=function(){_resize.apply(this.ui,arguments)}}}this.__call=function(){this.events.scope(this)}});Class(function Controller(name){Inherit(this,MVC);name=Hydra.getClassName(name);this.element=this.container=$("#"+name);this.element.__useFragment=true;this.css=function(obj){this.container.css(obj)}});Class(function Component(){Inherit(this,MVC);this.startRender=function(callback){this.__renderLoop=callback;Render.start(callback)};this.stopRender=function(callback){this.__renderLoop=null;Render.stop(callback)};this.__call=function(){this.events.scope(this);delete this.__call}});Class(function Utils(){var _this=this;var _obj={};if(typeof Float32Array=="undefined")Float32Array=Array;if(typeof Promise=="undefined")Promise={};function rand(min,max){return lerp(Math.random(),min,max)}function lerp(ratio,start,end){return start+(end-start)*ratio}this.doRandom=function(min,max,precision){if(typeof precision=="number"){var p=Math.pow(10,precision);return Math.round(rand(min,max)*p)/p}else{return Math.round(rand(min-.5,max+.5))}};this.headsTails=function(heads,tails){return!_this.doRandom(0,1)?heads:tails};this.toDegrees=function(rad){return rad*(180/Math.PI)};this.toRadians=function(deg){return deg*(Math.PI/180)};this.findDistance=function(p1,p2){var dx=p2.x-p1.x;var dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)};this.timestamp=function(){var num=Date.now()+_this.doRandom(0,99999);return num.toString()};this.hitTestObject=function(obj1,obj2){var x1=obj1.x,y1=obj1.y,w=obj1.width,h=obj1.height;var xp1=obj2.x,yp1=obj2.y,wp=obj2.width,hp=obj2.height;var x2=x1+w,y2=y1+h,xp2=xp1+wp,yp2=yp1+hp;if(xp1>=x1&&xp1<=x2){if(yp1>=y1&&yp1<=y2){return true}else if(y1>=yp1&&y1<=yp2){return true}}else if(x1>=xp1&&x1<=xp2){if(yp1>=y1&&yp1<=y2){return true}else if(y1>=yp1&&y1<=yp2){return true}}return false};this.randomColor=function(){var color="#"+Math.floor(Math.random()*16777215).toString(16);if(color.length<7)color=this.randomColor();return color};this.touchEvent=function(e){var touchEvent={};touchEvent.x=0;touchEvent.y=0;if(e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches){if(e.touches.length){touchEvent.x=e.touches[0].pageX;touchEvent.y=e.touches[0].pageY-Mobile.scrollTop}else{touchEvent.x=e.changedTouches[0].pageX;touchEvent.y=e.changedTouches[0].pageY-Mobile.scrollTop}}else{touchEvent.x=e.pageX;touchEvent.y=e.pageY}if(Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(window.orientation==90||window.orientation===0){var x=touchEvent.y;touchEvent.y=touchEvent.x;touchEvent.x=Stage.width-x}if(window.orientation==-90||window.orientation===180){var y=touchEvent.x;touchEvent.x=touchEvent.y;touchEvent.y=Stage.height-y}}return touchEvent};this.clamp=function(num,min,max){return Math.min(Math.max(num,min),max)};this.constrain=function(num,min,max){return Math.min(Math.max(num,Math.min(min,max)),Math.max(min,max))};this.nullObject=function(object){if(object.destroy||object.div){for(var key in object){if(typeof object[key]!=="undefined")object[key]=null}}return null};this.convertRange=this.range=function(oldValue,oldMin,oldMax,newMin,newMax,clamped){var oldRange=oldMax-oldMin;var newRange=newMax-newMin;var newValue=(oldValue-oldMin)*newRange/oldRange+newMin;if(clamped)return _this.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax));return newValue};this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))};this.mergeObject=function(){var obj={};for(var i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o){obj[key]=o[key]}}return obj};this.mix=function(from,to,alpha){return from*(1-alpha)+to*alpha};this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};this.padInt=function(num,digits,max){if(max)num=Math.min(num,Math.pow(10,digits)-1);let str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str};this.query=function(key){const str=decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(key).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"));if(!str.length||str=="0"||str=="false")return false;return str};this.smoothstep=function(min,max,value){var x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)};this.shuffleArray=function(array){var currentIndex=array.length;var temporaryValue;var randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex];array[randomIndex]=temporaryValue}return array};this.sign=function(num){return num<0?-1:1};Math.rand=function(min=0,max=1,precision=2){const p=Math.pow(10,precision);return Math.round((min+Math.random()*(max-min))*p)/p};String.prototype.strpos=function(str){if(Array.isArray(str)){for(var i=0;i<str.length;i++){if(this.indexOf(str[i])>-1)return true}return false}else{return this.indexOf(str)!=-1}};String.prototype.clip=function(num,end){return this.length>num?this.slice(0,num)+end:this};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};Array.prototype.findAndRemove=function(reference){if(!this.indexOf)return;var index=this.indexOf(reference);if(index>-1)return this.splice(index,1)};Array.prototype.getRandom=function(){return this[_this.doRandom(0,this.length-1)]};Array.storeRandom=function(arr){arr.randomStore=[]};Array.prototype.random=function(range){let value=Math.rand(0,this.length-1,0);if(arguments.length&&!this.randomStore)Array.storeRandom(this);if(!this.randomStore)return this[value];if(range>this.length-1)range=this.length;if(range>1){while(!!~this.randomStore.indexOf(value))if((value+=1)>this.length-1)value=0;this.randomStore.push(value);if(this.randomStore.length>=range)this.randomStore.shift()}return this[value]};Array.prototype.last=function(){return this[this.length-1]};Array.prototype.shuffle=function(){let i=this.length-1;let temp,r;while(i!==0){r=Math.rand(0,i,0);i-=1;temp=this[i];this[i]=this[r];this[r]=temp}};Promise.create=function(){var promise=new Promise(function(resolve,reject){_obj.resolve=resolve;_obj.reject=reject});promise.resolve=_obj.resolve;promise.reject=_obj.reject;if(arguments.length){var fn=arguments[0];var params=[];for(var i=1;i<arguments.length;i++)params.push(arguments[i]);params.push(promise.resolve);fn.apply(fn,params)}_obj.resolve=_obj.reject=null;return promise}},"Static");Class(function CSS(){var _this=this;var _obj,_style,_needsUpdate;Hydra.ready(function(){_style="";_obj=document.createElement("style");_obj.type="text/css";document.getElementsByTagName("head")[0].appendChild(_obj)});function objToCSS(key){var match=key.match(/[A-Z]/);var camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex);var end=key.slice(camelIndex);key=start+"-"+end.toLowerCase()}return key}function cssToObj(key){var match=key.match(/\-/);var camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex);var end=key.slice(camelIndex).slice(1);var letter=end.charAt(0);end=end.slice(1);end=letter.toUpperCase()+end;key=start+end}return key}function setHTML(){_obj.innerHTML=_style;_needsUpdate=false}this._read=function(){return _style};this._write=function(css){_style=css;if(!_needsUpdate){_needsUpdate=true;defer(setHTML)}};this._toCSS=objToCSS;this.style=function(selector,obj){var s=selector+" {";for(var key in obj){var prop=objToCSS(key);var val=obj[key];if(typeof val!=="string"&&key!="opacity")val+="px";s+=prop+":"+val+"!important;"}s+="}";_this._write(_style+s)};this.get=function(selector,prop){var values=new Object;var string=_obj.innerHTML.split(selector+" {");for(var i=0;i<string.length;i++){var str=string[i];if(!str.length)continue;var split=str.split("!important;");for(var j in split){if(split[j].strpos(":")){var fsplit=split[j].split(":");if(fsplit[1].slice(-2)=="px"){fsplit[1]=Number(fsplit[1].slice(0,-2))}values[cssToObj(fsplit[0])]=fsplit[1]}}}if(!prop)return values;else return values[prop]};this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""});__body.addChild($clone);var width=$clone.div.offsetWidth;var height=$clone.div.offsetHeight;$clone.remove();return{width:width,height:height}};this.prefix=function(style){return Device.styles.vendor==""?style.charAt(0).toLowerCase()+style.slice(1):Device.styles.vendor+style}},"Static");Class(function Device(){var _this=this;var _tagDiv;this.agent=navigator.userAgent.toLowerCase();this.detect=function(array){if(typeof array==="string")array=[array];for(var i=0;i<array.length;i++){if(this.agent.strpos(array[i]))return true}return false};var prefix=function(){var pre="";if(!window._NODE_&&!window._GLES_){var styles=window.getComputedStyle(document.documentElement,"");pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||styles.OLink===""&&["","o"])[1];var dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1]}else{pre="webkit"}var IE=_this.detect("trident");return{unprefixed:IE&&!_this.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:(IE?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}();function checkForTag(prop){var div=_tagDiv||document.createElement("div"),vendors="Khtml ms O Moz Webkit".split(" "),len=vendors.length;_tagDiv=div;if(prop in div.style)return true;prop=prop.replace(/^[a-z]/,function(val){return val.toUpperCase()});while(len--){if(vendors[len]+prop in div.style){return true}}return false}this.mobile=!window._NODE_&&(!!("ontouchstart"in window||"onpointerdown"in window)&&this.detect(["ios","iphone","ipad","windows phone","android","blackberry"]))?{}:false;if(this.mobile&&this.detect("windows")&&!this.detect("touch"))this.mobile=false;if(this.mobile){this.mobile.tablet=Math.max(screen.width,screen.height)>1e3;this.mobile.phone=!this.mobile.tablet}this.browser={};this.browser.ie=function(){if(_this.detect("msie"))return true;if(_this.detect("trident")&&_this.detect("rv:"))return true;if(_this.detect("windows")&&_this.detect("edge"))return true}();this.browser.chrome=!this.browser.ie&&this.detect("chrome");this.browser.safari=!this.browser.chrome&&!this.browser.ie&&this.detect("safari");this.browser.firefox=this.detect("firefox");this.browser.version=function(){try{if(_this.browser.chrome)return Number(_this.agent.split("chrome/")[1].split(".")[0]);if(_this.browser.firefox)return Number(_this.agent.split("firefox/")[1].split(".")[0]);if(_this.browser.safari)return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if(_this.browser.ie){if(_this.detect("msie"))return Number(_this.agent.split("msie ")[1].split(".")[0]);if(_this.detect("rv:"))return Number(_this.agent.split("rv:")[1].split(".")[0]);return Number(_this.agent.split("edge/")[1].split(".")[0])}}catch(e){return-1}}();this.vendor=prefix.css;this.transformProperty=function(){switch(prefix.lowercase){case"moz":return"-moz-transform";break;case"webkit":return"-webkit-transform";break;case"o":return"-o-transform";break;case"ms":return"-ms-transform";break;default:return"transform";break}}();this.system={};this.system.retina=window.devicePixelRatio>1;this.system.webworker=typeof window.Worker!=="undefined";this.system.offline=typeof window.applicationCache!=="undefined";if(!window._NODE_){this.system.geolocation=typeof navigator.geolocation!=="undefined";this.system.pushstate=typeof window.history.pushState!=="undefined"}this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);this.system.language=window.navigator.userLanguage||window.navigator.language;this.system.webaudio=typeof window.AudioContext!=="undefined";this.system.vr=!!window.VRDisplay;try{this.system.localStorage=typeof window.localStorage!=="undefined"}catch(e){this.system.localStorage=false}this.system.fullscreen=typeof document[prefix.lowercase+"CancelFullScreen"]!=="undefined";this.system.os=function(){if(_this.detect("mac os"))return"mac";else if(_this.detect("windows nt 6.3"))return"windows8.1";else if(_this.detect("windows nt 6.2"))return"windows8";else if(_this.detect("windows nt 6.1"))return"windows7";else if(_this.detect("windows nt 6.0"))return"windowsvista";else if(_this.detect("windows nt 5.1"))return"windowsxp";else if(_this.detect("windows"))return"windows";else if(_this.detect("linux"))return"linux";return"undetected"}();this.pixelRatio=window.devicePixelRatio;this.touchCapable=!!("ontouchstart"in window);this.media={};this.media.audio=function(){if(!!document.createElement("audio").canPlayType){return _this.detect(["firefox","opera"])?"ogg":"mp3"}else{return false}}();this.media.video=function(){var vid=document.createElement("video");if(!!vid.canPlayType){if(Device.mobile)return"mp4";if(_this.browser.chrome)return"webm";if(_this.browser.firefox||_this.browser.opera){if(vid.canPlayType('video/webm; codecs="vorbis,vp8"'))return"webm";return"ogv"}return"mp4"}else{return false}}();this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection);this.graphics={};this.graphics.webgl=function(){try{var gl;var names=["webgl","experimental-webgl","webkit-3d","moz-webgl"];var canvas=document.createElement("canvas");for(var i=0;i<names.length;i++){gl=canvas.getContext(names[i]);if(gl)break}var info=gl.getExtension("WEBGL_debug_renderer_info");var output={};if(info){var gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}output.renderer=gl.getParameter(gl.RENDERER).toLowerCase();output.version=gl.getParameter(gl.VERSION).toLowerCase();output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase();output.extensions=gl.getSupportedExtensions();output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().strpos(matches))return true;if(output.version&&output.version.toLowerCase().strpos(matches))return true;for(var i=0;i<output.extensions.length;i++){if(output.extensions[i].toLowerCase().strpos(matches))return true}return false};return output}catch(e){return false};}();this.graphics.canvas=function(){var canvas=document.createElement("canvas");return canvas.getContext?true:false}();this.styles={};this.styles.filter=checkForTag("filter");this.styles.blendMode=checkForTag("mix-blend-mode");this.styles.vendor=prefix.unprefixed?"":prefix.js;this.styles.vendorTransition=this.styles.vendor.length?this.styles.vendor+"Transition":"transition";this.styles.vendorTransform=this.styles.vendor.length?this.styles.vendor+"Transform":"transform";this.tween={};this.tween.transition=checkForTag("transition");this.tween.css2d=checkForTag("transform");this.tween.css3d=checkForTag("perspective");this.tween.complete=function(){if(prefix.unprefixed)return"transitionend";return prefix.lowercase+"TransitionEnd"}();this.test=function(name,test){this[name]=test()};function checkFullscreen(){if(!_this.getFullscreen()){HydraEvents._fireEvent(HydraEvents.FULLSCREEN,{fullscreen:false});Render.stop(checkFullscreen)}}this.openFullscreen=function(obj){obj=obj||__body;if(obj&&_this.system.fullscreen){if(obj==__body)obj.css({top:0});obj.div[prefix.lowercase+"RequestFullScreen"]();HydraEvents._fireEvent(HydraEvents.FULLSCREEN,{fullscreen:true});Render.start(checkFullscreen,10)}};this.closeFullscreen=function(){if(_this.system.fullscreen)document[prefix.lowercase+"CancelFullScreen"]();Render.stop(checkFullscreen)};this.getFullscreen=function(){if(_this.browser.firefox)return document.mozFullScreen;return document[prefix.lowercase+"IsFullScreen"]}},"Static");Class(function DynamicObject(_properties){var prototype=DynamicObject.prototype;if(_properties){for(var key in _properties){this[key]=_properties[key]}}this._tweens={};if(typeof prototype.tween!=="undefined")return;prototype.tween=function(properties,time,ease,delay,update,complete){if(typeof delay!=="number"){complete=update;update=delay;delay=0}if(!this.multiTween)this.stopTween();if(typeof complete!=="function")complete=null;if(typeof update!=="function")update=null;this._tween=TweenManager.tween(this,properties,time,ease,delay,complete,update);return this._tween};prototype.stopTween=function(tween){var _tween=tween||this._tween;if(_tween&&_tween.stop)_tween.stop()};prototype.pause=function(){var _tween=this._tween;if(_tween&&_tween.pause)_tween.pause()};prototype.resume=function(){var _tween=this._tween;if(_tween&&_tween.resume)_tween.resume()};prototype.copy=function(pool){var c=pool&&pool.get?pool.get():new DynamicObject;for(var key in this){if(typeof this[key]==="number")c[key]=this[key]}return c};prototype.copyFrom=function(obj){for(var key in obj){if(typeof obj[key]=="number")this[key]=obj[key]}};prototype.copyTo=function(obj){for(var key in obj){if(typeof this[key]=="number")obj[key]=this[key]}};prototype.clear=function(){for(var key in this){if(typeof this[key]!=="function")delete this[key]}return this};prototype.destroy=function(){this.stopTween()}});Class(function ObjectPool(_type,_number){var _this=this;var _pool=[];this.array=_pool;(function(){if(_type){_number=_number||10;_type=_type||Object;for(var i=0;i<_number;i++){_pool.push(new _type)}}}());this.get=function(){return _pool.shift()||(_type?new _type:null)};this.empty=function(){_pool.length=0};this.put=function(obj){if(obj)_pool.push(obj)};this.insert=function(array){if(typeof array.push==="undefined")array=[array];for(var i=0;i<array.length;i++){_pool.push(array[i])}};this.length=function(){return _pool.length};this.destroy=function(){for(var i=0;i<_pool.length;i++){if(_pool[i].destroy)_pool[i].destroy()}_pool=null}});Class(function LinkedList(){var prototype=LinkedList.prototype;this.length=0;this.first=null;this.last=null;this.current=null;this.prev=null;if(typeof prototype.push!=="undefined")return;prototype.push=function(obj){if(!this.first){this.first=obj;this.last=obj;obj.__prev=obj;obj.__next=obj}else{obj.__next=this.first;obj.__prev=this.last;this.last.__next=obj;this.last=obj}this.length++};prototype.remove=function(obj){if(!obj||!obj.__next)return;if(this.length<=1){this.empty()}else{if(obj==this.first){this.first=obj.__next;this.last.__next=this.first;this.first.__prev=this.last}else if(obj==this.last){this.last=obj.__prev;this.last.__next=this.first;this.first.__prev=this.last}else{obj.__prev.__next=obj.__next;obj.__next.__prev=obj.__prev}this.length--}obj.__prev=null;obj.__next=null};prototype.empty=function(){this.first=null;this.last=null;this.current=null;this.prev=null;this.length=0};prototype.start=function(){this.current=this.first;this.prev=this.current;return this.current};prototype.next=function(){if(!this.current)return;this.current=this.current.__next;if(this.length==1||this.prev.__next==this.first)return;this.prev=this.current;return this.current};prototype.destroy=function(){Utils.nullObject(this);return null}});Class(function Mouse(){var _this=this;var _capturing;this.x=0;this.y=0;this.lastX=0;this.lastY=0;this.moveX=0;this.moveY=0;this.autoPreventClicks=false;function moved(e){_this.lastX=_this.x;_this.lastY=_this.y;if(!Device.mobile&&e.touches)e.preventDefault();_this.ready=true;if(e.windowsPointer){_this.x=e.x;_this.y=e.y}else{var convert=Utils.touchEvent(e);_this.x=convert.x;_this.y=convert.y}_this.moveX=_this.x-_this.lastX;_this.moveY=_this.y-_this.lastY}this.capture=function(x,y){if(_capturing)return false;_capturing=true;_this.x=x||0;_this.y=y||0;_this.move=new Interaction.Input(__window);if(Device.touchCapable||Device.mobile){__window.bind("touchmove",moved);__window.bind("touchstart",moved);__window.bind("touchend",resetMove)}if(!Device.mobile){__window.bind("mousemove",moved)}};this.stop=function(){if(!_capturing)return false;_capturing=false;_this.x=0;_this.y=0;__window.unbind("mousemove",moved);__window.unbind("touchmove",moved);__window.unbind("touchstart",moved);__window.unbind("touchend",resetMove)};this.preventClicks=function(){_this._preventClicks=true;Timer.create(function(){_this._preventClicks=false},300)};this.preventFireAfterClick=function(){_this._preventFire=true};function resetMove(){_this.moveX=0;_this.moveY=0}},"Static");Class(function Timer(){var _this=this;var _clearTimeout,_created;var _callbacks=[];var _completed=[];function loop(t,tsl,delta){var len=_completed.length;for(var i=0;i<len;i++){var obj=_completed[i];obj.callback=null;_callbacks.findAndRemove(obj)}if(len>0)_completed.length=0;if(delta>70)return;len=_callbacks.length;for(var i=0;i<len;i++){var obj=_callbacks[i];if(!obj)continue;if(obj.frames){++obj.current;if(obj.current>=obj.frames){obj.callback();_completed.push(obj)}}if(obj.time){obj.current+=delta;if(obj.current>=obj.time){obj.callback&&obj.callback();_completed.push(obj)}}}}function find(ref){for(var i=_callbacks.length-1;i>-1;i--){var c=_callbacks[i];if(c.ref==ref)return c}}function create(){_created=true;Render.start(loop)}_clearTimeout=window.clearTimeout;window.clearTimeout=function(ref){var c=find(ref);if(c){c.callback=null;_callbacks.findAndRemove(c)}else{_clearTimeout(ref)}};this.create=function(callback,time){if(!_created)create();if(window._NODE_)return setTimeout(callback,time);if(time<=0)return callback();var obj={};obj.time=time;obj.current=0;obj.ref=Utils.timestamp();obj.callback=callback;_callbacks.push(obj);return obj.ref};this.waitFrames=function(callback,frames){var obj={};obj.frames=frames;obj.current=0;obj.callback=callback;_callbacks.push(obj)}},"static");Class(function Render(){var _this=this;var _timer,_last,_timerName;var _render=[];var _time=Date.now();var _timeSinceRender=0;var rAF=window.requestAnimationFrame;this.TIME=Date.now();this.TARGET_FPS=60;(function(){if(!THREAD){rAF(render);Hydra.ready(addListeners)}}());function render(){var t=Date.now();var timeSinceLoad=t-_time;var diff=0;var fps=60;if(_last){diff=t-_last;fps=1e3/diff}_last=t;_this.FPS=fps;_this.TIME=t;_this.DELTA=diff;_this.TSL=timeSinceLoad;for(var i=_render.length-1;i>-1;i--){var callback=_render[i];if(!callback)continue;if(callback.fps){_timeSinceRender+=diff>200?0:diff;if(_timeSinceRender<1e3/callback.fps)continue;_timeSinceRender-=1e3/callback.fps}callback(t,timeSinceLoad,diff,fps,callback.frameCount++)}if(!THREAD)rAF(render)}function addListeners(){HydraEvents._addEvent(HydraEvents.BROWSER_FOCUS,focus,_this)}function focus(e){if(e.type=="focus"){_last=Date.now()}}this.startRender=this.start=function(callback,fps){var allowed=true;var count=_render.length-1;if(this.TARGET_FPS<60)fps=this.TARGET_FPS;if(typeof fps=="number")callback.fps=fps;callback.frameCount=0;if(_render.indexOf(callback)==-1)_render.push(callback)};this.stopRender=this.stop=function(callback){var i=_render.indexOf(callback);if(i>-1)_render.splice(i,1)};this.startTimer=function(name){_timerName=name||"Timer";if(console.time&&!window._NODE_)console.time(_timerName);else _timer=Date.now()};this.stopTimer=function(){if(console.time&&!window._NODE_)console.timeEnd(_timerName);else console.log("Render "+_timerName+": "+(Date.now()-_timer))};this.nextFrame=function(callback){Timer.create(callback,2)};this.tick=function(){if(!THREAD)return;render()};this.setRAF=function(fn){rAF=fn};this.onIdle=function(callback,max){if(window.requestIdleCallback){if(max)max={timeout:max};return window.requestIdleCallback(callback,max)}else{var start=_this.TIME;return defer(function(){callback({didTimeout:false,timeRemaining:function(){return Math.max(0,50-(_this.TIME-start))}})})}};window.defer=this.nextFrame;window.onIdle=this.onIdle},"Static");Class(function HydraEvents(){var _events=[];var _e={};this.BROWSER_FOCUS="hydra_focus";this.HASH_UPDATE="hydra_hash_update";this.COMPLETE="hydra_complete";this.PROGRESS="hydra_progress";this.UPDATE="hydra_update";this.LOADED="hydra_loaded";this.END="hydra_end";this.FAIL="hydra_fail";this.SELECT="hydra_select";this.ERROR="hydra_error";this.READY="hydra_ready";this.RESIZE="hydra_resize";this.CLICK="hydra_click";this.HOVER="hydra_hover";this.MESSAGE="hydra_message";this.ORIENTATION="orientation";this.BACKGROUND="background";this.BACK="hydra_back";this.PREVIOUS="hydra_previous";this.NEXT="hydra_next";this.RELOAD="hydra_reload";this.FULLSCREEN="hydra_fullscreen";this._checkDefinition=function(evt){if(typeof evt=="undefined"){throw"Undefined event"}};this._addEvent=function(e,callback,object){if(this._checkDefinition)this._checkDefinition(e);var add=new Object;add.evt=e;add.object=object;add.callback=callback;_events.push(add)};this._removeEvent=function(eventString,callback){if(this._checkDefinition)this._checkDefinition(eventString);defer(function(){for(var i=_events.length-1;i>-1;i--){if(_events[i].evt==eventString&&_events[i].callback==callback){_events[i]=null;_events.splice(i,1)}}})};this._destroyEvents=function(object){for(var i=_events.length-1;i>-1;i--){if(_events[i].object==object){_events[i]=null;_events.splice(i,1)}}};this._fireEvent=function(eventString,obj){if(this._checkDefinition)this._checkDefinition(eventString);var fire=true;obj=obj||_e;let called=false;for(var i=0;i<_events.length;i++){let evt=_events[i];if(evt.evt==eventString){if(fire){evt.callback(obj);called=true}else{return true}}}return called};this._consoleEvents=function(){console.log(_events)};this._saveLink=function(obj){if(!this.links)this.links=[];if(this.links.indexOf(obj)==-1)this.links.push(obj)};this.createLocalEmitter=function(child){var events=new HydraEvents;if(child){child.on=events._addEvent;child.off=events._removeEvent;child.fire=events._fireEvent;child.destroyEvents=events._destroyEvents}return events}},"Static");Class(function Events(_this){this.events={};var _events={};var _e={};var _emitter,_linked;this.events.subscribe=function(object,evt,callback){if(typeof object!=="object"){callback=evt;evt=object;object=null}if(object){if(!_linked)_linked=[];let emitter=object.events.emitter();emitter._addEvent(evt,!!callback.resolve?callback.resolve:callback,_this);emitter._saveLink(_this);_linked.push(emitter)}else{HydraEvents._addEvent(evt,!!callback.resolve?callback.resolve:callback,_this)}return callback};this.events.unsubscribe=function(object,evt,callback){if(typeof object!=="object"){callback=evt;evt=object;object=null}if(object)object.events.emitter()._removeEvent(evt,!!callback.resolve?callback.resolve:callback,_this);else HydraEvents._removeEvent(evt,!!callback.resolve?callback.resolve:callback)};this.events.fire=function(evt,obj,avoidGlobal){obj=obj||_e;HydraEvents._checkDefinition(evt);if(_emitter&&_emitter._fireEvent(evt,obj)){}else if(_events[evt]){obj.target=obj.target||_this;_events[evt](obj);obj.target=null}else if(!avoidGlobal){HydraEvents._fireEvent(evt,obj)}};this.events.add=function(evt,callback){HydraEvents._checkDefinition(evt);_events[evt]=!!callback.resolve?callback.resolve:callback;return callback};this.events.remove=function(evt){HydraEvents._checkDefinition(evt);if(_events[evt])delete _events[evt]};this.events.bubble=function(object,evt){HydraEvents._checkDefinition(evt);var _this=this;object.events.add(evt,function(e){_this.fire(evt,e)})};this.events.scope=function(ref){_this=ref};this.events.destroy=function(){HydraEvents._destroyEvents(_this);if(_linked)_linked.forEach(emitter=>emitter._destroyEvents(_this));if(_emitter&&_emitter.links)_emitter.links.forEach(obj=>obj.events&&obj.events._unlink(_emitter));_events=null;_this=null;return null};this.events.emitter=function(){if(!_emitter)_emitter=HydraEvents.createLocalEmitter();return _emitter};this.events.createEmitter=function(){HydraEvents.createLocalEmitter(_this)};this.events._unlink=function(emitter){_linked.findAndRemove(emitter)}});Class(function Dispatch(){var _this=this;var _callbacks={};var _instances={};function empty(){}this.register=function(object,method){defer(function(){_callbacks[Hydra.getClassName(object)+"-"+method]=object[method]})};this.instance=function(object){_instances[Hydra.getClassName(object)]=object};this.find=function(object,method,args){let name=object.toString().match(/function ([^\(]+)/)[1];if(!method)return _instances[name]||console.error(`No instance ${name} found`);let path=name+"-"+method;if(_callbacks[path]){return _callbacks[path]}else{delete _callbacks[path];return empty}}},"static");Class(function Mobile(){Inherit(this,Component);var _this=this;var _lastTime;var _cancelScroll=true;var _scrollTarget={};var _orientationPrevent,_type,_lastWidth;this.sleepTime=1e4;this.scrollTop=0;this.autoResizeReload=true;this.disableScrollManagement=false;Mobile.ScreenLock;if(Device.mobile){for(var b in Device.browser){Device.browser[b]=false}this.phone=Device.mobile.phone;this.tablet=Device.mobile.tablet;this.orientation=window.innerWidth>window.innerHeight?"landscape":"portrait";this.os=function(){if(Device.detect("windows","iemobile"))return"Windows";if(Device.detect(["ipad","iphone"]))return"iOS";if(Device.detect(["android","kindle"]))return"Android";if(Device.detect("blackberry"))return"Blackberry";return"Unknown"}();this.version=function(){try{if(_this.os=="iOS"){var num=Device.agent.split("os ")[1].split("_");var main=num[0];var sub=num[1].split(" ")[0];return Number(main+"."+sub)}if(_this.os=="Android"){var version=Device.agent.split("android ")[1].split(";")[0];if(version.length>3)version=version.slice(0,-2);if(version.charAt(version.length-1)==".")version=version.slice(0,-1);return Number(version)}if(_this.os=="Windows"){if(Device.agent.strpos("rv:11"))return 11;return Number(Device.agent.split("windows phone ")[1].split(";")[0])}}catch(e){}return-1}();this.browser=function(){if(_this.os=="iOS"){if(Device.detect(["twitter","fbios"]))return"Social";if(Device.detect("crios"))return"Chrome";if(Device.detect("safari"))return"Safari";return"Unknown"}if(_this.os=="Android"){if(Device.detect(["twitter","fb","facebook"]))return"Social";if(Device.detect("chrome"))return"Chrome";if(Device.detect("firefox"))return"Firefox";return"Browser"}if(_this.os=="Windows")return"IE";return"Unknown"}();if(this.os=="Android"&&this.browser=="Chrome"){this.browserVersion=Number(Device.agent.split("chrome/")[1].split(".")[0])}Hydra.ready(function(){window.addEventListener("orientationchange",orientationChange);window.onresize=resizeHandler;if(_this.browser=="Safari"&&(!_this.NativeCore||!_this.NativeCore.active)){document.body.scrollTop=0;__body.css({height:"101%"})}setHeight();_this.orientation=Stage.width>Stage.height?"landscape":"portrait";if(!(_this.NativeCore&&_this.NativeCore.active)){window.addEventListener("touchstart",touchStart,{passive:false})}else{Stage.css({overflow:"hidden"})}_type=_this.phone?"phone":"tablet";_lastWidth=Stage.width});function determineType(){}function setHeight(){Stage.width=document.body.clientWidth;Stage.height=document.body.clientHeight;if(Hydra.__offset){Stage.width-=Hydra.__offset.x;Stage.height-=Hydra.__offset.y;Stage.css({width:Stage.width,height:Stage.height})}if(_this.browser=="Social"&&_this.os=="iOS"){Stage.width=window.innerWidth;Stage.height=window.innerHeight}}function resizeHandler(){clearTimeout(_this.fireResize);if(!_this.allowScroll)document.body.scrollTop=0;_this.fireResize=_this.delayedCall(function(){setHeight();determineType();var type=_this.phone?"phone":"tablet";if((_this.os=="iOS"||_this.os=="Android"&&_this.version>=7)&&type!=_type&&_lastWidth!=Stage.width&&_this.autoResizeReload)window.location.reload();_this.orientation=window.innerWidth>window.innerHeight?"landscape":"portrait";_this.events.fire(HydraEvents.RESIZE);_lastWidth=Stage.width},32)}function orientationChange(){_this.events.fire(HydraEvents.ORIENTATION)}function touchStart(e){if(_this.disableScrollManagemenet)return;var touch=Utils.touchEvent(e);var target=e.target;var inputElement=target.nodeName=="INPUT"||target.nodeName=="TEXTAREA"||target.nodeName=="SELECT"||target.nodeName=="A";if(inputElement)return;if(_cancelScroll)return e.preventDefault();var prevent=true;target=e.target;while(target.parentNode){if(target._scrollParent){prevent=false;_scrollTarget.target=target;_scrollTarget.y=touch.y;target.hydraObject.__preventY=touch.y}target=target.parentNode}if(prevent)e.preventDefault()}}function checkTime(){var time=Date.now();if(_lastTime){if(time-_lastTime>_this.sleepTime){_this.events.fire(HydraEvents.BACKGROUND)}}_lastTime=time}this.Class=window.Class;this.fullscreen=function(){if(_this.NativeCore&&_this.NativeCore.active||navigator.platform&&navigator.platform.toLowerCase().strpos(["windows","mac"]))return;if(_this.os=="Android"){__window.bind("touchend",function(){Device.openFullscreen()});if(_this.orientationSet)_this.events.fire(HydraEvents.RESIZE);return true}return false};this.overflowScroll=function($object,dir){if(!Device.mobile)return false;var x=!!dir.x;var y=!!dir.y;var overflow={"-webkit-overflow-scrolling":"touch"};if(!x&&!y||x&&y)overflow.overflow="scroll";if(!x&&y){overflow.overflowY="scroll";overflow.overflowX="hidden"}if(x&&!y){overflow.overflowX="scroll";overflow.overflowY="hidden"}$object.css(overflow);$object.div._scrollParent=true;_cancelScroll=false;$object.div._preventEvent=function(e){if($object.maxScroll){var touch=Utils.touchEvent(e);var delta=touch.y-$object.__preventY<0?1:-1;if($object.div.scrollTop<2){if(delta==-1)e.preventDefault();else e.stopPropagation()}else if($object.div.scrollTop>$object.maxScroll-2){if(delta==1)e.preventDefault();else e.stopPropagation()}}else{e.stopPropagation()}};if(!_this.isNative())$object.div.addEventListener("touchmove",$object.div._preventEvent)};this.removeOverflowScroll=function($object){$object.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""});$object.div.removeEventListener("touchmove",$object.div._preventEvent)};this.setOrientation=function(type){if(_this.System&&_this.NativeCore.active){_this.System.orientation=_this.System[type.toUpperCase()];return}if(Device.mobile){_this.ScreenLock.lock(type)}_this.orientationSet=type};this.vibrate=function(time){navigator.vibrate&&navigator.vibrate(time)};this.isPWA=function(){if(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches)return true;if(window.navigator.standalone)return true;return false};this.isNative=function(){return _this.NativeCore&&_this.NativeCore.active}},"Static");Class(function Modules(){var _this=this;var _modules={};(function(){defer(exec)}());function exec(){for(var m in _modules){for(var key in _modules[m]){var module=_modules[m][key];if(module._ready)continue;module._ready=true;if(module.exec)module.exec()}}}function requireModule(root,path){var module=_modules[root];if(!module)throw`Module ${root} not found`;module=module[path];if(!module._ready){module._ready=true;if(module.exec)module.exec()}return module}this.push=function(module){};this.Module=function(module){var m=new module;var name=module.toString().slice(0,100).match(/function ([^\(]+)/);if(name){m._ready=true;name=name[1];_modules[name]={index:m}}else{if(!_modules[m.module])_modules[m.module]={};_modules[m.module][m.path]=m}};this.require=function(path){var root;if(!path.strpos("/")){root=path;path="index"}else{root=path.split("/")[0];path=path.replace(root+"/","")}return requireModule(root,path).exports};window.Module=this.Module;if(!window._NODE_||window.EJECTA){window.requireNative=window.require;window.require=this.require}},"Static");Class(function Color(_value,_a=1){Inherit(this,Component);var _this=this;var _hsl,_array;this.r=1;this.g=1;this.b=1;this.a=_a;(function(){set(_value)}());function set(value){if(value instanceof Color){copy(value)}else if(typeof value==="number"){setHex(value)}else if(Array.isArray(value)){setRGB(value)}else{setHex(Number("0x"+value.slice(1)))}}function copy(color){_this.r=color.r;_this.g=color.g;_this.b=color.b}function setHex(hex){hex=Math.floor(hex);_this.r=(hex>>16&255)/255;_this.g=(hex>>8&255)/255;_this.b=(hex&255)/255}function setRGB(values){_this.r=values[0];_this.g=values[1];_this.b=values[2]}function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*6*(2/3-t);return p}this.set=function(value){set(value);return this};this.setRGB=function(r,g,b){this.r=r;this.g=g;this.b=b;return this};this.setHSL=function(h,s,l){if(s===0){this.r=this.g=this.b=l}else{var p=l<=.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this};this.offsetHSL=function(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this};this.getStyle=function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"};this.getRGBA=function(){return"rgba("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+", "+this.a+")"};this.getHex=function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0};this.getHexString=function(){return"#"+("000000"+this.getHex().toString(16)).slice(-6)};this.getHSL=function(){_hsl=_hsl||{h:0,s:0,l:0};var hsl=_hsl;var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=lightness<=.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl};this.setAlpha=function(alpha){this.a=alpha};this.add=function(color){this.r+=color.r;this.g+=color.g;this.b+=color.b};this.mix=function(color,percent){this.r=this.r*(1-percent)+color.r*percent;this.g=this.g*(1-percent)+color.g*percent;this.b=this.b*(1-percent)+color.b*percent};this.addScalar=function(s){this.r+=s;this.g+=s;this.b+=s};this.multiply=function(color){this.r*=color.r;this.g*=color.g;this.b*=color.b};this.multiplyScalar=function(s){this.r*=s;this.g*=s;this.b*=s};this.clone=function(){return new Color([this.r,this.g,this.b])};this.toArray=function(){if(!_array)_array=[];_array[0]=this.r;_array[1]=this.g;_array[2]=this.b;return _array}});Class(function Noise(){var module=this;function Grad(x,y,z){this.x=x;this.y=y;this.z=z}Grad.prototype.dot2=function(x,y){return this.x*x+this.y*y};Grad.prototype.dot3=function(x,y,z){return this.x*x+this.y*y+this.z*z};var grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];var p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var perm=new Array(512);var gradP=new Array(512);module.seed=function(seed){if(seed>0&&seed<1){seed*=65536}seed=Math.floor(seed);if(seed<256){seed|=seed<<8}for(var i=0;i<256;i++){var v;if(i&1){v=p[i]^seed&255}else{v=p[i]^seed>>8&255}perm[i]=perm[i+256]=v;gradP[i]=gradP[i+256]=grad3[v%12]}};module.seed(0);var F2=.5*(Math.sqrt(3)-1);var G2=(3-Math.sqrt(3))/6;var F3=1/3;var G3=1/6;module.simplex2=function(xin,yin){var n0,n1,n2;var s=(xin+yin)*F2;var i=Math.floor(xin+s);var j=Math.floor(yin+s);var t=(i+j)*G2;var x0=xin-i+t;var y0=yin-j+t;var i1,j1;if(x0>y0){i1=1;j1=0}else{i1=0;j1=1}var x1=x0-i1+G2;var y1=y0-j1+G2;var x2=x0-1+2*G2;var y2=y0-1+2*G2;i&=255;j&=255;var gi0=gradP[i+perm[j]];var gi1=gradP[i+i1+perm[j+j1]];var gi2=gradP[i+1+perm[j+1]];var t0=.5-x0*x0-y0*y0;if(t0<0){n0=0}else{t0*=t0;n0=t0*t0*gi0.dot2(x0,y0)}var t1=.5-x1*x1-y1*y1;if(t1<0){n1=0}else{t1*=t1;n1=t1*t1*gi1.dot2(x1,y1)}var t2=.5-x2*x2-y2*y2;if(t2<0){n2=0}else{t2*=t2;n2=t2*t2*gi2.dot2(x2,y2)}return 70*(n0+n1+n2)};module.simplex3=function(xin,yin,zin){var n0,n1,n2,n3;var s=(xin+yin+zin)*F3;var i=Math.floor(xin+s);var j=Math.floor(yin+s);var k=Math.floor(zin+s);var t=(i+j+k)*G3;var x0=xin-i+t;var y0=yin-j+t;var z0=zin-k+t;var i1,j1,k1;var i2,j2,k2;if(x0>=y0){if(y0>=z0){i1=1;j1=0;k1=0;i2=1;j2=1;k2=0}else if(x0>=z0){i1=1;j1=0;k1=0;i2=1;j2=0;k2=1}else{i1=0;j1=0;k1=1;i2=1;j2=0;k2=1}}else{if(y0<z0){i1=0;j1=0;k1=1;i2=0;j2=1;k2=1}else if(x0<z0){i1=0;j1=1;k1=0;i2=0;j2=1;k2=1}else{i1=0;j1=1;k1=0;i2=1;j2=1;k2=0}}var x1=x0-i1+G3;var y1=y0-j1+G3;var z1=z0-k1+G3;var x2=x0-i2+2*G3;var y2=y0-j2+2*G3;var z2=z0-k2+2*G3;var x3=x0-1+3*G3;var y3=y0-1+3*G3;var z3=z0-1+3*G3;i&=255;j&=255;k&=255;var gi0=gradP[i+perm[j+perm[k]]];var gi1=gradP[i+i1+perm[j+j1+perm[k+k1]]];var gi2=gradP[i+i2+perm[j+j2+perm[k+k2]]];var gi3=gradP[i+1+perm[j+1+perm[k+1]]];var t0=.6-x0*x0-y0*y0-z0*z0;if(t0<0){n0=0}else{t0*=t0;n0=t0*t0*gi0.dot3(x0,y0,z0)}var t1=.6-x1*x1-y1*y1-z1*z1;if(t1<0){n1=0}else{t1*=t1;n1=t1*t1*gi1.dot3(x1,y1,z1)}var t2=.6-x2*x2-y2*y2-z2*z2;if(t2<0){n2=0}else{t2*=t2;n2=t2*t2*gi2.dot3(x2,y2,z2)}var t3=.6-x3*x3-y3*y3-z3*z3;if(t3<0){n3=0}else{t3*=t3;n3=t3*t3*gi3.dot3(x3,y3,z3)}return 32*(n0+n1+n2+n3)};function fade(t){return t*t*t*(t*(t*6-15)+10)}function lerp(a,b,t){return(1-t)*a+t*b}this.perlin=function(x){return module.perlin2(x,0)};this.perlin2=function(x,y){var X=Math.floor(x),Y=Math.floor(y);x=x-X;y=y-Y;X=X&255;Y=Y&255;var n00=gradP[X+perm[Y]].dot2(x,y);var n01=gradP[X+perm[Y+1]].dot2(x,y-1);var n10=gradP[X+1+perm[Y]].dot2(x-1,y);var n11=gradP[X+1+perm[Y+1]].dot2(x-1,y-1);var u=fade(x);return lerp(lerp(n00,n10,u),lerp(n01,n11,u),fade(y))};this.perlin3=function(x,y,z){var X=Math.floor(x),Y=Math.floor(y),Z=Math.floor(z);x=x-X;y=y-Y;z=z-Z;X=X&255;Y=Y&255;Z=Z&255;var n000=gradP[X+perm[Y+perm[Z]]].dot3(x,y,z);var n001=gradP[X+perm[Y+perm[Z+1]]].dot3(x,y,z-1);var n010=gradP[X+perm[Y+1+perm[Z]]].dot3(x,y-1,z);var n011=gradP[X+perm[Y+1+perm[Z+1]]].dot3(x,y-1,z-1);var n100=gradP[X+1+perm[Y+perm[Z]]].dot3(x-1,y,z);var n101=gradP[X+1+perm[Y+perm[Z+1]]].dot3(x-1,y,z-1);var n110=gradP[X+1+perm[Y+1+perm[Z]]].dot3(x-1,y-1,z);var n111=gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1,y-1,z-1);var u=fade(x);var v=fade(y);var w=fade(z);return lerp(lerp(lerp(n000,n100,u),lerp(n001,n101,u),w),lerp(lerp(n010,n110,u),lerp(n011,n111,u),w),v)}},"Static");Class(function Matrix2(){var _this=this;var prototype=Matrix2.prototype;var a11,a12,a13,a21,a22,a23,a31,a32,a33;var b11,b12,b13,b21,b22,b23,b31,b32,b33;this.type="matrix2";this.data=new Float32Array(9);(function(){identity()}());function identity(d){d=d||_this.data;d[0]=1,d[1]=0,d[2]=0;d[3]=0,d[4]=1,d[5]=0;d[6]=0,d[7]=0,d[8]=1}function noE(n){n=Math.abs(n)<.000001?0:n;return n}if(typeof prototype.identity!=="undefined")return;prototype.identity=function(d){identity(d);return this};prototype.transformVector=function(v){var d=this.data;var x=v.x;var y=v.y;v.x=d[0]*x+d[1]*y+d[2];v.y=d[3]*x+d[4]*y+d[5];return v};prototype.setTranslation=function(tx,ty,m){var d=m||this.data;d[0]=1,d[1]=0,d[2]=tx;d[3]=0,d[4]=1,d[5]=ty;d[6]=0,d[7]=0,d[8]=1;return this};prototype.getTranslation=function(v){var d=this.data;v=v||new Vector2;v.x=d[2];v.y=d[5];return v};prototype.setScale=function(sx,sy,m){var d=m||this.data;d[0]=sx,d[1]=0,d[2]=0;d[3]=0,d[4]=sy,d[5]=0;d[6]=0,d[7]=0,d[8]=1;return this};prototype.setShear=function(sx,sy,m){var d=m||this.data;d[0]=1,d[1]=sx,d[2]=0;d[3]=sy,d[4]=1,d[5]=0;d[6]=0,d[7]=0,d[8]=1;return this};prototype.setRotation=function(a,m){var d=m||this.data;var r0=Math.cos(a);var r1=Math.sin(a);d[0]=r0,d[1]=-r1,d[2]=0;d[3]=r1,d[4]=r0,d[5]=0;d[6]=0,d[7]=0,d[8]=1;return this};prototype.setTRS=function(tx,ty,a,sx,sy){var d=this.data;var r0=Math.cos(a);var r1=Math.sin(a);d[0]=r0*sx,d[1]=-r1*sy,d[2]=tx;d[3]=r1*sx,d[4]=r0*sy,d[5]=ty;d[6]=0,d[7]=0,d[8]=1;return this};prototype.translate=function(tx,ty){this.identity(Matrix2.__TEMP__);this.setTranslation(tx,ty,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.rotate=function(a){this.identity(Matrix2.__TEMP__);this.setTranslation(a,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.scale=function(sx,sy){this.identity(Matrix2.__TEMP__);this.setScale(sx,sy,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.shear=function(sx,sy){this.identity(Matrix2.__TEMP__);this.setRotation(sx,sy,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.multiply=function(m){var a=this.data;var b=m.data||m;a11=a[0],a12=a[1],a13=a[2];a21=a[3],a22=a[4],a23=a[5];a31=a[6],a32=a[7],a33=a[8];b11=b[0],b12=b[1],b13=b[2];b21=b[3],b22=b[4],b23=b[5];b31=b[6],b32=b[7],b33=b[8];a[0]=a11*b11+a12*b21+a13*b31;a[1]=a11*b12+a12*b22+a13*b32;a[2]=a11*b13+a12*b23+a13*b33;a[3]=a21*b11+a22*b21+a23*b31;a[4]=a21*b12+a22*b22+a23*b32;a[5]=a21*b13+a22*b23+a23*b33;return this};prototype.inverse=function(m){m=m||this;var a=m.data;var b=this.data;a11=a[0],a12=a[1],a13=a[2];a21=a[3],a22=a[4],a23=a[5];a31=a[6],a32=a[7],a33=a[8];var det=m.determinant();if(Math.abs(det)<1e-7){}var invdet=1/det;b[0]=(a22*a33-a32*a23)*invdet;b[1]=(a13*a32-a12*a33)*invdet;b[2]=(a12*a23-a13*a22)*invdet;b[3]=(a23*a31-a21*a33)*invdet;b[4]=(a11*a33-a13*a31)*invdet;b[5]=(a21*a13-a11*a23)*invdet;b[6]=(a21*a32-a31*a22)*invdet;b[7]=(a31*a12-a11*a32)*invdet;b[8]=(a11*a22-a21*a12)*invdet;return m};prototype.determinant=function(){var a=this.data;a11=a[0],a12=a[1],a13=a[2];a21=a[3],a22=a[4],a23=a[5];a31=a[6],a32=a[7],a33=a[8];return a11*(a22*a33-a32*a23)-a12*(a21*a33-a23*a31)+a13*(a21*a32*a22*a31)};prototype.copyTo=function(m){var a=this.data;var b=m.data||m;b[0]=a[0],b[1]=a[1],b[2]=a[2];b[3]=a[3],b[4]=a[4],b[5]=a[5];b[6]=a[6],b[7]=a[7],b[8]=a[8];return m};prototype.copyFrom=function(m){var a=this.data;var b=m.data||m;b[0]=a[0],b[1]=a[1],b[2]=a[2];b[3]=a[3],b[4]=a[4],b[5]=a[5];b[6]=a[6],b[7]=a[7],b[8]=a[8];return this};prototype.getCSS=function(force2D){var d=this.data;if(Device.tween.css3d&&!force2D){return"matrix3d("+noE(d[0])+", "+noE(d[3])+", 0, 0, "+noE(d[1])+", "+noE(d[4])+", 0, 0, 0, 0, 1, 0, "+noE(d[2])+", "+noE(d[5])+", 0, 1)"}else{return"matrix("+noE(d[0])+", "+noE(d[3])+", "+noE(d[1])+", "+noE(d[4])+", "+noE(d[2])+", "+noE(d[5])+")"}}},function(){Matrix2.__TEMP__=(new Matrix2).data});Class(function Vector2(_x,_y){var _this=this;var prototype=Vector2.prototype;this.x=typeof _x=="number"?_x:0;this.y=typeof _y=="number"?_y:0;this.type="vector2";if(typeof prototype.set!=="undefined")return;prototype.set=function(x,y){this.x=x;this.y=y;return this};prototype.clear=function(){this.x=0;this.y=0;return this};prototype.copyTo=function(v){v.x=this.x;v.y=this.y;return this};prototype.copyFrom=prototype.copy=function(v){this.x=v.x;this.y=v.y;return this};prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this};prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this};prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;return this};prototype.add=function(v){this.x+=v.x;this.y+=v.y;return this};prototype.sub=function(v){this.x-=v.x;this.y-=v.y;return this};prototype.multiply=function(v){this.x*=v;this.y*=v;return this};prototype.divide=function(v){this.x/=v;this.y/=v;return this};prototype.lengthSq=function(){return this.x*this.x+this.y*this.y||.00001};prototype.length=function(){return Math.sqrt(this.lengthSq())};prototype.setLength=function(length){this.normalize().multiply(length);return this};prototype.normalize=function(){var length=this.length();this.x/=length;this.y/=length;return this};prototype.perpendicular=function(a,b){var tx=this.x;var ty=this.y;this.x=-ty;this.y=tx;return this};prototype.lerp=function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this};prototype.interp=function(v,alpha,ease){var a=0;var f=TweenManager.Interpolation.convertEase(ease);var calc=Vector2.__TEMP__;calc.subVectors(this,v);var dist=Utils.clamp(Utils.range(calc.lengthSq(),0,5e3*5e3,1,0),0,1)*(alpha/10);if(typeof f==="function")a=f(dist);else a=TweenManager.Interpolation.solve(f,dist);this.x+=(v.x-this.x)*a;this.y+=(v.y-this.y)*a};prototype.setAngleRadius=function(a,r){this.x=Math.cos(a)*r;this.y=Math.sin(a)*r;return this};prototype.addAngleRadius=function(a,r){this.x+=Math.cos(a)*r;this.y+=Math.sin(a)*r;return this};prototype.clone=function(){return new Vector2(this.x,this.y)};prototype.dot=function(a,b){b=b||this;return a.x*b.x+a.y*b.y};prototype.distanceTo=function(v,noSq){var dx=this.x-v.x;var dy=this.y-v.y;if(!noSq)return Math.sqrt(dx*dx+dy*dy);return dx*dx+dy*dy};prototype.solveAngle=function(a,b){if(!b)b=this;return Math.atan2(a.y-b.y,a.x-b.x)};prototype.equals=function(v){return this.x==v.x&&this.y==v.y};prototype.console=function(){console.log(this.x,this.y)};prototype.toString=function(split){split=split||" ";return this.x+split+this.y}},function(){Vector2.__TEMP__=new Vector2;Vector2.__TEMP2__=new Vector2});Class(function Vector3(_x,_y,_z,_w){var _this=this;var prototype=Vector3.prototype;this.x=typeof _x==="number"?_x:0;this.y=typeof _y==="number"?_y:0;this.z=typeof _z==="number"?_z:0;this.w=typeof _w==="number"?_w:1;this.type="vector3";if(typeof prototype.set!=="undefined")return;prototype.set=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||1;return this};prototype.clear=function(){this.x=0;this.y=0;this.z=0;this.w=1;return this};prototype.copyTo=function(p){p.x=this.x;p.y=this.y;p.z=this.z;p.w=this.w;return p};prototype.copyFrom=prototype.copy=function(p){this.x=p.x||0;this.y=p.y||0;this.z=p.z||0;this.w=p.w||1;return this};prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z};prototype.length=function(){return Math.sqrt(this.lengthSq())};prototype.normalize=function(){var m=1/this.length();this.set(this.x*m,this.y*m,this.z*m);return this};prototype.setLength=function(length){this.normalize().multiply(length);return this};prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};prototype.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this};prototype.sub=function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this};prototype.multiply=function(v){this.x*=v;this.y*=v;this.z*=v;return this};prototype.divide=function(v){this.x/=v;this.y/=v;this.z/=v;return this};prototype.limit=function(max){if(this.length()>max){this.normalize();this.multiply(max)}};prototype.heading2D=function(){var angle=Math.atan2(-this.y,this.x);return-angle};prototype.lerp=function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this};prototype.deltaLerp=function(v,alpha,delta){delta=delta||1;for(var i=0;i<delta;i++){var f=alpha;this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha}return this};prototype.interp=function(v,alpha,ease,dist){if(!Vector3.__TEMP__)Vector3.__TEMP__=new Vector3;dist=dist||5e3;var a=0;var f=TweenManager.Interpolation.convertEase(ease);var calc=Vector3.__TEMP__;calc.subVectors(this,v);var dist=Utils.clamp(Utils.range(calc.lengthSq(),0,dist*dist,1,0),0,1)*(alpha/10);if(typeof f==="function")a=f(dist);else a=TweenManager.Interpolation.solve(f,dist);this.x+=(v.x-this.x)*a;this.y+=(v.y-this.y)*a;this.z+=(v.z-this.z)*a};prototype.setAngleRadius=function(a,r){this.x=Math.cos(a)*r;this.y=Math.sin(a)*r;this.z=Math.sin(a)*r;return this};prototype.addAngleRadius=function(a,r){this.x+=Math.cos(a)*r;this.y+=Math.sin(a)*r;this.z+=Math.sin(a)*r;return this};prototype.dot=function(a,b){b=b||this;return a.x*b.x+a.y*b.y+a.z*b.z};prototype.clone=function(){return new Vector3(this.x,this.y,this.z)};prototype.cross=function(a,b){if(!b)b=this;var x=a.y*b.z-a.z*b.y;var y=a.z*b.x-a.x*b.z;var z=a.x*b.y-a.y*b.x;this.set(x,y,z,this.w);return this};prototype.distanceTo=function(v,noSq){var dx=this.x-v.x;var dy=this.y-v.y;var dz=this.z-v.z;if(!noSq)return Math.sqrt(dx*dx+dy*dy+dz*dz);return dx*dx+dy*dy+dz*dz};prototype.solveAngle=function(a,b){if(!b)b=this;return Math.acos(a.dot(b)/(a.length()*b.length()||.00001))};prototype.solveAngle2D=function(a,b){if(!b)b=this;Vector2.__TEMP__.copy(a);Vector2.__TEMP2__.copy(b);return Vector2.__TEMP__.solveAngle(Vector2.__TEMP2__)};prototype.equals=function(v){return this.x==v.x&&this.y==v.y&&this.z==v.z};prototype.console=function(){console.log(this.x,this.y,this.z)};prototype.toString=function(split){split=split||" ";return this.x+split+this.y+split+this.z};prototype.applyQuaternion=function(q){var x=this.x,y=this.y,z=this.z;var qx=q.x,qy=q.y,qz=q.z,qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this}},function(){Vector3.__TEMP__=new Vector3});Mobile.Class(function Accelerometer(){var _this=this;this.x=0;this.y=0;this.z=0;this.alpha=0;this.beta=0;this.gamma=0;this.heading=0;this.rotationRate={};this.rotationRate.alpha=0;this.rotationRate.beta=0;this.rotationRate.gamma=0;this.toRadians=Mobile.os=="iOS"?Math.PI/180:1;HydraEvents.createLocalEmitter(this);function updateAccel(e){switch(window.orientation){case 0:_this.x=-e.accelerationIncludingGravity.x;_this.y=e.accelerationIncludingGravity.y;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=e.rotationRate.beta*_this.toRadians;_this.rotationRate.beta=-e.rotationRate.alpha*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case 180:_this.x=e.accelerationIncludingGravity.x;_this.y=-e.accelerationIncludingGravity.y;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=-e.rotationRate.beta*_this.toRadians;_this.rotationRate.beta=e.rotationRate.alpha*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case 90:_this.x=e.accelerationIncludingGravity.y;_this.y=e.accelerationIncludingGravity.x;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=e.rotationRate.alpha*_this.toRadians;_this.rotationRate.beta=e.rotationRate.beta*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case-90:_this.x=-e.accelerationIncludingGravity.y;_this.y=-e.accelerationIncludingGravity.x;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=-e.rotationRate.alpha*_this.toRadians;_this.rotationRate.beta=-e.rotationRate.beta*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break}if(Mobile.os=="Android"){_this.x*=-1;_this.y*=-1;_this.z*=-1}_this.fire("motion",null)}function updateOrientation(e){for(var key in e){if(key.toLowerCase().strpos("heading"))_this.heading=e[key]}switch(window.orientation){case 0:_this.alpha=e.beta*_this.toRadians;_this.beta=-e.alpha*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case 180:_this.alpha=-e.beta*_this.toRadians;_this.beta=e.alpha*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case 90:_this.alpha=e.alpha*_this.toRadians;_this.beta=e.beta*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case-90:_this.alpha=-e.alpha*_this.toRadians;_this.beta=-e.beta*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break}_this.tilt=e.beta*_this.toRadians;_this.yaw=e.alpha*_this.toRadians;_this.roll=-e.gamma*_this.toRadians;if(Mobile.os=="Android")_this.heading=compassHeading(e.alpha,e.beta,e.gamma);_this.fire("orientation",null)}function compassHeading(alpha,beta,gamma){var degtorad=Math.PI/180;var _x=beta?beta*degtorad:0;var _y=gamma?gamma*degtorad:0;var _z=alpha?alpha*degtorad:0;var cX=Math.cos(_x);var cY=Math.cos(_y);var cZ=Math.cos(_z);var sX=Math.sin(_x);var sY=Math.sin(_y);var sZ=Math.sin(_z);var Vx=-cZ*sY-sZ*sX*cY;var Vy=-sZ*sY+cZ*sX*cY;var compassHeading=Math.atan(Vx/Vy);if(Vy<0){compassHeading+=Math.PI}else if(Vx<0){compassHeading+=2*Math.PI}return compassHeading*(180/Math.PI)}this.capture=function(){if(!this.active){this.active=true;window.ondevicemotion=updateAccel;window.addEventListener("deviceorientation",updateOrientation)}};this.stop=function(){this.active=false;window.ondevicemotion=null;_this.x=_this.y=_this.z=0;window.removeEventListener("deviceorientation",updateOrientation)}},"Static");Mobile.Class(function ScreenLock(){Inherit(this,Component);var _this=this;var _lockedNodes=[];(function(){addListeners()}());function addListeners(){_this.events.subscribe(HydraEvents.RESIZE,orientationChange)}function orientationChange(){var width=document.body.clientWidth;var height=document.body.clientHeight;_lockedNodes.forEach(function(e){if((Device.getFullscreen()||Mobile.isPWA())&&window.screen&&window.screen.orientation.lock){window.screen.orientation.lock(e.orientation=="portrait"?"portrait":"landscape");if(!Mobile.ScreenLock.FORCE_LOCK)return;e.object.size(width,height);e.object.div.style.transformOrigin="";e.object.div.style.transform="";return}if(!Mobile.ScreenLock.FORCE_LOCK)return;if(width<height){e.object.size(width,height);e.object.div.style.transformOrigin="";e.object.div.style.transform=""}else{var w=width;var h=height;width=Math.max(w,h);height=Math.min(w,h);e.object.size(height,width);e.object.div.style.transformOrigin="0% 0%";if(window.orientation==-90||window.orientation==180){e.object.div.style.transform="translateX("+width+"px) rotate(90deg)"}else{e.object.div.style.transform="translateY("+height+"px) rotate(-90deg)"}}})}this.lock=function(orientation){_lockedNodes.push({object:Stage,orientation:orientation});orientationChange()};this.unlock=function(){var obj=Stage;_lockedNodes.every(function(o,i){if(o.object==obj){_lockedNodes.splice(i,1);return false}return true})};this.forceOrientationChange=orientationChange},"static");Class(function Interaction(){Namespace(this);this.CLICK="interaction_click";this.START="interaction_start";this.MOVE="interaction_move";this.END="interaction_end"},"static");Interaction.Class(function Input(_object){Inherit(this,Component);var _this=this;var _hold=new Vector2;var _diff=new Vector2;var _lastMove=new Vector2;var _distance=new Vector2;var _delta=Render.TIME;var _lastTime=Render.TIME;this.velocity=new Vector2;this.clickLimit=20;this.requireDrag=true;(function(){if(_object instanceof HydraObject)addListeners()}());function addListeners(){if(_object==Stage||_object==__window)Interaction.Input.bind("touchstart",touchStart);else _object.bind("touchstart",touchStart);Interaction.Input.bind("touchmove",touchMove);Interaction.Input.bind("touchend",touchEnd)}function touchStart(e){_this.touching=true;_this.velocity.clear();_distance.clear();_hold.copyFrom(e);_lastMove.copyFrom(e);_this.events.fire(Interaction.START,e,true)}function touchMove(e){if(_this.requireDrag&&!_this.touching)return;_diff.subVectors(e,_hold);_delta=Render.TIME-_lastTime||.01;if(_delta>=16){_this.velocity.subVectors(e,_lastMove);_distance.x+=Math.abs(_this.velocity.x);_distance.y+=Math.abs(_this.velocity.y);_this.velocity.divide(_delta);_lastTime=Render.TIME;_lastMove.copyFrom(e)}e.delta=_diff;_this.events.fire(Interaction.MOVE,e,true)}function touchEnd(e){if(_this.requireDrag&&!_this.touching)return;_this.touching=false;_this.events.fire(Interaction.END,e,true);if(_distance.length()<_this.clickLimit){_this.events.fire(Interaction.CLICK,e,true)}}this.attach=function(object){if(_object instanceof HydraObject)_object.unbind("touchstart",touchStart);_object=object;addListeners()};this.touchStart=function(e){touchStart({x:Mouse.x,y:Mouse.y})};this.end=this.touchEnd=function(){touchEnd()};this.set("onStart",callback=>{_this.events.add(Interaction.START,callback);console.warn("Interaction.Input::onStart has switched to Interaction.START Hydra event")});this.set("onUpdate",callback=>{_this.events.add(Interaction.MOVE,callback);console.warn("Interaction.Input::onUpdate has switched to Interaction.MOVE Hydra event; diff is now e.delta")});this.set("onEnd",callback=>{_this.events.add(Interaction.END,callback);console.warn("Interaction.Input::onEnd has switched to Interaction.END Hydra event")});this.set("onClick",callback=>{_this.events.add(Interaction.CLICK,callback);console.warn("Interaction.Input::onClick has switched to Interaction.CLICK Hydra event")});this.destroy=function(){Interaction.Input.unbind("touchmove",touchMove);Interaction.Input.unbind("touchstart",touchStart);Interaction.Input.unbind("touchend",touchEnd);_object&&_object.unbind&&_object.unbind("touchstart",touchStart);return this._destroy&&this._destroy()}},()=>{var _events={touchstart:[],touchmove:[],touchend:[]};var _bound;function bind(){_bound=true;__window.bind("touchstart",touchStart);__window.bind("touchmove",touchMove);__window.bind("touchend",touchEnd);__window.bind("touchcancel",touchEnd);__window.bind("contextmenu",touchEnd)}function touchMove(e){_events.touchmove.forEach(function(callback){callback(e)})}function touchStart(e){_events.touchstart.forEach(function(callback){callback(e)})}function touchEnd(e){_events.touchend.forEach(function(callback){callback(e)})}Interaction.Input.bind=function(evt,callback){_events[evt].push(callback);if(!_bound)bind()};Interaction.Input.unbind=function(evt,callback){_events[evt].findAndRemove(callback)}});Class(function ParticlePhysics(_integrator){Inherit(this,Component);var _this=this;_integrator=_integrator||new EulerIntegrator;var _timestep=1/60;var _time=0;var _step=0;var _clock=null;var _buffer=0;var _toDelete=[];this.friction=1;this.maxSteps=1;this.emitters=new LinkedList;this.initializers=new LinkedList;this.behaviors=new LinkedList;this.particles=new LinkedList;this.springs=new LinkedList;function init(p){var i=_this.initializers.start();while(i){i(p);i=_this.initializers.next()}}function updateSprings(dt){var s=_this.springs.start();while(s){s.update(dt);s=_this.springs.next()}}function deleteParticles(){for(var i=_toDelete.length-1;i>-1;i--){var particle=_toDelete[i];_this.particles.remove(particle);particle.system=null}_toDelete.length=0}function updateParticles(dt){var index=0;var p=_this.particles.start();while(p){if(p.enabled){var b=_this.behaviors.start();while(b){b.applyBehavior(p,dt,index);b=_this.behaviors.next()}if(p.behaviors.length)p.update(dt,index)}index++;p=_this.particles.next()}}function integrate(dt){updateParticles(dt);if(_this.springs.length)updateSprings(dt);if(!_this.skipIntegration)_integrator.integrate(_this.particles,dt,_this.friction)}this.addEmitter=function(emitter){if(!emitter.emit)throw"Emitter must be Emitter";this.emitters.push(emitter);emitter.parent=emitter.system=this};this.removeEmitter=function(emitter){if(!emitter.emit)throw"Emitter must be Emitter";this.emitters.remove(emitter);emitter.parent=emitter.system=null};this.addInitializer=function(init){if(typeof init!=="function")throw"Initializer must be a function";this.initializers.push(init)};this.removeInitializer=function(init){this.initializers.remove(init)};this.addBehavior=function(b){this.behaviors.push(b);b.system=this};this.removeBehavior=function(b){this.behaviors.remove(b)};this.addParticle=function(p){if(!_integrator.type){if(typeof p.pos.z==="number")_integrator.type="3D";else _integrator.type="2D"}p.system=this;this.particles.push(p);if(this.initializers.length)init(p)};this.removeParticle=function(p){p.system=null;_toDelete.push(p)};this.addSpring=function(s){s.system=this;this.springs.push(s)};this.removeSpring=function(s){s.system=null;this.springs.remove(s)};this.update=function(force){if(!_clock)_clock=THREAD?Date.now():Render.TIME;var time=THREAD?Date.now():Render.TIME;var delta=time-_clock;if(!force&&delta<=0)return;delta*=.001;_clock=time;_buffer+=delta;if(!force){var i=0;while(_buffer>=_timestep&&i++<_this.maxSteps){integrate(_timestep);_buffer-=_timestep;_time+=_timestep}}else{integrate(.016)}_step=Date.now()-time;if(_toDelete.length)deleteParticles()}});Class(function Particle(_pos,_mass,_radius){var _this=this;var _vel,_acc,_old;var prototype=Particle.prototype;this.mass=_mass||1;this.massInv=1/this.mass;this.enabled=true;this.radius=_radius||1;this.radiusSq=this.radius*this.radius;this.behaviors=new LinkedList;this.fixed=false;(function(){initVectors()}());function initVectors(){var Vector=typeof _pos.z==="number"?Vector3:Vector2;_pos=_pos||new Vector;_vel=new Vector;_acc=new Vector;_old={};_old.pos=new Vector;_old.acc=new Vector;_old.vel=new Vector;_old.pos.copyFrom(_pos);_this.pos=_this.position=_pos;_this.vel=_this.velocity=_vel;_this.acc=_this.acceleration=_acc;_this.old=_old}this.moveTo=function(pos){_pos.copyFrom(pos);_old.pos.copyFrom(_pos);_acc.clear();_vel.clear()};if(typeof prototype.setMass!=="undefined")return;prototype.setMass=function(mass){this.mass=mass||1;this.massInv=1/this.mass};prototype.setRadius=function(radius){this.radius=radius;this.radiusSq=radius*radius};prototype.update=function(dt){if(!this.behaviors.length)return;var b=this.behaviors.start();while(b){b.applyBehavior(this,dt);b=this.behaviors.next()}};prototype.applyForce=function(force){this.acc.add(force)};prototype.addBehavior=function(behavior){if(!behavior||typeof behavior.applyBehavior==="undefined")throw"Behavior must have applyBehavior method";this.behaviors.push(behavior)};prototype.removeBehavior=function(behavior){if(!behavior||typeof behavior.applyBehavior==="undefined")throw"Behavior must have applyBehavior method";this.behaviors.remove(behavior)}});Class(function EulerIntegrator(){Inherit(this,Component);var _this=this;var _vel,_accel;this.useDeltaTime=false;(function(){}());function createVectors(){var Vector=_this.type=="3D"?Vector3:Vector2;_vel=new Vector;_accel=new Vector}this.integrate=function(particles,dt,drag){if(!_vel)createVectors();var dtSq=dt*dt;var p=particles.start();while(p){if(!p.fixed&&!p.disabled){p.old.pos.copyFrom(p.pos);p.acc.multiply(p.massInv);_vel.copyFrom(p.vel);_accel.copyFrom(p.acc);if(this.useDeltaTime){p.pos.add(_vel.multiply(dt)).add(_accel.multiply(.5*dtSq));p.vel.add(p.acc.multiply(dt))}else{p.pos.add(_vel).add(_accel.multiply(.5));p.vel.add(p.acc)}if(drag)p.vel.multiply(drag);p.acc.clear()}if(p.saveTo)p.pos.copyTo(p.saveTo);p=particles.next()}}});Class(function Gravity(_force){Inherit(this,Component);var _this=this;this.force=_force;if(!_force)throw"Gravity requires parameter Vector";this.applyBehavior=function(p,dt){p.vel.add(_force)}});Class(function Emitter(_position,_startNumber){Inherit(this,Component);var _this=this;var _pool;var _total=0;var Vector=_position.type=="vector3"?Vector3:Vector2;this.initializers=[];this.position=_position;this.autoEmit=1;this.persist=true;(function(){initObjectPool();if(_startNumber!=0)addParticles(_startNumber||100)}());function initObjectPool(){_pool=_this.initClass(ObjectPool);_this.pool=_pool}function addParticles(total){_total+=total;var particles=[];for(var i=0;i<total;i++){particles.push(new Particle)}_pool.insert(particles)}this.addInitializer=function(callback){if(typeof callback!=="function")throw"Initializer must be a function";this.initializers.push(callback)};this.removeInitializer=function(callback){var index=this.initializers.indexOf(callback);if(index>-1)this.initializers.splice(index,1)};this.emit=function(num){if(!this.parent)throw"Emitter needs to be added to a System";num=num||this.autoEmit;for(var i=0;i<num;i++){var p=_pool.get();if(!p)return;p.moveTo(this.position);p.emitter=this;p.enabled=true;if(!p.system)this.parent.addParticle(p);for(var j=0;j<this.initializers.length;j++){this.initializers[j](p,i/num)}}};this.remove=function(particle){_pool.put(particle);if(!_this.persist)_this.parent.removeParticle(particle);particle.enabled=false};this.mix=function(){for(var i=0;i<6;i++)Utils.shuffleArray(_pool.array)};this.addToPool=function(particle){_pool.put(particle);if(!_this.persist&&particle.system)_this.parent.removeParticle(particle);particle.enabled=false}});Class(function SplitTextfield(){var _style={display:"block",position:"relative",padding:0,margin:0,cssFloat:"left",styleFloat:"left",width:"auto",height:"auto"};function splitLetter($obj){var _array=[];var text=$obj.div.innerHTML;var split=text.split("");$obj.div.innerHTML="";for(var i=0;i<split.length;i++){if(split[i]==" ")split[i]="&nbsp;";var letter=$("t","span");letter.html(split[i],true).css(_style);_array.push(letter);$obj.addChild(letter)}return _array}function splitWord($obj){var _array=[];var text=$obj.div.innerHTML;var split=text.split(" ");$obj.empty();for(var i=0;i<split.length;i++){var word=$("t","span");var empty=$("t","span");word.html(split[i]).css(_style);empty.html("&nbsp",true).css(_style);_array.push(word);_array.push(empty);$obj.addChild(word);$obj.addChild(empty)}return _array}this.split=function($obj,by){if(by=="word")return splitWord($obj);else return splitLetter($obj)}},"Static");Class(function CSSAnimation(){Inherit(this,Component);var _this=this;var _name="a"+Utils.timestamp();var _frames,_timer,_started;var _duration=1e3;var _ease="linear";var _delay=0;var _loop=false;var _count=1;var _steps=null;var _applyTo=[];(function(){}());function complete(){_this.playing=false;if(_this.events)_this.events.fire(HydraEvents.COMPLETE,null,true)}function updateCSS(){var css=CSS._read();var id="/*"+_name+"*/";var keyframe="@"+Device.vendor+"keyframes "+_name+" {\n";var string=id+keyframe;if(css.strpos(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}var steps=_frames.length-1;var perc=Math.round(100/steps);var total=0;for(var i=0;i<_frames.length;i++){var frame=_frames[i];if(i==_frames.length-1)total=100;string+=(frame.percent||total)+"% {\n";var hasTransform=false;var transforms={};var styles={};for(var key in frame){if(TweenManager.checkTransform(key)){transforms[key]=frame[key];hasTransform=true}else{styles[key]=frame[key]}}if(hasTransform){string+=Device.vendor+"transform: "+TweenManager.parseTransform(transforms)+";"}for(key in styles){var val=styles[key];if(typeof val!=="string"&&key!="opacity"&&key!="zIndex")val+="px";string+=CSS._toCSS(key)+": "+val+";"}string+="\n}\n";total+=perc}string+="}"+id;css+=string;CSS._write(css)}function destroy(){var css=CSS._read();var id="/*"+_name+"*/";if(css.strpos(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}CSS._write(css)}function applyTo(callback){for(var i=_applyTo.length-1;i>-1;i--)callback(_applyTo[i])}this.set("frames",function(frames){_frames=frames;updateCSS()});this.set("steps",function(steps){_steps=steps;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]="steps("+steps+")"})}});this.set("duration",function(duration){_duration=Math.round(duration);if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDuration")]=_this.duration+"ms"})}});this.get("duration",function(){return _duration});this.set("ease",function(ease){_ease=ease;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]=TweenManager.getEase(_ease)})}});this.get("ease",function(){return _ease});this.set("loop",function(loop){_loop=loop;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}});this.get("loop",function(){return _loop});this.set("count",function(count){_count=count;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}});this.get("count",function(){return _count});this.set("delay",function(delay){_delay=delay;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDelay")]=_delay+"ms"})}});this.get("delay",function(){return _delay});this.play=function(){applyTo(function($obj){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager.getEase(_ease))+" "+(_loop?"infinite":_count);$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})});_this.playing=true;clearTimeout(_timer);if(!_this.loop){_started=Date.now();_timer=_this.delayedCall(complete,_count*_duration)}};this.pause=function(){_this.playing=false;clearTimeout(_timer);applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationPlayState")]="paused"})};this.stop=function(){_this.playing=false;clearTimeout(_timer);applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationName")]=""})};this.applyTo=function($obj){_applyTo.push($obj);if(_this.playing){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager.getEase(_ease))+" "+(_loop?"infinite":_count);$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})}};this.remove=function($obj){$obj.div.style[CSS.prefix("AnimationName")]="";var i=_applyTo.indexOf($obj);if(i>-1)_applyTo.splice(i,1)};this.destroy=function(){if(!this._destroy)return;this.stop();_frames=null;destroy();return this._destroy()}});Class(function TweenManager(){Namespace(this);var _this=this;var _tweens=[];(function(){if(window.Hydra)Hydra.ready(initPools);if(window.Render)Render.startRender(updateTweens)}());function initPools(){_this._dynamicPool=new ObjectPool(DynamicObject,100);_this._arrayPool=new ObjectPool(Array,100);_this._dynamicPool.debug=true}function updateTweens(time){for(var i=0;i<_tweens.length;i++){let tween=_tweens[i];if(tween.update)tween.update(time);else _this._removeMathTween(tween)}}function stringToValues(str){var values=str.split("(")[1].slice(0,-1).split(",");for(var i=0;i<values.length;i++)values[i]=parseFloat(values[i]);return values}function findEase(name){var eases=_this.CSSEases;for(var i=eases.length-1;i>-1;i--){if(eases[i].name==name){return eases[i]}}return false}this._addMathTween=function(tween){_tweens.push(tween)};this._removeMathTween=function(tween){_tweens.findAndRemove(tween)};this._detectTween=function(object,props,time,ease,delay,callback){if(ease==="spring"){return new SpringTween(object,props,time,ease,delay,callback)}if(!_this.useCSSTrans(props,ease,object)){return new FrameTween(object,props,time,ease,delay,callback)}else{if(Device.tween.webAnimation){return new CSSWebAnimation(object,props,time,ease,delay,callback)}else{return new CSSTransition(object,props,time,ease,delay,callback)}}};this.tween=function(obj,props,time,ease,delay,complete,update,manual){if(typeof delay!=="number"){update=complete;complete=delay;delay=0}var tween;if(ease==="spring"){tween=new SpringTween(obj,props,time,ease,delay,update,complete)}else{tween=new MathTween(obj,props,time,ease,delay,update,complete,manual)}var usePromise=null;if(complete&&complete instanceof Promise){usePromise=complete;complete=complete.resolve}return usePromise||tween};this.iterate=function(array,props,time,ease,offset,delay,callback){if(typeof delay!=="number"){callback=delay;delay=0}props=new DynamicObject(props);if(!array.length)throw"TweenManager.iterate :: array is empty";var len=array.length;for(var i=0;i<len;i++){var obj=array[i];var complete=i==len-1?callback:null;obj.tween(props.copy(),time,ease,delay+offset*i,complete)}};this.clearTween=function(obj){if(obj._mathTween&&obj._mathTween.stop)obj._mathTween.stop();if(obj._mathTweens){var tweens=obj._mathTweens;for(var i=0;i<tweens.length;i++){var tw=tweens[i];if(tw&&tw.stop)tw.stop()}obj._mathTweens=null}};this.clearCSSTween=function(obj){if(obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween){obj.div.style[Device.styles.vendorTransition]="";obj.div._transition=false;obj._cssTween=null}};this.checkTransform=function(key){var index=_this.Transforms.indexOf(key);return index>-1};this.addCustomEase=function(ease){var add=true;if(typeof ease!=="object"||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CSSEases.length-1;i>-1;i--){if(ease.name==_this.CSSEases[i].name){add=false}}if(add){if(ease.curve.charAt(0).toLowerCase()=="m")ease.path=new EasingPath(ease.curve);else ease.values=stringToValues(ease.curve);_this.CSSEases.push(ease)}return ease};this.getEase=function(name,values){if(Array.isArray(name)){var c1=findEase(name[0]);var c2=findEase(name[1]);if(!c1||!c2)throw"Multi-ease tween missing values "+JSON.stringify(name);if(!c1.values)c1.values=stringToValues(c1.curve);if(!c2.values)c2.values=stringToValues(c2.curve);if(values)return[c1.values[0],c1.values[1],c2.values[2],c2.values[3]];return"cubic-bezier("+c1.values[0]+","+c1.values[1]+","+c2.values[2]+","+c2.values[3]+")"}else{var ease=findEase(name);if(!ease)return false;if(values){return ease.path?ease.path.solve:ease.values}else{return ease.curve}}};this.inspectEase=function(name){return findEase(name)};this.getAllTransforms=function(object){var obj={};for(var i=_this.Transforms.length-1;i>-1;i--){var tf=_this.Transforms[i];var val=object[tf];if(val!==0&&typeof val==="number"){obj[tf]=val}}return obj};this.parseTransform=function(props){var transforms="";var translate="";if(props.perspective>0)transforms+="perspective("+props.perspective+"px)";if(typeof props.x!=="undefined"||typeof props.y!=="undefined"||typeof props.z!=="undefined"){var x=props.x||0;var y=props.y||0;var z=props.z||0;translate+=x+"px, ";translate+=y+"px";if(Device.tween.css3d){translate+=", "+z+"px";transforms+="translate3d("+translate+")"}else{transforms+="translate("+translate+")"}}if(typeof props.scale!=="undefined"){transforms+="scale("+props.scale+")"}else{if(typeof props.scaleX!=="undefined")transforms+="scaleX("+props.scaleX+")";if(typeof props.scaleY!=="undefined")transforms+="scaleY("+props.scaleY+")"}if(typeof props.rotation!=="undefined")transforms+="rotate("+props.rotation+"deg)";if(typeof props.rotationX!=="undefined")transforms+="rotateX("+props.rotationX+"deg)";if(typeof props.rotationY!=="undefined")transforms+="rotateY("+props.rotationY+"deg)";if(typeof props.rotationZ!=="undefined")transforms+="rotateZ("+props.rotationZ+"deg)";if(typeof props.skewX!=="undefined")transforms+="skewX("+props.skewX+"deg)";if(typeof props.skewY!=="undefined")transforms+="skewY("+props.skewY+"deg)";return transforms};this.interpolate=function(num,alpha,ease){var fn=_this.Interpolation.convertEase(ease);return num*(typeof fn=="function"?fn(alpha):_this.Interpolation.solve(fn,alpha))};this.interpolateValues=function(start,end,alpha,ease){var fn=_this.Interpolation.convertEase(ease);return start+(end-start)*(typeof fn=="function"?fn(alpha):_this.Interpolation.solve(fn,alpha))}},"Static");(function(){TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"];TweenManager.CSSEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}];TweenManager.useCSSTrans=function(props,ease,object){if(props.math)return false;if(typeof ease==="string"&&(ease.strpos("Elastic")||ease.strpos("Bounce")))return false;if(object.multiTween||TweenManager.inspectEase(ease).path)return false;if(!Device.tween.transition)return false;return true}}());Class(function CSSTransition(_object,_props,_time,_ease,_delay,_callback){var _this=this;var _transformProps,_transitionProps,_stack,_totalStacks;var _startTransform,_startProps;this.playing=true;(function(){if(typeof _time!=="number")throw"CSSTween Requires object, props, time, ease";initProperties();if(typeof _ease=="object"&&!Array.isArray(_ease))initStack();else initCSSTween()}());function killed(){return!_this||_this.kill||!_object||!_object.div}function initProperties(){var transform=TweenManager.getAllTransforms(_object);var properties=[];for(var key in _props){if(TweenManager.checkTransform(key)){transform.use=true;transform[key]=_props[key];delete _props[key]}else{if(typeof _props[key]==="number"||key.strpos("-"))properties.push(key)}}if(transform.use)properties.push(Device.transformProperty);delete transform.use;_transformProps=transform;_transitionProps=properties}function initStack(){initStart();var prevTime=0;var interpolate=function(start,end,alpha,ease,prev,ke){var last=prev[key];if(last)start+=last;return TweenManager.interpolateValues(start,end,alpha,ease)};_stack=[];_totalStacks=0;for(var p in _ease){var perc=p.strpos("%")?Number(p.replace("%",""))/100:(Number(p)+1)/_ease.length;if(isNaN(perc))continue;var ease=_ease[p];_totalStacks++;var transform={};var props={};var last=_stack[_stack.length-1];var pr=last?last.props:{};var zeroOut=!last;for(var key in _transformProps){if(!_startTransform[key])_startTransform[key]=key.strpos("scale")?1:0;transform[key]=interpolate(_startTransform[key],_transformProps[key],perc,ease,pr,key);if(zeroOut)pr[key]=_startTransform[key]}for(key in _props){props[key]=interpolate(_startProps[key],_props[key],perc,ease,pr,key);if(zeroOut)pr[key]=_startProps[key]}var time=perc*_time-prevTime;prevTime+=time;_stack.push({percent:perc,ease:ease,transform:transform,props:props,delay:_totalStacks==1?_delay:0,time:time})}initCSSTween(_stack.shift())}function initStart(){_startTransform=TweenManager.getAllTransforms(_object);var transform=TweenManager.parseTransform(_startTransform);if(!transform.length){for(var i=TweenManager.Transforms.length-1;i>-1;i--){var key=TweenManager.Transforms[i];_startTransform[key]=key=="scale"?1:0}}_startProps={};for(key in _props){_startProps[key]=_object.css(key)}}function initCSSTween(values){if(killed())return;if(_object._cssTween)_object._cssTween.kill=true;_object._cssTween=_this;_object.div._transition=true;var strings=function(){if(!values){return buildStrings(_time,_ease,_delay)}else{return buildStrings(values.time,values.ease,values.delay)}}();_object.willChange(strings.props);var time=values?values.time:_time;var delay=values?values.delay:_delay;var props=values?values.props:_props;var transformProps=values?values.transform:_transformProps;Timer.create(function(){if(killed())return;_object.div.style[Device.styles.vendorTransition]=strings.transition;_this.playing=true;if(Device.browser.safari){Timer.create(function(){if(killed())return;_object.css(props);_object.transform(transformProps)},16)}else{_object.css(props);_object.transform(transformProps)}Timer.create(function(){if(killed())return;if(!_stack){clearCSSTween();if(_callback)_callback()}else{executeNextInStack()}},time+delay)},50)}function executeNextInStack(){if(killed())return;var values=_stack.shift();if(!values){clearCSSTween();if(_callback)_callback}else{var strings=buildStrings(values.time,values.ease,values.delay);_object.div.style[Device.styles.vendorTransition]=strings.transition;_object.css(values.props);_object.transform(values.transform);Timer.create(executeNextInStack,values.time)}}function buildStrings(time,ease,delay){var props="";var str="";var len=_transitionProps.length;for(var i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp;str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager.getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}function clearCSSTween(){if(killed())return;_this.playing=false;_object._cssTween=null;_object.willChange(null);_object=_props=null;_this=null;Utils.nullObject(this)}function tweenComplete(){if(!_callback&&_this.playing)clearCSSTween()}this.stop=function(){if(!this.playing)return;this.kill=true;this.playing=false;_object.div.style[Device.styles.vendorTransition]="";_object.div._transition=false;_object.willChange(null);_object._cssTween=null;_this=null;Utils.nullObject(this)}});Class(function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _this=this;var _endValues,_transformEnd,_transformStart,_startValues;var _isTransform,_isCSS,_transformProps;var _cssTween,_transformTween;this.playing=true;(function(){if(typeof _ease==="object")_ease="easeOutCubic";if(_object&&_props){if(typeof _time!=="number")throw"FrameTween Requires object, props, time, ease";initValues();startTween()}}());function killed(){return _this.kill||!_object||!_object.div}function initValues(){if(_props.math)delete _props.math;if(Device.tween.transition&&_object.div._transition){_object.div.style[Device.styles.vendorTransition]="";_object.div._transition=false}_endValues=new DynamicObject;_transformEnd=new DynamicObject;_transformStart=new DynamicObject;_startValues=new DynamicObject;if(!_object.multiTween){if(typeof _props.x==="undefined")_props.x=_object.x;if(typeof _props.y==="undefined")_props.y=_object.y;if(typeof _props.z==="undefined")_props.z=_object.z}for(var key in _props){if(TweenManager.checkTransform(key)){_isTransform=true;_transformStart[key]=_object[key]||(key=="scale"?1:0);_transformEnd[key]=_props[key]}else{_isCSS=true;var v=_props[key];if(typeof v==="string"){_object.div.style[key]=v}else if(typeof v==="number"){_startValues[key]=Number(_object.css(key));_endValues[key]=v}}}}function startTween(){if(_object._cssTween&&!_manual&&!_object.multiTween)_object._cssTween.kill=true;if(_object.multiTween){if(!_object._cssTweens)_object._cssTweens=[];_object._cssTweens.push(_this)}_object._cssTween=_this;_this.playing=true;_props=_startValues.copy();_transformProps=_transformStart.copy();if(_isCSS)_cssTween=TweenManager.tween(_props,_endValues,_time,_ease,_delay,tweenComplete,update,_manual);if(_isTransform)_transformTween=TweenManager.tween(_transformProps,_transformEnd,_time,_ease,_delay,!_isCSS?tweenComplete:null,!_isCSS?update:null,_manual)}function clear(){if(_object._cssTweens){_object._cssTweens.findAndRemove(_this)}_this.playing=false;_object._cssTween=null;_object=_props=null}function update(){if(killed())return;if(_isCSS)_object.css(_props);if(_isTransform){if(_object.multiTween){for(var key in _transformProps){if(typeof _transformProps[key]==="number")_object[key]=_transformProps[key]}_object.transform()}else{_object.transform(_transformProps)}}}function tweenComplete(){if(_this.playing){clear();if(_callback)_callback()}}this.stop=function(){if(!this.playing)return;if(_cssTween&&_cssTween.stop)_cssTween.stop();if(_transformTween&&_transformTween.stop)_transformTween.stop();clear()};this.interpolate=function(elapsed){if(_cssTween)_cssTween.interpolate(elapsed);if(_transformTween)_transformTween.interpolate(elapsed);update()};this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}};this.setEase=function(ease){if(_cssTween)_cssTween.setEase(ease);if(_transformTween)_transformTween.setEase(ease)}});TweenManager.Class(function Interpolation(){function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getTForX(aX,mX1,mX2){var aGuessT=aX;for(var i=0;i<4;i++){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope==0)return aGuessT;var currentX=calculateBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope}return aGuessT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;break;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;break;case"easeInQuart":return TweenManager.Interpolation.Quart.In;break;case"easeInQuint":return TweenManager.Interpolation.Quint.In;break;case"easeInSine":return TweenManager.Interpolation.Sine.In;break;case"easeInExpo":return TweenManager.Interpolation.Expo.In;break;case"easeInCirc":return TweenManager.Interpolation.Circ.In;break;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;break;case"easeInBack":return TweenManager.Interpolation.Back.In;break;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;break;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;break;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;break;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;break;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;break;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;break;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;break;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;break;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;break;case"easeOutBack":return TweenManager.Interpolation.Back.Out;break;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;break;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;break;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;break;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;break;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;break;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;break;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;break;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;break;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;break;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;break;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;break;case"linear":return TweenManager.Interpolation.Linear.None;break}}();if(!fn){var curve=TweenManager.getEase(ease,true);if(curve)fn=curve;else fn=TweenManager.Interpolation.Cubic.Out}return fn};this.solve=function(values,elapsed){if(values[0]==values[1]&&values[2]==values[3])return elapsed;return calculateBezier(getTForX(elapsed,values[0],values[2]),values[1],values[3])};this.Linear={None:function(k){return k}};this.Quad={In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1)return.5*k*k;return-.5*(--k*(k-2)-1)}};this.Cubic={In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){if((k*=2)<1)return.5*k*k*k;return.5*((k-=2)*k*k+2)}};this.Quart={In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){if((k*=2)<1)return.5*k*k*k*k;return-.5*((k-=2)*k*k*k-2)}};this.Quint={In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){if((k*=2)<1)return.5*k*k*k*k*k;return.5*((k-=2)*k*k*k*k+2)}};this.Sine={In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}};this.Expo={In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0)return 0;if(k===1)return 1;if((k*=2)<1)return.5*Math.pow(1024,k-1);return.5*(-Math.pow(2,-10*(k-1))+2)}};this.Circ={In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){if((k*=2)<1)return-.5*(Math.sqrt(1-k*k)-1);return.5*(Math.sqrt(1-(k-=2)*k)+1)}};this.Elastic={In:function(k){var s,a=.1,p=.4;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k){var s,a=.1,p=.4;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1},InOut:function(k){var s,a=.1,p=.4;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);if((k*=2)<1)return-.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1}};this.Back={In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1)return.5*(k*k*((s+1)*k-s));return.5*((k-=2)*k*((s+1)*k+s)+2)}};this.Bounce={In:function(k){return 1-this.Bounce.Out(1-k)},Out:function(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function(k){if(k<.5)return this.Bounce.In(k*2)*.5;return this.Bounce.Out(k*2-1)*.5+.5}}},"Static");Class(function EasingPath(_curve){Inherit(this,Component);var _this=this;var _path,_boundsStartIndex,_pathLength,_pool;var _precompute=145e1;var _step=1/_precompute;var _rect=100;var _approximateMax=5;var _eps=.001;var _boundsPrevProgress=-1;var _prevBounds={};var _newPoint={};var _samples=[];var _using=[];(function(){initPool();initPath();preSample()}());function initPool(){_pool=_this.initClass(ObjectPool,Object,100)}function initPath(){_path=document.createElementNS("http://www.w3.org/2000/svg","path");_path.setAttributeNS(null,"d",normalizePath(_curve));_pathLength=_path.getTotalLength()}function preSample(){var i,j,length,point,progress,ref;for(i=j=0,ref=_precompute;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){progress=i*_step;length=_pathLength*progress;point=_path.getPointAtLength(length);_samples.push({point:point,length:length,progress:progress})}}function normalizePath(path){var svgRegex=/[M|L|H|V|C|S|Q|T|A]/gim;var points=path.split(svgRegex);points.shift();var commands=path.match(svgRegex);var startIndex=0;points[startIndex]=normalizeSegment(points[startIndex],0);var endIndex=points.length-1;points[endIndex]=normalizeSegment(points[endIndex],_rect);return joinNormalizedPath(commands,points)}function normalizeSegment(segment,value){value=value||0;segment=segment.trim();var nRgx=/(-|\+)?((\d+(\.(\d|\e(-|\+)?)+)?)|(\.?(\d|\e|(\-|\+))+))/gim;var pairs=getSegmentPairs(segment.match(nRgx));var lastPoint=pairs[pairs.length-1];var x=lastPoint[0];var parsedX=Number(x);if(parsedX!==value){segment="";lastPoint[0]=value;for(var i=0;i<pairs.length;i++){var point=pairs[i];var space=i===0?"":" ";segment+=""+space+point[0]+","+point[1]}}return segment}function joinNormalizedPath(commands,points){var normalizedPath="";for(var i=0;i<commands.length;i++){var command=commands[i];var space=i===0?"":" ";normalizedPath+=""+space+command+points[i].trim()}return normalizedPath}function getSegmentPairs(array){if(array.length%2!==0)throw"EasingPath :: Failed to parse path -- segment pairs are not even.";var newArray=[];for(var i=0;i<array.length;i+=2){var value=array[i];var pair=[array[i],array[i+1]];newArray.push(pair)}return newArray}function findBounds(array,p){if(p==_boundsPrevProgress)return _prevBounds;if(!_boundsStartIndex)_boundsStartIndex=0;var len=array.length;var loopEnd,direction,start;if(_boundsPrevProgress>p){loopEnd=0;direction="reverse"}else{loopEnd=len;direction="forward"}if(direction=="forward"){start=array[0];end=array[array.length-1]}else{start=array[array.length-1];end=array[0]}var i,j,ref,ref1,buffer;for(i=j=ref=_boundsStartIndex,ref1=loopEnd;ref<=ref1?j<ref1:j>ref1;i=ref<=ref1?++j:--j){var value=array[i];var pointX=value.point.x/_rect;var pointP=p;if(direction=="reverse"){buffer=pointX;pointX=pointP;pointP=buffer}if(pointX<pointP){start=value;_boundsStartIndex=i}else{end=value;break}}_boundsPrevProgress=p;_prevBounds.start=start;_prevBounds.end=end;return _prevBounds}function checkIfBoundsCloseEnough(p,bounds){var point;var y=checkIfPointCloseEnough(p,bounds.start.point);if(y)return y;return checkIfPointCloseEnough(p,bounds.end.point)}function findApproximate(p,start,end,approximateMax){approximateMax=approximateMax||_approximateMax;var approximation=approximate(start,end,p);var point=_path.getPointAtLength(approximation);var x=point.x/_rect;if(closeEnough(p,x)){return resolveY(point)}else{if(approximateMax--<1){return resolveY(point)}var newPoint=_pool.get();newPoint.point=point;newPoint.length=approximation;_using.push(newPoint);if(p<x)return findApproximate(p,start,newPoint,approximateMax);else return findApproximate(p,newPoint,end,approximateMax)}}function approximate(start,end,p){var deltaP=end.point.x-start.point.x;var percentP=(p-start.point.x/_rect)/(deltaP/_rect);return start.length+percentP*(end.length-start.length)}function checkIfPointCloseEnough(p,point){if(closeEnough(p,point.x/_rect))return resolveY(point)}function closeEnough(n1,n2){return Math.abs(n1-n2)<_eps}function resolveY(point){return 1-point.y/_rect}function cleanUpObjects(){for(var i=_using.length-1;i>-1;i--){_pool.put(_using[i])}_using.length=0}this.solve=function(p){p=Utils.clamp(p,0,1);var bounds=findBounds(_samples,p);var res=checkIfBoundsCloseEnough(p,bounds);var output=res;if(!output)output=findApproximate(p,bounds.start,bounds.end);cleanUpObjects();return output}});Class(function MathTween(_object,_props,_time,_ease,_delay,_update,_callback,_manual){var _this=this;var _startTime,_startValues,_endValues,_currentValues;var _easeFunction,_paused,_newEase,_stack,_current;var _elapsed=0;(function(){if(_object&&_props){if(typeof _time!=="number")throw"MathTween Requires object, props, time, ease";start();if(typeof _ease=="object"&&!Array.isArray(_ease))initStack()}}());function start(){if(!_object.multiTween&&_object._mathTween&&!_manual)TweenManager.clearTween(_object);if(!_manual)TweenManager._addMathTween(_this);_object._mathTween=_this;if(_object.multiTween){if(!_object._mathTweens)_object._mathTweens=[];_object._mathTweens.push(_this)}if(typeof _ease=="string"){_ease=TweenManager.Interpolation.convertEase(_ease);_easeFunction=typeof _ease==="function"}else if(Array.isArray(_ease)){_easeFunction=false;_ease=TweenManager.getEase(_ease,true)}_startTime=Date.now();_startTime+=_delay;_endValues=_props;_startValues={};_this.startValues=_startValues;for(var prop in _endValues){if(typeof _object[prop]==="number")_startValues[prop]=_object[prop]}}function initStack(){var prevTime=0;var interpolate=function(start,end,alpha,ease,prev,key){var last=prev[key];if(last)start+=last;return TweenManager.interpolateValues(start,end,alpha,ease)};_stack=[];for(var p in _ease){var perc=p.strpos("%")?Number(p.replace("%",""))/100:(Number(p)+1)/_ease.length;if(isNaN(perc))continue;var ease=_ease[p];var last=_stack[_stack.length-1];var props={};var pr=last?last.end:{};var zeroOut=!last;for(var key in _startValues){props[key]=interpolate(_startValues[key],_endValues[key],perc,ease,pr,key);if(zeroOut)pr[key]=_startValues[key]}var time=perc*_time-prevTime;prevTime+=time;_stack.push({percent:perc,ease:ease,start:pr,end:props,time:time})}_currentValues=_stack.shift()}function clear(){if(!_object&&!_props)return false;_object._mathTween=null;TweenManager._removeMathTween(_this);Utils.nullObject(_this);if(_object._mathTweens){_object._mathTweens.findAndRemove(_this)}}function updateSingle(time){_elapsed=(time-_startTime)/_time;_elapsed=_elapsed>1?1:_elapsed;var delta=_easeFunction?_ease(_elapsed):TweenManager.Interpolation.solve(_ease,_elapsed);for(var prop in _startValues){if(typeof _startValues[prop]==="number"){var start=_startValues[prop];var end=_endValues[prop];_object[prop]=start+(end-start)*delta}}if(_update)_update(delta);if(_elapsed==1){if(_callback)_callback();clear()}}function updateStack(time){var v=_currentValues;if(!v.elapsed){v.elapsed=0;v.timer=0}v.timer+=Render.DELTA;v.elapsed=v.timer/v.time;if(v.elapsed<1){for(var prop in v.start){_object[prop]=TweenManager.interpolateValues(v.start[prop],v.end[prop],v.elapsed,v.ease)}if(_update)_update(v.elapsed)}else{_currentValues=_stack.shift();if(!_currentValues){if(_callback)_callback();clear()}}}this.update=function(time){if(_paused||time<_startTime)return;if(_stack)updateStack(time);else updateSingle(time)};this.pause=function(){_paused=true};this.resume=function(){_paused=false;_startTime=Date.now()-_elapsed*_time};this.stop=function(){_this.stopped=true;clear();return null};this.setEase=function(ease){if(_newEase!=ease){_newEase=ease;_ease=TweenManager.Interpolation.convertEase(ease);_easeFunction=typeof _ease==="function"}};this.getValues=function(){return{start:_startValues,end:_endValues}};this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues){if(typeof _startValues[prop]==="number"&&typeof _endValues[prop]==="number"){var start=_startValues[prop];var end=_endValues[prop];_object[prop]=start+(end-start)*delta}}}});Class(function SpringTween(_object,_props,_friction,_ease,_delay,_update,_callback){var _this=this;var _startTime,_velocityValues,_endValues,_startValues;var _damping,_friction,_count,_paused;(function(){if(_object&&_props){if(typeof _friction!=="number")throw"SpringTween Requires object, props, time, ease";start()}}());function start(){TweenManager.clearTween(_object);_object._mathTween=_this;TweenManager._addMathTween(_this);_startTime=Date.now();_startTime+=_delay;_endValues={};_startValues={};_velocityValues={};if(_props.x||_props.y||_props.z){if(typeof _props.x==="undefined")_props.x=_object.x;if(typeof _props.y==="undefined")_props.y=_object.y;if(typeof _props.z==="undefined")_props.z=_object.z}_count=0;_damping=_props.damping||.5;delete _props.damping;for(var prop in _props){if(typeof _props[prop]==="number"){_velocityValues[prop]=0;_endValues[prop]=_props[prop]}}for(prop in _props){if(typeof _object[prop]==="number"){_startValues[prop]=_object[prop]||0;_props[prop]=_startValues[prop]}}}function clear(stop){if(_object){_object._mathTween=null;if(!stop){for(var prop in _endValues){if(typeof _endValues[prop]==="number")_object[prop]=_endValues[prop]}if(_object.transform)_object.transform()}}TweenManager._removeMathTween(_this)}this.update=function(time){if(time<_startTime||_paused)return;var vel;for(var prop in _startValues){if(typeof _startValues[prop]==="number"){var start=_startValues[prop];var end=_endValues[prop];var val=_props[prop];var d=end-val;var a=d*_damping;_velocityValues[prop]+=a;_velocityValues[prop]*=_friction;_props[prop]+=_velocityValues[prop];_object[prop]=_props[prop];vel=_velocityValues[prop]}}if(Math.abs(vel)<.001){_count++;if(_count>30){if(_callback)_callback.apply(_object);clear()}}if(_update)_update(time);if(_object.transform)_object.transform()};this.pause=function(){_paused=true};this.stop=function(){clear(true);return null}});Class(function TweenTimeline(){Inherit(this,Component);var _this=this;var _tween;var _total=0;var _tweens=[];var _fallbacks=[];this.elapsed=0;(function(){}());function calculate(){_tweens.sort(function(a,b){var ta=a.time+a.delay;var tb=b.time+b.delay;return tb-ta});var first=_tweens[0];_total=first.time+first.delay}function loop(){var time=_this.elapsed*_total;for(var i=_tweens.length-1;i>-1;i--){var t=_tweens[i];var relativeTime=time-t.delay;var elapsed=Utils.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(TweenTimeline.UPDATE,_this,true)}this.add=function(object,props,time,ease,delay){var tween;if(object instanceof HydraObject)tween=new FrameTween(object,props,time,ease,delay,null,true);else tween=new MathTween(object,props,time,ease,delay,null,null,true);_tweens.push(tween);_fallbacks.push({object:object,props:props,time:time,ease:ease,delay:delay});tween.time=time;tween.delay=delay||0;calculate();return tween};this.tween=function(to,time,ease,delay,callback){this.stopTween();_tween=TweenManager.tween(_this,{elapsed:to},time,ease,delay,callback,loop)};this.stopTween=function(){if(_tween&&_tween.stop)_tween.stop()};this.startRender=function(){Render.startRender(loop)};this.stopRender=function(){Render.stopRender(loop)};this.update=function(){loop()};this.calculateRemainingTime=function(){return _total-_this.elapsed*_total};this.fallback=function(dir){_fallbacks.forEach(function(config,index){var fTween=_tweens[index].getValues();var props=null;if(config.object instanceof HydraObject){if(dir==1)props=Utils.mergeObject(fTween.end,fTween.transformEnd);else props=Utils.mergeObject(fTween.start,fTween.transformStart);for(var key in props){if(typeof props[key]!="number")delete props[key]}config.object.tween(props,config.time,config.ease,config.delay)}else{if(dir==1)props=Utils.mergeObject(fTween.end);else props=Utils.mergeObject(fTween.start);for(var key in props){if(typeof props[key]!="number")delete props[key]}TweenManager.tween(config.object,props,config.time,config.ease,config.delay)}})};this.destroy=function(){Render.stopRender(loop);for(var i=0;i<_tweens.length;i++)_tweens[i].stop();return this._destroy()}},()=>{TweenTimeline.UPDATE="tweentimeline_update"});Class(function Shaders(){Inherit(this,MVC);var _this=this;(function(){}());function parseSingleShader(code){let uniforms=code.split("#!UNIFORMS")[1].split("#!")[0];let varyings=code.split("#!VARYINGS")[1].split("#!")[0];let attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];while(code.strpos("#!SHADER")){code=code.slice(code.indexOf("#!SHADER"));let split=code.split("#!SHADER")[1];let br=split.indexOf("\n");let name=split.slice(0,br).split(": ")[1];let glsl=split.slice(br);if(name.strpos(".vs"))glsl=attributes+uniforms+varyings+glsl;else glsl=uniforms+varyings+glsl;_this[name]=glsl;code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i];var text=split[i+1];if(text.strpos("#!UNIFORMS"))parseSingleShader(text);else _this[name]=text}}function parseRequirements(){for(var key in _this){var obj=_this[key];if(typeof obj==="string"){_this[key]=require(obj)}}}function require(shader){if(!shader.strpos("require"))return shader;shader=shader.replace(/# require/g,"#require");while(shader.strpos("#require")){var split=shader.split("#require(");var name=split[1].split(")")[0];name=name.replace(/ /g,"");if(!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;shader=shader.replace("#require("+name+")",_this[name])}return shader}this.parse=function(code,file){if(!code.strpos("{@}")){file=file.split("/");file=file[file.length-1];_this[file]=code}else{parseCompiled(code);parseRequirements()}_this.shadersParsed=true};this.onReady=this.ready=function(callback){let promise=Promise.create();if(callback)promise.then(callback);this.wait(()=>promise.resolve(),this,"shadersParsed");return promise};this.getShader=function(string){if(_this.FALLBACKS){if(_this.FALLBACKS[string]){string=_this.FALLBACKS[string]}}var code=_this[string];if(code){while(code.strpos("#test ")){try{var test=code.split("#test ")[1];var name=test.split("\n")[0];var glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];if(!eval(name)){code=code.replace(glsl,"")}code=code.replace("#test "+name+"\n","");code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}}}return code}},"static");Class(function RenderPerformance(){Inherit(this,Component);var _this=this;var _time;var _times=[];var _fps=[];this.enabled=true;this.pastFrames=60;this.time=function(){if(!this.enabled)return;if(!_time){_time=performance.now()}else{var t=performance.now()-_time;_time=null;_times.unshift(t);if(_times.length>this.pastFrames)_times.pop();_fps.unshift(Render.FPS);if(_fps.length>this.pastFrames)_fps.pop();this.average=0;var len=_times.length;for(var i=0;i<len;i++){this.average+=_times[i]}this.average/=len;this.averageFPS=0;len=_fps.length;for(i=0;i<len;i++){this.averageFPS+=_fps[i]}this.averageFPS/=len}};this.clear=function(){_times.length=0};this.dump=function(){console.log(_times)};this.get("times",function(){return _times});this.get("median",function(){_times.sort(function(a,b){return a-b});return _times[~~(_times.length/2)]})});Class(function AssetLoader(_assets,_complete){Inherit(this,Component);var _this=this;var _total=0;var _loaded=0;var _added=0;var _triggered=0;var _queueLength=2;var _lastTriggered=0;var _queue,_qLoad,_currentQueue;var _output,_loadedFiles;var _id=Utils.timestamp();if(typeof _complete==="number"){_queueLength=_complete;_complete=null}(function(){_queue={};_loadedFiles=[];prepareAssets();startLoading()}());function prepareAssets(){var perQueue=_assets.length/_queueLength;var count=0;var index=0;for(var i=0;i<_assets.length;i++){if(typeof _assets[i]!=="undefined"){if(!_queue[index])_queue[index]=[];var queue=_queue[index];_total++;count++;if(count>=perQueue){index+=1;count=0}queue.push(_assets[i])}}}function startLoading(){_currentQueue=0;loadQueue()}function loadQueue(){var queue=_queue[_currentQueue];if(!queue)return;_qLoad=0;for(var i=0;i<queue.length;i++){loadAsset(queue[i])}}function checkQ(){if(!_queue)return;var queue=_queue[_currentQueue];if(!queue)return;var length=queue.length;_qLoad++;if(_qLoad==length){_currentQueue++;loadQueue()}}function missingFiles(){if(!_queue)return;var missing=[];for(var i=0;i<_queue.length;i++){var loaded=false;for(var j=0;j<_loadedFiles.length;j++){if(_loadedFiles[j]==_queue[i])loaded=true}if(!loaded)missing.push(_queue[i])}if(missing.length){console.log("AssetLoader Files Failed To Load:");console.log(missing)}}function wrapXHR(xhr){xhr.onError=function(e){_this.events.fire(HydraEvents.ERROR,e)}}function loadAsset(asset){if(!asset)return;var name=asset.split("/");name=name[name.length-1];var split=name.split(".");var ext=split[split.length-1].split("?")[0];switch(ext){case"html":wrapXHR(XHR.get(asset,function(contents){Hydra.HTML[split[0]]=contents;assetLoaded(asset)},"text"));break;case"js":case"php":case undefined:wrapXHR(XHR.get(asset,function(script){script=script.replace("use strict","");eval.call(window,script);assetLoaded(asset)},"text"));break;case"fnt":case"json":wrapXHR(XHR.get(asset,function(contents){Hydra.JSON[split[0]]=contents;assetLoaded(asset)},ext=="fnt"?"text":null));break;case"svg":wrapXHR(XHR.get(asset,function(contents){Hydra.SVG[split[0]]=contents;assetLoaded(asset)},"text"));break;case"fs":case"vs":wrapXHR(XHR.get(asset,function(contents){Shaders.parse(contents,asset);assetLoaded(asset)},"text"));break;default:var image=Images.createImg(asset);if(image.complete){assetLoaded(asset);return}image.onload=function(){assetLoaded(asset)};break}}function assetLoaded(asset){_loaded++;_this.percent=_loaded/_total;if(_this.events)_this.events.fire(HydraEvents.PROGRESS,{percent:_loaded/_total});_loadedFiles.push(asset);clearTimeout(_output);checkQ();if(_loaded==_total){_this.complete=true;if(_this.events)_this.events.fire(HydraEvents.COMPLETE,null,true);if(typeof _complete==="function")_complete()}else{if(!window.THREAD&&_this.delayedCall)_output=_this.delayedCall(missingFiles,5e3)}}this.add=function(num){_total+=num;_added+=num};this.trigger=function(num){num=num||1;for(var i=0;i<num;i++)assetLoaded("trigger")};this.triggerPercent=function(percent,num){num=num||_added;var trigger=Math.ceil(num*percent);if(trigger>_lastTriggered)this.trigger(trigger-_lastTriggered);_lastTriggered=trigger};this.destroy=function(){_assets=null;_loaded=null;_queue=null;_qLoad=null;return this._destroy&&this._destroy()}},function(){AssetLoader.loadAllAssets=function(callback,cdn){let promise=Promise.create();if(!callback)callback=promise.resolve;cdn=cdn||"";var list=[];for(var i=0;i<ASSETS.length;i++){list.push(cdn+ASSETS[i])}var assets=new AssetLoader(list,function(){if(callback)callback();if(assets&&assets.destroy)assets=assets.destroy()});promise.loader=assets;return promise};AssetLoader.loadAssets=function(list,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;if(!list.length)return Promise.resolve();var assets=new AssetLoader(list,callback);promise.loader=assets;return promise};AssetLoader.waitForLib=function(name,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;var interval=setInterval(function(){if(window[name]){clearInterval(interval);callback&&callback();interval=callback=null}},100);return promise}});Class(function MultiLoader(){Inherit(this,Component);var _this=this;var _complete=0;var _loaders=[];function progress(e){let percent=0;for(let i=0;i<_loaders.length;i++){percent+=_loaders[i].percent||0}percent/=_this.loaderCount||_loaders.length;_this.events.fire(HydraEvents.PROGRESS,{percent:percent})}function complete(e){if(++_complete==_loaders.length){_this.events.fire(HydraEvents.COMPLETE)}_this.events.fire(HydraEvents.UPDATE,{loader:e.target})}this.push=function(loader){_loaders.push(loader);loader.events.add(HydraEvents.PROGRESS,progress);loader.events.add(HydraEvents.COMPLETE,complete)};this.complete=function(){_this.events.fire(HydraEvents.PROGRESS,{percent:1});_this.events.fire(HydraEvents.COMPLETE)}});Class(function AssetUtil(){var _this=this;var _assets={};var _exclude=["!!!"];this.PATH="";function canInclude(asset,match){for(var i=0;i<_exclude.length;i++){var excl=_exclude[i];if(asset.strpos(excl)&&match!=excl)return false}return true}this.getAssets=this.loadAssets=function(list){if(Hydra.CDN&&!_this.PATH.length)_this.PATH=Hydra.CDN;var assets=this.get(list);var output=[];for(var i=assets.length-1;i>-1;i--){var asset=assets[i];if(!_assets[asset]){output.push(asset.strpos("http")?asset:_this.PATH+asset);_assets[asset]=1}}return output};this.get=function(list){if(!Array.isArray(list))list=[list];var assets=[];for(var i=ASSETS.length-1;i>-1;i--){var asset=ASSETS[i];for(var j=list.length-1;j>-1;j--){var match=list[j];if(asset.strpos(match)){if(canInclude(asset,match))assets.push(asset)}}}return assets};this.exclude=function(list){if(!Array.isArray(list))list=[list];for(var i=0;i<list.length;i++)_exclude.push(list[i])};this.removeExclude=function(list){if(!Array.isArray(list))list=[list];for(var i=0;i<list.length;i++)_exclude.findAndRemove(list[i])};this.clearExclude=function(){_exclude=["!!!"]};this.loadAllAssets=this.getAllAssets=function(list){var assets=_this.loadAssets(list||"/");var loader=new AssetLoader(assets)};this.exists=function(match){for(var i=ASSETS.length-1;i>-1;i--){var asset=ASSETS[i];if(asset.strpos(match))return true}return false};this.prependPath=function(path,files){if(!Array.isArray(files))files=[files];for(var i=ASSETS.length-1;i>-1;i--){var asset=ASSETS[i];files.forEach(function(file){if(asset.strpos(file))ASSETS[i]=path+asset})}}},"Static");Class(function FontLoader(_fonts,_callback){Inherit(this,Component);var _this=this;var $element;(function(){initFonts();finish()}());function initFonts(){if(!Array.isArray(_fonts))_fonts=[_fonts];$element=Stage.create("FontLoader");for(var i=0;i<_fonts.length;i++){var $f=$element.create("font");$f.fontStyle(_fonts[i],12,"#000").text("LOAD").css({top:-999})}}function finish(){_this.delayedCall(function(){$element.remove();if(_callback)_callback();else _this.events.fire(HydraEvents.COMPLETE)},500)}},function(){FontLoader.loadFonts=function(fonts,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;var loader=new FontLoader(fonts,function(){if(callback)callback();loader=null});return promise}});Class(function Images(){var _this=this;this.inMemory=false;this.store={};this.useCORS=false;function parseResolution(path){if(!ASSETS.RES)return path;var res=ASSETS.RES[path];var ratio=Math.min(Device.pixelRatio,3);if(res){if(res["x"+ratio]){var split=path.split("/");var file=split[split.length-1];split=file.split(".");return path.replace(file,split[0]+"-"+ratio+"x."+split[1])}else{return path}}else{return path}}this.getPath=function(path){if(path.strpos("http"))return path;path=parseResolution(path);return(Hydra.CDN||"")+path};this.createImg=function(path){var cors=_this.useCORS;if(!path.strpos("http")){path=parseResolution(path);path=(Hydra.CDN||"")+path}var img=new Image;if(cors)img.crossOrigin="";img.src=path;if(this.store)this.storeImg(img);return img};this.storeImg=function(img){if(this.inMemory)this.store[img.src]=img};this.releaseImg=function(path){path=path.src?path.src:path;delete this.store[path]}},"static");Class(function XHR(){var _this=this;var _serial;var _android=window.location.href.strpos("file://");this.headers={};this.options={};function serialize(key,data){if(typeof data==="object"){for(var i in data){var newKey=key+"["+i+"]";if(typeof data[i]==="object")serialize(newKey,data[i]);else _serial.push(newKey+"="+data[i])}}else{_serial.push(key+"="+data)}}this.get=function(url,data,callback,type){if(typeof data==="function"){type=callback;callback=data;data=null}else if(typeof data==="object"){var string="?";for(var key in data){string+=key+"="+data[key]+"&"}string=string.slice(0,-1);url+=string}var xhr=new XMLHttpRequest;xhr.open("GET",url,true);if(type=="text")xhr.overrideMimeType("text/plain");if(type=="json")xhr.setRequestHeader("Accept","application/json");for(var key in _this.headers){xhr.setRequestHeader(key,_this.headers[key])}for(var key in _this.options){xhr[key]=_this.options[key]}var promise=Promise.create();callback=callback||promise.resolve;xhr.send();xhr.onreadystatechange=function(){if(xhr.readyState==4&&(_android||xhr.status==200)){if(typeof callback==="function"){var data=xhr.responseText;if(type=="text"){callback(data)}else{try{callback(JSON.parse(data))}catch(e){throw e}}}}if(!_this.ignoreReject){if(xhr.status==0||xhr.status==401||xhr.status==404||xhr.status==500)promise.reject(xhr.status+" "+xhr.responseText)}};return promise};this.post=function(url,data,callback,type,header){if(typeof data==="function"){header=type;type=callback;callback=data;data=null}else if(typeof data==="object"){if(callback=="json"||type=="json"||header=="json"){data=JSON.stringify(data);header="json"}else{_serial=new Array;for(var key in data)serialize(key,data[key]);data=_serial.join("&");data=data.replace(/\[/g,"%5B");data=data.replace(/\]/g,"%5D");_serial=null}}var xhr=new XMLHttpRequest;xhr.open("POST",url,true);if(type=="text")xhr.overrideMimeType("text/plain");if(type=="json")xhr.setRequestHeader("Accept","application/json");switch(header){case"upload":header="application/upload";break;case"json":header="application/json";break;default:header="application/x-www-form-urlencoded";break}xhr.setRequestHeader("Content-type",header);for(var key in _this.headers){xhr.setRequestHeader(key,_this.headers[key])}for(var key in _this.options){xhr[key]=_this.options[key]}var promise=Promise.create();callback=callback||promise.resolve;xhr.onreadystatechange=function(){if(xhr.readyState==4&&(_android||xhr.status==200)){if(typeof callback==="function"){var data=xhr.responseText;if(type=="text"){callback(data)}else{try{callback(JSON.parse(data))}catch(e){throw e}}}}if(!_this.ignoreReject){if(xhr.status==0||xhr.status==401||xhr.status==404||xhr.status==500)promise.reject(xhr.status+" "+xhr.responseText)}};xhr.send(data);return promise}},"Static");Class(function Storage(){var _this=this;var _storage;(function(){testStorage()}());function testStorage(){try{if(window.localStorage){try{window.localStorage["test"]=1;window.localStorage.removeItem("test");_storage=true}catch(e){_storage=false}}else{_storage=false}}catch(e){_storage=false}}function cookie(key,value,expires){var options;if(arguments.length>1&&(value===null||typeof value!=="object")){options={};options.path="/";options.expires=expires||1;if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}options=value||{};var result,decode=options.raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}this.setCookie=function(key,value,expires){cookie(key,value,expires)};this.getCookie=function(key){return cookie(key)};this.set=function(key,value){if(value!=null&&typeof value==="object")value=JSON.stringify(value);if(_storage){if(value===null)window.localStorage.removeItem(key);else window.localStorage[key]=value}else{cookie(key,value,365)}};this.get=function(key){var val;if(_storage)val=window.localStorage[key];else val=cookie(key);if(val){var char0;if(val.charAt)char0=val.charAt(0);if(char0=="{"||char0=="[")val=JSON.parse(val);if(val=="true"||val=="false")val=val=="true"?true:false}return val}},"Static");Class(function Thread(_class){Inherit(this,Component);var _this=this;var _worker,_callbacks,_path,_mvc;var _msg={};(function(){init();importClasses();addListeners()}());function init(){_callbacks={};_worker=new Worker(Thread.PATH+"assets/js/hydra/hydra-thread.js")}function importClasses(){importClass(Utils);importClass(MVC);importClass(Component);importClass(Events);importClass(_class,true)}function importClass(_class,scoped){if(!_class)return;var code,namespace;if(!scoped){if(typeof _class!=="function"){code=_class.constructor.toString();if(code.strpos("[native"))return;namespace=_class.constructor._namespace?_class.constructor._namespace+".":"";code=namespace+"Class("+code+', "static");'}else{namespace=_class._namespace?_class._namespace+".":"";code=namespace+"Class("+_class.toString()+");"}}else{code=_class.toString().replace("{","!!!");code=code.split("!!!")[1];var splitChar=window._MINIFIED_?"=":" ";while(code.strpos("this")){var split=code.slice(code.indexOf("this."));var name=split.split("this.")[1].split(splitChar)[0];code=code.replace("this","self");createMethod(name)}code=code.slice(0,-1)}_worker.postMessage({code:code})}function createMethod(name){_this[name]=function(message,callback){_this.send(name,message,callback)}}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console){console.log(e.data.message)}else if(e.data.id){var callback=_callbacks[e.data.id];if(callback)callback(e.data.message);delete _callbacks[e.data.id]}else if(e.data.emit){var callback=_callbacks[e.data.evt];if(callback)callback(e.data.msg)}else{var callback=_callbacks["transfer"];if(callback)callback(e.data)}}this.on=function(evt,callback){_callbacks[evt]=callback};this.off=function(evt){delete _callbacks[evt]};this.loadFunctions=function(){for(var i=0;i<arguments.length;i++)this.loadFunction(arguments[i])};this.loadFunction=function(code){code=code.toString();code=code.replace("(","!!!");var split=code.split("!!!");var name=split[0].split(" ")[1];code="self."+name+" = function("+split[1];_worker.postMessage({code:code});createMethod(name)};this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:true})};this.importClass=function(){for(var i=0;i<arguments.length;i++){var code=arguments[i];importClass(code)}};this.send=function(name,message,callback){if(typeof name==="string"){var fn=name;message=message||{};message.fn=name}else{callback=message;message=name}var id=Utils.timestamp();if(callback)_callbacks[id]=callback;if(message.transfer){message.msg.id=id;message.msg.fn=message.fn;message.msg.transfer=true;_worker.postMessage(message.msg,message.buffer)}else{_msg.message=message;_msg.id=id;_worker.postMessage(_msg)}};this.destroy=function(){if(_worker.terminate)_worker.terminate();if(this._destroy)return this._destroy()}},()=>{Thread.PATH="";Thread.absolutePath=function(path){let pathname=location.pathname;if(pathname.strpos("/index.html"))pathname=pathname.replace("/index.html","");let port=Number(location.port)>1e3?`:${location.port}`:"";return path.strpos("http")?path:location.protocol+"//"+(location.hostname+port+pathname+"/"+path).replace("//","/")}});Class(function Service(){Inherit(this,Component);var _this=this;var _sw;this.active=false;this.ready=false;this.cached=false;this.offline=false;(function(){Hydra.ready(()=>{if("serviceWorker"in navigator&&(!Hydra.LOCAL||location.port!=""))initWorker()})}());function initWorker(){_this.active=true;navigator.serviceWorker.register("sw.js").then(handleRegistration).then(handleReady).then(handleError)}function checkCache(){var cache=Storage.get("service_cache");if(cache!=window._CACHE_)_this.post("clearCache")}function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;assets.forEach((asset,i)=>{if(asset.strpos(".js"))asset=assets[i].replace(".js",".js?"+window._CACHE_)});return assets}function handleRegistration(e){}function handleReady(e){_this.ready=true;_this.events.fire(HydraEvents.READY,e,true);_sw=navigator.serviceWorker.controller;checkCache()}function handleError(e){if(e){_this.events.fire(HydraEvents.ERROR,e,true);_this.active=false}}function handleMessage(e){var data=e.data;if(data.evt)_this.events.fire(data.evt,data)}this.cache=function(assets=[]){assets=Array.from(assets);let upload=function(){_this.post("upload",{assets:assets,cdn:Hydra.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline});Storage.set("service_cache",window._CACHE_);_this.cached=true};if(_this.active)_this.wait(upload,_this,"ready")};this.post=function(fn,data={}){if(!_this.active)return;let send=function(){let mc=new MessageChannel;mc.port1.onmessage=handleMessage;data.fn=fn;_sw&&_sw.postMessage(data,[mc.port2])};_this.wait(send,_this,"ready")}},"static");Class(function Dev(){var _this=this;var _post,_alert;var _id=Utils.timestamp();(function(){if(Hydra.LOCAL)Hydra.development(true)}());function catchErrors(){window.onerror=function(message,file,line){var string=message+" ::: "+file+" : "+line;if(_alert)alert(string);if(_post)XHR.post(_post+"/api/data/debug",getDebugInfo(string));if(_this.onError)_this.onError(message,file,line)}}function getDebugInfo(string){var obj={};obj.time=(new Date).toString();obj.deviceId=_id;obj.err=string;obj.ua=Device.agent;obj.width=Stage.width;obj.height=Stage.height;obj.screenWidth=screen.width;obj.screenHeight=screen.height;return obj}this.alertErrors=function(url){_alert=true;if(typeof url==="string")url=[url];for(var i=0;i<url.length;i++){if(location.href.strpos(url[i])||location.hash.strpos(url[i]))return catchErrors()}};this.postErrors=function(url,post){_post=post;if(typeof url==="string")url=[url];for(var i=0;i<url.length;i++){if(location.href.strpos(url[i]))return catchErrors()}};this.expose=function(name,val,force){if(Hydra.LOCAL||force)window[name]=val};this.logServer=function(msg){if(_post)XHR.post(_post+"/api/data/debug",getDebugInfo(msg))};this.unsupported=function(needsAlert){if(needsAlert)alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")}},"Static");window.ASSETS=["assets/geometry/common/asteroid.json","assets/geometry/common/enemy-aa.json","assets/geometry/common/enemy-construction.json","assets/geometry/common/enemy-virus.json","assets/geometry/common/enemy.json","assets/geometry/common/friendly.json","assets/geometry/common/hangar.json","assets/geometry/gameplay/insignia/airman.json","assets/geometry/gameplay/insignia/brigadier-general.json","assets/geometry/gameplay/insignia/captain.json","assets/geometry/gameplay/insignia/chief-master-sergeant.json","assets/geometry/gameplay/insignia/colonel.json","assets/geometry/gameplay/insignia/first-lieutenant.json","assets/geometry/gameplay/insignia/major.json","assets/geometry/gameplay/insignia/master-sergeant.json","assets/geometry/gameplay/insignia/staff-sergeant.json","assets/geometry/gameplay/insignia/technical-sergeant.json","assets/geometry/gameplay/levelnav/map0-nav.json","assets/geometry/gameplay/levelnav/map1-nav.json","assets/geometry/gameplay/levelnav/map10-nav.json","assets/geometry/gameplay/levelnav/map12-nav.json","assets/geometry/gameplay/levelnav/map13-nav.json","assets/geometry/gameplay/levelnav/map14-nav.json","assets/geometry/gameplay/levelnav/map15-nav.json","assets/geometry/gameplay/levelnav/map2-nav.json","assets/geometry/gameplay/levelnav/map3-nav.json","assets/geometry/gameplay/levelnav/map4-nav.json","assets/geometry/gameplay/levelnav/map5-nav.json","assets/geometry/gameplay/levelnav/map7-nav.json","assets/geometry/gameplay/levelnav/test-nav.json","assets/geometry/gameplay/maps/map0.json","assets/geometry/gameplay/maps/map1.json","assets/geometry/gameplay/maps/map10.json","assets/geometry/gameplay/maps/map12.json","assets/geometry/gameplay/maps/map13.json","assets/geometry/gameplay/maps/map14.json","assets/geometry/gameplay/maps/map15.json","assets/geometry/gameplay/maps/map2.json","assets/geometry/gameplay/maps/map3.json","assets/geometry/gameplay/maps/map4.json","assets/geometry/gameplay/maps/map5.json","assets/geometry/gameplay/maps/map7.json","assets/geometry/gameplay/maps/map99.json","assets/geometry/gameplay/maps/test-map.json","assets/geometry/gameplay/misc/carry-player.json","assets/geometry/gameplay/misc/earth-mesh-low-poly.json","assets/geometry/gameplay/misc/earth-mesh-med-poly.json","assets/geometry/gameplay/misc/earth-points-hi-poly.json","assets/geometry/gameplay/misc/earth-points-hi-poly2.json","assets/geometry/gameplay/misc/map1-road.json","assets/geometry/gameplay/misc/map15-road.json","assets/geometry/gameplay/misc/parachute.json","assets/geometry/gameplay/misc/server-main.json","assets/geometry/gameplay/misc/server.json","assets/geometry/gameplay/planes/a-10-new.json","assets/geometry/gameplay/planes/a-10.json","assets/geometry/gameplay/planes/ac-130-new.json","assets/geometry/gameplay/planes/ac-130.json","assets/geometry/gameplay/planes/c-17-new.json","assets/geometry/gameplay/planes/c-17.json","assets/geometry/gameplay/planes/c130h3-new.json","assets/geometry/gameplay/planes/c130h3.json","assets/geometry/gameplay/planes/f-16-new.json","assets/geometry/gameplay/planes/f-16.json","assets/geometry/gameplay/planes/f-22-new.json","assets/geometry/gameplay/planes/f-22.json","assets/geometry/gameplay/planes/hh60-new.json","assets/geometry/gameplay/planes/hh60-rotor_back.json","assets/geometry/gameplay/planes/hh60-rotor_front.json","assets/geometry/gameplay/planes/hh60.json","assets/geometry/gameplay/planes/kc135-new.json","assets/geometry/gameplay/planes/kc135r.json","assets/geometry/gameplay/planes/millstar-4.json","assets/geometry/gameplay/planes/mq9-reaper.json","assets/geometry/gameplay/planes/test.json","assets/geometry/gameplay/player/car.json","assets/geometry/gameplay/player/fallback-player-fallen.json","assets/geometry/gameplay/player/fallback-player-idle.json","assets/geometry/gameplay/player/player-carry-idle.json","assets/geometry/gameplay/player/player-carry-run.json","assets/geometry/gameplay/player/player-crouch.json","assets/geometry/gameplay/player/player-fallen.json","assets/geometry/gameplay/player/player-idle.json","assets/geometry/gameplay/player/player-kneel.json","assets/geometry/gameplay/player/player-laying-cough.json","assets/geometry/gameplay/player/player-laying-hand.json","assets/geometry/gameplay/player/player-laying.json","assets/geometry/gameplay/player/player-look-behind.json","assets/geometry/gameplay/player/player-run.json","assets/geometry/gameplay/player/player-scared.json","assets/geometry/gameplay/player/player-sitting.json","assets/geometry/gameplay/player/player.json","assets/geometry/gameplay/spawn/map7-spawn_planes.json","assets/geometry/globe/globe.json","assets/images/common/dot.png","assets/images/common/earth/cube.jpg","assets/images/common/enemy/arrow.png","assets/images/common/enemy/arrows.png","assets/images/common/enemy/fire.png","assets/images/common/enemy/target.png","assets/images/common/fog/fog.png","assets/images/common/fx/002.jpg","assets/images/common/fx/dust.png","assets/images/common/fx/smoke.png","assets/images/common/glow.png","assets/images/common/hangar/0.png","assets/images/common/hangar/1.png","assets/images/common/hangar/2.png","assets/images/common/insignia.png","assets/images/common/insignia2.png","assets/images/common/movement/dot-path.png","assets/images/common/movement/enemy.png","assets/images/common/movement/evac.png","assets/images/common/movement/fire.png","assets/images/common/movement/select.png","assets/images/common/movement/target.png","assets/images/common/movement/x.png","assets/images/common/noise.jpg","assets/images/common/player/alert_EOD.png","assets/images/common/player/alert_ammunition.png","assets/images/common/player/alert_attack.png","assets/images/common/player/alert_combat.png","assets/images/common/player/alert_construction.png","assets/images/common/player/alert_construction2.png","assets/images/common/player/alert_fire.png","assets/images/common/player/alert_hostage.png","assets/images/common/player/alert_injured.png","assets/images/common/player/alert_inspection.png","assets/images/common/player/alert_maintenance.png","assets/images/common/player/alert_medic1.png","assets/images/common/player/alert_medic2.png","assets/images/common/player/alert_medic3.png","assets/images/common/player/alert_package1.png","assets/images/common/player/alert_package1_drop.png","assets/images/common/player/alert_package2.png","assets/images/common/player/alert_package2_drop.png","assets/images/common/player/alert_package3.png","assets/images/common/player/alert_package3_drop.png","assets/images/common/player/alert_propulsion.png","assets/images/common/player/alert_protect.png","assets/images/common/player/ammunition.png","assets/images/common/player/ammunition_select.png","assets/images/common/player/combat.png","assets/images/common/player/combat_select.png","assets/images/common/player/construction.png","assets/images/common/player/construction_select.png","assets/images/common/player/drop.png","assets/images/common/player/eod.png","assets/images/common/player/eod_select.png","assets/images/common/player/fire.png","assets/images/common/player/fire_select.png","assets/images/common/player/fuel_icon.png","assets/images/common/player/fuelbar1.png","assets/images/common/player/fuelbar2.png","assets/images/common/player/hostage.png","assets/images/common/player/hostage_select.png","assets/images/common/player/inspection.png","assets/images/common/player/inspection_select.png","assets/images/common/player/lifebar.png","assets/images/common/player/lifebar_full.png","assets/images/common/player/maintenance.png","assets/images/common/player/maintenance_select.png","assets/images/common/player/medic1.png","assets/images/common/player/medic1_select.png","assets/images/common/player/medic2.png","assets/images/common/player/medic2_select.png","assets/images/common/player/medic3.png","assets/images/common/player/medic3_select.png","assets/images/common/player/package1.png","assets/images/common/player/package1_select.png","assets/images/common/player/package2.png","assets/images/common/player/package2_select.png","assets/images/common/player/package3.png","assets/images/common/player/package3_select.png","assets/images/common/player/propulsion.png","assets/images/common/player/propulsion_select.png","assets/images/common/player/save.png","assets/images/common/player/save_select.png","assets/images/common/player/target.png","assets/images/common/player/target_select.png","assets/images/common/player/vip.png","assets/images/common/player/vip_select.png","assets/images/common/satellite_icon.png","assets/images/common/share/generic.png","assets/images/environments/clouds/base-height.jpg","assets/images/environments/clouds/cloud.png","assets/images/environments/clouds/noise.jpg","assets/images/environments/common/grid_tile.png","assets/images/environments/desert/base-height.jpg","assets/images/environments/desert/base.jpg","assets/images/environments/desert/desert2-height.jpg","assets/images/environments/desert/desert2.jpg","assets/images/environments/desert/forest-height.jpg","assets/images/environments/desert/forest.jpg","assets/images/environments/desert/forest2-height.jpg","assets/images/environments/desert/forest2.jpg","assets/images/environments/desert/forest3-height.jpg","assets/images/environments/desert/forest3-height.png","assets/images/environments/desert/forest3.jpg","assets/images/environments/desert/snow-height.jpg","assets/images/environments/desert/snow.jpg","assets/images/environments/particles/clouds.png","assets/images/environments/particles/desert.png","assets/images/environments/particles/forest.png","assets/images/environments/particles/snow.png","assets/images/environments/particles/stars.png","assets/images/environments/sky/desertcolor.png","assets/images/environments/sky/desertcolor2.png","assets/images/environments/sky/sky_day.png","assets/images/environments/sky/sky_forest.png","assets/images/environments/sky/sky_forest2.png","assets/images/environments/sky/sky_forest3.png","assets/images/environments/sky/sky_night.png","assets/images/environments/sky/sky_snow.png","assets/images/environments/stars/star_0.png","assets/images/fallback/logo-small.png","assets/images/fallback/logo.png","assets/images/globe/cloud.png","assets/images/globe/clouds-full.jpg","assets/images/globe/clouds-half.jpg","assets/images/globe/diffuse-full.jpg","assets/images/globe/diffuse-half.jpg","assets/images/globe/normal.jpg","assets/images/globe/ocean-normal.jpg","assets/images/globe/particle.png","assets/images/globe/radius0.jpg","assets/images/globe/radius1.jpg","assets/images/globe/radius2.jpg","assets/images/globe/regions-full.jpg","assets/images/globe/regions-half.jpg","assets/images/globe/specular.jpg","assets/images/landing/airman.png","assets/images/landing/challenge.png","assets/images/landing/hero0.png","assets/images/landing/hero1.png","assets/images/landing/hero2.png","assets/images/landing/welcome.png","assets/images/ui/achievement/breach.jpg","assets/images/ui/achievement/brothers-keeper.jpg","assets/images/ui/achievement/bulls-eye.jpg","assets/images/ui/achievement/flashpoint.jpg","assets/images/ui/achievement/ghost-rider.jpg","assets/images/ui/achievement/hurry-home.jpg","assets/images/ui/achievement/knock-knock.jpg","assets/images/ui/achievement/operation-boomerang-pt--1.jpg","assets/images/ui/achievement/operation-boomerang-pt--2.jpg","assets/images/ui/achievement/red-horizon.jpg","assets/images/ui/achievement/rolling-thunder.jpg","assets/images/ui/achievement/shake-rattle-roll.jpg","assets/images/ui/achievement/tangled-web.jpg","assets/images/ui/achievement/that-others-may-live.jpg","assets/images/ui/achievement/thieves-in-the-night.jpg","assets/images/ui/achievement/washed-away.jpg","assets/images/ui/common/arrow-left.png","assets/images/ui/common/arrow-right.png","assets/images/ui/common/classified.png","assets/images/ui/common/corner.png","assets/images/ui/common/dropdown-arrow-on.png","assets/images/ui/common/dropdown-arrow.png","assets/images/ui/common/fire-meter.png","assets/images/ui/common/locked-icon.png","assets/images/ui/common/locked.png","assets/images/ui/common/logo.png","assets/images/ui/common/plane-dial.png","assets/images/ui/common/plane-icon.png","assets/images/ui/common/plane-lines.png","assets/images/ui/common/plane-placer.png","assets/images/ui/common/rotate.png","assets/images/ui/common/spin-blue.png","assets/images/ui/common/spin.png","assets/images/ui/common/star-behind.png","assets/images/ui/common/star-outline.png","assets/images/ui/common/star.png","assets/images/ui/gauge/ammunition.png","assets/images/ui/gauge/fuel.png","assets/images/ui/gauge/inspection.png","assets/images/ui/gauge/maintenance.png","assets/images/ui/gauge/mask.png","assets/images/ui/gauge/outline-accent.png","assets/images/ui/gauge/outline.png","assets/images/ui/gauge/propulsion.png","assets/images/ui/insignia/airman.png","assets/images/ui/insignia/brigadier-general.png","assets/images/ui/insignia/captain.png","assets/images/ui/insignia/chief-master-sergeant.png","assets/images/ui/insignia/colonel.png","assets/images/ui/insignia/first-lieutenant.png","assets/images/ui/insignia/major.png","assets/images/ui/insignia/master-sergeant.png","assets/images/ui/insignia/staff-sergeant.png","assets/images/ui/insignia/technical-sergeant.png","assets/images/ui/list/scroll-bottom.png","assets/images/ui/list/scroll-top.png","assets/images/ui/loader/headphones.png","assets/images/ui/loader/logo-mask.png","assets/images/ui/loader/wipe.png","assets/images/ui/mission/memory/blur.png","assets/images/ui/mission/selection/person.png","assets/images/ui/mission/selection/right.png","assets/images/ui/mission/selection/wrong.png","assets/images/ui/mission/stability/finish.png","assets/images/ui/mission/stability/start.png","assets/images/ui/share/aptitude.jpg","assets/images/ui/share/aptitude.png","assets/images/ui/share/fb.png","assets/images/ui/share/generic.jpg","assets/images/ui/share/tw.png","assets/images/vfx/digitaltransition.jpg","assets/js/lib/cannon.min.js","assets/js/lib/firebase.min.js","assets/js/lib/klang.min.js","assets/js/lib/pathfinder.min.js","assets/js/lib/three.min.js","assets/js/lib/uil.min.js","assets/shaders/compiled.vs"];ASSETS.LEVELS={"knock-knock":["images/environments/sky/desertcolor.png","images/environments/desert/base-height.jpg","images/environments/desert/base.jpg","images/globe/particle.png","images/environments/common/grid_tile.png","images/environments/particles/desert.png","images/ui/common/star-behind.png","images/ui/common/star.png","geometry/gameplay/maps/map0.json","geometry/gameplay/levelnav/map0-nav.json","images/common/player/inspection.png","images/common/player/inspection_select.png","images/common/glow.png","images/common/enemy/arrows.png","images/common/enemy/target.png","images/common/player/alert_combat.png","images/common/fx/002.jpg","images/common/hangar/0.png","images/common/hangar/1.png","geometry/gameplay/planes/mq9-reaper.json","images/common/hangar/2.png","images/common/movement/target.png"],"ghost-rider":["images/environments/sky/sky_forest.png","images/environments/desert/forest-height.jpg","images/environments/desert/forest.jpg","images/environments/stars/star_0.png","images/environments/sky/sky_night.png","images/environments/particles/forest.png","geometry/gameplay/maps/map1.json","geometry/gameplay/levelnav/map1-nav.json","geometry/gameplay/misc/map1-road.json","geometry/gameplay/planes/ac-130-new.json"],"red-horizon":["images/ui/common/arrow-left.png","images/ui/common/arrow-right.png","images/common/satellite_icon.png","images/environments/particles/stars.png","geometry/gameplay/planes/millstar-4.json","geometry/common/asteroid.json"],"brothers-keeper":["images/environments/sky/desertcolor2.png","images/environments/desert/desert2-height.jpg","images/environments/desert/desert2.jpg","geometry/gameplay/maps/map3.json","geometry/gameplay/levelnav/map3-nav.json","geometry/gameplay/player/car.json","images/common/movement/dot-path.png","images/common/player/eod.png","images/common/player/eod_select.png","images/common/player/vip.png","images/common/player/vip_select.png","images/common/player/alert_eod.png","images/common/fog/fog.png","images/common/noise.jpg"],"bulls-eye":["images/environments/sky/sky_forest2.png","images/environments/desert/forest2-height.jpg","images/environments/desert/forest2.jpg","geometry/gameplay/maps/map2.json","geometry/gameplay/levelnav/map2-nav.json","images/common/player/alert_protect.png","geometry/gameplay/planes/a-10.json","geometry/gameplay/planes/c-17.json"],"shake-rattle-and-roll":["geometry/gameplay/maps/map5.json","geometry/gameplay/levelnav/map5-nav.json","geometry/gameplay/player/player.json","geometry/gameplay/player/player-idle.json","geometry/gameplay/player/player-run.json","geometry/gameplay/player/player-laying.json","geometry/gameplay/player/player-laying-cough.json","geometry/gameplay/player/player-fallen.json","geometry/gameplay/player/player-sitting.json","images/common/player/medic1.png","images/common/player/medic1_select.png","images/common/player/medic2.png","images/common/player/medic2_select.png","images/common/player/medic3.png","images/common/player/medic3_select.png","images/ui/gauge/outline.png","images/ui/gauge/mask.png","images/ui/gauge/outline-accent.png","images/common/player/alert_injured.png","images/common/player/alert_medic3.png","images/common/player/alert_medic2.png","images/common/player/alert_medic1.png"],"hurry-home":["geometry/gameplay/maps/map10.json","geometry/gameplay/levelnav/map10-nav.json","geometry/gameplay/player/player-crouch.json","geometry/gameplay/player/player-kneel.json","geometry/gameplay/player/player-look-behind.json","images/common/player/save.png","images/common/player/save_select.png","images/common/player/alert_construction2.png"],"that-others-may-live":["geometry/gameplay/maps/map4.json","geometry/gameplay/levelnav/map4-nav.json","geometry/gameplay/planes/hh60-new.json","geometry/gameplay/planes/hh60-rotor_front.json","geometry/gameplay/planes/hh60-rotor_back.json"],"operation-boomerang-pt--1":["images/environments/sky/sky_day.png","images/environments/clouds/cloud.png","images/environments/clouds/noise.jpg","images/environments/clouds/base-height.jpg","images/environments/particles/clouds.png","images/ui/gauge/fuel.png","geometry/gameplay/planes/kc135r.json","geometry/gameplay/planes/f-22.json"],"operation-boomerang-pt--2":["images/environments/sky/sky_snow.png","images/environments/desert/snow-height.jpg","images/environments/desert/snow.jpg","images/environments/particles/snow.png","geometry/gameplay/maps/map7.json","geometry/gameplay/levelnav/map7-nav.json","geometry/gameplay/spawn/map7-spawn_planes.json","images/common/player/maintenance.png","images/common/player/maintenance_select.png","images/common/player/propulsion.png","images/common/player/propulsion_select.png","images/common/player/ammunition.png","images/common/player/ammunition_select.png","geometry/gameplay/planes/a-10.json","geometry/gameplay/planes/f-16.json","geometry/gameplay/planes/f-22.json","images/common/player/alert_inspection.png","images/common/player/alert_maintenance.png","images/common/player/alert_propulsion.png","images/common/player/alert_ammunition.png"],flashpoint:["images/ui/common/plane-dial.png","images/ui/common/fire-meter.png","images/ui/common/plane-lines.png","images/ui/common/plane-icon.png","images/environments/sky/sky_forest3.png","images/environments/desert/forest3-height.jpg","geometry/gameplay/planes/c130h3-new.json","images/environments/desert/forest3.jpg","images/ui/common/plane-placer.png","images/common/fx/smoke.png","images/common/enemy/fire.png"],"tangled-web":["geometry/gameplay/misc/earth-points-hi-poly2.json","geometry/gameplay/misc/server-main.json","geometry/gameplay/misc/server.json","images/common/player/target.png","images/common/player/target_select.png","images/common/player/alert_attack.png","images/common/enemy/arrow.png","images/common/earth/cube.jpg"],"thieves-in-the-night":["geometry/gameplay/maps/map12.json","geometry/gameplay/levelnav/map12-nav.json","geometry/gameplay/player/player-carry-idle.json","geometry/gameplay/player/player-carry-run.json","geometry/gameplay/misc/carry-player.json","images/common/player/alert_hostage.png"],"washed-away":["geometry/gameplay/maps/map13.json","geometry/gameplay/levelnav/map13-nav.json","geometry/gameplay/misc/parachute.json","images/common/player/package1.png","images/common/player/package1_select.png","images/common/player/alert_package1.png","images/common/player/alert_package2.png","images/common/player/alert_package3.png","geometry/gameplay/planes/c-17.json","images/common/player/alert_package1_drop.png","images/common/player/alert_package2_drop.png","images/common/player/alert_package3_drop.png"],breach:["geometry/gameplay/maps/map14.json","geometry/gameplay/levelnav/map14-nav.json","images/common/player/construction.png","images/common/player/construction_select.png","images/common/player/fire.png","images/common/player/fire_select.png","images/common/player/combat.png","images/common/player/combat_select.png","images/common/player/alert_fire.png","images/common/player/alert_construction.png"],"rolling-thunder":["geometry/gameplay/maps/map15.json","geometry/gameplay/levelnav/map15-nav.json","geometry/gameplay/misc/map15-road.json","geometry/gameplay/planes/ac-130-new.json","geometry/gameplay/planes/a-10-new.json","geometry/gameplay/planes/f-22-new.json"]};Class(function Config(){var _this=this;this.ENV=_CONFIG_.E;this.SITE_URL=_CONFIG_.U;this.STATIC_DATA=_CONFIG_.D;this.API=_CONFIG_.A;this.SHARE_URL=_CONFIG_.S;this.FACEBOOK_APP_ID=_CONFIG_.F;this.GTM_ID=_CONFIG_.G;this.FIREBASE=_CONFIG_.B;this.CDN="";this.IMAGES=this.CDN+"assets/images/";this.ENV_SIZE=2e3;this.UI_OFFSET=Mobile.phone?20:Device.mobile?35:40;this.UI_FONTSIZE=Mobile.phone?13:22;this.UI_COLORS={blue:"#9dbbee",clouds:"#788394",desert:"#706252"};this.SOUND=!Hydra.LOCAL||Hydra.HASH.strpos("sound");this.BG_CLEAR_COLOR=725534},"static");Class(function IconConfig(){var _this=this;this.GAUGE_TYPES={fuel:`<path d="M52.9,0.8c0,0-28.9,33.7-33.5,58.3c-4.5,24.2,18.3,40,33.5,40c15.7,0,33.3-14.8,30.2-40.3 C80,32.8,52.9,0.8,52.9,0.8z"/>`,inspection:`<path fill="#FFFFFF" d="M65.4,5.3c-8.6-4.1-18.2-4.6-27.2-1.5c-9,3.1-16.2,9.6-20.3,18.1c-7.4,15.4-2.7,33.6,10.4,43.6l-11,22.8
		c-1.7,3.6-0.2,8,3.4,9.7v0c3.6,1.7,8,0.2,9.7-3.4l11-22.8c2.8,0.7,5.6,1.1,8.5,1.1c4,0,7.9-0.7,11.8-2c9-3.1,16.2-9.6,20.3-18.1
		C90.5,35,83.1,13.8,65.4,5.3z M69.7,46.8C64.5,57.7,51.4,62.2,40.5,57c-10.9-5.2-15.5-18.3-10.2-29.2c2.5-5.3,7-9.2,12.5-11.2
		c2.4-0.8,4.8-1.2,7.3-1.2c3.2,0,6.5,0.7,9.5,2.2C70.4,22.8,74.9,35.9,69.7,46.8z"/>`,maintenance:`<path fill="#FFFFFF" d="M94.5,22.4l-6.7,6.7c-1,1-2.7,1-3.8,0L71.7,16.8c-1-1-1-2.7,0-3.8l7.2-7.2c1.7-1.7,0.5-4.6-1.9-4.5
		c-5.6,0-11.2,2.2-15.5,6.4c-6.4,6.4-8,15.7-4.9,23.6L31.2,56.8c-7.9-3-17.3-1.4-23.6,4.8c-4,4-6.2,9.3-6.4,14.6
		c-0.1,2.4,2.8,3.7,4.5,2l6.7-6.7c1-1,2.7-1,3.8,0l12.3,12.3c1,1,1,2.7,0,3.8l-7.2,7.2c-1.7,1.7-0.5,4.6,1.9,4.5
		c5.6,0,11.2-2.2,15.5-6.4c6.6-6.6,8.1-16.2,4.6-24.2l25-25c8,3.3,17.7,1.8,24.2-4.6c4-4,6.2-9.3,6.4-14.6
		C99.1,21.9,96.2,20.7,94.5,22.4z"/>`,propulsion:`<path fill="#FFFFFF" d="M80.5,58.1c0,0,1.3,2.6,8.4-0.3c0,0-12.7,14.7-26.2,15.1C49.2,73.2,44,65,39.4,57.6c0,0,10.4,7.3,18.9,5.5
		c8.4-1.8,13.3-10.8,13.3-10.8s-11.2,6.4-18-0.9c0,0,7.2-1.5,10.7-5.5c0,0-11.8,1.1-15.6-3.2c-5.4-6.1-6-5.2-9.3-4.8
		c0,0,4.7-4.7,11.7-8.2c6.9-3.5,13.9-1.9,18.4,1.5c3.8,2.9,7.3,4.6,10,4.6c0,0-5.2,5.2-11.5,1.4c0,0,4,4.8,11.7,7.8
		c7.7,3,15-0.6,18.4-2.7C98.1,42.3,95.8,51.5,80.5,58.1z M30,17.8L18.5,33.7H7.2c-2.9,0-5.2,2.3-5.2,5.2v22.7c0,2.9,2.3,5.2,5.2,5.2
		h11.3L30,82.7c1.6,2.2,5.1,1.1,5.1-1.6V19.5C35.1,16.8,31.6,15.6,30,17.8z"/>`,ammunition:`<path fill="#FFFFFF" d="M43.1,88H13.9V34.7h29.2V88z M43.1,15.9c0-8.1-6.5-14.6-14.6-14.6h0c-8.1,0-14.6,6.5-14.6,14.6v14.6h29.2
		V15.9z M47.1,95.7L47.1,95.7c0-1.9-1.6-3.5-3.5-3.5h-30c-1.9,0-3.5,1.6-3.5,3.5v0c0,1.9,1.6,3.5,3.5,3.5h30
		C45.5,99.2,47.1,97.6,47.1,95.7z M86.1,34.7H56.9V88h29.2V34.7z M86.1,15.9c0-8.1-6.5-14.6-14.6-14.6h0c-8.1,0-14.6,6.5-14.6,14.6
		v14.6h29.2V15.9z M90,95.7L90,95.7c0-1.9-1.6-3.5-3.5-3.5h-30c-1.9,0-3.5,1.6-3.5,3.5v0c0,1.9,1.6,3.5,3.5,3.5h30
		C88.4,99.2,90,97.6,90,95.7z"/>`}},"static");Class(function AirmanEvents(){var _this=this;this.LOADED="loaded";this.CLEAR_LEVEL="clear_level";this.LOGGED_IN="LOGGED_IN";this.LOGGED_OUT="LOGGED_OUT";this.MISSION_SELECT="mission_select";this.MISSION_SELECT_HOVER="mission_select_hover";this.MISSION_LIST_HOVER="mission_list_hover";this.NAV_CHANGE="nav_change";this.MISSION_END="mission_end";this.MISSION_RETRY="mission_retry";this.MISSION_QUIT="mission_quit";this.DISABLE_NAV="disable_nav";this.MISSION_INFO="mission_info";this.MISSION_HELP="mission_help";this.MISSION_UPDATE_SCORE="mission_update_score";this.ACHIEVEMENT_UNLOCKED="achievement_unlocked";this.RANK_UNLOCKED="rank_unlocked";this.APTITUDE_ZOOM="aptitude_zoom"},"static");Class(function Tracking(){Inherit(this,Model);var _this=this;var _debug=Storage.get("analytic_debug")||false;var Analytics;var _init=false;(function(){initDebug();Hydra.ready(initTags)}());function initDebug(){Dev.expose("analyticDebug",setSetBug)}function initTags(){if(_init)return;Analytics=require("TrackingTags");var config={GoogleTagManager:Config.GTM_ID};Analytics.init(config);_init=true}function setSetBug(bool){_debug=bool;Storage.set("analytic_debug",bool)}this.api=function(url,data){if(!data)data={};if(Config.ENV==="dev"||Hydra.LOCAL)return;XHR.post(url+"?token="+Storage.get("userModel_token"),data)};this.page=function(section){Render.onIdle(()=>{let url=`airmanchallenge/${section.toLowerCase()}`;let title=section.charAt(0).toUpperCase()+section.substr(1,section.length);if(title.indexOf("-")>=0){let pos=title.indexOf("-")+1;let subsection=section.substr(pos,title.length);subsection=subsection.charAt(0).toUpperCase()+subsection.substr(1,subsection.length);title=title.substr(0,pos)+subsection}if(Analytics.GoogleTagManager)dataLayer.push({event:"routeChange",attributes:{url,title}});if(_debug)console.log("EVENT TRACKING>>>>>>>>>>> ","routeChange",{url,title})})};this.event=function(params){Render.onIdle(()=>{if(Analytics.GoogleTagManager){params.event="event";if(!params.label)params.label="";dataLayer.push(params)}if(_debug){console.log(">>>>>>>>>>>>>>>>>>>> New Event <<<<<<<<<<<<<<<<<<<");for(var obj in params){var type=params[obj];console.log(obj+" "+type)}console.log(">>>>>>>>>>>>>>>>>>>> End Event <<<<<<<<<<<<<<<<<<<")}})};this.aTag=function(obj){if(!obj.div.querySelectorAll)return;var array=obj.div.querySelectorAll("a");for(var i=0;i<array.length;i++){var a=array[i];(function(a){$(a).click(function(e){if(e.object.div.hasAttribute("data-type")){var type=e.object.div.getAttribute("data-type");if(type==="privacy")_this.event({category:"login",action:"privacy-policy-click"})}})}(a))}};this.progress=function(current,total){console.log(current,total)}},"Static");Module(function TrackingTags(){var _this=this;var tags={GoogleAnalytics:function(id){(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"));ga("create",id,"auto");ga("send","pageview")},GoogleTagManager:function(id){var iframe=document.createElement("iframe");iframe.setAttribute("src","//www.googletagmanager.com/ns.html?id="+id);iframe.style.height=0+"px";iframe.style.width=0+"px";iframe.style.display="none";iframe.style.visibility="hidden";document.body.parentNode.insertBefore(iframe,document.body.nextSibling);(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!="dataLayer"?"&l="+l:"";j.async=true;j.src="//www.googletagmanager.com/gtm.js?id="+i+dl;f.parentNode.insertBefore(j,f)}(window,document,"script","dataLayer",id))}};this.exports={init:function(config){for(var key in config){if(!tags[key])throw"No key "+key+" found in Analytics";_this.exports[key]=true;tags[key](config[key])}}}});Class(function Canvas(_width,_height,_retina){Inherit(this,Component);var _this=this;var _interactive,_over,_down,_local,_imgData;this.children=[];this.offset={x:0,y:0};this.retina=_retina;(function(){if(_retina instanceof HydraObject){initAsBackground(_retina)}else{initAsElement()}_this.width=_width;_this.height=_height;_this.context._matrix=new Matrix2;resize(_width,_height,_retina)}());function initAsBackground(){var id="c"+Utils.timestamp();_this.context=document.getCSSCanvasContext("2d",id,_width,_height);_this.background="-"+Device.styles.vendor.toLowerCase()+"-canvas("+id+")";_retina.css({backgroundImage:_this.background});_retina=null}function initAsElement(){_this.div=document.createElement("canvas");_this.context=_this.div.getContext("2d");_this.object=$(_this.div)}function resize(w,h,retina){var ratio=retina&&Device.system.retina?2:1;if(_this.div){_this.div.width=w*ratio;_this.div.height=h*ratio}_this.width=w;_this.height=h;_this.scale=ratio;if(_this.object)_this.object.size(_this.width,_this.height);if(Device.system.retina&&retina){_this.context.scale(ratio,ratio);_this.div.style.width=w+"px";_this.div.style.height=h+"px"}}function findHit(e){e=Utils.touchEvent(e);e.x-=_this.offset.x;e.y-=_this.offset.y;e.width=1;e.height=1;for(var i=_this.children.length-1;i>-1;i--){var hit=_this.children[i].hit(e);if(hit)return hit}return false}function touchStart(e){var hit=findHit(e);if(!hit)return _this.interacting=false;_this.interacting=true;_down=hit;if(Device.mobile){hit.events.fire(HydraEvents.HOVER,{action:"over"},true);hit.__time=Date.now()}}function touchMove(e){var hit=findHit(e);if(hit)_this.interacting=true;else _this.interacting=false;if(!Device.mobile){if(hit&&_over){if(hit!=_over){_over.events.fire(HydraEvents.HOVER,{action:"out"},true);hit.events.fire(HydraEvents.HOVER,{action:"over"},true);_over=hit}}else if(hit&&!_over){_over=hit;hit.events.fire(HydraEvents.HOVER,{action:"over"},true)}else if(!hit&&_over){if(_over)_over.events.fire(HydraEvents.HOVER,{action:"out"},true);_over=null}}}function touchEnd(e){var hit=findHit(e);if(hit)_this.interacting=true;else _this.interacting=false;if(!_down&&!hit)return;if(!Device.mobile){if(hit&&hit==_down)hit.events.fire(HydraEvents.CLICK,{action:"click"},true)}else{if(_down)_down.events.fire(HydraEvents.HOVER,{action:"out"},true);if(hit==_down){if(Date.now()-_down.__time<750)hit.events.fire(HydraEvents.CLICK,{action:"click"},true)}}_down=null}this.set("interactive",function(val){if(!_interactive&&val){Stage.bind("touchstart",touchStart);Stage.bind("touchmove",touchMove);Stage.bind("touchend",touchEnd)}else if(_interactive&&!val){Stage.unbind("touchstart",touchStart);Stage.unbind("touchmove",touchMove);Stage.unbind("touchend",touchEnd)}_interactive=val});this.get("interactive",function(){return _interactive});this.toDataURL=function(type,quality){return _this.div.toDataURL(type,quality)};this.sort=function(){_objects.sort(function(a,b){return a.z-b.z})};this.render=function(noClear){if(!(typeof noClear==="boolean"&&noClear))_this.clear();var len=_this.children.length;for(var i=0;i<len;i++){_this.children[i].render()}this._rendered=Render.TIME};this.clear=function(){_this.context.clearRect(0,0,_this.div.width,_this.div.height)};this.add=function(display){display.setCanvas(this);display._parent=this;this.children.push(display);display._z=this.children.length};this.remove=function(display){if(!display)return;display._canvas=null;display._parent=null;var i=this.children.indexOf(display);if(i>-1)this.children.splice(i,1)};this.destroy=function(){if(_interactive){Stage.unbind("touchstart",touchStart);Stage.unbind("touchmove",touchMove);Stage.unbind("touchend",touchEnd)}this.stopRender();for(var i=0;i<this.children.length;i++){if(this.children[i].destroy)this.children[i].destroy()}return this._destroy&&this._destroy()};this.startRender=function(){Render.startRender(_this.render)};this.stopRender=function(){Render.stopRender(_this.render)};this.getImageData=function(x,y,w,h){this.imageData=this.context.getImageData(x||0,y||0,w||this.width,h||this.height);return this.imageData};this.getPixel=function(x,y,dirty){if(!this.imageData||dirty)_this.getImageData(0,0,_this.width,_this.height);if(!_imgData)_imgData={};var index=(x+y*_this.width)*4;var pixels=this.imageData.data;_imgData.r=pixels[index];_imgData.g=pixels[index+1];_imgData.b=pixels[index+2];_imgData.a=pixels[index+3];return _imgData};this.texture=function(src){var img=new Image;img.src=src;return img};this.localizeMouse=function(){_local=_local||{};_local.x=Mouse.x-_this.offset.x;_local.y=Mouse.y-_this.offset.y;return _local};this.size=resize});Class(function CanvasGraphics(_w,_h){Inherit(this,CanvasObject);var _this=this;var _props={};var _draw=[];var _pool,_mask;this.width=_w||0;this.height=_h||0;(function(){initArrayPool()}());function setProperties(context){for(var key in _props){var val=_props[key];if(val instanceof Color){context[key]=val.getHexString()}else{context[key]=val}}}function initArrayPool(){_pool=new ObjectPool(Array,25)}function draw(){var array=_pool.get()||[];for(var i=0;i<arguments.length;i++){array[i]=arguments[i]}_draw.push(array)}this.set("strokeStyle",function(val){_props.strokeStyle=val});this.get("strokeStyle",function(){return _props.strokeStyle});this.set("fillStyle",function(val){_props.fillStyle=val});this.get("fillStyle",function(){return _props.fillStyle});this.set("lineWidth",function(val){_props.lineWidth=val});this.get("lineWidth",function(){return _props.lineWidth});this.set("lineWidth",function(val){_props.lineWidth=val});this.get("lineWidth",function(){return _props.lineWidth});this.set("lineCap",function(val){_props.lineCap=val});this.get("lineCap",function(){return _props.lineCap});this.set("lineDashOffset",function(val){_props.lineDashOffset=val});this.get("lineDashOffset",function(){return _props.lineDashOffset});this.set("lineJoin",function(val){_props.lineJoin=val});this.get("lineJoin",function(){return _props.lineJoin});this.set("lineJoin",function(val){_props.lineJoin=val});this.get("lineJoin",function(){return _props.lineJoin});this.set("lineJoin",function(val){_props.lineJoin=val});this.get("lineJoin",function(){return _props.lineJoin});this.set("miterLimit",function(val){_props.miterLimit=val});this.get("miterLimit",function(){return _props.miterLimit});this.set("font",function(val){_props.font=val});this.get("font",function(val){return _props.font});this.set("textAlign",function(val){_props.textAlign=val});this.get("textAlign",function(val){return _props.textAlign});this.set("textBaseline",function(val){_props.textBaseline=val});this.get("textBaseline",function(val){return _props.textBaseline});this.draw=function(override){if(this.isMask()&&!override)return false;var context=this._canvas.context;this.startDraw(-this.anchor.tx,-this.anchor.ty);setProperties(context);for(var i=0;i<_draw.length;i++){var cmd=_draw[i];if(!cmd)continue;var fn=cmd.shift();context[fn].apply(context,cmd);cmd.unshift(fn)}this.endDraw();if(_mask){context.save();context.clip();_mask.render(true);context.restore()}};this.clear=function(){for(var i=0;i<_draw.length;i++){_draw[i].length=0;_pool.put(_draw[i])}_draw.length=0};this.arc=function(x,y,endAngle,radius,startAngle,anti){if(x&&!y){endAngle=x;x=0;y=0}x=x||0;y=y||0;endAngle=endAngle||0;endAngle-=90;anti=anti||false;startAngle=startAngle||0;startAngle-=90;radius=radius?radius:this.radius||this.width/2;draw("beginPath");draw("arc",x,y,radius,Utils.toRadians(startAngle),Utils.toRadians(endAngle),anti)};this.quadraticCurveTo=function(cpx,cpy,x,y){draw("quadraticCurveTo",cpx,cpy,x,y)};this.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){draw("bezierCurveTo",cp1x,cp1y,cp2x,cp2y,x,y)};this.fillRect=function(x,y,w,h){draw("fillRect",x,y,w,h)};this.clearRect=function(x,y,w,h){draw("clearRect",x,y,w,h)};this.strokeRect=function(x,y,w,h){draw("strokeRect",x,y,w,h)};this.moveTo=function(x,y){draw("moveTo",x,y)};this.lineTo=function(x,y){draw("lineTo",x,y)};this.stroke=function(){draw("stroke")};this.fill=function(){if(!_mask)draw("fill")};this.beginPath=function(){draw("beginPath")};this.closePath=function(){draw("closePath")};this.fillText=function(text,x,y){draw("fillText",text,x,y)};this.strokeText=function(text,x,y){draw("strokeText",text,x,y)};this.setLineDash=function(value){draw("setLineDash",value)};this.mask=function(object){if(!object)return _mask=null;if(!this._parent)throw"CanvasTexture :: Must add to parent before masking.";var siblings=this._parent.children;var canMask=false;for(var i=0;i<siblings.length;i++){if(object==siblings[i])canMask=true}if(canMask){_mask=object;object.masked=this;for(i=0;i<_draw.length;i++){if(_draw[i][0]=="fill"||_draw[i][0]=="stroke"){_draw[i].length=0;_pool.put(_draw[i]);_draw.splice(i,1)}}}else{throw"CanvasGraphics :: Can only mask a sibling"}}});Class(function CanvasObject(){Inherit(this,Component);var _this=this;this.alpha=1;this.x=0;this.y=0;this.width=0;this.height=0;this.rotation=0;this.scale=1;this.visible=true;this.anchor={x:.5,y:.5};this.values=new CanvasValues;this.styles=new CanvasValues(true);this.children=[];this.blendMode="normal";this.updateValues=function(){this.anchor.tx=this.anchor.x<=1&&!this.anchor.full?this.anchor.x*this.width:this.anchor.x;this.anchor.ty=this.anchor.y<=1&&!this.anchor.full?this.anchor.y*this.height:this.anchor.y;this.values.setTRSA(this.x,this.y,Utils.toRadians(this.rotation),this.scaleX||this.scale,this.scaleY||this.scale,this.alpha);if(this._parent.values)this.values.calculate(this._parent.values);if(this._parent.styles)this.styles.calculateStyle(this._parent.styles)};this.render=function(override){if(!this.visible)return false;this.updateValues();if(this.draw)this.draw(override);var len=this.children.length;for(var i=0;i<len;i++){this.children[i].render(override)}};this.startDraw=function(ox,oy,override){var context=this._canvas.context;var v=this.values.data;var x=v[0]+(ox||0);var y=v[1]+(oy||0);if(this.styles.styled)context.save();context._matrix.setTRS(x,y,v[2],v[3],v[4]);if(!override)context.globalCompositeOperation=this.blendMode||"normal";var m=context._matrix.data;context.transform(m[0],m[3],m[1],m[4],m[2],m[5]);context.globalAlpha=v[5];if(this.styles.styled){var values=this.styles.values;for(var key in values){var val=values[key];if(val instanceof Color){context[key]=val.getHexString()}else{context[key]=val}}}};this.endDraw=function(){var context=this._canvas.context;context._matrix.inverse();var m=context._matrix.data;if(this.styles.styled)context.restore();else context.transform(m[0],m[3],m[1],m[4],m[2],m[5])};this.add=function(display){display._canvas=this._canvas;display._parent=this;this.children.push(display);display._z=this.children.length};this.setCanvas=function(canvas){this._canvas=canvas;for(var i=this.children.length-1;i>-1;i--){var child=this.children[i];child.setCanvas(canvas)}};this.remove=function(display){display._canvas=null;display._parent=null;var i=this.children.indexOf(display);if(i>-1)this.children.splice(i,1)};this.isMask=function(){var obj=this;while(obj){if(obj.masked)return true;obj=obj._parent}return false};this.unmask=function(){this.masked.mask(null);this.masked=null};this.setZ=function(z){if(!this._parent)throw"CanvasObject :: Must add to parent before setZ";this._z=z;this._parent.children.sort(function(a,b){return a._z-b._z})};this.hit=function(e){if(!this.ignoreHit){var hit=Utils.hitTestObject(e,this.values.hit(this));if(hit)return this}for(var i=this.children.length-1;i>-1;i--){var child=this.children[i];hit=child.hit(e);if(hit)return child}return false};this.destroy=function(){for(var i=0;i<this.children.length;i++){if(this.children[i].destroy)this.children[i].destroy()}return Utils.nullObject(this)}});Class(function CanvasTexture(_texture,_w,_h,_force){Inherit(this,CanvasObject);var _this=this;var _mask;this.width=_w||0;this.height=_h||0;(function(){initTexture()}());function initTexture(){if(typeof _texture==="string"){_texture=CanvasTexture.createImage(_texture,_force);if(_texture.width>0)setDimensions();else _texture.onload=setDimensions}else{setDimensions()}_this.texture=_texture}function setDimensions(){if(_this.onload)_this.onload();if(!_this.width&&!_this.height){_this.width=_texture.width/(_this._canvas&&_this._canvas.retina?2:1);_this.height=_texture.height/(_this._canvas&&_this._canvas.retina?2:1)}}this.set("texture",function(img){_texture=img});this.draw=function(override){var context=this._canvas.context;if(this.isMask()&&!override)return false;if(_texture){this.startDraw(this.anchor.tx,this.anchor.ty,override);context.drawImage(_texture,-this.anchor.tx,-this.anchor.ty,this.width,this.height);this.endDraw()}if(_mask){context.globalCompositeOperation="source-in";_mask.render(true);context.globalCompositeOperation="source-over"}};this.mask=function(object){if(!object)return _mask=null;if(!this._parent)throw"CanvasTexture :: Must add to parent before masking.";var siblings=this._parent.children;var canMask=false;for(var i=0;i<siblings.length;i++){if(object==siblings[i])canMask=true}if(canMask){_mask=object;object.masked=this}else{throw"CanvasGraphics :: Can only mask a sibling"}}},function(){var _images={};CanvasTexture.createImage=function(src,force){if(!_images[src]||force){var img=Images.createImg(src);if(force)return img;_images[src]=img}return _images[src]}});Class(function CanvasValues(_style){Inherit(this,Component);var _this=this;var _styles={};var _hit={x:0,y:0,width:0,height:0};if(!_style){this.data=new Float32Array(6)}else{this.styled=false}this.set("shadowOffsetX",function(val){_this.styled=true;_styles.shadowOffsetX=val});this.get("shadowOffsetX",function(){return _styles.shadowOffsetX});this.set("shadowOffsetY",function(val){_this.styled=true;_styles.shadowOffsetY=val});this.get("shadowOffsetY",function(){return _styles.shadowOffsetY});this.set("shadowBlur",function(val){_this.styled=true;_styles.shadowBlur=val});this.get("shadowBlur",function(){return _styles.shadowBlur});this.set("shadowColor",function(val){_this.styled=true;_styles.shadowColor=val});this.get("shadowColor",function(){_this.styled=true;return _styles.shadowColor});this.get("values",function(){return _styles});this.setTRSA=function(x,y,r,sx,sy,a){var m=this.data;m[0]=x;m[1]=y;m[2]=r;m[3]=sx;m[4]=sy;m[5]=a};this.calculate=function(values){var v=values.data;var m=this.data;m[0]=m[0]+v[0];m[1]=m[1]+v[1];m[2]=m[2]+v[2];m[3]=m[3]*v[3];m[4]=m[4]*v[4];m[5]=m[5]*v[5]};this.calculateStyle=function(parent){if(!parent.styled)return false;this.styled=true;var values=parent.values;for(var key in values){if(!_styles[key])_styles[key]=values[key]}};this.hit=function(object){_hit.x=this.data[0];_hit.y=this.data[1];_hit.width=object.width;_hit.height=object.height;return _hit}});Module(function CartesianToSpherical(){function convert(lat,lon,radius){var phi=lat*Math.PI/180;var theta=(lon-180)*Math.PI/180;var x=-radius*Math.cos(phi)*Math.cos(theta);var y=radius*Math.sin(phi);var z=radius*Math.cos(phi)*Math.sin(theta);return new THREE.Vector3(x,y,z)}this.exports=convert});Class(function Firebase(){Inherit(this,Model);var _this=this;_this.isReady=false;(function(){AssetLoader.waitForLib("firebase",init)}());function init(){if(firebase){firebase.initializeApp(Config.FIREBASE||{apiKey:"AIzaSyDnCfQvAIn487klvxcgD1aKXDQj71pgFLs",authDomain:"airman-challenge-dev.firebaseapp.com",databaseURL:"https://airman-challenge-dev.firebaseio.com",storageBucket:"airman-challenge-dev.appspot.com",messagingSenderId:"613342593783"});_this.isReady=true}else{console.log("Error: Firebase not ready")}}this.ready=function(){let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"isReady");return promise}},"Static");Class(function FirebaseDB(){Inherit(this,Model);var _this=this;let _database;let NOT_READY_MESSAGE="Firebase DB is not ready";_this.isReady=false;(function(){Firebase.ready().then(init)}());function init(){_database=firebase.database();_this.isReady=true}this.ready=function(){if(Data.preventAccess())return;let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"isReady");return promise};this.database=function(){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);return _database};this.ref=function(ref){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);return _database.ref(ref)};this.read=function(ref){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);let promise=Promise.create();_database.ref(ref).once("value").then(function(snapshot){promise.resolve(snapshot.val())}).catch(function(error){promise.reject(error)});return promise};this.readList=(ref,options,exclude)=>{if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);let promise=Promise.create();let query=_database.ref(ref);if(options){if(options.limitToFirst)query=query.limitToFirst(options.limitToFirst);if(options.limitToLast)query=query.limitToLast(options.limitToLast);if(options.startAt)query=query.startAt(options.startAt);if(options.endAt)query=query.endAt(options.endAt);if(options.equalTo)query=query.equalTo(options.equalTo);if(options.orderByChild)query=query.orderByChild(options.orderByChild);if(options.orderByKey)query=query.orderByKey(options.orderByKey);if(options.orderByValue)query=query.orderByValue(options.orderByValue)}query.once("value",snapshot=>{let results=[];snapshot.forEach(function(childSnapshot){let result=childSnapshot.val();result.key=childSnapshot.key;results.push(result)});if(options&&options.reverseOrder)results=results.reverse();promise.resolve(results)});return promise};this.insert=function(ref,data){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);let promise=Promise.create();let key=_database.ref(ref).push().key;_database.ref(ref+"/"+key).set(data).then(response=>{promise.resolve(key)});return promise};this.update=function(ref,data){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);let promise=Promise.create();return _database.ref(ref).set(data).then(response=>{promise.resolve()});return promise};this.delete=function(ref){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);return _database.ref(ref).set(null)};this.deleteAll=function(ref){if(Data.preventAccess())return;if(!_database)return console.log(NOT_READY_MESSAGE);return _database.ref(ref).set(null)}},"Static");Class(function Geo(){Inherit(this,Model);var _this=this;var _data;const GOOGLE_API_KEY="AIzaSyBqCIUn5dQv1-sa8sr2Hk5WIaOB0aFdhKk";(function(){}());function get(){let promise=Promise.create();let timeout=setTimeout(error,5e3);function error(){_data={lat:0,lng:0,country:"-",countryCode:"-",state:"-",stateCode:"-",city:"-"};clearTimeout(timeout);promise.resolve(_data)}XHR.post("https://www.googleapis.com/geolocation/v1/geolocate?key="+GOOGLE_API_KEY).then(function(geolocate){if(geolocate&&geolocate.location&&geolocate.location.lat&&geolocate.location.lng){XHR.post("https://maps.googleapis.com/maps/api/geocode/json?latlng="+geolocate.location.lat+","+geolocate.location.lng+"&key="+GOOGLE_API_KEY).then(geocode=>{if(geocode.results&&geocode.results.length>0){_data={lat:geolocate.location.lat,lng:geolocate.location.lng};geocode.results[0].address_components.forEach(address=>{address.types.forEach(addressType=>{if(addressType==="country")_data.country=address.long_name;if(addressType==="country")_data.countryCode=address.short_name;if(addressType==="administrative_area_level_1")_data.state=address.long_name;if(addressType==="administrative_area_level_1")_data.stateCode=address.short_name;if(addressType==="locality")_data.city=address.long_name;if(addressType==="neighborhood")_data.neighborhood=address.long_name})});clearTimeout(timeout);promise.resolve(_data)}else{error()}})}else{error()}});return promise}this.data=function(){let promise=Promise.create();if(_data){promise.resolve(_data);return promise}else{return get()}}},"static");Class(function GPU(){Inherit(this,MVC);var _this=this;var _split={};Hydra.ready(()=>{_this.detect=function(match){if(!Device.graphics.webgl)return;return Device.graphics.webgl.detect(match)};_this.detectAll=function(){if(!Device.graphics.webgl)return;var match=true;for(var i=0;i<arguments.length;i++){if(!Device.graphics.webgl.detect(arguments[i]))match=false}return match};_this.matchGPU=function(str,min,max=99999){let num=splitGPU(str);return num>=min&&num<max};_this.gpu=Device.graphics.webgl?Device.graphics.webgl.gpu:"";function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0]);_split[string]=num;return num}catch(e){return-1}}Mobile.iOS=require("iOSDevices").find();_this.BLACKLIST=require("GPUBlacklist").match();_this.T0=function(){if(Device.mobile)return false;if(_this.BLACKLIST)return true;if(_this.detectAll("intel","hd")){return _this.matchGPU("hd graphics ",1e3,4e3)}return false}();_this.T1=function(){if(Device.mobile)return false;if(!_this.detect(["nvidia","amd"]))return true;return false}();_this.T2=function(){if(Device.mobile)return false;if(_this.detect(["nvidia","amd"]))return true;return false}();_this.T3=function(){if(Device.mobile)return false;if(_this.detect(["titan","amd radeon pro","quadro","gtx 1080 ti"]))return true;if(_this.matchGPU("gtx ",104e1))return true;return false}();_this.MT0=function(){if(!Device.mobile)return false;if(Mobile.iOS.strpos(["legacy","ipad mini 1","5x","ipad 4"]))return true;if(Mobile.os=="Android"&&_this.detect("sgx"))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",0,330);if(_this.detect("mali"))return _this.matchGPU("mali-t",0,628);return false}();_this.MT1=function(){if(!Device.mobile)return false;if(Mobile.iOS.strpos(["5s","ipad air 1"]))return true;if(Mobile.os=="Android"&&!_this.MT0)return true;return false}();_this.MT2=function(){if(!Device.mobile)return false;if(Mobile.iOS.strpos(["6x","ipad air 2"]))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",399);return false}();_this.MT3=function(){if(!Device.mobile)return false;if(Mobile.iOS.strpos(["6s","ipad pro","7x"]))return true;if(_this.detect("nvidia tegra")&&Device.detect("pixel c")){return true}if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",530);if(navigator.platform.toLowerCase().strpos("mac"))return true;return false}();_this.lt=function(num){if(_this.TIER>-1){return _this.TIER<=num}return false};_this.gt=function(num){if(_this.TIER>-1){return _this.TIER>=num}return false};_this.eq=function(num){if(_this.TIER>-1){return _this.TIER==num}return false};_this.mobileEq=function(num){if(_this.M_TIER>-1){return _this.M_TIER==num}return false};_this.mobileLT=function(num){if(_this.M_TIER>-1){return _this.M_TIER<=num}return false};_this.mobileGT=function(num){if(_this.M_TIER>-1){return _this.M_TIER>=num}return false};for(var key in _this){if(key.charAt(0)=="T"&&_this[key]===true)_this.TIER=Number(key.charAt(1));if(key.slice(0,2)=="MT"&&_this[key]===true)_this.M_TIER=Number(key.charAt(2))}_this.OVERSIZED=!Device.mobile&&_this.TIER<2&&Math.max(window.innerWidth,window.innerHeight)>144e1;_this.initialized=true});this.ready=function(){let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"initialized");return promise}},"static");Module(function GPUBlacklist(){this.exports={match:function(){if(!Device.graphics.webgl)return true;return Device.graphics.webgl.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","radeon r9 200","mali-4","mali-3","mali-2"])}}});Class(function Lighting(){Inherit(this,Component);var _this=this;var _particleDepthShader;var _lights=[];(function(){}());function loop(){decomposeLights(_lights)}function decomposeLights(lights){for(var i=lights.length-1;i>-1;i--){var light=lights[i];if(!light.parent)light.updateMatrixWorld();else if(!light.parent.parent)light.parent.updateMatrixWorld();if(!light._world)light._world=new THREE.Vector3;light.getWorldPosition(light._world)}}function updateArrays(shader){var lights=shader.lights;var lighting=shader.__lighting;var light;lighting.position.length=0;lighting.color.length=0;lighting.intensity.length=0;lighting.distance.length=0;for(var i=0;i<lights.length;i++){light=lights[i];lighting.position.push(light._world);lighting.color.push(light.color.r,light.color.g,light.color.b);lighting.intensity.push(light.intensity);lighting.distance.push(light.distance)}for(i=0;i<_lights.length;i++){light=_lights[i];lighting.position.push(light._world);lighting.color.push(light.color.r,light.color.g,light.color.b);lighting.intensity.push(light.intensity);lighting.distance.push(light.distance)}}this.add=function(light){_lights.push(light);Render.start(loop)};this.remove=function(light){_lights.findAndRemove(light)};this.getLighting=function(shader,force){if(shader.__lighting&&!force)return shader.__lighting;var lighting={position:[],color:[],intensity:[],distance:[]};shader.__lighting=lighting;if(_lights[0]&&!_lights[0]._world)decomposeLights(_lights);decomposeLights(shader.lights);updateArrays(shader);return lighting};this.update=function(shader){decomposeLights(shader.lights);updateArrays(shader)};this.getParticleDepthShader=function(light,size){if(!_particleDepthShader){_particleDepthShader=new Shader("ParticleDepth");_particleDepthShader.uniforms={pointSize:{type:"f",value:size||5},lightPos:{type:"v3",value:light.position},far:{type:"f",value:light.shadow.camera.far}};_particleDepthShader.receiveShadow=true}var shader=_particleDepthShader.clone();shader.set("pointSize",size||5);shader.set("lightPos",light.position);shader.set("far",light.shadow.camera.far);return shader}},"static");Class(function BasicPass(){Inherit(this,NukePass);var _this=this;this.fragmentShader=["varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","}"];this.init(this.fragmentShader)});Class(function FXLayer(_parentNuke,_pass){Inherit(this,Component);var _this=this;var _nuke,_rt;var _scene=new THREE.Scene;var _objects=[];var _rts={};var _id=Utils.timestamp();this.resolution=1;this.autoVisible=true;function addListeners(){_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}function initRT(){_rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr);_this.rt=_rt}function updateTopParent(obj){var parent=obj.parent;while(parent){parent.updateMatrixWorld();parent=parent.parent}}this.create=function(nuke,pass){if(!nuke)return;_this=this;_this.scene=_scene;_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr});_nuke.parentNuke=nuke;if(pass)_nuke.add(pass);_this.nuke=_nuke;initRT();addListeners()};this.addObject=function(object){if(!_nuke)return;var clone=object.clone();object["clone_"+_id]=clone;_scene.add(clone);_objects.push(object);return clone};this.removeObject=function(object){if(!_nuke)return;_scene.remove(object["clone_"+_id]);_objects.findAndRemove(object);delete object["clone_"+_id]};this.render=this.draw=function(stage,camera){if(!_nuke)return;if(!_this.forceRender&&(_parentNuke.disabled||!_objects.length))return;if(stage){_nuke.stage=stage;_this.setSize(stage.width,stage.height)}if(camera){_nuke.camera=camera}else{_nuke.camera=_nuke.parentNuke.camera}for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i];var clone=obj["clone_"+_id];if(_this.autoVisible){clone.material.visible=true;var parent=obj;while(parent){if(parent.visible==false||parent.material&&parent.material.visible==false){clone.material.visible=false}parent=parent.parent}}if(_this.forceRender){clone.material.visible=true}obj.updateMatrixWorld();if(!obj.ignoreMatrix)Utils3D.decompose(obj,clone)}_nuke.rtt=_rt;_nuke.render()};this.addPass=function(pass){if(!_nuke)return;_nuke.add(pass)};this.removePass=function(pass){if(!_nuke)return;_nuke.remove(pass)};this.setSize=function(width,height){if(!_nuke)return;if(_rt.width==width&&_rt.height==height)return;_this.events.unsubscribe(HydraEvents.RESIZE,resizeHandler);_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr);_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)};this.setDPR=function(dpr){if(!_nuke)return;_nuke.dpr=dpr};this.getObjects=function(){return _objects};if(_parentNuke instanceof Nuke)this.create(_parentNuke,_pass)});Namespace("FX");Class(function Nuke(_stage,_params){Inherit(this,Component);var _this=this;if(!_params.renderer)console.error("Nuke :: Must define renderer");_this.stage=_stage;_this.renderer=_params.renderer;_this.camera=_params.camera;_this.scene=_params.scene;_this.rtt=_params.rtt;_this.enabled=_params.enabled==false?false:true;_this.passes=_params.passes||[];var _dpr=_params.dpr||1;var _rts={};var _rtStack=[];var _rttPing,_rttPong,_nukeScene,_nukeMesh,_rttCamera;(function(){initNuke();addListeners()}());function initNuke(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,"ping");_rttPong=Nuke.getRT(width,height,"pong");_rttCamera=new THREE.OrthographicCamera(_this.stage.width/-2,_this.stage.width/2,_this.stage.height/2,_this.stage.height/-2,1,1e3);_nukeScene=new THREE.Scene;_nukeMesh=new THREE.Mesh(Nuke.getPlaneGeom(),new THREE.MeshBasicMaterial);_nukeScene.add(_nukeMesh)}function finalRender(scene,camera){if(_this.rtt){_this.renderer.render(scene,camera||_this.camera,_this.rtt)}else{_this.renderer.render(scene,camera||_this.camera)}_this.postRender&&_this.postRender()}function addListeners(){_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing.dispose();_rttPong.dispose();_rttPing=Nuke.getRT(width,height,"ping");_rttPong=Nuke.getRT(width,height,"pong");_rttCamera.left=_this.stage.width/-2;_rttCamera.right=_this.stage.width/2;_rttCamera.top=_this.stage.height/2;_rttCamera.bottom=_this.stage.height/-2;_rttCamera.updateProjectionMatrix()}_this.add=function(pass,index){if(!pass.pass){defer(function(){_this.add(pass,index)});return}if(typeof index=="number"){_this.passes.splice(index,0,pass);return}_this.passes.push(pass)};_this.remove=function(pass){if(typeof pass=="number"){_this.passes.splice(pass)}else{_this.passes.findAndRemove(pass)}};_this.renderToTexture=function(clear,rtt){_this.renderer.render(_this.scene,_this.camera,rtt||_rttPing,typeof clear=="boolean"?clear:true)};_this.render=function(){if(!_this.enabled||!_this.passes.length){finalRender(_this.scene);return}if(!_this.multiRender){_this.renderer.render(_this.scene,_this.camera,_rttPing,true)}var pingPong=true;for(var i=0;i<_this.passes.length-1;i++){_nukeMesh.material=_this.passes[i].pass;_nukeMesh.material.uniforms.tDiffuse.value=pingPong?_rttPing.texture:_rttPong.texture;_this.renderer.render(_nukeScene,_rttCamera,pingPong?_rttPong:_rttPing);pingPong=!pingPong}_nukeMesh.material=_this.passes[_this.passes.length-1].pass;_nukeMesh.material.uniforms.tDiffuse.value=pingPong?_rttPing.texture:_rttPong.texture;finalRender(_nukeScene,_rttCamera)};_this.setSize=function(width,height){_this.events.unsubscribe(HydraEvents.RESIZE,resizeHandler);if(!_rts[width+"_"+height]){var rttPing=Nuke.getRT(width*_dpr,height*_dpr,"ping");var rttPong=Nuke.getRT(width*_dpr,height*_dpr,"pong");_rts[width+"_"+height]={ping:rttPing,pong:rttPong,name:width+"_"+height};_rtStack.push(_rts[width+"_"+height]);if(_rtStack.length>3){let rts=_rtStack.shift();delete _rts[rts.name];rts.ping.dispose();rts.pong.dispose()}}var rts=_rts[width+"_"+height];_rttPing=rts.ping;_rttPong=rts.pong};_this.set("dpr",function(v){_dpr=v||Device.pixelRatio;resizeHandler()});_this.get("dpr",function(){return _dpr});_this.get("output",function(){return _nukeMesh.material.uniforms?_nukeMesh.material.uniforms.tDiffuse.value:null})},function(){var _plane;var _rts={};Nuke.getPlaneGeom=function(){if(!_plane)_plane=new THREE.PlaneBufferGeometry(2,2,1,1);return _plane};Nuke.getRT=function(width,height,type){return Utils3D.createRT(width,height)}});Class(function NukePass(_fs,_vs,_pass){Inherit(this,Component);var _this=this;this.name=typeof _fs=="string"?_fs:Hydra.getClassName(_fs);function prefix(code){if(!code)throw`No shader ${_fs} found`;var pre="";pre+="precision highp float;\n";pre+="precision highp int;\n";if(!code.strpos("uniform sampler2D tDiffuse")){pre+="uniform sampler2D tDiffuse;\n";pre+="varying vec2 vUv;\n"}code=pre+code;return code}function getVS(){return`
        precision highp float;
        precision highp int;

        varying vec2 vUv;

        attribute vec2 uv;
        attribute vec3 position;

        void main() {
            vUv = uv;
            gl_Position = vec4(position, 1.0);
        }
        `}this.init=function(fs){if(_this.pass)return;_this=this;var name=fs||this.constructor.toString().match(/function ([^\(]+)/)[1];var fragmentShader=Array.isArray(fs)?fs.join(""):null;_this.uniforms=_this.uniforms||{};_this.uniforms.tDiffuse={type:"t",value:null};_this.pass=new THREE.RawShaderMaterial({uniforms:_this.uniforms,vertexShader:typeof _vs==="string"?Shaders.getShader(name+".vs"):getVS(),fragmentShader:fragmentShader||prefix(Shaders.getShader(name+".fs"))});_this.uniforms=_this.pass.uniforms};this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]);this.uniforms[key].value=value};this.tween=function(key,value,time,ease,delay,callback,update){TweenManager.tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.clone=function(){if(!_this.pass)_this.init(_fs);return new NukePass(null,null,_this.pass.clone())};if(typeof _fs==="string"){defer(function(){_this.init(_fs)})}else if(_pass){_this.pass=_pass;_this.uniforms=_pass.uniforms}});Class(function Raycaster(_camera){Inherit(this,Component);var _this=this;var _mouse=new THREE.Vector3;var _raycaster=new THREE.Raycaster;var _debug=null;(function(){}());function intersect(objects){var hit;if(Array.isArray(objects)){hit=_raycaster.intersectObjects(objects)}else{hit=_raycaster.intersectObject(objects)}if(_debug)updateDebug();return hit}function updateDebug(){var vertices=_debug.geometry.vertices;vertices[0].copy(_raycaster.ray.origin.clone());vertices[1].copy(_raycaster.ray.origin.clone().add(_raycaster.ray.direction.clone().multiplyScalar(1e4)));_debug.geometry.verticesNeedUpdate=true}this.set("camera",function(camera){_camera=camera});this.set("pointsThreshold",function(value){_raycaster.params.Points.threshold=value});this.debug=function(scene){var geom=new THREE.Geometry;geom.vertices.push(new THREE.Vector3(-100,0,0));geom.vertices.push(new THREE.Vector3(100,0,0));var mat=new THREE.LineBasicMaterial({color:1671168e1});_debug=new THREE.Line(geom,mat);scene.add(_debug)};this.checkHit=function(objects,mouse){mouse=mouse||Mouse;var rect=_this.rect||Stage;_mouse.x=mouse.x/rect.width*2-1;_mouse.y=-(mouse.y/rect.height)*2+1;_raycaster.setFromCamera(_mouse,_camera);return intersect(objects)};this.checkFromValues=function(objects,origin,direction){_raycaster.set(origin,direction,0,Number.POSITIVE_INFINITY);return intersect(objects)}});Class(function ScreenProjection(_camera){Inherit(this,Component);var _this=this;var _v3=new THREE.Vector3;var _v32=new THREE.Vector3;var _value=new THREE.Vector3;(function(){}());this.set("camera",function(v){_camera=v});this.unproject=function(mouse,distance){var rect=_this.rect||Stage;_v3.set(mouse.x/rect.width*2-1,-(mouse.y/rect.height)*2+1,.5);_v3.unproject(_camera);var pos=_camera.position;_v3.sub(pos).normalize();var dist=distance||-pos.z/_v3.z;_value.copy(pos).add(_v3.multiplyScalar(dist));return _value};this.project=function(pos,screen){screen=screen||Stage;if(pos instanceof THREE.Object3D){pos.updateMatrixWorld();_v32.set(0,0,0).setFromMatrixPosition(pos.matrixWorld)}else{_v32.copy(pos)}_v32.project(_camera);_v32.x=(_v32.x+1)/2*screen.width;_v32.y=-(_v32.y-1)/2*screen.height;return _v32}});Class(function Shader(_vertexShader,_fragmentShader,_name,_material){Inherit(this,Component);var _this=this;this.receiveShadow=false;this.receiveLight=false;this.lights=[];this.uniforms={};this.name=_vertexShader;(function(){if(!_fragmentShader)_fragmentShader=_vertexShader;if(Hydra.LOCAL&&_name)expose();if(_material){_this.uniforms=_material.uniforms;_this.attributes=_material.attributes;defer(function(){if(_this.receiveLight){initLights();Render.start(updateLights)}})}}());function expose(){Dev.expose(_name,_this)}function process(code,type){var lights=initLights();var header="";if(!_this.useShaderMaterial&&!_this.receiveShadow){if(type=="vs"){header=["precision highp float;","precision highp int;","attribute vec2 uv;","attribute vec3 position;","attribute vec3 normal;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;",""].join("\n")}else{header=[code.strpos("dFdx")?"#extension GL_OES_standard_derivatives : enable":"","precision highp float;","precision highp int;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;",""].join("\n")}}else{if(type=="fs"){header=["uniform mat4 modelViewMatrix;",""].join("\n")}}code=lights+code;code=header+code;var threeChunk=function(a,b){return THREE.ShaderChunk[b]+"\n"};return code.replace(/#s?chunk\(\s?(\w+)\s?\);/g,threeChunk)}function initLights(){if(!_this.receiveLight)return"";var lighting=Lighting.getLighting(_this);var numLights=lighting.position.length;if(numLights==0){if(!Shader.disableWarnings)console.warn("Lighting enabled but 0 lights added. Be sure to add them before calling shader.material");return""}return["#define NUM_LIGHTS "+numLights,"uniform vec3 lightPos["+numLights+"];","uniform vec3 lightColor["+numLights+"];","uniform float lightIntensity["+numLights+"];","uniform float lightDistance["+numLights+"];",""].join("\n")}function updateMaterialLight(lighting){_material.uniforms.lightPos={type:"v3v",value:lighting.position};_material.uniforms.lightColor={type:"fv",value:lighting.color};_material.uniforms.lightIntensity={type:"fv1",value:lighting.intensity};_material.uniforms.lightDistance={type:"fv1",value:lighting.distance};Render.start(updateLights)}function updateLights(){if(_material.visible!==false)Lighting.update(_this,true)}this.get("material",function(){if(!_material){var params={};params.vertexShader=process(Shaders.getShader(_vertexShader+".vs")||_vertexShader,"vs");params.fragmentShader=process(Shaders.getShader(_fragmentShader+".fs")||_fragmentShader,"fs");if(_this.attributes)params.attributes=_this.attributes;if(_this.uniforms)params.uniforms=_this.uniforms;if(_this.receiveShadow){for(var key in THREE.UniformsLib.lights){params.uniforms[key]=THREE.UniformsLib.lights[key]}}_material=_this.receiveShadow||_this.useShaderMaterial?new THREE.ShaderMaterial(params):new THREE.RawShaderMaterial(params);_material.shader=_this;_this.uniforms=_material.uniforms;if(_this.receiveLight)updateMaterialLight(_this.__lighting);if(_this.receiveShadow){_material.lights=true;if(params.vertexShader.strpos("dFdx"))_material.extensions.derivatives=true}}return _material});this.set=function(key,value){if(typeof value!=="undefined")_this.uniforms[key].value=value;return _this.uniforms[key].value};this.getValues=function(){var out={};for(var key in _this.uniforms){out[key]=_this.uniforms[key].value}return out};this.copyUniformsTo=function(obj){for(var key in _this.uniforms){obj.uniforms[key]=_this.uniforms[key]}};this.cloneUniformsTo=function(obj){for(var key in _this.uniforms){obj.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value}}};this.tween=function(key,value,time,ease,delay,callback,update){return TweenManager.tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.clone=function(name){var shader=new Shader(_vertexShader,_fragmentShader,name||_name,_this.material.clone());shader.receiveLight=this.receiveLight;shader.receiveShadow=this.receiveShadow;shader.lights=this.lights;shader.material.shader=shader;return shader};this.updateLighting=function(){var lighting=Lighting.getLighting(_this,true);_material.uniforms.lightPos.value=lighting.position;_material.uniforms.lightColor.value=lighting.color;_material.uniforms.lightIntensity.value=lighting.intensity;_material.uniforms.lightDistance.value=lighting.distance};this.onDestroy=function(){Render.stop(updateLights);_material&&_material.dispose&&_material.dispose()}},()=>{Shader.copyUniforms=function(to,from){for(var key in from.uniforms){to.uniforms[key]=from.uniforms[key]}}});Class(function ParticlePhysicsBufferConverter(_geom,_system){Inherit(this,Component);var _this=this;var _convert=[];var _particles=_system.particles;_convert.push({name:"position",props:["x","y","z"],size:3});this.add=function(name,props){let obj={name,props,size:props.length};_convert.push(obj);return obj};this.exec=function(){var index=0;var p=_particles.start();while(p){for(var i=_convert.length-1;i>-1;i--){var obj=_convert[i];if(obj.disabled)continue;var attribute=_geom.attributes[obj.name];for(var j=0;j<obj.size;j++){attribute.array[index*obj.size+j]=p[obj.props[j]]||p.pos[obj.props[j]]||0}attribute.needsUpdate=true}++index;p=_particles.next()}};this.find=function(name){for(let i=0;i<_convert.length;i++){let obj=_convert[i];if(obj.name==name)return obj}}});Class(function RandomEulerRotation(_container){var _this=this;var _euler=["x","y","z"];var _rot;this.speed=1;(function(){initRotation()}());function initRotation(){_rot={};_rot.x=Utils.doRandom(0,2);_rot.y=Utils.doRandom(0,2);_rot.z=Utils.doRandom(0,2);_rot.vx=Utils.doRandom(-5,5)*.0025;_rot.vy=Utils.doRandom(-5,5)*.0025;_rot.vz=Utils.doRandom(-5,5)*.0025}this.update=function(){var time=Render.TIME;for(var i=0;i<3;i++){var v=_euler[i];switch(_rot[v]){case 0:_container.rotation[v]+=Math.cos(Math.sin(time*.25))*_rot["v"+v]*_this.speed;break;case 1:_container.rotation[v]+=Math.cos(Math.sin(time*.25))*_rot["v"+v]*_this.speed;break;case 2:_container.rotation[v]+=Math.cos(Math.cos(time*.25))*_rot["v"+v]*_this.speed;break}}};this.startRender=function(){Render.start(_this.update)};this.stopRender=function(){Render.stop(_this.update)};this.onDestroy=function(){this.stopRender()}});Class(function Utils3D(){var _this=this;var _objectLoader,_geomLoader,_bufferGeomLoader;var _textures={};this.PATH="";this.decompose=function(local,world){local.matrixWorld.decompose(world.position,world.quaternion,world.scale)};this.createDebug=function(size,color){var geom=new THREE.IcosahedronGeometry(size||40,1);var mat=color?new THREE.MeshBasicMaterial({color:color}):new THREE.MeshNormalMaterial;return new THREE.Mesh(geom,mat)};this.createRT=function(width,height){var params={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false};return new THREE.WebGLRenderTarget(width,height,params)};this.getTexture=function(path){if(!_textures[path]){var img=new Image;img.crossOrigin="anonymous";img.src=_this.PATH+path;var texture=new THREE.Texture(img);texture.promise=Promise.create();img.onload=function(){texture.needsUpdate=true;texture.promise.resolve();if(texture.onload){texture.onload();texture.onload=null}if(!THREE.Math.isPowerOfTwo(img.width*img.height))texture.minFilter=THREE.LinearFilter};texture._dispose=texture.dispose;texture.dispose=function(){delete _textures[path];this._dispose()};_textures[path]=texture}return _textures[path]};this.setInfinity=function(v){var inf=Number.POSITIVE_INFINITY;v.set(inf,inf,inf);return v};this.freezeMatrix=function(mesh){mesh.matrixAutoUpdate=false;mesh.updateMatrix()};this.getCubemap=function(src){var path="cube_"+(Array.isArray(src)?src[0]:src);if(!_textures[path]){var images=[];for(var i=0;i<6;i++){var img=new Image;img.crossOrigin="";img.src=_this.PATH+(Array.isArray(src)?src[i]:src);images.push(img);img.onload=function(){_textures[path].needsUpdate=true}}_textures[path]=new THREE.Texture;_textures[path].image=images;_textures[path].minFilter=THREE.LinearFilter}return _textures[path]};this.loadObject=function(name){let json=typeof name=="object"?name:Hydra.JSON[name];if(json.type=="hydra_c4d"){let group=new THREE.Group;let mat=new THREE.MeshBasicMaterial({wireframe:true,color:104448e1});json.geometries.forEach(obj=>{let data=obj.data;let geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));let mesh=new THREE.Mesh(geometry,mat);mesh.position.copy(obj.position);mesh.rotation.x=obj.rotation.x;mesh.rotation.y=obj.rotation.y;mesh.rotation.z=obj.rotation.z;mesh.scale.copy(obj.scale);mesh.name=obj.id;group.add(mesh)});return group}else{if(!_objectLoader)_objectLoader=new THREE.ObjectLoader;return _objectLoader.parse(Hydra.JSON[name])}};this.loadGeometry=function(name){if(!_geomLoader)_geomLoader=new THREE.JSONLoader;if(!_bufferGeomLoader)_bufferGeomLoader=new THREE.BufferGeometryLoader;var json=Hydra.JSON[name];if(json.type=="BufferGeometry"){return _bufferGeomLoader.parse(json)}else{return _geomLoader.parse(json.data).geometry}};this.disposeAllTextures=function(){for(var key in _textures){_textures[key].dispose()}};this.disableWarnings=function(){window.console.warn=function(str,msg){};window.console.error=function(){}};this.detectGPU=function(matches){var gpu=_this.GPU_INFO;if(gpu.gpu&&gpu.gpu.strpos(matches))return true;if(gpu.version&&gpu.version.strpos(matches))return true;return false};this.loadBufferGeometry=function(name){var data=Hydra.JSON[name];var geometry=new THREE.BufferGeometry;if(data.data)data=data.data;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal||data.position.length),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv||data.position.length/3*2),2));return geometry};this.loadSkinnedGeometry=function(name){var data=Hydra.JSON[name];var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));geometry.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(data.skinIndices),4));geometry.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(data.skinWeights),4));geometry.bones=data.bones;return geometry};this.loadCurve=function(obj){if(typeof obj==="string")obj=Hydra.JSON[obj];var data=obj;var points=[];for(var j=0;j<data.length;j+=3){points.push(new THREE.Vector3(data[j+0],data[j+1],data[j+2]))}return new THREE.CatmullRomCurve3(points)};this.setLightCamera=function(light,size,near,far,texture){light.shadow.camera.left=-size;light.shadow.camera.right=size;light.shadow.camera.top=size;light.shadow.camera.bottom=-size;light.castShadow=true;if(near)light.shadow.camera.near=near;if(far)light.shadow.camera.far=far;if(texture)light.shadow.mapSize.width=light.shadow.mapSize.height=texture;light.shadow.camera.updateProjectionMatrix()};this.getRepeatTexture=function(src){var texture=this.getTexture(src);texture.onload=function(){texture.wrapS=texture.wrapT=THREE.RepeatWrapping};return texture};this.forceVisible=function(group){let setProperties=obj=>{if(typeof obj.visible!=="undefined"){obj.__visible=obj.visible;obj.visible=true}if(typeof obj.frustumCulled!=="undefined"){obj.__frustumCulled=obj.frustumCulled;obj.frustumCulled=false}};let children=group.children;children.forEach(child=>{setProperties(child);if(child.material)setProperties(child.material);_this.forceVisible(child)})};this.resetForceVisible=function(group){let setProperties=obj=>{if(typeof obj.__visible!=="undefined"){obj.visible=obj.__visible;delete obj.__visible}if(typeof obj.__frustumCulled!=="undefined"){obj.frustumCulled=obj.__frustumCulled;delete obj.__frustumCulled}};let children=group.children;children.forEach(child=>{setProperties(child);if(child.material)setProperties(child.material);_this.resetForceVisible(child)})};this.findTexturesByPath=function(path){let array=[];for(let key in _textures){if(key.strpos(path))array.push(_textures[key])}return array}},"static");Class(function Interaction3D(_meshes,_camera){Inherit(this,Component);var _this=this;var _hover,_click;var _ray=_this.initClass(Raycaster,_camera);var _v3=new THREE.Vector3;this.cursor="auto";function facingAway(mesh){mesh.getWorldPosition(_v3);var dot=_v3.dot(_camera.position);return dot<0}function touchStart(e){if(Device.mobile)touchMove(e);let hit=_ray.checkHit(_meshes,e)[0];if(hit){if(facingAway(hit.object))return;_click=hit.object;_click.time=Render.TIME;_hover=null}else{Stage.css("cursor","auto")}}function touchMove(e){let hit=_ray.checkHit(_meshes,Mouse)[0];if(!hit){if(_hover){_this.events.fire(Interaction3D.HOVER,{action:"out",mesh:_hover},true);Stage.css("cursor",_this.cursor);_hover=null}}else{let mesh=hit.object;if(_hover!=mesh){if(facingAway(hit.object))return;_hover&&_this.events.fire(Interaction3D.HOVER,{action:"out",mesh:_hover},true);_this.events.fire(Interaction3D.HOVER,{action:"over",mesh:mesh},true);Stage.css("cursor","pointer")}_hover=mesh}}function touchEnd(e){Stage.css("cursor",_this.cursor);if(!_click)return;let hit=_ray.checkHit(_meshes,e)[0];if(hit&&hit.object==_click){if(Render.TIME-_click.time<750)_this.events.fire(Interaction3D.CLICK,{action:"click",mesh:_click},true)}_click=null}this.set("camera",c=>{_ray.camera=c;_camera=c});this.addListeners=function(){Stage.bind("touchstart",touchStart);Stage.bind("touchmove",touchMove);Stage.bind("touchend",touchEnd)};this.removeListeners=function(){Stage.unbind("touchstart",touchStart);Stage.unbind("touchmove",touchMove);Stage.unbind("touchend",touchEnd)}},()=>{Interaction3D.HOVER="interaction3d_hover";Interaction3D.CLICK="interaction3d_click"});Module(function iOSDevices(){this.exports={find:function(){if(Mobile.os!="iOS")return"";if(!Device.graphics.webgl)return"legacy";var detect=Device.graphics.webgl.detect;if(detect(["a9","a10","a11","a12","a13","a14"])||navigator.platform.toLowerCase().strpos("mac"))return Mobile.phone?"6s, 7x":"ipad pro";if(detect("a8"))return Mobile.phone?"6x":"ipad air 2, ipad mini 4";if(detect("a7"))return Mobile.phone?"5s":"ipad air 1, ipad mini 2, ipad mini 3";if(detect(["sgx554","sgx 554"]))return Mobile.phone?"":"ipad 4";if(detect(["sgx543","sgx 543"]))return Mobile.phone?"5x, 5c, 4s":"ipad mini 1, ipad 2";return"legacy"}}});Class(function KeyboardUtil(){Inherit(this,Component);var _this=this;_this.DOWN="keyboard_down";_this.PRESS="keyboard_press";_this.UP="keyboard_up";(function(){Hydra.ready(addListeners)}());function addListeners(){__window.keydown(keydown);__window.keyup(keyup);__window.keypress(keypress)}function keydown(e){_this.events.fire(_this.DOWN,e)}function keyup(e){_this.events.fire(_this.UP,e)}function keypress(e){_this.events.fire(_this.PRESS,e)}},"static");Class(function ScrollUtil(){Inherit(this,Component);var _this=this;var _divide;var _callbacks=[];var _time=Date.now();var _touch={y:0,save:0};var _wheel=false;var _delta={};(function(){initDivide();Hydra.ready(addListeners)}());function initDivide(){if(Device.browser.ie)return _divide=2;if(Device.system.os=="mac"){if(Device.browser.chrome||Device.browser.safari)_divide=40;else _divide=1}else{if(Device.browser.chrome)_divide=15;else _divide=.5}}function addListeners(){if(!Device.mobile){window.addEventListener("wheel",scroll)}else{__window.bind("touchstart",touchStart);__window.bind("touchend",touchEnd);__window.bind("touchcancel",touchEnd)}}function touchStart(e){_touch.y=e.y;_touch.time=Date.now();_touch.velocity=0;__window.bind("touchmove",touchMove)}function touchMove(e){var diff=e.y-_touch.y;_touch.y=e.y;_touch.velocity=diff/(_touch.time-Date.now());_touch.time=Date.now();callback(-diff)}function touchEnd(e){__window.unbind("touchmove",touchMove);callback(_touch.velocity*100||0,_touch)}function keyPress(e){var value=750;if(e.code==40)scroll({deltaY:value,deltaX:0,key:true});if(e.code==39)scroll({deltaY:0,deltaX:value,key:true});if(e.code==38)scroll({deltaY:-value,deltaX:0,key:true});if(e.code==37)scroll({deltaY:0,deltaX:-value,key:true})}function scroll(e){var value=e.wheelDelta||-e.detail;var timeDelta=Render.TIME-_time;if(typeof e.deltaX!=="undefined"||e.key){_delta.x=-e.deltaX*.4;_delta.y=e.deltaY*.4;if(Device.browser.firefox&&Device.system.os=="mac"){_delta.y*=.5;if(timeDelta<50)_delta.y*=30}}else{_delta.x=0;var delta=Math.ceil(-value/_divide);if(delta<=0)delta-=1;delta=Utils.clamp(delta,-60,60);_delta.y=delta*3.5}if(Device.browser.firefox&&Device.system.os.strpos("windows"))_delta.y*=10;callback(_delta);_time=Render.TIME;if(!Device.mobile){if(Math.abs(_delta.y)<1)_this.TRACKPAD=true;if(Math.abs(_delta.y)>100)_this.TRACKPAD=false}}function callback(delta){for(var i=0;i<_callbacks.length;i++)_callbacks[i](delta)}this.reset=function(){this.value=0};this.link=function(callback){_callbacks.push(callback)};this.unlink=function(callback){var index=_callbacks.indexOf(callback);if(index>-1)_callbacks.splice(index,1)}},"Static");Class(function Share(){Inherit(this,Model);var _this=this;var _debug=localStorage.share_debug||false;var _share={tw:twitter,fb:facebook};var _copy={title:"Airman Challenge",url:Config.SITE_URL,text:"FPO Share Copy",img:`${Config.SITE_URL}assets/meta/airman-meta.png`};var _popups={};(function(){_this.events.subscribe(AirmanEvents.LOADED,()=>{initTags();initDebug()})}());function initTags(){let config={facebook:Config.FACEBOOK_APP_ID};let tags=require("ShareTags");tags.init(config)}function initDebug(){Dev.expose("shareDebug",_this.debug)}function popWindow(url,name,w,h){_popups[name]=window.open(url,name,"height="+h+",width="+w+",scrollbars=yes");if(_popups[name].focus)_popups[name].focus();return false}function encodeURI(str){return encodeURIComponent(str)}function twitter(info){var height=400;var width=500;var url="https://twitter.com/intent/tweet?text="+encodeURI((info.copy||_copy.text)+" "+_copy.url);popWindow(url,"tw",width,height)}function facebook(info){if(!window.FB)return;FB.ui({method:"feed",name:_copy.title,picture:info.img||_copy.img,link:_copy.url,description:(info.copy||_copy.text)+" "+_copy.url},function(){})}function checkAchievement(){let achievement=Storage.get("achievementCyberWarrior")||0;if(Number(achievement)>=2){Data.UserAchievements.unlock("cyber-warrior");achievement=0}achievement++;Storage.set("achievementCyberWarrior",achievement)}this.fire=function(type,info){_share[type](info);checkAchievement()};this.debug=function(bool){_debug=bool;Storage.set("share_bebug",bool)};this.openPopup=popWindow;this.closePopup=function(name){_popups[name].close()}},"static");Module(function ShareTags(){var _this=this;var tags={facebook:function(id){window.fbAsyncInit=function(){FB.init({appId:id,xfbml:true,version:"v2.8"})};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return}js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/sdk.js";fjs.parentNode.insertBefore(js,fjs)}(document,"script","facebook-jssdk"))},gplus:function(){var btns=[];var script=document.createElement("script");script.src="https://apis.google.com/js/platform.js";script.async="defer";_this.SETTINGS.gplus.buttons.forEach(function(id,i){var btn=document.createElement("div");btn.id=id;btn.style.top=-1e4+"px";btn.style.left=-1e4+"px";btns.push(btn)});Hydra.ready(function(){defer(function(){btns.forEach(function(btn,i){document.body.insertBefore(btn,i>0?document.body.children[i]:document.body.firstChild)});document.body.parentNode.insertBefore(script,document.body.nextSibling)})})},twitter:function(){}};this.exports={init:function(config){for(var key in config){if(!tags[key])throw"No key "+key+" found in Analytics";_this.exports[key]=true;tags[key](config[key])}}}});Class(function ShareDynamic(){Inherit(this,Model);var _this=this;var $container;var _loader,_timer,_image;var _url=Config.SITE_URL;var _siteUrl=`${Config.SITE_URL}`;var _imageUrl=`${_siteUrl}#upload`;var _shareURL=`${_siteUrl}#dynamicShare`;var _title=`Airman Challenge`;var _blue="#0e182d";var _copy={heading:{text:"APTITUDE TEST",fontStyle:"StratumBlack",spacing:0,fontSize:20,x:590,y:285,fill:true,paddingSide:10,paddingTop:5,color:_blue},subheading:{text:"CUMULATIVE SCORE",fontStyle:"StratumBold",spacing:0,fontSize:48,center:true,y:115},atr1:{text:"MEMORY",fontStyle:"StratumBlack",spacing:2,fontSize:14,x:-25,y:35,graph:true,left:true,top:true},atr2:{text:"SPEED",fontStyle:"StratumBlack",spacing:2,fontSize:14,x:-35,y:35,graph:true,left:false,top:true},atr3:{text:"ACCURACY",fontStyle:"StratumBlack",spacing:2,fontSize:14,x:-42,y:-25,graph:true,left:true,top:false},atr4:{text:"READINESS",fontStyle:"StratumBlack",spacing:2,fontSize:14,x:-35,y:-25,graph:true,left:false,top:false},linkCopy:{text:"VISIT",fontStyle:"DIN",spacing:0,fontSize:17,x:865,y:590},linkHref:{text:"WWW.AIRMANCHALLENGE.COM",fontStyle:"DINBold",spacing:0,fontSize:16,x:910,y:590}};var _prefilledText="FPO SHARE";(function(){Hydra.ready(()=>{FontLoader.loadFonts(["DIN","DINBold","Digital7","StratumBold","StratumBlack"])})}());function upload(image){let promise=Promise.create();let id=Utils.timestamp();XHR.post(Config.API+"share/shareImage",{image,id},function(data){promise.resolve(data)});return promise}function encode(str){return encodeURIComponent(str)}function twitter(imgID){var text=`${Storage.get("share-copy")} ${Config.SHARE_URL}?${imgID}`;return"https://twitter.com/intent/tweet?text="+encode(text)}function facebook(imgID,fullURL){let appId=Config.FACEBOOK_APP_ID;let img=fullURL;let text=Storage.get("share-copy");return"https://www.facebook.com/dialog/feed?"+"app_id="+appId+"&display=popup"+"&description="+encode(text)+"&link="+encode(`${_url}`)+"&name="+encode(_title)+"&picture="+encode(img)}function redirect(type,data,full){if(type==="fb")return getURL(facebook(data,full));if(type==="tw")return getURL(twitter(data));if(type==="download")return getURL(`${_imageUrl}${data}.png`)}function updatePopup(type,data,full){if(type==="fb")return window.location=facebook(data,full);if(type==="tw")return window.location=twitter(data);if(type==="download")return window.location=`${_imageUrl}${data}.png`}function checkAchievement(){let achievement=Storage.get("achievementCyberWarrior")||0;if(achievement>=2){Data.UserAchievements.unlock("cyber-warrior");achievement=0}achievement++;Storage.set("achievementCyberWarrior",achievement)}this.save=function(settings){if(Device.mobile||Device.browser.safari&&Device.browser.version<10||Device.browser.ie)return _this.popup("download");_image=_this.initClass(ShareDynamicImage,_copy,settings);_image.getData(data=>{var download=document.createElement("a");download.href=data;download.download="SocialDownload.jpg";if(Device.browser.firefox){document.body.appendChild(download);download.click();document.body.removeChild(download)}else{download.click()}})};this.popup=function(type,settings){let id=`image_${Utils.timestamp()}?${type}`;Storage.set("share-type",type);checkAchievement();if(settings.mission)_copy.subheading.text=`MISSION: ${settings.mission.toUpperCase()}`;_image=_this.initClass(ShareDynamicImage,_copy,type,settings);_image.getData(data=>{upload(data).then(function(data){if(Mobile.browser=="Social"){Stage.interact(null,function(){redirect(type,data.url)})}else{Storage.set(id,data.url);Storage.set("fullShareURL",data.fullURL)}})});if(Mobile.browser=="Social")return;var nw=window.open(`${_siteUrl}#dynamicShare/${id}`,`share${id}`,"height="+500+",width="+500+",scrollbars=yes");if(window.focus&&nw.focus)nw.focus()};this.create=function(id,type){$container=Stage.create("share-container");$container.css({width:Stage.width,height:Stage.height});_loader=_this.initClass(ShareDynamicLoader,[$container]);_loader.animateIn();var removeLoader=function(data,full){_loader.animateOut(()=>{updatePopup(type,data,full)})};var check=function(){let data=Storage.get(id);let full=Storage.get("fullShareURL");if(!data){clearTimeout(_timer);_timer=_this.delayedCall(check,300)}else{removeLoader(data,full)}};check()}},"static");Class(function ShareDynamicImage(_copy,_type,_settings){Inherit(this,Component);var _this=this;var _bgImage=Config.CDN+"assets/share/"+""+".png";var _canvas,_bg,_logo,_callback;var _specs={width:12e2,height:630};var _offset=150;var _size=320;var _top=170;var _bgURL=`assets/images/ui/share/aptitude.jpg`;var _logoURL=`assets/images/ui/common/logo.png`;(function(){initCanvas();initImages()}());function initCanvas(){_canvas=_this.initClass(Canvas,_specs.width,_specs.height)}function initImages(){let promise=img=>{let p=Promise.create();img.onload=p.resolve;return p};_logo=Images.createImg(_logoURL);_bg=Images.createImg(_bgURL);Promise.all([promise(_bg),promise(_logo)]).then(finishSetup)}function finishSetup(){_canvas.context.drawImage(_bg,0,0,_specs.width,_specs.height);_canvas.context.drawImage(_logo,25,25,80,62);_canvas.context.drawImage(_settings.img.canvas.div,_offset,_top,_size,_size);for(var line in _copy){if(_copy[line].fill)createFill(_copy[line]);createText(_copy[line])}if(_settings.stats)createStats();let data=_canvas.toDataURL("image/jpeg",.75);_callback(data)}function createFill(data){_canvas.context.font=data.fontSize+"px "+data.fontStyle;_canvas.context.fillStyle=data.color||"#fff";let characters=data.text.split("");let height=data.fontSize;let width=0;for(var i=0;i<characters.length;i++){width+=_canvas.context.measureText(characters[i]).width+data.spacing}_canvas.context.fillStyle=data.fillColor||"#fff";_canvas.context.rect(data.x-data.paddingSide,data.y+2-(height+data.paddingTop),width+data.paddingSide*2,height+data.paddingTop*2);_canvas.context.fill()}function createStats(){let stats=_settings.stats;stats.sort((a,b)=>{return b.perc-a.perc});let y=360;let mainSize=72;let subSize=24;let offset=.75;let x=575;Storage.set("share-copy",stats[0].share[_type]);stats.forEach((stat,i)=>{createText({text:`${stat.copy.toUpperCase()}: ${(stat.perc*100).toFixed(1)}%`,fontStyle:"StratumBold",spacing:0,fontSize:i===0?mainSize:subSize,x,y});y+=(i===0?(mainSize-45)*offset:subSize*offset)+10;if(i===0)x+=5})}function createText(data){let totalWidth=0;_canvas.context.font=data.fontSize+"px "+data.fontStyle;_canvas.context.fillStyle=data.color||"#fff";let characters=data.text.split("");for(var i=0;i<characters.length;i++){totalWidth+=_canvas.context.measureText(characters[i]).width+data.spacing}let currentPosition=data.center?(_specs.width-totalWidth)/2:data.x;if(data.graph){currentPosition+=_offset;if(!data.left)currentPosition+=_size}let index=0,chr;do{let top=data.y;if(data.graph){top+=_top;if(!data.top)top+=_size}chr=characters[index++];_canvas.context.fillText(chr,currentPosition,top);currentPosition+=_canvas.context.measureText(chr).width+data.spacing}while(index<data.text.length)}this.getData=function(callback){_callback=callback}});Class(function ShareDynamicLoader(){Inherit(this,View);var _this=this;var $this,$bg,$spin;var _data,_anim,_connection,_finish;var _blue="#0e182d";(function(){initHTML();initText()}());function initHTML(){$this=_this.element;$this.size("100%").css({opacity:0}).setZ(-1);Stage.add($this);$bg=$this.create("bg");$bg.size("100%").bg("#fff")}function initText(){$spin=$this.create(".spin");$spin.size(120,120).center().css({opacity:1});$spin.inner=$spin.create(".inner");$spin.inner.size(120,120).bg(Config.IMAGES+"ui/common/spin-blue.png").css({opacity:1});_data=_this.initClass(FlashText,{quick:true,text:"CONSTRUCTING SHARE",color:"#fff",size:18,fill:true,fillColor:_blue});_data.element.center().css({marginTop:-13});_anim=_this.initClass(CSSAnimation);_anim.duration=7e3;_anim.loop=true;_anim.frames=[{rotation:0},{rotation:360}];_anim.applyTo($spin)}this.animateIn=function(callback){$this.setZ(9999);_this.delayedCall(_data.animateIn,100);_anim.play();$spin.css({opacity:0}).tween({opacity:1},500,"easeOutSine");$this.tween({opacity:1},500,"easeOutSine",callback)};this.animateOut=function(delay,callback){if(!delay)delay=0;if(typeof delay==="function"){callback=delay;delay=0}$spin.tween({opacity:0},500,"easeOutSine");_this.delayedCall(_data.animateOut,200);$this.tween({opacity:0},700,"easeInOutSine",delay,()=>{if(callback)callback();$this.setZ(-1)})}});Class(function ShaderUIL(){Inherit(this,Component);var _this=this;var _uil,_active;var _groups=[];function initUIL(){if(!Global.UIL){_uil=new UIL.Gui({css:"top: 0; right: 50px;",size:300,center:true});Stage.add(_uil)}else{_uil=Global.UIL}}this.activate=function(){_active=true;if(window.UIL)initUIL()};this.push=function(shader){if(!_uil){if(_active&&window.UIL)initUIL();else return}let group=new ShaderUILGroup(shader,_uil);_groups.push(group)};this.list=function(){_groups.forEach(group=>group.console())};this.clear=function(){_groups.forEach(group=>group.clear())}},"singleton");Class(function ShaderUILGroup(_shader,_uil){Inherit(this,Component);var _this=this;var _group=_uil.add("group",{name:_shader.name});var _objects=[];var _items=[];(function(){initItems()}());function initItems(){for(var key in _shader.uniforms){let obj=_shader.uniforms[key];switch(obj.type){case"f":createNumber(obj,key);break;case"c":createColor(obj,key);break}}}function createNumber(obj,key){let val=new UILItem(key,obj.value,{prefix:_shader.name},val=>{obj.value=val});_group.add("number",val.obj);_objects.push({key,obj});_items.push(val)}function createColor(obj,key){let val=new UILItem(key,obj.value.getHex(),{prefix:_shader.name},val=>{if(Array.isArray(val))obj.value.setRGB(val[0],val[1],val[2]);else obj.value.set(val)});_group.add("color",val.obj);_objects.push({key,obj});_items.push(val)}this.console=function(){console.log(_shader.name);_objects.forEach(obj=>{if(obj.obj.type=="c")console.log(obj.key,"#"+obj.obj.value.getHexString());else console.log(obj.key,obj.obj.value)});console.log("----")};this.clear=function(){_items.forEach(item=>item.clear())}});Class(function UILItem(_name,_value,_params={},_callback){Inherit(this,Component);var _this=this;_params.prefix=_params.prefix?_params.prefix.slice(0,50):"";_value=Storage.get("uilitem_"+_params.prefix+_name)||_value;if(typeof _params==="function"){_callback=_params;_params=null}(function(){_callback&&_callback(_value);initUIL()}());function initUIL(){_this.obj={name:_name,type:"html",value:_value,callback:callback};if(_params){for(var key in _params){_this.obj[key]=_params[key]}}}function callback(v){_value=v;Storage.set("uilitem_"+_params.prefix+_name,v);_callback&&_callback(v)}this.clear=function(){Storage.set("uilitem_"+_params.prefix+_name,null)};this.get("value",function(){return _value})});Class(function WiggleBehavior(_position){Inherit(this,Component);var _this=this;var _angle=Utils.toRadians(Utils.doRandom(0,360));var _wobble=new Vector3;var _origin=new Vector3;this.target=_wobble;this.scale=1;this.alpha=.025;this.speed=1;this.zMove=2;this.enabled=true;(function(){if(_position)_origin.copyFrom(_position)}());this.update=function(){if(!_this.enabled||_this.disabled)return;var t=window.Render?Render.TIME:Date.now();_wobble.x=Math.cos(_angle+t*(.00075*_this.speed))*(_angle+Math.sin(t*(.00095*_this.speed))*200);_wobble.y=Math.sin(Math.asin(Math.cos(_angle+t*(.00085*_this.speed))))*(Math.sin(_angle+t*(.00075*_this.speed))*150);_wobble.x*=Math.sin(_angle+t*(.00075*_this.speed))*2;_wobble.y*=Math.cos(_angle+t*(.00065*_this.speed))*1.75;_wobble.x*=Math.cos(_angle+t*(.00075*_this.speed))*1.1;_wobble.y*=Math.sin(_angle+t*(.00025*_this.speed))*1.15;_wobble.z=Math.sin(_angle+_wobble.x*.0025)*(100*_this.zMove);_wobble.multiply(_this.scale*.1);_wobble.add(_origin);if(_position){if(_this.ease)_position.interp(_wobble,_this.alpha,_this.ease);else _position.lerp(_wobble,_this.alpha)}};this.copyOrigin=function(){_origin.copyFrom(_position)};this.startRender=function(){Render.start(_this.update)};this.stopRender=function(){Render.stop(_this.update)};this.onDestroy=function(){Render.stop(_this.update)};this.set("position",p=>{_position=p})});Class(function ScoreLayer(){Inherit(this,Model);var _this=this;var _obj={};var _config;(function(){}());function update(){let score,perc=0;try{eval(`var fn = function(data, config) { ${_config.scoreLogic} }`);let result=fn(_obj,_config.levelVars);score=result.score||result}catch(e){console.log("score error")}if(_obj.teamCorrect)score+=_obj.teamCorrect*300;if(_obj.teamIncorrect)score-=_obj.teamIncorrect*200;if(_obj.aptitudeCount&&_obj.aptitudeTotal&&_obj.aptitudeTotal>0)score+=_obj.aptitudeCount/(_obj.aptitudeTotal+1)*1e3+_obj.aptitudeCount*50;if(_obj.speed&&_obj.speedCount)score+=_obj.speed*1e3+_obj.speedCount*50;if(_obj.accuracy&&_obj.accuracyCount)score+=_obj.accuracy*1e3+_obj.accuracyCount*50;if(_obj.intelligence&&_obj.intelligenceCount)score+=_obj.intelligence*1e3+_obj.intelligenceCount*50;if(_obj.memory&&_obj.memoryCount)score+=_obj.memory*1e3+_obj.memoryCount*50;if(_config){score=Math.max(score,0);score=Math.min(score,Number(_config.maxScore));perc=score/Number(_config.passScore);if(perc>1)perc=1;_this.events.fire(AirmanEvents.MISSION_UPDATE_SCORE,{number:score,perc:perc});return{number:score,perc:perc}}return{number:0,perc:0}}this.update=update;this.reset=function(config){if(config){_obj={};_config=config}else{let obj={};if(_obj.teamCorrect||_obj.teamCorrect===0)obj.teamCorrect=_obj.teamCorrect;if(_obj.teamIncorrect||_obj.teamIncorrect===0)obj.teamIncorrect=_obj.teamIncorrect;if(_obj.aptitudeCount||_obj.aptitudeCount===0)obj.aptitudeCount=_obj.aptitudeCount;if(_obj.aptitudeTotal||_obj.aptitudeTotal===0)obj.aptitudeTotal=_obj.aptitudeTotal;if(_obj.speed||_obj.speed===0)obj.speed=_obj.speed;if(_obj.speedCount||_obj.speedCount===0)obj.speedCount=_obj.speedCount;if(_obj.speedTotal||_obj.speedTotal===0)obj.speedTotal=_obj.speedTotal;if(_obj.accuracy||_obj.accuracy===0)obj.accuracy=_obj.accuracy;if(_obj.accuracyCount||_obj.accuracyCount===0)obj.accuracyCount=_obj.accuracyCount;if(_obj.accuracyTotal||_obj.accuracyTotal===0)obj.accuracyTotal=_obj.accuracyTotal;if(_obj.intelligence||_obj.intelligence===0)obj.intelligence=_obj.intelligence;if(_obj.intelligenceCount||_obj.intelligenceCount===0)obj.intelligenceCount=_obj.intelligenceCount;if(_obj.intelligenceTotal||_obj.intelligenceTotal===0)obj.intelligenceTotal=_obj.intelligenceTotal;if(_obj.memory||_obj.memory===0)obj.memory=_obj.memory;if(_obj.memoryCount||_obj.memoryCount===0)obj.memoryCount=_obj.memoryCount;if(_obj.memoryTotal||_obj.memoryTotal===0)obj.memoryTotal=_obj.memoryTotal;_obj=obj}};this.set=function(key,value){let err=new Error;if(err.stack){let stack=err.stack.toString().toLowerCase();if(!stack.strpos(["mission","enemy","enemies","fire","complete","click"]))return;_obj[key]=value}else{_obj[key]=value}update()};this.get=function(){return _obj}},"static");Class(function KlangLoader(){Inherit(this,Component);var _this=this;(function(){AssetLoader.waitForLib("Klang").then(init)}());function init(){AudioController.init({onSuccess:onSuccess,onProgress:onProgress,onFail:function(){}})}function onSuccess(){if(!_this.events)return;_this.init=true;_this.events.fire(HydraEvents.PROGRESS,{percent:1});_this.events.fire(HydraEvents.COMPLETE)}function onProgress(prog){if(!_this.events)return;_this.percent=prog/100;_this.events.fire(HydraEvents.PROGRESS,{percent:_this.percent})}this.ready=function(){let promise=Promise.create();_this.wait(promise.resolve,_this,"init");return promise};this.onDestroy=function(){onSucces=onProgress=null}});Class(function MissionLoadManager(){Inherit(this,Component);var _this=this;var _list;(function(){}());function initList(){_list=[];Data.Missions.getData().forEach(data=>_list.push(data.perma))}function next(){let perma=_list.shift();if(!perma)return;let loader=new MissionLoader(perma);loader.events.add(HydraEvents.COMPLETE,next)}function getLastMission(){let data=Data.Story.getData();for(let i=data.length-1;i>-1;i--){if(data[i].locked!==true)return data[i]}}this.start=function(){if(!_list)initList();_this.delayedCall(()=>{Render.onIdle(()=>{_this.load(getLastMission().perma);let ui=AssetUtil.getAssets(["images/ui"]);AssetLoader.loadAssets(ui);Service.cache(ui)})},32e2)};this.load=function(perma){if(Global.PLAYGROUND)return;if(_list.indexOf(perma)==-1)perma=_list[Utils.doRandom(0,_list.length-1)];new MissionLoader(perma);_list.findAndRemove(perma)}},"static");Class(function MissionLoader(_perma){Inherit(this,Component);var _this=this;(function(){if(MissionLoader.loaded.indexOf(_perma)>-1)return complete();loadAssets()}());function loadAssets(){let promises=[];let assets=ASSETS.LEVELS[_perma];let list=AssetUtil.getAssets(assets);if(list.length)promises.push(AssetLoader.loadAssets(list));promises.push(MissionLoader.loadRoleImages(_perma));let json=[];assets.forEach(asset=>{if(asset.strpos("json"))promises.push(MapUtil.loadGeometry("assets/"+asset,true))});let audio=_this.initClass(MissionLoaderAudio,Data.Missions.findByPerma(_perma));promises.push(audio.load());Service.cache(assets);Promise.all(promises).then(complete)}function complete(){_this.events.fire(HydraEvents.COMPLETE);MissionLoader.loaded.push(_perma)}},()=>{MissionLoader.loaded=[];MissionLoader.roles=[];MissionLoader.loadRoleImages=function(perma){let promise=Promise.create();if(MissionLoader.roles.indexOf(perma)>-1)return promise.resolve();let story=Data.Story.findByPerma(perma);let list=[];for(let key in story){if(key.strpos("instructionIcon")&&story[key].length){list.push(story[key])}}story.team.available.forEach(p=>{list.push(Data.Roles.findByPerma(p).image)});AssetLoader.loadAssets(list).then(()=>{MissionLoader.roles.push(perma);promise.resolve()});return promise}});Class(function MissionLoaderAudio(_data){Inherit(this,Component);var _this=this;(function(){}());function getMissionLoadgroups(){let missionGroups=["missions-shared",_data.perma];switch(_data.perma){case"knock-knock":case"ghost-rider":case"bulls-eye":case"that-others-may-live":case"washed-away":case"rolling-thunder":missionGroups.push("walkmission");break;case"shake-rattle-and-roll":case"operation-boomerang-pt--2":case"hurry-home":case"thieves-in-the-night":case"breach":missionGroups.push("airmission");break;default:}return missionGroups}this.load=function(){if(!Config.SOUND){let promise=Promise.create();promise.resolve();return promise}let promises=[];let loadGroups=getMissionLoadgroups();let fileHandler=Klang.getFileHandlerInstance();if(!fileHandler._fileInfo)return Promise.resolve();let files=fileHandler._fileInfo.filter(file=>loadGroups.indexOf(file.load_group)>-1);let baseUri=fileHandler._baseURL;let format=Klang.detector.browser.name==="Firefox"||Klang.detector.browser.name==="Chrome"?".ogg":".mp3";files.forEach(file=>{let promise=Promise.create();XHR.get(baseUri+file.url+format,()=>promise.resolve(),"text");promises.push(promise)});return Promise.all(promises)}});Class(function MapUtil(){Inherit(this,Component);var _this=this;var _thread,_height,_hit,_bounding;var _envGeom,_colorArray,_colors,_res;var _cache={};this.time={type:"f",value:0};this.resolution={type:"v2",value:new Vector2};this.dpr={type:"f",value:1};(function(){GPU.ready().then(checkTextures);AssetLoader.waitForLib("THREE",initThree)}());function checkTextures(){if(Tests.reduceTextures())AssetUtil.exclude("-full");else AssetUtil.exclude("-half")}function initThree(){if(Hydra.LOCAL)addListeners();_this.lightPosition=new THREE.Vector3(500,300,-100);_this.light=new THREE.PointLight(_this.lightPosition);_this.resolution.value=new THREE.Vector2;_this.startRender(loop)}function initThread(){let ThreadType=Device.browser.ie&&Device.browser.version<=11?SimulatedThread:Thread;_thread=_this.initClass(ThreadType);_thread.importScript(Config.CDN+"assets/js/lib/three.min.js");_thread.importClass(XHR);_thread.loadFunction(loadMap);_thread.loadFunction(loadGeometry)}function loadMap(e,id){XHR.get(e.path,data=>{data=data.data||data;let geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.computeBoundingBox();post({position:geometry.attributes.position.array,bounding:geometry.boundingBox.max,vertices:data.position.length/3},id,[geometry.attributes.position.array.buffer])})}function loadGeometry(e,id){XHR.get(e.path,data=>{if(e.cache)return post({},id);data=data.data||data;let position=new Float32Array(data.position);let uv=new Float32Array(data.uv||0);let normal=new Float32Array(data.normal||0);post({position,uv,normal},id,[position.buffer,uv.buffer,normal.buffer])})}function generateHeight(geom,maxHeight){let size=512;if(!_height){_height={};_height.scene=new THREE.Scene;_height.camera=new THREE.OrthographicCamera(-200,200,140,-140,1,1e3);_height.camera.position.y=100;_height.camera.lookAt(new THREE.Vector3(0,0,0));_height.shader=new Shader("MapUtilHeight");_height.shader.uniforms={maxHeight:{type:"f",value:maxHeight}}}_height.shader.material.side=THREE.DoubleSide;_height.shader.set("maxHeight",maxHeight);let rt=Utils3D.createRT(size,size);let mesh=new THREE.Mesh(geom,_height.shader.material);_height.scene.add(mesh);World.RENDERER.render(_height.scene,_height.camera,rt);return rt.texture}function loop(){_this.dpr.value=World.DPR||1;_this.time.value=Render.TSL*.0025;_this.resolution.value&&_this.resolution.value.set(Stage.width*World.DPR,Stage.height*World.DPR)}function addListeners(){_this.events.subscribe(KeyboardUtil.PRESS,spacePress)}function spacePress(e){if(e.keyCode!=32)return;if(!_hit){_hit={};_hit.geom=new THREE.PlaneBufferGeometry(750,600);_hit.geom.rotateX(Utils.toRadians(-90));_hit.mesh=new THREE.Mesh(_hit.geom);_hit.ray=new Raycaster(World.CAMERA)}_hit.ray.camera=World.CAMERA;let hit=_hit.ray.checkHit(_hit.mesh);if(hit[0])console.log(hit[0].point.x.toFixed(2)+", "+hit[0].point.y.toFixed(2)+", "+hit[0].point.z.toFixed(2))}this.clearCache=function(){_cache={}};this.loadMap=function(index,maxHeight){let promise=Promise.create();if(!_thread)initThread();if(_cache[`map_${index}`])return Promise.resolve(_cache[`map_${index}`]);_thread.loadMap({path:Thread.absolutePath(Config.CDN+`assets/geometry/gameplay/maps/map${index}.json`)},data=>{let geom=new THREE.BufferGeometry;let bounding=data.bounding;geom.addAttribute("position",new THREE.BufferAttribute(data.position,3));geom.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.vertices*2),2));geom.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.vertices*3),3));let height=generateHeight(geom,maxHeight);_bounding=data.bounding;_cache[`map_${index}`]={geom,bounding,height};promise.resolve({geom,bounding,height})});return promise};this.loadGeometry=function(path,cache){let promise=Promise.create();if(!_thread)initThread();if(_cache[`geom_${path}`])return Promise.resolve(_cache[`geom_${path}`]);_thread.loadGeometry({path:Thread.absolutePath(Config.CDN+path),cache},data=>{if(!data.position)return promise.resolve();let geom=new THREE.BufferGeometry;geom.addAttribute("position",new THREE.BufferAttribute(data.position,3));geom.addAttribute("uv",new THREE.BufferAttribute(data.uv,2));geom.addAttribute("normal",new THREE.BufferAttribute(data.normal,3));_cache[`geom_${path}`]=geom;promise.resolve(geom)});return promise};this.loadJSON=function(asset){let promise=Promise.create();var name=asset.split("/");name=name[name.length-1];var split=name.split(".");if(Hydra.JSON[split[0]]){promise.resolve()}else{XHR.get(Config.CDN+asset,function(contents){Hydra.JSON[split[0]]=contents;promise.resolve(contents)})}return promise};this.loadNavMesh=function(asset){let promise=Promise.create();if(_cache[`navmesh_${asset}`])Promise.resolve(_cache[`navmesh_${asset}`]);var name=asset.split("/");name=name[name.length-1];var split=name.split(".");XHR.get(asset,function(data){createGeometry(data)});function createGeometry(data){var geometry=new THREE.Geometry;for(let i=0;i<data.position.length;i+=3){geometry.vertices.push(new THREE.Vector3(data.position[i],data.position[i+1],data.position[i+2]))}for(let i=0;i<data.indices.length;i+=3){geometry.faces.push(new THREE.Face3(data.indices[i],data.indices[i+1],data.indices[i+2]))}geometry.computeFaceNormals();_cache[`navmesh_${asset}`]=geometry;promise.resolve(geometry)}return promise};this.getEnvGeom=function(){if(!_envGeom){_envGeom=new THREE.PlaneBufferGeometry(25e2,2e3,55,55);_envGeom.rotateX(Utils.toRadians(-90))}return _envGeom};this.getCurveLength=function(c){let length=0;for(var i=1;i<c.points.length;i++){length+=c.points[i-1].distanceTo(c.points[i])}c.length=length;return length};this.getGradient=function(alpha){if(!_colors){_colors={};_colors.red=new THREE.Color(Config.GLOBAL.redColor);_colors.blue=new THREE.Color(Config.GLOBAL.blueColor);_colors.color=new THREE.Color}_colors.color.copy(_colors.red).lerp(_colors.blue,alpha<.4?0:1);return"#"+_colors.color.getHexString()};this.getRes=function(path){if(!_res)_res=Tests.reduceTextures()?"-half":"-full";let split=path.split(".");return split[0]+_res+"."+split[1]};this.get("gradientArray",()=>{if(!_colorArray){let red=new THREE.Color(Config.GLOBAL.redColor);let blue=new THREE.Color(Config.GLOBAL.blueColor);_colorArray=[];_colorArray.push(red.r,red.g,red.b);_colorArray.push(blue.r,blue.g,blue.b)}return _colorArray});this.set("hit",hit=>{if(!_hit){_hit={};_hit.geom=new THREE.PlaneBufferGeometry(750,500);_hit.geom.rotateX(Utils.toRadians(-90));_hit.mesh=new THREE.Mesh(_hit.geom);_hit.ray=new Raycaster(World.CAMERA)}_hit.mesh=hit})},"static");Class(function DijkstraPathfinder(_vertices){Inherit(this,Component);var _this=this;_this.count=_vertices.length;_this.vertices=_vertices;(function(){initGraph();calculateVertices()}());function initGraph(){_this.graph=new Graph}function calculateVertices(){_vertices.forEach((v,i)=>{let neighbours={};v.neighbours.forEach(n=>{neighbours[String(n)]=v.position.distanceTo(_vertices[n].position)});_this.graph.addVertex(String(i),neighbours)})}function updatePoints(){_this.graph.vertices={};calculateVertices()}function PriorityQueue(){this._nodes=[];this.enqueue=function(priority,key){this._nodes.push({key:key,priority:priority});this.sort()};this.dequeue=function(){return this._nodes.shift().key};this.sort=function(){this._nodes.sort(function(a,b){return a.priority-b.priority})};this.isEmpty=function(){return!this._nodes.length};this.clear=function(){this._nodes=[]}}function Graph(){let INFINITY=1/0;let nodes=new PriorityQueue;this.vertices={};this.addVertex=function(name,edges){this.vertices[name]=edges};this.shortestPath=function(start,finish){let distances={};let previous={};let path=[];let smallest,vertex,neighbor,alt;for(vertex in this.vertices){if(vertex===start){distances[vertex]=0;nodes.enqueue(0,vertex)}else{distances[vertex]=INFINITY;nodes.enqueue(INFINITY,vertex)}previous[vertex]=null}while(!nodes.isEmpty()){smallest=nodes.dequeue();if(smallest===finish){path=[];while(previous[smallest]){path.push(smallest);smallest=previous[smallest]}break}if(!smallest||distances[smallest]===INFINITY){continue}for(neighbor in this.vertices[smallest]){alt=distances[smallest]+this.vertices[smallest][neighbor];if(alt<distances[neighbor]){distances[neighbor]=alt;previous[neighbor]=smallest;nodes.enqueue(alt,neighbor)}}}nodes.clear();return path}}this.getPath=function(origin,destination){let path=_this.graph.shortestPath(String(origin),String(destination)).concat([String(origin)]).reverse();let points=[];path.forEach(i=>{points.push(_vertices[Number(i)].position)});return points};this.addPoint=function(v){let index=_vertices.length;v.position.index=index;_vertices.push(v);v.neighbours.forEach(i=>{_vertices[i].neighbours.push(index)});return index};this.resetPoints=function(){for(let i=_vertices.length-1;i>=_this.count;i--){_vertices[i].neighbours.forEach(j=>{_vertices[j].neighbours.pop()});_vertices.splice(i,1)}updatePoints()};this.updatePoints=updatePoints});Class(function PathFinder(_level,_config,_threadType,_isSkipPath){Inherit(this,Component);var _this=this;var _thread;var _evt={};var _lastPos=new Vector3;var _count=0;this.pos=new Vector3(0,0,0);this.config=_config;this.loaded=false;(function(){initThread()}());function initThread(){if(!_isSkipPath)_this.isOptimized=Tests.reducePathFinding();_thread=_this.initClass(Thread,_threadType||(_config.pathFinder?window[_config.pathFinder]:PathFinderThread));if(window.IS_ES5)_thread.importScript(Config.CDN+"assets/js/lib/_babel-polyfill.js");_thread.importScript(Config.CDN+"assets/js/lib/three.min.js");_thread.importScript(Config.CDN+"assets/js/lib/pathfinder.min.js");_thread.importClass(Raycaster,ObjectPool,Vector3,Vector2,XHR);_thread.init({path:_level?Thread.absolutePath(Config.CDN+"assets/geometry/gameplay/levelnav/"+_level+"-nav.json"):null,bounding:_config.bounding,levelVars:_config.levelVars});_thread.on("loaded",loaded)}function loop(t,dt,delta){if(_this.isOptimized&&_count%7>0)return;if(!_evt.camera){_evt.camera={};_evt.camera.position={};_evt.camera.quaternion={};_evt.stage={}}_evt.camera.position.x=World.CAMERA.position.x;_evt.camera.position.y=World.CAMERA.position.y;_evt.camera.position.z=World.CAMERA.position.z;_evt.camera.quaternion.x=World.CAMERA.quaternion.x;_evt.camera.quaternion.y=World.CAMERA.quaternion.y;_evt.camera.quaternion.z=World.CAMERA.quaternion.z;_evt.camera.quaternion.w=World.CAMERA.quaternion.w;_evt.aspect=World.CAMERA.aspect;_evt.stage.width=Stage.width;_evt.stage.height=Stage.height;_evt.lastPos=_lastPos;_evt.pos=_this.pos;_evt.skipPath=_isSkipPath||_this.isOptimized;if(_this.forceCheck)_evt.skipPath=false;_thread.input(_evt,updatePath);_lastPos.copy(_this.pos);_this.forceCheck=false}function addListeners(){if(Device.mobile)_this.events.subscribe(MissionInteraction.CLICK,touchMove);else Stage.bind("touchmove",touchMove);if(_this.isOptimized)_this.events.subscribe(MissionInteraction.CLICK,forcePath)}function touchMove(e){if(!_this.loaded)return;_evt.x=e.x;_evt.y=e.y;if(Device.mobile)loop()}function forcePath(){_this.forceCheck=true}function updatePath(e){_this.path=e.array||[];_this.events.fire(PathFinder.PATH,e)}function loaded(){_this.loaded=true}this.set("start",p=>{p=p.position||p;_this.pos.copy(p);_lastPos.copy(p)});this.generatePath=function(from,to,pad,callback){if(typeof pad=="function"){callback=pad;pad=0}let promise=Promise.create();if(!callback)callback=promise.resolve;_thread.generatePath({from,to,pad},callback);return promise};this.ready=function(){let promise=Promise.create();_this.wait(promise.resolve,_this,"loaded");return promise};this.autoUpdate=function(){addListeners();if(!Device.mobile)_this.startRender(loop)};this.removeNavGeometryFaces=function(index,count){_thread.removeNavGeometryFaces({index,count})};this.onDestroy=function(){Stage.unbind("touchmove",touchMove);Stage.unbind("touchend",touchMove)}},()=>{PathFinder.PATH="pathfinder_path";PathFinder.MOVE="pathfinder_move"});Class(function PathFinderThread(){Inherit(this,Component);var _this=this;var _ray,_camera,_hitMesh,_levelReady,_stage,_pos,_pool,_navGeometry;var _levelName="level";var _evt={};(function(){}());function initObjects(){_camera=new THREE.PerspectiveCamera(45,1,1,100);_ray=new Raycaster;_pool={};_pool.position=new ObjectPool;_pool.offset=new ObjectPool;for(let i=0;i<50;i++){_pool.position.put(new Float32Array(150));_pool.offset.put(new Float32Array(50))}}function initHitMesh(bounding){let geom=new THREE.PlaneBufferGeometry(720,650);geom.rotateX(Utils.toRadians(-90));_hitMesh=new THREE.Mesh(geom)}function loadLevel(path){window.console.warn=function(e){console.log(e)};loadNavMesh(path).then(geometry=>{_navGeometry=geometry;setPatrolGeometry(_navGeometry);_levelReady=true;emit("loaded")})}function loadNavMesh(asset){let promise=Promise.create();var name=asset.split("/");name=name[name.length-1];var split=name.split(".");XHR.get(asset,function(data){createGeometry(data)});function createGeometry(data){var geometry=new THREE.Geometry;for(let i=0;i<data.position.length;i+=3){geometry.vertices.push(new THREE.Vector3(data.position[i],data.position[i+1],data.position[i+2]))}for(let i=0;i<data.indices.length;i+=3){let face=new THREE.Face3(data.indices[i],data.indices[i+1],data.indices[i+2]);face.index=i/3;geometry.faces.push(face)}geometry.computeFaceNormals();promise.resolve(geometry)}return promise}function setPatrolGeometry(geometry){let zoneNodes=patrol.buildNodes(geometry);patrol.setZoneData(_levelName,zoneNodes)}function generatePathCurve(array){let curve=new THREE.CatmullRomCurve3(array);curve.type="catmullrom";curve.tension=.3;let vertices=curve.getPoints(49);let position=_pool.position.get()||new Float32Array(150);let offset=_pool.offset.get()||new Float32Array(50);for(let i=0;i<vertices.length;i++){offset[i]=i/vertices.length;position[i*3+0]=vertices[i].x;position[i*3+1]=vertices[i].y;position[i*3+2]=vertices[i].z}return{position,offset,array}}function findHit(e,id){_evt.noPath=false;_evt.skipPath=false;if(!_evt.target)_evt.target=new THREE.Vector3;let hit=_ray.checkHit(_hitMesh,e);if(!hit[0]){_evt.target.set(99999,0,0);_evt.noPath=true;return post(_evt,id)}let point=hit[0].point;_evt.target.copy(point);if(e.skipPath){_evt.skipPath=true;post(_evt,id);return}let group=patrol.getGroup(_levelName,_pos);let path=patrol.findPath(_pos,point,_levelName,group);if(!path){_evt.noPath=true;return post(_evt,id)}path.unshift((new THREE.Vector3).copy(_pos));path=removeDuplicates(path);path=addHalfPoints(path);let buffers=generatePathCurve(path);buffers.path=path;buffers.target=(new THREE.Vector3).copy(_evt.target);post(buffers,id,[buffers.position.buffer,buffers.offset.buffer])}function padPath(path,amount){let v1=new THREE.Vector2;for(var i=1;i<path.length-1;i++){let a=path[i];let b=path[i-1];let c=path[i+1];v1.set(b.x,b.z);v1.x-=a.x;v1.y-=a.z;let angle1=v1.angle();if(angle1>Math.PI)angle1-=Math.PI*2;if(angle1<-Math.PI)angle1+=Math.PI*2;v1.set(c.x,c.z);v1.x-=a.x;v1.y-=a.z;let angle2=v1.angle();if(angle2>Math.PI)angle2-=Math.PI*2;if(angle2<-Math.PI)angle2+=Math.PI*2;let angle=angle1-angle2;let mid=angle1-.5*angle;if(Math.abs(angle)>Math.PI){a.x+=Math.cos(mid)*amount;a.z+=Math.sin(mid)*amount}else{a.x-=Math.cos(mid)*amount;a.z-=Math.sin(mid)*amount}}return path}function removeDuplicates(path){for(var i=path.length-2;i>=0;i--){let a=path[i];let b=path[i+1];if(a.x!==b.x)continue;if(a.z!==b.z)continue;path.splice(i+1,1)}return path}function addHalfPoints(path){let vertices=[];for(let i=0;i<path.length;i++){let point=path[i];let prev=path[i-1];if(prev&&point.distanceTo(prev)>100){let halfWay=(new THREE.Vector3).copy(prev);halfWay.lerp(point,.5);vertices.push(halfWay)}vertices.push(point)}return vertices}this.init=function(e){initObjects();initHitMesh();if(e.path){loadLevel(e.path)}else{emit("loaded")}};this.input=function(e,id){_camera.position.copy(e.camera.position);_camera.quaternion.copy(e.camera.quaternion);_stage=e.stage;_camera.aspect=e.aspect;_camera.updateMatrix();_camera.updateMatrixWorld();_camera.updateProjectionMatrix();_ray.camera=_camera;_ray.rect=_stage;_pos=e.pos;findHit(e,id)};this.generatePath=function(e,id){let group=patrol.getGroup(_levelName,e.from);let path=patrol.findPath(e.from,e.to,_levelName,group);if(!path)console.log(e);path.unshift(e.from);path=removeDuplicates(path);path=addHalfPoints(path);post({path},id)};this.removeNavGeometryFaces=function(e,id){_levelName="level"+Date.now();for(let i=0;i<_navGeometry.faces.length;i++){if(_navGeometry.faces[i].index==e.index){_navGeometry.faces.splice(i,e.count);break}}setPatrolGeometry(_navGeometry)}});Class(function Randomizr(){var _this=this;var _last=[];this.random=function(min,max,range){var actualRange=max-min+1;if(range>actualRange)range=actualRange;var num=Utils.doRandom(min,max);if(actualRange>1){while(_last.indexOf(num)!==-1){num++;if(num>max)num=min}_last.push(num);if(_last.length>=range)_last.shift()}return num}});Class(function Tests(){var _this=this;GPU.ready().then(()=>{if(Mobile.iOS.strpos("legacy"))window.location="./fallback.html";GPU.IRIS=GPU.matchGPU("iris(tm) graphics ",540)&&Math.max(Stage.width,Stage.height)<15e2});this.renderShadows=function(){return false};this.mustLogin=function(){if(document.referrer.strpos(["awwwards","thefwa"]))return false;if(window.location.search.strpos("u"))return false;return true};this.getDPR=function(){if(GPU.lt(1)&&Device.browser.ie&&Device.browser.version<=11)return.85;if(Mobile.os=="iOS"){if(GPU.mobileGT(3)&&Mobile.phone)return 1.5;if(GPU.mobileGT(2)&&Mobile.phone)return 1.2}else{if(GPU.mobileGT(2)&&(Device.detect("samsung")||Mobile.version<7))return 1.1;if(GPU.mobileGT(3)&&Mobile.phone)return 1.25;if(GPU.mobileGT(2)&&Mobile.phone)return 1.15}if(GPU.gt(3)){if(Math.max(Stage.width,Stage.height)>17e2)return 1;if(Device.pixelRatio>1)return 1.5;else return 1.2}if(GPU.gt(2)&&Device.pixelRatio>1){if(Math.max(Stage.width,Stage.height)>17e2)return 1;if(Device.pixelRatio>1)return 1.25;else return 1.1}if(GPU.mobileLT(0))return.8;if(Mobile.iOS.strpos("legacy"))return.2;if(GPU.OVERSIZED)return.8;return 1};this.renderVFX=function(){if(Device.browser.ie&&Device.browser.version<=11)return false;if(GPU.lt(1)&&Device.pixelRatio>1&&!GPU.IRIS&&Device.system.os.strpos("mac"))return false;if(GPU.lt(1)&&!Device.browser.chrome)return false;if(GPU.OVERSIZED)return false;if(GPU.lt(0))return false;if(GPU.mobileLT(0))return false;return true};this.renderVFXMission=function(){if(Math.max(Stage.width,Stage.height)>15e2)return false;if(GPU.lt(1))return false;if(Device.mobile)return false;return true};this.particleReduce=function(){if(GPU.mobileLT(1))return.3;if(GPU.lt(1))return.75;if(GPU.lt(0))return.5;if(Device.mobile)return.7;return 1};this.simpleDashboard=function(){if(Mobile.os=="Android")return true;if(GPU.mobileLT(1))return true;return false};this.hologramParticleScale=function(){return 1.5};this.screenRGB=function(){if(GPU.OVERSIZED)return false;if(GPU.mobileLT(1))return false;return true};this.screenBlur=function(){return false};this.simpleUI=function(){if(this.simpleParralax())return true;if(Device.browser.ie)return true;if(Device.browser.firefox)return true;return false};this.simpleParralax=function(){if(Mobile.tablet)return true;if(GPU.OVERSIZED)return true;if(GPU.lt(0))return true;if(GPU.mobileLT(1))return true;return false};this.noFlashText=function(){if(GPU.lt(1))return true;if(Device.mobile||!Device.browser.chrome)return true;return false};this.insigniaReduce=function(){if(GPU.mobileLT(1))return.3;if(GPU.mobileLT(2))return.3;if(GPU.lt(1))return.7;if(GPU.lt(0))return.3;if(Device.mobile)return.4;return 1};this.reducePathFinding=function(){if(window.IS_ES5)return true;return false};this.noSkeletons=function(){if(Device.browser.ie&&Device.browser.version==11)return true;return false};this.simpleEarth=function(){if(GPU.lt(1)&&Device.pixelRatio>1&&!GPU.IRIS&&Device.system.os.strpos("mac"))return true;if(GPU.lt(0))return true;if(GPU.OVERSIZED)return true;if(Device.system.os.strpos("windows")&&!Device.browser.chrome&&GPU.lt(1))return true;if(Device.mobile)return true;return false};this.disableParticles=function(){if(this.blockSocialBrowser())return true;if(GPU.lt(0))return true;if(GPU.mobileLT(0))return true;if(Device.browser.ie&&Device.browser.version<=11)return true;return false};this.reduceTextures=function(){if(GPU.lt(0))return true;if(GPU.mobileLT(1))return true;return false};this.quickSimTransition=function(){if(Device.browser.ie&&Device.browser.version<=11)return true;if(Device.mobile)return true;return false};this.skyResolution=function(){if(GPU.lt(0))return.5;if(GPU.lt(1))return.7;if(GPU.mobileLT(0))return.3;if(Device.mobile)return.5;return 1};this.fontSmoothing=function(){if(Mobile.os=="Android")return false;return true};this.noInsignia=function(){if(Device.mobile)return true;if(Device.browser.ie&&Device.browser.version==11)return true;if(GPU.lt(0))return true;if(GPU.mobileLT(0))return true;return false};this.insigniaDelay=function(){if(GPU.mobileLT(2))return 35e2;if(Device.mobile)return 2e3;return 1e3};this.blockSocialBrowser=function(){if(Hydra.HASH.strpos("socialBrowser"))return true;if(!Device.mobile)return false;return Mobile.browser=="Social"&&Mobile.os=="iOS"};this.missionCompleteTime=function(){if(Device.mobile)return 1e3;return 750};this.simpleBackgrounds=function(){if(GPU.lt(1))return true;if(GPU.mobileLT(2))return true;return false};this.noTextMask=function(){if(GPU.lt(0))return true;if(GPU.mobileLT(1))return true;return false};this.reduceAudio=function(){if(Device.mobile)return true;return false}},"static");Class(function GameTimer(_total){Inherit(this,Component);var _this=this;var _time,_inc,_start;var _sec;var _obj={};(function(){_start=_time=_total;_total*=1e3;_inc=0}());function loop(t,tsl,dt){_total-=dt;_time=_total/1e3;_inc+=dt;if(Math.floor(_time)!==_sec){_sec=Math.floor(_time);_this.events.fire(HydraEvents.PROGRESS,_start-_sec)};if(_total<=0){_this.events.fire(HydraEvents.COMPLETE);_this.stopRender(loop);_time=_total=0}}this.start=function(){_this.startRender(loop)};this.stop=function(){_this.stopRender(loop)};this.getTime=function(){_obj.ms=_total;_obj.percent=_time/_start;_obj.min=Math.floor(_time/60);_obj.sec=Math.floor(_time-_obj.min*60);_obj.ms=Math.round(_time/1e3%Math.max(1,_obj.sec)*100);_obj.min=_obj.min.toString();_obj.sec=_obj.sec.toString();_obj.ms=_obj.ms.toString()||0;if(_obj.min.length<2)_obj.min="0"+_obj.min;if(_obj.sec.length<2)_obj.sec="0"+_obj.sec;if(_obj.ms.length<2)_obj.ms="0"+_obj.ms;if(_obj.ms=="100")_obj.ms="99";_obj.total=_inc/1e3;_obj.clock=`${_obj.min}:${_obj.sec}:${_obj.ms}`;return _obj}});Class(function Validation(){Inherit(this,Model);var _this=this;function emailValidation(str){var reg=new RegExp(/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+(?:[A-Z]{2}|com|org|net|edu|gov|mil|io|biz|info|mobi|name|aero|asia|jobs|museum|COM|ORG|NET|EDU|GOV|MIL|IO|BIZ|INFO|MOBI|NAME|AERO|ASIA|JOBS|MUSEM)\b$/);return reg.test(str)}function postalValidation(str){var reg=new RegExp(/(^\d{5}$)|(^\d{5}-\d{4}$)/);return reg.test(str)}function phoneValidation(str){var reg=new RegExpt(/^[2-9]\d{2}-\d{3}-\d{4}$/);return reg.test(str)}function nameValidation(str){var reg=new RegExp(/^[a-zA-Z0-9'´\s\p{P}]+$/);return reg.test(str)}function birthdayValidation(str){var reg=new RegExp(/^(?:(?:(?:0?[13578]|1[02])(\/|-|\.)31)\1|(?:(?:0?[1,3-9]|1[0-2])(\/|-|\.)(?:29|30)\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:0?2(\/|-|\.)29\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:(?:0?[1-9])|(?:1[0-2]))(\/|-|\.)(?:0?[1-9]|1\d|2[0-8])\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/g);let date=str.split("/");let age=(new Date).getFullYear()-Number(date[2]);return reg.test(str)&&(age>=18&&age<=100)}this.check=function(type,str){if(type==="first"||type==="last")type="name";var validate;if(type==="middle")return true;switch(type){case"zipcode":validate=postalValidation(str);break;case"email":validate=emailValidation(str);break;case"phone":validate=phoneValidation(str);break;case"name":validate=nameValidation(str);break;case"birthday":validate=birthdayValidation(str);break}return validate}},"Static");Class(function VFX(){Inherit(this,Component);var _this=this;var _passes={};var _screen;(function(){}());this.getMapComposite=function(){let pass=new NukePass("MapComposite");pass.uniforms={};Shader.copyUniforms(pass,FX.DigitalTransition.instance().pass);return pass};this.getSkyComposite=function(){let pass=new NukePass("SkyComposite");pass.uniforms={digStrength:{type:"f",value:1},rgbStrength:{type:"f",value:1}};Shader.copyUniforms(pass,FX.DigitalTransition.instance().pass);return pass};this.toScreenSpace=function(v3){if(!_screen)_screen=new ScreenProjection(World.CAMERA);return _screen.project(v3)}},"static");Class(function Data(){Inherit(this,Model);var _this=this;var _keys=[];const Error=window.Error;(function(){addListeners()}());function addListeners(){_this.events.subscribe(KeyboardUtil.DOWN,keyDown)}function keyDown(e){_keys.unshift(e.keyCode);if(_keys.length>3)_keys.slice(0,3);if(_keys[0]==76&&_keys[1]==91){Storage.set("simulator_landing",false);Storage.set("simulator_landing_vo1",false)}}this.init=function(data){Config.GLOBAL=data.globalconfig;Config.COPY=data.copy};this.preventAccess=function(){let err=new Error;if(err.stack){let stack=err.stack.toString().toLowerCase();if(stack.strpos(["@debugger","<anonymous>:1:15","_evaluateandwrap","eval code:1:1)"]))return true}return false}},"static");Data.Class(function Account(){Inherit(this,Model);var _this=this;var _uid;var _fbInit=false;_this.isReady=false;_this.isLoggedIn=false;(function(){Firebase.ready().then(initFirebase).then(initAF)}());function initFirebase(){let promise=Promise.create();firebase.auth().onAuthStateChanged(user=>{if(user){_uid=user.uid;if(Storage.get("userModel_token")&&Storage.get("userModel_token").length>=64){let decoded=parseJwt(Storage.get("userModel_token"));if(_uid===decoded.username){Data.User.initData().then(()=>{let loggedIn=_this.isLoggedIn;_this.isLoggedIn=true;if(!loggedIn)_this.events.fire(AirmanEvents.LOGGED_IN,true);Tracking.api("/api/airmanchallenge/last-played");promise.resolve()})}else{firebase.auth().signOut()}}else{Data.User.initData().then(()=>{let loggedIn=_this.isLoggedIn;_this.isLoggedIn=false;if(loggedIn)_this.events.fire(AirmanEvents.LOGGED_IN,false);promise.resolve()})}}else{_uid=null;if(Storage.get("userModel_token")&&Storage.get("userModel_token").length>=64){loginFirebase().catch(error=>{console.log(error);loginAnonymous()})}else{loginAnonymous()}}});return promise}function initAF(){if(Storage.get("userModel_token")&&Storage.get("userModel_token").length>=64){_this.isLoggedIn=true;_this.isReady=true;Data.UserAchievements.unlock("trainee")}else{if(_uid){_this.isReady=true}else{_this.logout().then(()=>{_this.isReady=true})}}}function loginAnonymous(){let promise=Promise.create();firebase.auth().signInAnonymously().then(()=>{promise.resolve()}).catch(function(error){promise.reject(error)});return promise}function parseJwt(token){var base64Url=token.split(".")[1];var base64=base64Url.replace("-","+").replace("_","/");return JSON.parse(window.atob(base64))}function loginFirebase(){let promise=Promise.create();let token=Storage.get("userModel_token");let firstName=Storage.get("userModel_firstName");let lastName=Storage.get("userModel_lastName");if(token){let form={token,firstName,lastName};if(_this.uid())form.uid=_this.uid();XHR.post(Config.API+"user/loginFirebase",form).then(response=>{if(response&&response.success===false&&response.message)return promise.reject(response.message);if(response&&response.success){Storage.set("token",response.token);firebase.auth().signInWithCustomToken(response.token).then(()=>{promise.resolve(true)}).catch(error=>{promise.reject(error)})}else{promise.reject("ERROR LOGGING IN")}}).catch(error=>{promise.reject("ERROR LOGGING IN")})}return promise}function oAuthFacebook(type){let promise=Promise.create();if(!_fbInit){FB.init({appId:Config.FACEBOOK_APP_ID,cookie:true,xfbml:false,version:"v2.5"});_fbInit=true}FB.login(function(response){if(response.status==="connected"){FB.api("me","get",{fields:"email,last_name,first_name,middle_name,age_range"},function(permissions){permissions.token=response.authResponse.signedRequest;permissions.authRepsone=response.authResponse;promise.resolve(permissions)})}},{scope:"user_about_me,public_profile",return_scopes:true});return promise}function oAuthTwitter(){let promise=Promise.create();let twitterReq=`${window.location.protocol}//${window.location.host}/auth/twitter`;let name="tw"+Utils.timestamp();Share.openPopup(twitterReq,name,500,500);window.addEventListener("message",data=>{handleTwitterReq(data,promise,name)});return promise}function handleTwitterReq(e,promise,name){let object;if(e.origin!==`${window.location.protocol}//${window.location.host}`)return;if(e.data&&typeof e.data==="string"){object=JSON.parse(e.data);if(object.data.success)promise.resolve(object.data.authToken)}else promise.reject();Share.closePopup(name);window.removeEventListener("message",data=>{handleTwitterReq(data,promise)})}this.ready=function(){if(Data.preventAccess())return;let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"isReady");return promise};this.loggedIn=function(){if(Data.preventAccess())return;let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"isLoggedIn");return promise};this.hasLoggedIn=function(){if(Data.preventAccess())return;return _this.isLoggedIn};this.uid=function(){if(Data.preventAccess())return;if(_uid)return _uid;return null};this.register=function(data){if(Data.preventAccess())return;let promise=Promise.create();if(_this.uid())data.uid=_this.uid();if(data.oAuth){if(data.oAuth.type==="fb")data.fbSignedRequest=data.oAuth.token;if(data.oAuth.type==="tw")data.twitterAuthToken=data.oAuth.token}let key=function(){if(data.fbSignedRequest)return data.fbSignedRequest;if(data.twitterAuthToken)return data.twitterAuthToken;return data.password}();if(data.firstName&&data.lastName&&data.email&&data.privacy&&key&&data.approvedAge){XHR.post(Config.API+"user/register",data).then(response=>{if(response&&response.error&&response.error.code==="error.form.validation"){if(response.error.fields&&response.error.fields[0]&&response.error.fields[0].message&&response.error.fields[0].field){return promise.reject(response.error.fields[0].field+": "+response.error.fields[0].message)}else{return promise.reject("ERROR REGISTERING")}}if(response&&response.success===false&&response.message)return promise.reject(response.message);if(response&&response.success){Storage.set("displayName",response.displayName);Storage.set("token",response.token);Storage.set("userModel_email",response.afEmail);Storage.set("userModel_token",response.afToken);Storage.set("userModel_firstName",response.firstName);Storage.set("userModel_lastName",response.lastName);Storage.set("achievements",null);firebase.auth().signInWithCustomToken(response.token).then(()=>{promise.resolve(true)}).catch(error=>{promise.reject(error)})}else{promise.reject("ERROR REGISTERING")}}).catch(error=>{promise.reject("ERROR REGISTERING")})}else{promise.reject("MISSING REQUIRED FIELDS")}return promise};this.registerSocial=function(type){if(Data.preventAccess())return;let promise=Promise.create();if(type==="fb"){oAuthFacebook("register").then(data=>{promise.resolve(data)}).catch(message=>{console.log(message)})}else{oAuthTwitter().then(data=>{promise.resolve(data)}).catch(message=>{console.log(message)})}return promise};this.loginSocial=function(type){if(Data.preventAccess())return;let promise=Promise.create();let d,f;if(type==="fb"){oAuthFacebook("login").then(data=>{f={signedRequest:data.token};d=data;_this.login(f).then(promise.resolve).catch(message=>{promise.reject({error:message,token:d.token,data:d})})})}else{oAuthTwitter().then(data=>{f={twitter_auth_token:data};_this.login(f).then(promise.resolve).catch(message=>{promise.reject({error:message,token:data})})})}return promise};this.login=function(form){if(Data.preventAccess())return;let promise=Promise.create();if(_this.uid())form.uid=_this.uid();XHR.post(Config.API+"user/login",form).then(response=>{if(response&&response.success===false&&response.message)return promise.reject(response.message);if(response&&response.success){Storage.set("displayName",response.displayName);Storage.set("token",response.token);Storage.set("userModel_email",response.afEmail);Storage.set("userModel_token",response.afToken);Storage.set("userModel_firstName",response.firstName);Storage.set("userModel_lastName",response.lastName);Storage.set("achievements",null);firebase.auth().signInWithCustomToken(response.token).then(()=>{promise.resolve(true)}).catch(error=>{promise.reject(error)})}else{promise.reject("ERROR LOGGING IN")}}).catch(error=>{promise.reject("ERROR LOGGING IN")});return promise};this.logout=function(){if(Data.preventAccess())return;let promise=Promise.create();Storage.set("displayName",null);Storage.set("token",null);Storage.set("userModel_email",null);Storage.set("userModel_token",null);Storage.set("userModel_firstName",null);Storage.set("userModel_lastName",null);Storage.set("achievements",null);Storage.set("twitReq",null);firebase.auth().signOut().catch(error=>{promise.reject(error);console.log("Error signing out: "+error)});return promise};this.reset=function(email){if(Data.preventAccess())return;return XHR.post(Config.API+"user/reset",{email})}});Data.Class(function Achievements(){Inherit(this,Model);var _this=this;var _data;(function(){}());this.init=function(data){if(Data.preventAccess())return;_data=data};this.findByPerma=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(_data[i].perma==perma)return _data[i]}};this.getData=function(){if(Data.preventAccess())return;let data=[];_data.forEach(a=>data.push(a));data.sort((a,b)=>{return a.locked===b.locked?0:!a.locked?-1:1});return Utils.cloneObject(data)}});Data.Class(function Copy(){Inherit(this,Model);var _this=this;var _data;(function(){}());this.init=function(data){if(Data.preventAccess())return;_data=data};this.get=function(key,uppercase){if(Data.preventAccess())return;if(_data&&_data[key]&&uppercase)return _data[key].toUpperCase();if(_data&&_data[key])return _data[key];return"!MISSING!"};this.findByPerma=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(_data[i].perma==perma)return _data[i]}}});Data.Class(function Leaderboard(){Inherit(this,Model);var _this=this;_this.isReady=false;(function(){init()}());function init(){_this.isReady=true}this.ready=function(){if(Data.preventAccess())return;let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"isReady");return promise};this.getOverall=()=>{return XHR.get(Config.API+"leaderboard/overall")};this.getMonthly=()=>{return XHR.get(Config.API+"leaderboard/monthly")};this.getDaily=()=>{return XHR.get(Config.API+"leaderboard/daily")};this.getMission=mission=>{return XHR.get(Config.API+"leaderboard/mission?mission="+mission)};this.checkAchievements=()=>{if(Data.preventAccess())return;let promise=Promise.create();_this.getOverall().then(data=>{data.forEach((row,index)=>{if(row&&row.uid&&row.uid===Data.Account.uid()){if(index<10)Data.UserAchievements.unlock("decade");if(index<25)Data.UserAchievements.unlock("quadrant");if(index<50)Data.UserAchievements.unlock("half-century");if(index<100)Data.UserAchievements.unlock("century")}});promise.resolve()});return promise}});Data.Class(function Missions(){Inherit(this,Model);var _this=this;var _data;(function(){}());function parse(data){let vars=atob(data.levelVars);let gameBalance=JSON.parse(data.gameBalance);let obj={};let lines=vars.split("\n");lines.forEach(l=>{if(!l.strpos(":"))return;let split=l.split(":");let key=split[0];let val=split[1].replace(/ /g,"");if(val.strpos("${GB}"))val=Number(gameBalance[key])/100;if(!isNaN(Number(val)))val=Number(val);obj[key]=val});return obj}this.init=function(data){if(Data.preventAccess())return;_data=data;data.forEach(mission=>{mission.scoreLogic=atob(mission.scoreLogic);mission.gps=mission.gps.split(",");mission.gps.forEach((v,i)=>mission.gps[i]=Number(v))});let storyData=Data.STATIC_DATA.story;delete Data.STATIC_DATA;for(let i=0;i<_data.length;i++){for(let j=0;j<storyData.length;j++){if(storyData[j].perma===_data[i].perma){_data[i].gameBalance=storyData[j].gamebalance;break}}}};this.getConfig=function(perma){if(Data.preventAccess())return;let data=this.findByPerma(perma)||_data[perma];if(typeof data.levelVars==="string")data.levelVars=parse(data);return data};this.getNextMission=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(perma==_data[i].perma){return _data[i+1]}}};this.getData=function(){if(Data.preventAccess())return;return _data};this.getLength=function(){if(Data.preventAccess())return;return _data.length};this.findByPerma=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){_data[i].index=i;if(_data[i].perma==perma)return _data[i]}}});Data.Class(function Ranks(){Inherit(this,Model);var _this=this;var _data;(function(){}());this.init=function(data){if(Data.preventAccess())return;data.forEach(rank=>{rank.xp=Number(rank.xp)});_data=data};this.findByPerma=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(_data[i].perma==perma)return _data[i]}};this.getTotalXP=function(){if(Data.preventAccess())return;return _data[_data.length-1].xp};this.getData=function(){if(Data.preventAccess())return;return _data};this.getRankByIndex=function(index){if(Data.preventAccess())return;for(var i=_data.length-1;i>=0;i--){if(_data[i].index&&Number(_data[i].index)===index)return _data[i]}return null};this.getRankByXP=function(xp){if(Data.preventAccess())return;for(var i=_data.length-1;i>=0;i--){if(xp>=_data[i].xp)return _data[i]}};this.getNextRank=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(_data[i].perma===perma){if(_data[i+1])return _data[i+1];else return null}}return null}});Data.Class(function Roles(){Inherit(this,Model);var _this=this;var _data;(function(){addListeners()}());function addListeners(){_this.events.subscribe(AirmanEvents.CLEAR_LEVEL,clear)}function clear(){if(_data)_data.forEach(role=>{role.required=false})}this.init=function(data){if(Data.preventAccess())return;_data=data;for(let i=0;i<_data.length;i++){var info=_data[i].shortInfo.replace(/(?:\r\n|\r|\n)/g,"<br />");var split=info.split("<br />");var text="";for(var j=0;j<split.length;j++){var s=split[j];if(s.strpos("• ")>-1)s=s.split("• ")[1];text+="<li>"+s+"</li>"}_data[i].shortInfoList=text}};this.findByPerma=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(_data[i].perma==perma)return _data[i]}};this.getData=function(){if(Data.preventAccess())return;let data=[];_data.forEach(a=>data.push(a));data.sort((a,b)=>{return a.locked===b.locked?0:!a.locked?-1:1});return data}});Data.Class(function Story(){Inherit(this,Model);var _this=this;var _data;(function(){}());this.init=function(data){if(Data.preventAccess())return;_data=data};this.findByPerma=function(perma){if(Data.preventAccess())return;for(let i=0;i<_data.length;i++){if(_data[i].perma==perma)return _data[i]}};this.getData=function(){if(Data.preventAccess())return;return _data};this.getUniqueAvailableRoles=function(){if(Data.preventAccess())return;let roles=[];for(let i=0;i<_data.length;i++)roles=roles.concat(_data[i].team.available);return unique(roles)};this.getUnusedAvailableRoles=function(){if(Data.preventAccess())return;let usedRoles=_this.getUniqueAvailableRoles();let unusedRoles=[];Data.Roles.getData().forEach(role=>{if(usedRoles.indexOf(role.perma)===-1)unusedRoles.push(role.perma)});return unusedRoles};this.getUniqueRequiredRoles=function(){if(Data.preventAccess())return;let roles=[];for(let i=0;i<_data.length;i++)roles=roles.concat(_data[i].team.required);return unique(roles)};this.getUnlockedRoles=function(){if(Data.preventAccess())return;let roles=[];_data.forEach(mission=>{if(mission.stars&&mission.stars>0){roles=roles.concat(mission.team.available)}});return unique(roles)};this.getMissionTest=function(){if(Data.preventAccess())return;return Utils.cloneObject(this.findByPerma("knock-knock").premission[0])};function unique(array){let a=array.concat();for(let i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j])a.splice(j--,1)}}return a}});Data.Class(function NotificationQueue(){Inherit(this,Model);var _this=this;var _queue;(function(){init()}());function init(){_queue=Storage.get("notifications")?Storage.get("notifications"):[];if(!Array.isArray(_queue))_queue=[]}function add(data){if(!_queue)_queue=[];if(!Array.isArray(_queue))_queue=[];let exists=false;_queue.forEach(item=>{if(item.perma&&item.perma===data.perma)exists=true});if(exists)return;_queue.push(data);Storage.set("notifications",_queue);if(data.type==="achievement")_this.events.fire(AirmanEvents.ACHIEVEMENT_UNLOCKED,data.perma);if(data.type==="rank")_this.events.fire(AirmanEvents.RANK_UNLOCKED,data.perma)}this.addAchievement=function(perma){console.log("ACHIEVEMENT UNLOCKED: "+perma);add({type:"achievement",perma:perma})};this.addRank=function(perma){console.log("RANK UNLOCKED: "+perma);add({type:"rank",perma:perma})};this.getQueue=function(){return _queue};this.clearQueue=function(){_queue=[];Storage.set("notifications",[])}});Data.Class(function User(){Inherit(this,Model);var _this=this;_this.isReady=false;var _profile;var _location;var _missions={array:[],total:null};var _rank;(function(){Firebase.ready().then(init);Data.Account.loggedIn().then(updateLocation).then(updateProgress)}());function init(){_this.isReady=true;addListeners()}function addListeners(){_this.events.subscribe(AirmanEvents.LOGGED_IN,loggedIn)}function loggedIn(){_rank=undefined;_location=undefined;_this.getProfile(true)}function clear(){_profile=null}function updateLocation(){let promise=Promise.create();if(_location){promise.resolve()}else{let update=false;FirebaseDB.ref("users/"+Data.Account.uid()+"/locationUpdated").once("value",snapshot=>{let value=snapshot.val();if(value>0&&Date.now()-value>864e5)update=true;if(value===null)update=true;if(update){Geo.data().then(data=>{if(data.countryCode==="US")_location=data.city+", "+data.stateCode+", "+"USA";else if(data.city&&data.city!=="-")_location=data.city+", "+data.countryCode;else if(data.countryCode==="-")_location="-";else _location=data.country;FirebaseDB.update("users/"+Data.Account.uid()+"/location",_location).then(()=>{FirebaseDB.update("users/"+Data.Account.uid()+"/locationUpdated",firebase.database.ServerValue.TIMESTAMP).then(()=>{promise.resolve()}).catch(e=>promise.resolve())}).catch(e=>promise.resolve())}).catch(e=>{console.log("geo error");promise.resolve()})}else{promise.resolve()}}).catch(e=>{console.log("geo error");promise.resolve()})}return promise}function confirmStack(list){let err=new Error;if(!err.stack)return true;let stack=err.stack.toString().toLowerCase();return stack.strpos(list)}function updateProgress(){let promise=Promise.create();FirebaseDB.ref("users/"+Data.Account.uid()+"/missions/").once("value",snapshot=>{let missions=snapshot.val();let xp=0;let missionCount=0;for(let key in missions){let passScore=Number(Data.Missions.findByPerma(key).passScore);let highScore=Number(missions[key].highScore);if(highScore>0)missionCount++;xp+=highScore}FirebaseDB.ref("users/"+Data.Account.uid()+"/achievements/").once("value",snapshot=>{let achievements=snapshot.val();for(let key in achievements){if(achievements[key]===true){let achievement=Data.Achievements.findByPerma(key);if(achievement)xp+=Number(achievement.xp)}}let rank=Data.Ranks.getRankByXP(xp);let rankIndex=Number(rank.index);let promises=[];if(rankIndex>_rank){Data.NotificationQueue.addRank(rank.perma);if(_profile)_profile.rank=rankIndex;_rank=rankIndex;promises.push(_this.getProfile(true))}promises.push(FirebaseDB.update("users/"+Data.Account.uid()+"/xp",xp));promises.push(FirebaseDB.update("users/"+Data.Account.uid()+"/rank",rankIndex));Tracking.api("/api/airmanchallenge/progress",{rank:rankIndex+1,mission:missionCount});Promise.all(promises).then(()=>{promise.resolve({xp,rank})})})});return promise};function updateLeaderboard(xp,mission,missionScore){let promise=Promise.create();if(!Data.Account.hasLoggedIn()){promise.reject("Not logged in");return promise}let date=new Date;date.setTime(date.getTime()-5*(60*60*1e3));let month=date.getUTCFullYear()+"-"+(date.getUTCMonth()+1);let day=Math.floor(date/864e5);let overallUpdate=FirebaseDB.update("leaderboard/overall/"+Data.Account.uid(),{displayName:parseDisplayName(),xp,location:_location});let monthlyUpdate=FirebaseDB.update("leaderboard/monthly/"+month+"/"+Data.Account.uid(),{displayName:parseDisplayName(),xp,location:_location});let dailyUpdate=FirebaseDB.update("leaderboard/daily/"+day+"/"+Data.Account.uid(),{displayName:parseDisplayName(),xp,location:_location});let promises=[overallUpdate,monthlyUpdate,dailyUpdate];if(mission)promises.push(FirebaseDB.update("leaderboard/missions/"+mission+"/"+Data.Account.uid(),{displayName:parseDisplayName(),xp:missionScore,location:_location}));return Promise.all(promises)}function parseDisplayName(){let first=Storage.get("userModel_firstName");let middle=Storage.get("userModel_middleName");let last=Storage.get("userModel_lastName");if(first&&last){let name="";if(first&&first.length>0)name+=first+" ";if(middle&&middle.length>0)name+=middle.charAt(0)+" ";if(last&&last.length>0)name+=last.charAt(0);return name}return}this.ready=function(){if(Data.preventAccess())return;let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"isReady");return promise};this.getProfile=function(clear){if(Data.preventAccess())return;let promise=Promise.create();if(_profile&&!clear)promise.resolve(_profile);else FirebaseDB.ref("users/"+Data.Account.uid()).once("value",snapshot=>{let data=snapshot.val();if(!data)return promise.reject("No user data");let xp=0;let firstLocked=true;if(!_location&&data.location)_location=data.location;if(data.rank||data.rank===0)_rank=data.rank;if(!Data.Missions){console.log("Error: Data not ready");return _this.delayedCall(_this.getProfile,500)}_missions.total=Data.Missions.getLength();Data.Missions.getData().forEach(mission=>{let passScore=Number(mission.passScore);let locked=true;if(data.missions&&data.missions[mission.perma]&&data.missions[mission.perma].highScore&&data.missions[mission.perma].highScore>0){if(data.missions[mission.perma].highScore>0){if(_missions.array.indexOf(mission.perma)<0)_missions.array.push(mission.perma);locked=false}if(data.missions[mission.perma].highScore>passScore){mission.passed=true;mission.stars=1}else{mission.stars=data.missions[mission.perma].highScore/passScore}xp+=data.missions[mission.perma].highScore}else{if(locked&&firstLocked){locked=false;firstLocked=false;if(_missions.array.indexOf(mission.perma)<0)_missions.array.push(mission.perma)}if(passScore>0){mission.stars=0}}Data.Story.findByPerma(mission.perma).locked=locked;Data.Story.findByPerma(mission.perma).stars=mission.stars});Data.Achievements.getData().forEach(achievement=>{if(data.achievements&&data.achievements[achievement.perma]&&data.achievements[achievement.perma]===true){xp+=Number(achievement.xp);Data.Achievements.findByPerma(achievement.perma).locked=false}else{Data.Achievements.findByPerma(achievement.perma).locked=true}});data.xp=xp;let unlockedRoles=Data.Story.getUnlockedRoles();Data.Roles.getData().forEach(role=>{role.locked=unlockedRoles.indexOf(role.perma)===-1});_profile=data;promise.resolve(data)});return promise};this.getMissions=function(){if(Data.preventAccess())return;return _missions};this.saveScore=function(config,data){if(Data.preventAccess())return;if(!confirmStack(["fail","complete"]))return;let promise=Promise.create();clear();let score;if(data&&data.number)score=data.number;else score=0;FirebaseDB.ref("users/"+Data.Account.uid()+"/missions/"+config.perma).transaction(userMission=>{if(!userMission)userMission={plays:0,fails:0,highScore:0,scores:[]};userMission.plays++;if(score&&score>0){if(score>userMission.highScore){userMission.highScore=score}if(!userMission.scores)userMission.scores=[];userMission.scores.push(score)}else{userMission.fails++}return userMission},(error,committed,snapshot)=>{if(error){console.log(error);return promise.reject(error)}if(score&&score>0){updateProgress().then(data=>{let xp=data.xp;_this.getProfile().then(data=>Data.UserAchievements.update(data));if(Data.Account.hasLoggedIn()){let val=snapshot.val();if(val&&val.highScore&&score>=val.highScore){updateLeaderboard(xp,config.perma,score).then(()=>{Data.Leaderboard.checkAchievements();promise.resolve(true)})}else{promise.resolve(true)}}else{promise.resolve(true)}})}else{promise.resolve(true)}});return promise};this.saveAptitude=(aptitude,score)=>{if(Data.preventAccess())return;if(!confirmStack(["gamecomplete"]))return;let promise=Promise.create();clear();FirebaseDB.ref("users/"+Data.Account.uid()+"/aptitude/"+aptitude).transaction(userAptitude=>{if(!userAptitude||!userAptitude.scores)userAptitude={plays:0,highScore:0,averageScore:0,scores:[]};userAptitude.plays++;if(score){if(score>userAptitude.highScore)userAptitude.highScore=score;userAptitude.scores.push(score);let recentScores=userAptitude.scores.slice(Math.max(userAptitude.scores.length-5,0));let sum=recentScores.reduce((previous,current)=>current+=previous);userAptitude.averageScore=sum/recentScores.length}return userAptitude},(error,committed,snapshot)=>{if(error)console.log("saveAptitude: "+error);promise.resolve(true)});return promise};this.unlockAchievement=achievement=>{if(Data.preventAccess())return;if(!confirmStack(["unlock"]))return;let promise=Promise.create();FirebaseDB.ref("users/"+Data.Account.uid()+"/achievements/"+achievement).once("value",snapshot=>{if(snapshot.val()!==true){FirebaseDB.ref("users/"+Data.Account.uid()+"/achievements/"+achievement).set(true).then(()=>{Data.NotificationQueue.addAchievement(achievement);updateProgress().then(data=>{let xp=data.xp;_this.getProfile(true).then(()=>{if(Data.Account.hasLoggedIn()){updateLeaderboard(xp).then(()=>{promise.resolve(true)})}else{promise.resolve(true)}})})})}else{promise.resolve()}});return promise};this.initData=()=>{if(Data.preventAccess())return;let visits=FirebaseDB.ref("users/"+Data.Account.uid()+"/visits").transaction(visits=>{if(!visits)visits=0;visits++;return visits});let xp=FirebaseDB.ref("users/"+Data.Account.uid()+"/xp").transaction(xp=>{if(!xp)xp=0;return xp});let rank=FirebaseDB.ref("users/"+Data.Account.uid()+"/rank").transaction(rank=>{if(!rank)rank=0;return rank});return Promise.all([visits,xp,rank,updateLocation()])}});Data.Class(function UserAchievements(){Inherit(this,Model);var _this=this;var _games;var _sessionId;var _sessionCompleted={};(function(){Data.Account.ready().then(Data.User.getProfile).then(init)}());function init(data){_games=Storage.get("achievements_games")?Storage.get("achievements_games"):[];if(!Array.isArray(_games))_games=[];_sessionId=Date.now();update(data);addListeners()}function update(profileData){if(Data.preventAccess())return;if(profileData&&profileData.missions){let completedCount=0;let passCount=0;Data.Story.getData().forEach(story=>{if(story.locked===false){let data=profileData.missions[story.perma];let mission=Data.Missions.findByPerma(story.perma);if(data&&data.plays>=0&&data.fails>=0&&data.plays-data.fails>1)unlock("repeat-performance");if(data&&data.highScore>0)completedCount++;if(data&&data.highScore&&data.highScore>0&&data.highScore>=Number(mission.passScore)){passCount++;let achievementId=story.perma;if(story.perma==="ghost-rider")achievementId="ghost-rider-guardian";if(story.perma==="shake-rattle-and-roll")achievementId="shake-rattle-roll";unlock(achievementId)}}});if(completedCount>=Data.Story.getData().length)unlock("veteran");if(passCount>=1)unlock("bronze-star");if(passCount>=5)unlock("silver-star");if(passCount>=Data.Story.getData().length)unlock("gold-star");if(profileData.missions["knock-knock"]){let data=profileData.missions["knock-knock"];if(data.plays===1&&data.highScore>0)unlock("ace-gunner")}}updateAchievements()}function updateAchievements(){let classifiedCount=0;let unlockedCount=0;Data.Achievements.getData().forEach(achievement=>{if(achievement.classified)classifiedCount++;if(achievement.classified&&!achievement.locked)unlockedCount++});if(unlockedCount>0&&unlockedCount>=classifiedCount)unlock("intelligence")}function unlock(achievement){if(Data.preventAccess())return;let obj=Data.Achievements.findByPerma(achievement);if(obj&&obj.perma&&obj.locked){obj.locked=false;return Data.User.unlockAchievement(obj.perma)}}function addListeners(){_this.events.subscribe(AirmanEvents.MISSION_INFO,missionEnd)}function missionEnd(data){if(data.action!=="out")return;if(data.success){let now=new Date;if(now.getHours()>=0&&now.getHours()<=6)unlock("night-owl")}if(data.success)_sessionCompleted[data.config.perma]=true;let count=0;Data.Story.getData().forEach(story=>{if(_sessionCompleted[story.perma]===true)count++});if(count>=Data.Story.getData().length)unlock("special-ops");_games.push({sessionId:_sessionId,success:data.success,perma:data.config.perma,score:data.score});if(_games.length>5)_games.shift();var glorySteps=0;var gutsSteps=0;for(var i=_games.length-1;i>=0;--i){let success=_games[i]&&_games[i].success&&_games[i].score>0;let currentSession=_games[i].sessionId===_sessionId;let sameLastGame=i>0&&_games[i].perma===_games[i-1].perma;if(i===0)sameLastGame=true;success&&currentSession?glorySteps++:glorySteps=0;if(glorySteps>=3)unlock("glory");if(success&&sameLastGame&&gutsSteps>=2)unlock("guts");!success&&currentSession&&sameLastGame?gutsSteps++:gutsSteps=0}Storage.set("achievements_games",_games)}this.update=update;this.unlock=unlock});Class(function AudioController(){Inherit(this,Controller);var _this=this;var _forceMode;var initiated;var forceAudioTag=false;var loadLocally=true;var currentState;this.webaudioAvailible=function(){return window["AudioContext"]||window["webkitAudioContext"]};this.init=function init(options){var configLink;if(Device.mobile){configLink=loadLocally?"assets/audio/config_mobile.js":"http://klangfiles.s3.amazonaws.com/uploads/projects/k6gdt/config.js";Klang.useMonoBuffers=true}else{configLink=loadLocally?"assets/audio/config.js":"//klangfiles.s3.amazonaws.com/uploads/projects/5kcs7/config.js"}var forceMode=forceAudioTag?"audiotag":"";if(forceMode){console.log("** Klang running AudioTag mode **")}Klang.init(configLink,function(success){if(success){options.onSuccess();initiated=true}},options.onProgress,options.onFail,{forceMode:forceMode});if(Device.mobile){Stage.bind("touchend",this.initIOS)}registerEvents()};function registerEvents(){_this.events.subscribe(AirmanEvents.NAV_CHANGE,onNavChange);_this.events.subscribe(HydraEvents.CLICK,onClick)}function onClick(e){_this.trig("button_boxed_hover")}function onNavChange(e){if(e.text!=="MISSIONS"){_this.globeOut()}_this.trig("main_menu_start");_this.trig("mission_stop");_this.pregameTestComplete()}this.trig=function(){if(!Config.SOUND)return;Klang.trigger.apply(Klang,arguments)};this.mainMenuStart=function(){if(currentState!="mainMenu"){this.trig("main_menu_start")}currentState="mainMenu"};this.globeIn=function(){this.trig("globe_in");VOController.instance().globeVO()};this.globeOut=function(time){if(time===2e3){this.trig("globe_transition")}else{this.trig("globe_out")}VOController.instance().stop()};this.onMissionInstructionsIn=function(){this.trig("pregame_transition")};this.onDashboardHover=function(e){if(e.action==="over"){this.trig("dashboard_hover")}};this.onDashboardShareOver=function(){this.trig("dashboard_share_hover")};this.onMissionIntro=function(){this.trig("mission_intro_start")};this.onMissionScoreTick=function(){this.trig("pregame_score_tick")};this.pregameTestInit=function(){this.trig("pregame_init")};this.pregameTestStart=function(data){this.trig("pregame_start");this.pregameIsRunning=true};this.pregameTestComplete=function(data){this.trig("pregame_complete");this.pregameIsRunning=false};this.onSpeedTestCircleSpawned=function(){if(this.pregameIsRunning){this.trig("speed_test_circle_appear")}};this.onSpeedTestCircleClick=function(){this.trig("speed_test_circle_click")};this.onIntelligenceClick=function(correct){if(correct){this.trig("intelligence_correct")}else{this.trig("intelligence_wrong")}};this.onMemoryTestFail=function(){this.trig("memory_test_wrong")};this.onMemoryTestCorrect=function(){this.trig("memory_test_correct")};this.onStabilityTestFail=function(){this.trig("accuracy_test_fail")};this.onStabilityTestCorrect=function(){this.trig("speed_test_circle_click")};this.onStabilityStart=function(){this.trig("speed_test_circle_appear")};this.onStabilityTestDot=function(){this.trig("accuracy_test_plupp")};this.cardHoverIn=function(){this.trig("team_select_card_rollover")};this.onTeamComplete=function(){this.trig("team_select_transition")};this.onTeamSelectAnimateIn=function(){this.trig("team_select_start")};this.cardHoverOut=function(){};this.onMissionTitleIn=function(){this.trig("game_info_transition")};this.cardSelect=function(){this.trig("team_select_card_select")};this.cardDisable=function(){this.trig("team_select_card_error")};this.onOverlayIn=function(){this.trig("info_box_in")};this.onOverlayOut=function(){this.trig("info_box_out")};this.buttonOver=function(e){switch(e.action){case"over":this.trig("button_boxed_hover");break}};this.missionButtonOver=function(e){switch(e.action){case"over":this.trig("pointer_mission_hover");break}};this.menuHover=function(){this.trig("menu_header_hover")};this.onMissionMenuIn=function(){this.trig("mission_menu_in")};this.menuClick=function(text){switch(text){case"DASHBOARD":this.trig("dashboard_in");break;case"LEADERBOARD":this.trig("leaderboard_in");break;case"MISSIONS":this.trig("mission_in");break}};this.leaderBoardOver=function(){this.trig("leaderboard_hover")};this.leaderBoardItemClick=function(){this.trig("leaderboard_switch")};this.buttonClick=function(){this.trig("button_boxed_click")};this.onInvalidPath=function(){this.trig("invalid_path")};this.mute=function(){this.trig("sound_off")};this.unmute=function(){this.trig("sound_on")};this.initIOS=function(){if(_this.webaudioAvailible()){if(!initiated)return;if(Config.SOUND)Klang.initIOS()}Stage.unbind("touchend",this.initIOS)};this.startMission=function(data){};this.mainTitlesInit=function(data){this.trig("main_titles_enter");this.trig("main_title_start")};this.mainTitlesStop=function(){this.trig("main_title_stop")};Hydra.ready(()=>VOController.instance())},"Static");Class(function VOController(){Inherit(this,Component);var _this=this;var _data;var _audioEl;var _audioURI="assets/audio/vo/";var _muted=false;var _elIndex=0;var _numAudioSources=Device.mobile.phone||Device.mobile.tablet?1:2;var _playBlockingPromise=null;var _globVoPlayed=false;(function(){if(!Config.SOUND)return;_audioEl=[];for(var i=0;i<_numAudioSources;i++){_audioEl[i]=new Audio;_audioEl[i].src=_audioURI+"silence.mp3";if(typeof _audioEl[i].load==="function")_audioEl[i].load();_audioEl[i].addEventListener("play",function(){Klang.trigger("vo_start")},false);_audioEl[i].addEventListener("pause",function(){Klang.trigger("vo_end")},false);_audioEl[i].addEventListener("end",function(){Klang.trigger("vo_end")},false)}registerEvents()}());function registerEvents(){_this.events.subscribe(AirmanEvents.NAV_CHANGE,onNavChange);_this.events.subscribe(AirmanEvents.LOGGED_IN,onLoggedIn);_this.events.subscribe(HydraEvents.BROWSER_FOCUS,onFocusChange)}var _firstNavChange=true;function onNavChange(e){if(!_firstNavChange){_this.stop()}_firstNavChange=false}function onFocusChange(e){if(e.type==="blur"){_this.pause()}else{_this.resume()}};function getCompletedMissions(){var storyData=Data.Story.getData();if(!storyData||!storyData.length){return[]}return storyData.filter(m=>m.locked===false)}function onLoggedIn(loggedIn){if(!Config.SOUND||_muted)return;if(loggedIn===true){if(getCompletedMissions.length===16){load("log_in_with_all_missions_completed.mp3").then(el=>el.play())}}}this.mute=function(){_muted=true;this.pause()};this.unmute=function(){_muted=false;_pausedAudioElement=null;this.resume()};var _pausedAudioElement=null;this.pause=function(){_pausedAudioElement=_audioEl.find(el=>!el.paused);if(_pausedAudioElement){_pausedAudioElement.pause()}};this.resume=function(){if(_pausedAudioElement&&!_muted){_pausedAudioElement.play();_pausedAudioElement=null}};this.stop=function(){_audioEl&&_audioEl.forEach(el=>el.pause&&el.pause())};this.ready=function(){if(!Config.SOUND)return Promise.resolve();return Promise.resolve()};this.setMission=function(data){if(!Config.SOUND)return;_data=data};this.load=function(audioUri){if(!Config.SOUND||_muted)return;var promise=Promise.create();var loadError=false;var audioEl=_audioEl[(_elIndex+1)%_numAudioSources];audioEl.pause();var onLoadError=function(e){audioEl.removeEventListener("error",onLoadError,false);loadError=e;console.warn("error loading vo",audioUri,e);onLoadError=null};audioEl.addEventListener("error",onLoadError,false);audioEl.addEventListener("canplay",function onCanPlayThrough(){audioEl.removeEventListener("canplay",onCanPlayThrough,false);if(onLoadError){audioEl.removeEventListener("error",onLoadError,false)}if(loadError){promise.reject(loadError)}else{if(_numAudioSources>1){_audioEl[_elIndex].pause();_audioEl[_elIndex].src="";_elIndex++;_elIndex%=_numAudioSources}promise.resolve(_audioEl[_elIndex])}},false);audioEl.src=_audioURI+audioUri;if(typeof audioEl.load==="function"){audioEl.load()}return promise};this.playState=function(state,defered){if(!Config.SOUND||_muted)return Promise.resolve();if(_playBlockingPromise){return _playBlockingPromise.then(_this.playState.bind(_this,state,true))}var promise=Promise.create();var perma=_data.perma;if(perma==="shake-rattle-and-roll")perma="shake-rattle-roll";else if(perma.indexOf("operation-boomerang-pt--")!==-1)perma=perma.replace("operation-boomerang-pt--","op-boomerang-");else if(perma==="thieves-in-the-night")perma="thieves-in-night";else if(perma==="flashpoint")perma="flash-point";var audioUri=perma.replace(/-/gi,"_")+"_"+state;if(perma==="knock-knock"&&state==="dashboard"&&!Storage.get("knock_knock_dashboard_vo")){Storage.set("knock_knock_dashboard_vo",true);audioUri+="_first_time_playing"}audioUri+=".mp3";this.load(audioUri).then(function(audioEl){audioEl.addEventListener("ended",function onEnded(){if(perma.indexOf("rolling-thunder")>-1&&state==="dashboard"){_this.playOutro()}audioEl.removeEventListener("ended",onEnded,false);promise.resolve()},false);audioEl.play()}).catch(function(e){console.error("error playing vo: ",e);promise.resolve()});return promise};function playBlocking(url){if(_playBlockingPromise){_this.stop()}_playBlockingPromise=Promise.create();_this.load(url).then(el=>{el.addEventListener("pause",function onEnded(){el.removeEventListener("pause",onEnded,false);_playBlockingPromise&&_playBlockingPromise.resolve();_playBlockingPromise=null},false);el.play()});return _playBlockingPromise}this.playComplete=function(){if(!Config.SOUND||_muted)return};var _iosInitiated=false;this.initIOS=function(){if(!Config.SOUND)return;_iosInitiated=true;for(var i=0;i<_numAudioSources;i++){var p=_audioEl[i].play()}document.removeEventListener("touchend",_this.initIOS,false)};var _globeVOPlayed=false;this.globeVO=function(firstTime){if(!Config.SOUND||_muted)return;if(_globeVOPlayed)return;_globeVOPlayed=true;let unlockedMissions=getCompletedMissions();let url=firstTime?"first_visit_to_globe.mp3":"return_visit_to_globe_no_missions_completed.mp3";if(unlockedMissions.length){let lastUnlockedMissions=unlockedMissions[unlockedMissions.length-1];if(unlockedMissions.length===16&&Data.Missions.getData()[15].stars>0){url="log_in_with_all_missions_completed.mp3"}else if(unlockedMissions.length>1){url="map_with_"+lastUnlockedMissions.perma.replace(/\-/g,"_")+"_unlocked.mp3"}}_this.load(url).then(el=>el.play())};this.playOutro=function(){if(!Config.SOUND||_muted)return;this.load("outro_all_missions_completed.mp3").then(el=>el.play())};this.playIntro=function(){if(!Config.SOUND||_muted)return;this.load("welcome_intro.mp3").then(el=>el.play())};this.onTeamSelectCorrect=function(){if(!Config.SOUND||_muted)return;let r=["a","b","c","d"].sort(()=>Math.random()>.5?-1:1)[0];return playBlocking("select_correct_team_option_"+r+".mp3")};this.missionStart=function(){};this.pregameTestStart=function(){};this.dashboardContinue=function(){};document.addEventListener("touchend",this.initIOS,false)},"singleton");Class(function Blocker(){Inherit(this,Controller);var _this=this;var $container,$message,$text,$icon;var _message="Please rotate your device<br/>to landscape orientation";var _dimensions={};var _anim,_logo;var _cover=false;var _lockLandscape=true;(function(){initHTML();initSize();addListener();checkOrientation()}());function initHTML(){$container=_this.container;$container.size("100%").setZ(1e11).bg("#0b121e");$container.hide();Stage.add($container);$message=$container.create("rotation-message").size(400,400).center();$message.css({opacity:0}).transform({scale:1.1});$icon=$message.create("icon");$icon.size(60,60).center().css({marginTop:-20}).bg("assets/images/ui/common/rotate.png");_logo=_this.initClass(UILogo,.6);_logo.element.center().css({marginTop:-140});_anim=_this.initClass(CSSAnimation);_anim.loop=true;_anim.ease="easeInOutQuint";_anim.duration=3e3;_anim.frames=[{rotation:0},{rotation:-180}];_anim.applyTo($icon);$text=$message.create("text");$text.size(250,30).css({fontFamily:"DINBold",color:"#fff",fontSize:11,top:"270px",left:"75px",letterSpacing:1,lineHeight:18,textAlign:"center",marginTop:0});$text.transform({y:10}).css({opacity:0});$text.html(_message.toUpperCase())}function initSize(){_dimensions.width=Stage.width;_dimensions.height=Stage.height}function rotateMessage(flip){if(flip){$container.show();_anim.play();$message.tween({opacity:1,scale:1},15e2,"easeOutCubic",200);$text.tween({y:0,opacity:1},4e3,"easeOutCubic",500)}else{_this.landscape=true;_anim.stop();$container.hide();$message.css({opacity:0});$text.css({opacity:0})}_cover=flip}function addListener(){_this.events.subscribe(HydraEvents.RESIZE,checkOrientation)}function checkOrientation(){if(Tests.blockSocialBrowser())return;if(!Device.mobile)return;if(Stage.width<Stage.height&&(Stage.height>_dimensions.height*.9||Stage.height>_dimensions.width*.9))rotateMessage(true);else rotateMessage(false)}this.ready=function(){if(!Device.mobile||Tests.blockSocialBrowser())return Promise.resolve();let promise=Promise.create();this.wait(promise.resolve,_this,"landscape");return promise}},"Singleton");Class(function SocialBrowser(){Inherit(this,Controller);var _this=this;var $container,$textWrapper,$topCopy,$middleCopy,$bottomCopy,$arrow;(function(){initContainer();initText();initPointer();style();presetAnimation();_this.delayedCall(animateIn,4e3)}());function initContainer(){$container=_this.container;$container.css({width:"100%",height:"100%",zIndex:100});Stage.add($container)}function initText(){$textWrapper=$container.create("text-wrapper");$topCopy=$textWrapper.create("text");$middleCopy=$textWrapper.create("text");$bottomCopy=$textWrapper.create("text");let top="To play the";let middle="Airman Challenge";let bottom="please open in Safari";$topCopy.text(top.toUpperCase());$middleCopy.text(middle.toUpperCase());$bottomCopy.text(bottom.toUpperCase())}function initPointer(){$arrow=$container.create("arrow");$arrow.icon=$arrow.create("arrow");$arrow.size(30,30);if(Device.detect("twitter"))$arrow.css({top:15,right:8}).transform({rotation:180});else $arrow.css({bottom:125,right:15});$arrow.icon.size(30,30).bg(Config.IMAGES+"ui/common/arrow-right.png").transform({rotation:90})}function style(){let width=275;$textWrapper.css({width,height:200,left:"50%",top:"50%",marginLeft:-width/2,marginTop:-100});$textWrapper.css({fontStyle:"StratumBold",fontSize:16,color:"#fff",textAlign:"center",lineHeight:20});$topCopy.css({width:"100%",position:"relative",marginBottom:2});$middleCopy.css({width:"100%",position:"relative",fontSize:40,lineHeight:36,marginBottom:2});$bottomCopy.css({width:"100%",position:"relative"})}function presetAnimation(){$topCopy.transform({y:15}).css({opacity:0});$middleCopy.transform({y:15}).css({opacity:0});$bottomCopy.transform({y:15}).css({opacity:0});$arrow.transform({y:Device.detect("twitter")?15:-15,rotation:Device.detect("twitter")?-180:0}).css({opacity:0})}function animateIn(){$topCopy.tween({y:0,opacity:1},15e2,"easeOutCubic",0);$middleCopy.tween({y:0,opacity:1},15e2,"easeOutCubic",200);$bottomCopy.tween({y:0,opacity:1},15e2,"easeOutCubic",400);$arrow.tween({y:0,opacity:1},12e2,"easeOutSine",12e2,repeatArrow)}function repeatArrow(){$arrow.tween({y:Device.detect("twitter")?-15:15,opacity:0,rotation:Device.detect("twitter")?-180:0},1e3,"easeOutSine",()=>{$arrow.transform({y:Device.detect("twitter")?15:-15,rotation:Device.detect("twitter")?-180:0}).tween({y:0,opacity:1,rotation:Device.detect("twitter")?-180:0},1e3,"easeOutSine",()=>{_this.delayedCall(repeatArrow,1e3)})})}},"Singleton");Class(function Camera(){Inherit(this,Component);var _this=this;var _debug,_lockCamera,_transition;var _origin=new THREE.Group;var _target=new THREE.Group;var _lerp=new DynamicObject({v:.08});var _trans=new DynamicObject({v:0});this.worldCamera=new THREE.PerspectiveCamera(45,Stage.width/Stage.height,1,7e3);(function(){if(Hydra.HASH.strpos("debug"))initDebug();addListeners();_this.startRender(loop)}());function initDebug(){let white=new THREE.MeshBasicMaterial({color:16777215});let red=new THREE.MeshBasicMaterial({color:1671168e1});let materials=[white,white,white,white,white,red];_debug=new THREE.Mesh(new THREE.BoxGeometry(10,10,20),new THREE.MeshFaceMaterial(materials));World.SCENE.add(_debug)}function loop(){if(!_target)return;if(_lockCamera&&!_transition){_target.quaternion.copy(_lockCamera.quaternion);_target.position.copy(_lockCamera.position)}_this.worldCamera.position.lerp(_target.position,_lerp.v);_this.worldCamera.quaternion.slerp(_target.quaternion,_lerp.v);if(_debug){_debug.position.copy(_this.worldCamera.position);_debug.quaternion.copy(_this.worldCamera.quaternion)}}function addListeners(){_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){_this.worldCamera.aspect=Stage.width/Stage.height;_this.worldCamera.updateProjectionMatrix()}this.setCamera=function(camera){camera=camera.camera||camera;_lockCamera=camera;_target.position.copy(camera.position);_target.quaternion.copy(camera.quaternion);_this.worldCamera.position.copy(camera.position);_this.worldCamera.quaternion.copy(camera.quaternion)};this.transition=function(camera,time,ease,callback){if(!_lockCamera)return _this.setCamera(camera);camera=camera.camera||camera;_origin.position.copy(_lockCamera.position);_origin.quaternion.copy(_lockCamera.quaternion);_transition=true;_lerp.v=.02;_trans.stopTween();_trans.v=0;_trans.tween({v:1},time,ease,()=>{_lockCamera=camera;_target.quaternion.copy(_origin.quaternion).slerp(camera.quaternion,_trans.v);_target.position.copy(_origin.position).lerp(camera.position,_trans.v)},()=>{_lerp.tween({v:_lerp.target||.08},25e2,"easeInOutSine");_transition=false;_lerp.target=null;callback&&callback()})};this.transitionThrough=function(pos,camera,time,ease,callback){if(!_lockCamera)return _this.setCamera(camera);camera=camera.camera||camera;_origin.position.copy(_lockCamera.position);_origin.quaternion.copy(_lockCamera.quaternion);_transition=true;_lerp.v=.0001;_lerp.tween({v:.01},time*.3,"easeInOutSine");let curve=new THREE.CatmullRomCurve3([_origin.position,pos,camera.position]);_trans.stopTween();_trans.v=0;_trans.tween({v:1},time,ease,()=>{_lockCamera=camera;_target.quaternion.copy(_origin.quaternion).slerp(camera.quaternion,_trans.v);_target.position.copy(curve.getPoint(_trans.v))},()=>{_lerp.tween({v:_lerp.target||.08},25e2,"easeInOutSine");_transition=false;_lerp.target=null;callback&&callback()})};this.set("lerp",v=>{_lerp.target=v;_lerp.v=v})},"singleton");Class(function Container(){Inherit(this,Controller);var _this=this;var $container;var _ui;(function(){initContainer();initControllers();addListeners()}());function initContainer(){$container=_this.container;$container.size("100%");Stage.addChild($container)}function initControllers(){_ui=_this.initClass(UI);World.instance();World.SCENE.add(Simulator.instance().group);World.instance().setCamera(Camera.instance().worldCamera);$container.add(World.ELEMENT)}function addListeners(){_this.events.subscribe(AirmanEvents.LOADED,loaded)}function loaded(){Simulator.instance().animateIn();_this.events.unsubscribe(AirmanEvents.LOADED,loaded)}},"Singleton");Class(function Leaderboard(){Inherit(this,Controller);var _this=this;var $container;var _ui;(function(){init()}());function init(){$container=_this.container;$container.size("100%");Stage.add($container);_ui=_this.initClass(LeaderboardUI)}});Class(function Loader(){Inherit(this,Controller);var _this=this;var _loader,_view,_klang,_multi;const SOCIAL_BROWSER=Tests.blockSocialBrowser();const NO_SOUND=!Config.SOUND||SOCIAL_BROWSER;(function(){if(!window.location.hostname.strpos(["airforce.com","atlab.io"]))return;Stage.add(_this.element);_this.element.size("100%").setZ(9999);initView();_this.delayedCall(initLoader,300)}());function initView(){_view=_this.initClass(LoaderView)}function initLoader(){AssetUtil.exclude(["geometry/gameplay","pathfinder.min.js","cannon"]);if(window._BUILT_)AssetUtil.exclude("lib/uil");let assets=AssetUtil.getAssets(["images/ui/list","images/landing","images/vfx","ui/globe","lib","shaders","geometry"]);Service.cache(assets);if(window._BUILT_&&!SOCIAL_BROWSER)assets.unshift(Config.CDN+`assets/js/${window.IS_ES5?"es5-":""}airman-split.js`);_loader=_this.initClass(AssetLoader,assets);_multi=_this.initClass(MultiLoader);_multi.events.add(HydraEvents.COMPLETE,loadComplete);_multi.events.add(HydraEvents.PROGRESS,loadProgress);_multi.push(_loader);_loader.add(3);Data.loadData(Config.STATIC_DATA).then(()=>_loader.trigger()).then(GPU.ready).then(Data.Account.ready).then(()=>_loader.trigger()).then(waitForThree).then(waitForKlang).then(prerender).then(()=>_loader.trigger());if(!NO_SOUND){_klang=_this.initClass(KlangLoader);_multi.push(_klang)}}function waitForThree(){return AssetLoader.waitForLib("THREE")}function waitForKlang(){if(!_klang)return Promise.resolve();return _klang.ready()}function prerender(){if(Hydra.HASH.strpos("playground"))return Promise.resolve();let promise=Promise.create();Container.instance();return Simulator.instance().prerender()}function loadComplete(){_this.events.fire(AirmanEvents.LOADED);_view.animateOut(()=>{_this.events.fire(HydraEvents.COMPLETE)})}function loadProgress(e){_view.update(e.percent)}});Class(function Profile(){Inherit(this,Controller);var _this=this;var $container;var _ui;(function(){initContainer()}());function initContainer(){$container=_this.container;$container.size("100%");Stage.add($container);initUI()}function initUI(){_ui=_this.initClass(ProfileUI)}});Class(function Simulator(){Inherit(this,Component);var _this=this;var _bg,_particles,_globe,_transitionCamera;var _mission,_camera,_landing;this.group=new THREE.Group;(function(){initCamera();initViews();addListeners();resizeHandler();Tracking.api("/api/airmanchallenge/last-played")}());function initCamera(){_camera=new THREE.PerspectiveCamera(45,1,1,1e3);_camera.position.z=12e2;Camera.instance().setCamera(_camera)}function initViews(){_bg=_this.initClass(SimulatorBG);_this.group.add(_bg.group);_globe=_this.initClass(Globe);_this.group.add(_globe.group);resizeHandler();_globe.hide();_transitionCamera=new EnvironmentCamera;_transitionCamera.root.position.set(500,400,-417);_transitionCamera.root.lookAt(new THREE.Vector3);_transitionCamera.strength=0;_transitionCamera.update();_transitionCamera.stopRender();_particles=_this.initClass(SimulatorParticles,_globe.group.position);_this.group.add(_particles.group);_landing=_this.initClass(SimulatorLanding,_this.group,_particles,_globe)}function initMission(perma,loader){let config=Data.Missions.getConfig(perma);let story=Data.Story.findByPerma(perma);_mission=_this.initClass(Mission,config,story);FX.ScreenComposite.instance().danger=0;_this.group.add(_mission.group);_mission.ready().then(_mission.prerender).then(()=>{loader.animateOut(500,()=>loader.destroy());_mission.animateIn()})}function addListeners(){_this.events.subscribe(AirmanEvents.MISSION_SELECT,missionSelect);_this.events.subscribe(AirmanEvents.MISSION_QUIT,missionQuit);_this.events.subscribe(AirmanEvents.NAV_CHANGE,navChange);_this.events.subscribe(AirmanEvents.MISSION_LIST_HOVER,missionHover);_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){_globe.group.position.x=-260;_globe.group.position.y=-30;if(Mobile.phone){_globe.group.position.x=Utils.convertRange(Math.max(screen.width,screen.height),500,600,-540,-450);_globe.group.position.y=Mobile.phone?0:-30}}function missionHover(e){switch(e.action){case"over":if(!_this.hovered){_this.hovered=true;TweenManager.tween(_globe.group.position,{z:15},800,"easeOutCubic")}break;case"out":if(_this.hovered){_this.hovered=false;TweenManager.tween(_globe.group.position,{z:0},1e3,"easeOutCubic")}break}}function navChange(e){if(e.quit)return;let type=e.text.toLowerCase();_this.events.fire(AirmanEvents.DISABLE_NAV,{type:"disable",soft:true});_this.delayedCall(()=>_this.events.fire(AirmanEvents.DISABLE_NAV,{type:"enable",soft:true}),type=="leaderboard"?25e2:5e3);if(_mission){missionQuit(type=="missions")}else{if(type!="missions"){if(!_globe.hidden){_particles.fade(0);_globe.animateOut(600,"easeOutQuad",true);_particles.animateIn();_particles.globePos(new Vector3)}}else{_particles.globePos(_globe.group.position);if(_globe.hidden){_particles.fade(1);if(!_landing.activated)_globe.animateIn();if(!_landing.activated)FX.ScreenComposite.instance().set("vignette",0);FX.ScreenComposite.instance().danger=0}let delay=function(){if(_landing.activated){if(Device.mobile)return GPU.mobileLT(1)?5e3:4e3;return 35e2}if(Device.mobile)return GPU.mobileLT(1)?225e1:175e1;return 12e2}();_this.delayedCall(()=>Dispatch.find(UIMissions).animateIn(),delay)}}}function missionQuit(animateGlobe=false){let loader=_this.initClass(LevelLoader,true);_this.delayedCall(loader.animateIn,500);_mission.complete();_mission.animateOut(()=>{if(animateGlobe)_this.events.fire(AirmanEvents.NAV_CHANGE,{text:"MISSIONS",quit:true});FX.ScreenComposite.instance().set("vignette",0);FX.ScreenComposite.instance().danger=0;_this.delayedCall(()=>{_this.events.fire(AirmanEvents.CLEAR_LEVEL);loader.animateOut(()=>loader.destroy())},200);_this.group.remove(_mission.group);_mission=_mission.destroy();_particles.animateIn();_bg.group.visible=true;if(!animateGlobe)_particles.globePos(new Vector3);_this.delayedCall(()=>{if(animateGlobe){_globe.animateIn();_this.delayedCall(()=>{let missions=Dispatch.find(UIMissions);missions.animateIn&&missions.animateIn()},500)}},400);Camera.instance().transition(_camera,2e3,"easeOutQuad")})}function missionSelect(e){if(_globe.hidden){missionToMission(e)}else{globeToMission(e)}_this.events.fire(AirmanEvents.DISABLE_NAV,{type:"disable"})}function globeToMission(e){let quickSim=Tests.quickSimTransition();_this.delayedCall(_globe.animateOut,800,quickSim?175e1:225e1);Dispatch.find(UIMissions).animateOut();let loader=_this.initClass(LevelLoader);_this.delayedCall(loader.animateIn,quickSim?2e3:27e2);_transitionCamera.root.position.copy(e.pos);_transitionCamera.root.position.z-=300;_transitionCamera.root.position.x-=1e3;_transitionCamera.update();let pos=new THREE.Vector3(-260.7097473144531,-29.989164352416992,314.9991455078125);_transitionCamera.passPos=pos;Camera.instance().transitionThrough(pos,_transitionCamera,32e2,"easeInOutQuad",()=>{_globe.group.visible=false;_bg.group.visible=false;_particles.hide();initMission(e.data.perma,loader)})}function missionToMission(e){let next=()=>{let loader=_this.initClass(LevelLoader);loader.animateIn(()=>{if(_mission){_this.group.remove(_mission.group);_mission=_mission.destroy();_this.events.fire(AirmanEvents.CLEAR_LEVEL)}initMission(e.data.perma,loader)})};if(_mission){if(_mission.dark)next();else _mission.animateOut(next)}}this.preload=function(perma){if(Global.PLAYGROUND)return;new MissionLoader(perma)};this.transitionToMissions=function(quick){if(_landing.activated){_globe.animateToGlobe();FX.ScreenComposite.instance().tween("vignette",0,3e3,"easeInOutSine",1e3)}else{_globe.animateIn()}let camera=new THREE.PerspectiveCamera(45,1,1,1e3);camera.position.z=12e2;Camera.instance().transitionThrough(camera.position.clone().add(new THREE.Vector3(0,200,-500)),camera,quick?1e3:25e2,"easeInOutCubic");_this.events.fire(AirmanEvents.NAV_CHANGE,{text:"MISSIONS",landing:true});_particles.pullOut();_this.delayedCall(MissionLoadManager.start,quick?2e3:5e3);if(Mobile.os=="iOS")return;if(!Storage.get("simulator_landing_vo1")){Storage.set("simulator_landing_vo1",true);_this.delayedCall(()=>VOController.instance().globeVO(true),400)}else if(!Storage.get("simulator_landing_vo2")){Storage.set("simulator_landing_vo2",true);VOController.instance().globeVO(false)}};this.prerender=function(){let promise=Promise.create();if(!Tests.blockSocialBrowser())Insignia.instance();let textures=[];Utils3D.findTexturesByPath("globe").forEach(t=>{textures.push(t.promise)});if(_landing.activated){Utils3D.findTexturesByPath("landing").forEach(t=>{textures.push(t.promise)})}Promise.all(textures).then(()=>{Utils3D.forceVisible(_this.group);setTimeout(()=>{Utils3D.resetForceVisible(_this.group);promise.resolve()},_landing.activated?500:100)});return promise};this.animateIn=function(){_landing.animateIn()}},"singleton");Class(function UI(){Inherit(this,Controller);var _this=this;var $container,$wrapper;var _target=new Vector2;var _logo,_menu,_page,_old,_cue,_missions,_dashboard,_leaderboard;_this.parallax=1;(function(){initContainer();initView();addListeners()}());function initContainer(){$container=_this.container;$container.size("100%").setZ(100).mouseEnabled(false);$wrapper=$container.create(".wrapper");$wrapper.size("100%")}function initView(){_logo=_this.initClass(UILogo);if(Tests.blockSocialBrowser())return;_menu=_this.initClass(UIMenu);_missions=_this.initClass(UIMissions,[$wrapper])}function addListeners(){_this.events.subscribe(AirmanEvents.NAV_CHANGE,navChange);_this.events.subscribe(AirmanEvents.LOGGED_IN,loggedIn)}function navChange(e){if(_this.block)return;_this.block=true;Global.IN_MISSION=false;Global.UI_COLOR="#03060c";if(!Mobile.phone){$wrapper.tween({scale:.95,opacity:0},600,"easeOutSine")}else{if(_dashboard&&_dashboard.destroy)_dashboard=_dashboard.destroy();if(_leaderboard&&_leaderboard.destroy)_leaderboard=_leaderboard.destroy()}if(Insignia.instance().visible)Insignia.instance().animateOut();if(Mobile.phone)_menu.animateOut();if(!_menu.animatedIn)_menu.animateIn();_missions.animateOut();_this.page=e.text;if(_this.page=="MISSIONS"&&!e.force){_this.delayedCall(function(){_this.block=false;if(_dashboard&&_dashboard.destroy)_dashboard=_dashboard.destroy();if(_leaderboard&&_leaderboard.destroy)_leaderboard=_leaderboard.destroy();$wrapper.stopTween().transform({scale:1.25}).css({opacity:0}).tween({scale:1,opacity:1},25e2,"easeOutCubic")},600)}else{_this.delayedCall(function(){if(_dashboard&&_dashboard.destroy)_dashboard=_dashboard.destroy();if(_leaderboard&&_leaderboard.destroy)_leaderboard=_leaderboard.destroy();_missions.element.hide();switch(_this.page){case"MISSIONS":_this.delayedCall(_missions.animateIn,100);break;case"DASHBOARD":_dashboard=_this.initClass(UIDashboard,null,null,[$wrapper]);_this.delayedCall(_dashboard.animateIn,100);break;case"LEADERBOARD":_leaderboard=_this.initClass(UILeaderboard,[$wrapper]);_this.delayedCall(_leaderboard.animateIn,100);break}_this.block=false;$wrapper.stopTween().transform({scale:1.25}).css({opacity:0}).tween({scale:1,opacity:1},25e2,"easeOutCubic")},600)}}function loggedIn(){if(!Global.IN_MISSION&&_this.page)navChange({text:_this.page,force:true})}});Class(function World(){Inherit(this,Component);var _this=this;var _renderer,_scene,_camera,_nuke,_levelPasses;var _perf=new RenderPerformance;World.DPR=Tests.getDPR();this.dpr=World.DPR;(function(){initWorld();addListeners();resizeHandler();Render.start(loop)}());function initWorld(){_renderer=new THREE.WebGLRenderer({antialias:false,powerPreference:"high-performance"});_renderer.setPixelRatio(World.DPR);_renderer.setSize(Stage.width,Stage.height);_renderer.setClearColor(Config.BG_CLEAR_COLOR);_scene=new THREE.Scene;_camera=new THREE.PerspectiveCamera(45,Stage.width/Stage.height,1,7e3);_nuke=_this.initClass(Nuke,Stage,{scene:_scene,camera:_camera,renderer:_renderer,dpr:World.DPR});_nuke.enabled=Tests.renderVFX();World.SCENE=_scene;World.RENDERER=_renderer;World.ELEMENT=_renderer.domElement;World.CAMERA=_camera;World.NUKE=_nuke;Camera.instance();_nuke.add(FX.ScreenComposite.instance());if(Tests.renderShadows()){_renderer.shadowMap.enabled=true}}function loop(t,dt){_perf.time();_nuke.render();_perf.time()}function addListeners(){_this.events.subscribe(HydraEvents.RESIZE,resizeHandler);_this.events.subscribe(AirmanEvents.CLEAR_LEVEL,clearPasses)}function resizeHandler(){_renderer.setSize(Stage.width,Stage.height);if(Math.max(Stage.width,Stage.height)>16e2){if(GPU.lt(2)){_nuke.canEnableLowRes=_nuke.enabled;_nuke.enabled=false}if(Math.max(Stage.width,Stage.height)>17e2){if(_this.dpr>1){_this.dpr=1}else{_this.dpr=.8}_renderer.setPixelRatio(_this.dpr);loop()}}else{if(_nuke.canEnableLowRes){_nuke.canEnableLowRes=false;_nuke.enabled=true}}}function clearPasses(){if(!_levelPasses)return;_levelPasses.forEach((p,i)=>{_nuke.remove(p)})}this.setCamera=function(camera){_camera=camera;_renderer.camera=_camera;_nuke.camera=_camera;World.CAMERA=camera};this.setPasses=function(passes){if(!Tests.renderVFXMission())return;_levelPasses=passes;passes.forEach((p,i)=>{_nuke.add(p,i)})};this.clearPasses=function(){clearPasses()}},function(){var _instance;World.instance=function(){if(!_instance)_instance=new World;return _instance}});Class(function HologramText(_src,_width,_height){Inherit(this,Component);var _this=this;var _shader;(function(){initMesh()}());function initMesh(){let geom=new THREE.PlaneBufferGeometry(_width,_height);_shader=HologramText.getShader();_shader.set("tMap",Utils3D.getTexture(_src));_shader.set("tMask",HologramTextMask.instance().texture);_shader.set("tDistortion",Utils3D.getRepeatTexture("assets/images/vfx/digitaltransition.jpg"));_shader.uniforms.dOffset=FX.DigitalTransition.instance().pass.uniforms.dOffset;_shader.uniforms.time=MapUtil.time;_shader.uniforms.dpr=MapUtil.dpr;_shader.uniforms.resolution=MapUtil.resolution;_shader.material.transparent=true;_shader.material.depthWrite=false;_this.mesh=new THREE.Mesh(geom,_shader.material);ShaderUIL.instance().push(_shader);HologramTextMask.instance()}this.animateIn=function(time=15e2,delay=0){_shader.tween("transition",1,time,"easeInOutSine",delay+450)};this.animateOut=function(time=15e2,delay=0){_shader.tween("transition",0,time,"easeInOutSine")};this.transition=function(direction,delay=0){if(direction==-1){_shader.set("transOut",1);_shader.set("transition",0);_shader.tween("transition",1,3e3,"easeOutCubic")}else{_shader.tween("transition",direction,3e3,"easeOutCubic",delay)}};this.onDestroy=function(){_shader.uniforms.tMap.value.dispose();_shader.material.dispose();_this.mesh.geometry.dispose()}},()=>{var _shader;HologramText.getShader=function(){if(!_shader){_shader=new Shader("HologramText");_shader.uniforms={tMap:{type:"t",value:null},tDistortion:{type:"t",value:null},tMask:{type:"t",value:null},transition:{type:"f",value:0},transOut:{type:"f",value:0},time:MapUtil.time,resolution:MapUtil.resolution}}return _shader.clone()}});Class(function HologramTextMask(){Inherit(this,Component);var _this=this;var _canvas,_context,_stamp;var _last=new Vector2;var _mouse=new Vector2;var _v=new Vector2;var _stage=new Vector2;const SCALE=1.2;(function(){if(!Tests.noTextMask())_this.startRender(loop);initCanvas()}());function initCanvas(){_canvas=new Canvas(256,256);_context=_canvas.context;_stamp=Images.createImg("assets/images/common/dot.png");_stamp.onload=function(){_stamp.width*=SCALE;_stamp.height*=SCALE};_this.texture=new THREE.Texture(_canvas.div)}function loop(){_context.fillStyle="#000";_context.globalAlpha=.07;_context.fillRect(0,0,_canvas.width,_canvas.height);_context.globalAlpha=1;_mouse.copy(Mouse);_stage.set(Stage.width,Stage.height);let delta=_v.subVectors(_mouse,_last).length()/_stage.length();let scale=Utils.range(delta,0,.14,1,1.4)*Utils.range(delta,0,.005,0,1,true)*.4;let num=Utils.range(delta,0,.14,3,10);let sw=_stamp.width*scale;let sh=_stamp.height*scale;for(let i=0;i<num;i++){_v.copy(_last).lerp(_mouse,i/num);_context.drawImage(_stamp,Utils.range(_v.x,0,Stage.width,0,256)-sw/2,Utils.range(_v.y,0,Stage.height,0,256)-sh/2,sw,sh)}_last.copy(Mouse);_this.texture.needsUpdate=true}this.stop=function(){_this.stopRender(loop)}},"singleton");Class(function UICamera(){Inherit(this,Component);var _this=this;var _camera=new THREE.PerspectiveCamera(45,1,1,100);var _target=new Vector3;this.camera=new THREE.PerspectiveCamera(45,1,1,100);(function(){_this.startRender(loop)}());function loop(){_camera.position.z=200;_target.z=_camera.position.z;_target.x=Utils.range(Mouse.x,0,Stage.width,-200,200);_target.y=Utils.range(Mouse.y,0,Stage.height,-200,200);_camera.position.lerp(_target,.07);_camera.lookAt(World.SCENE.position);_camera.updateMatrixWorld();Utils3D.decompose(_camera,_this.camera)}});Class(function EnvironmentCamera(){Inherit(this,Component);var _this=this;var _g0,_g1;var _camera=new THREE.PerspectiveCamera(45,1,1,100);var _lookAt=new THREE.Vector3;var _target=new THREE.Vector3;this.camera=new THREE.PerspectiveCamera(45,1,1,100);this.strength=1;this.dir=new THREE.Vector2(1,1);this.lerpSpeed=1;const MOVE=30;Global.TILT_STRENGTH=1;(function(){initGroups();_this.startRender(loop)}());function initGroups(){_g0=new THREE.Group;_g0.add(_camera);_g1=new THREE.Group;_g0.add(_g1);_g1.add(_camera);_this.root=_g0;_this.g1=_g1;_lookAt.z=-100}function loop(){var x=Mouse.x;var y=Mouse.y;if(Device.mobile){x=Utils.convertRange(Mobile.Accelerometer.x,-5,5,Stage.width,0,true);y=Utils.convertRange(Mobile.Accelerometer.y,-10,10,0,Stage.height,true)}_target.z=_camera.position.z;_target.x=Utils.range(x,0,Stage.width,-MOVE*2,MOVE*2,true)*_this.strength*_this.dir.x*Global.TILT_STRENGTH;_target.y=Utils.range(y,0,Stage.height,-MOVE,MOVE,true)*_this.strength*_this.dir.y*Global.TILT_STRENGTH;_camera.position.lerp(_target,.07*_this.lerpSpeed);if(!_this.noLookAt)_camera.lookAt(_lookAt);_g0.updateMatrixWorld();Utils3D.decompose(_camera,_this.camera)}this.update=function(){loop()};this.stop=function(){_this.stopRender(loop)}});Class(function MissionCamera(){Inherit(this,Component);var _this=this;var _g0,_g1,_moving,_input,_topDown;var _camera=new THREE.PerspectiveCamera(45,1,1,100);var _hold=new Vector3;var _target=new Vector3;var _velocity=new Vector3;var _v3=new Vector3;var _tilt=new THREE.Vector3;var _move=new THREE.Vector3;this.camera=new THREE.PerspectiveCamera(45,1,1,100);this.tiltStrength=0;let SCREEN_ROTATION=Device.mobile?120:60;const Y_MOVE=100;const Z_BASE=700;const MOBILE_ZOOM=Mobile.phone?.7:1;const MOVE=.4;var _moved=false;this.zoom=1;(function(){initGroups();if(Global.DIRECT_MISSION_TEST){initInput();_this.startRender(loop)}loop()}());function initInput(){_input=_this.initClass(Interaction.Input,__window);_input.events.add(Interaction.START,touchStart);_input.events.add(Interaction.MOVE,touchMove);_input.events.add(Interaction.END,touchEnd)}function initGroups(){_g0=new THREE.Group;_g1=new THREE.Group;_g0.add(_g1);_g1.add(_camera);_camera.position.set(0,400,Z_BASE);_camera.lookAt(World.SCENE.position)}function loop(){_camera.position.z=Z_BASE*_this.zoom*MOBILE_ZOOM;_target.lerp(_velocity,.07);_v3.subVectors(_velocity,_target);_g0.rotation.y=Utils.toRadians(_target.x);if(!Device.mobile){_tilt.x=-Utils.range(Mouse.x,0,Stage.width,MOVE,-MOVE,true)*_this.tiltStrength;_tilt.y=Utils.range(Mouse.y,0,Stage.height,-MOVE,MOVE,true)*_this.tiltStrength;_move.lerp(_tilt,.07);_target.x+=_move.x;_target.y+=_move.y}World.CAMERA.isTopDown=_topDown;if(_topDown){if(Mobile.phone){_camera.position.z=Utils.range(_target.y,-100,100,300,150)}else{_camera.position.z=Utils.range(_target.y,-100,100,450,250)}_camera.position.y=600+_target.y*.5;if(Mobile.phone)_camera.position.y*=.85}else{_camera.position.y=400+_target.y;_camera.position.z+=(Z_BASE+Utils.range(Math.abs(_v3.x),10,30,0,Z_BASE*.1,true)-_camera.position.z)*.07}_camera.lookAt(World.SCENE.position);_g0.updateMatrixWorld();Utils3D.decompose(_camera,_this.camera)}function touchStart(e){if(e.touches&&e.touches.length>1||e.target.className=="hit")return _moving=false;_hold.copy(_target);_moving=true}function touchMove(e){if(!_moving)return;if(!_moved){_moved=true;Data.UserAchievements.unlock("photojournalist")}let diff=e.delta;_target.x=_hold.x+-diff.x/Stage.width*SCREEN_ROTATION;_target.y=_hold.y+Utils.range(diff.y,-Stage.height*.4,Stage.height*.4,-100,100);_velocity.x=_target.x;_velocity.y=_target.y;if(diff.length()>20)Global.CAMERA_DRAG=true;if(_velocity.y<-Y_MOVE){let diff=_velocity.y+Y_MOVE;_velocity.y=_target.y=-Y_MOVE+diff*.5}else if(_velocity.y>Y_MOVE){let diff=_velocity.y-Y_MOVE;_velocity.y=_target.y=Y_MOVE+diff*.5}}function touchEnd(e){if(!_moving)return;_moving=false;defer(()=>Global.CAMERA_DRAG=false);_velocity.x+=-_input.velocity.x*20;_velocity.y+=_input.velocity.y*100;_velocity.y=Utils.clamp(_velocity.y,-Y_MOVE,Y_MOVE)}this.start=function(){initInput();_this.startRender(loop)};this.set("topDown",v=>{_topDown=v;if(v){_hold.y=_target.y=_velocity.y=100}});this.set("SCREEN_ROTATION",v=>{SCREEN_ROTATION=v})});Class(function MissionSkyCamera(){Inherit(this,Component);var _this=this;var _g0,_g1,_g2,_custom;var _camera=new THREE.PerspectiveCamera(45,1,1,100);var _lookAt=new THREE.Vector3;var _target=new THREE.Vector3;this.camera=new THREE.PerspectiveCamera(45,1,1,100);this.strength=1;this.dir=new THREE.Vector2(1,1);const MOVE=30;(function(){initGroups();_this.startRender(loop)}());function initGroups(){_g0=new THREE.Group;_g0.add(_camera);_g1=new THREE.Group;_g0.add(_g1);_g1.add(_camera);_this.root=_g0;_this.g1=_g1;_this.g2=new THREE.Group;_g1.wiggle=new WiggleBehavior(_g1.position);_g1.wiggle.scale=1;_lookAt.z=-100}function loop(){_g1.wiggle.update();_target.z=_camera.position.z;_target.x=Utils.range(Mouse.x,0,Stage.width,-MOVE,MOVE,true)*_this.strength*_this.dir.x;_target.y=Utils.range(Mouse.y,0,Stage.height,-MOVE,MOVE,true)*_this.strength*_this.dir.y;if(_custom){_g1.position.copy(_this.g2.position).add(_g1.wiggle.target);_g1.rotation.y+=(_this.g2.rotation.y-_g1.rotation.y)*.07}_camera.position.lerp(_target,.07);_camera.lookAt(_lookAt);_g0.updateMatrixWorld();Utils3D.decompose(_camera,_this.camera)}this.start=function(){};this.customRotate=function(){_g1.wiggle.position=null;_custom=true}});Class(function LevelLoader(_noUI){Inherit(this,View);var _this=this;var $this,$bg,$spin;var _text,_anim;(function(){initHTML();if(!_noUI)initText()}());function initHTML(){$this=_this.element;$this.size("100%").css({opacity:0}).setZ(99);Stage.add($this);$bg=$this.create("bg");$bg.size("100%").bg("#0b121e")}function initText(){var size=Mobile.phone?100:120;$spin=$this.create(".spin");$spin.size(size,size).center().css({opacity:1});$spin.inner=$spin.create(".inner");$spin.inner.size(size,size).bg(Config.IMAGES+"ui/common/spin.png").css({opacity:1});_text=_this.initClass(FlashText,{quick:true,text:"GENERATING MISSION "+Global.MISSION_SELECT_INDEX,color:"#131720",size:Mobile.phone?13:18,fill:true});_text.element.center().css({marginTop:-13});_anim=LevelLoader.getAnimation();_anim.applyTo($spin)}this.animateIn=function(callback){if(!_this.delayedCall)return;Global.IN_MISSION=true;if(!_noUI){$spin.css({opacity:0});_this.delayedCall(_text.animateIn,100);_this.delayedCall(()=>{_anim.play();$spin.tween({opacity:1},500,"easeOutSine")},300)}$this.tween({opacity:1},500,"easeOutSine",callback)};this.animateOut=function(delay,callback){if(!_noUI){$spin.tween({opacity:0},500,"easeOutSine");_this.delayedCall(_text.animateOut,200)}$this.tween({opacity:0},700,"easeInOutSine",delay,callback)}},()=>{var _anim;LevelLoader.getAnimation=function(){if(!_anim){_anim=new CSSAnimation;_anim.duration=7e3;_anim.loop=true;_anim.frames=[{rotation:0},{rotation:360}]}return _anim}});Class(function LoaderView(){Inherit(this,View);var _this=this;var $this,$text,$wipe,$mask,$logo;var _text,_anim,_cue,_size;(function(){initHTML();initLogo();initText()}());function initHTML(){$this=_this.element;$this.percent=0;$this.size("100%").bg("#0b121e");if(!Tests.blockSocialBrowser())_cue=_this.initClass(UISoundCue)}function initLogo(){_size=Mobile.phone?200:300;$logo=$this.create(".logo");$logo.size(_size-20,_size-20).css({overflow:"hidden"}).center();$wipe=$logo.create(".wipe");$wipe.size(_size-20,_size-20).center().bg(Config.IMAGES+"ui/loader/wipe.png");$mask=$this.create(".mask");$mask.size(_size,_size).center().bg(Config.IMAGES+"ui/loader/logo-mask.png");_anim=LoaderView.getAnimation();_anim.applyTo($wipe);_anim.play()}function initText(){var size=Mobile.phone?300:600;let marginTop=function(){if(Mobile.phone){if(Mobile.os=="Android")return-size*.6;return-size*.43}if(Mobile.tablet){if(Mobile.os=="Android")return-size*.62}if(Device.system.os.strpos("windows"))return-size*.49;if(Device.browser.firefox)return-size*.62;return-size*.435}();_this.size=size;$text=$this.create(".text");$text.fontStyle("Digital7",size,"#fff");$text.css({width:"100%",textAlign:"center",opacity:.05,top:"50%",marginTop,lineHeight:size,padding:0});$text.css({opacity:0}).tween({opacity:Mobile.phone?.05:.025},500,"easeOutSine",300);$text.text("99");_text=_this.initClass(FlashText,{quick:true,text:"SYSTEM INITIALIZING",color:"#131720",size:Mobile.phone?13:18,fill:true});_text.element.center().setZ(10);defer(_text.animateIn)}function update(){if(_this.done)return;var perc=100-Math.round($this.percent*100);if(perc>99)perc=99;if(perc<10)perc="0"+perc;if(perc==0){_this.done=true;perc="00";_this.hundred=true}$text.text(perc)}this.animateOut=function(callback){_this.wait(()=>{AudioController.mainTitlesInit();_cue&&_cue.animateOut();_text.animateOut();$text.tween({opacity:0},500,"easeOutSine");$logo.tween({opacity:0},800,"easeOutSine");$this.tween({opacity:0},1e3,"easeInOutSine",callback)},_this,"hundred")};this.update=function(percent){TweenManager.tween($this,{percent:percent},600,"easeOutSine",null,update)}},()=>{var _anim;LoaderView.getAnimation=function(){if(!_anim){_anim=new CSSAnimation;_anim.duration=15e2;_anim.loop=true;_anim.frames=[{y:-300},{y:300}]}return _anim}});Class(function UISoundCue(){Inherit(this,View);var _this=this;var $this,$icon;var _text;(function(){initHTML();initIcon();initText();_this.delayedCall(()=>_this.animateIn(),50)}());function initHTML(){$this=_this.element;$this.size(200,Mobile.phone?48:56).center(1,0).css({bottom:Mobile.phone?30:40,opacity:.6}).setZ(1e4).invisible()}function initIcon(){$icon=$this.create(".icon");let size=Mobile.phone?36:40;$icon.size(size,size).center(1,0).bg(Config.IMAGES+"ui/loader/headphones.png")}function initText(){_text=_this.initClass(FlashText,{text:"ENABLE AUDIO",size:Mobile.phone?9:12});_text.element.center(1,0).css({bottom:0}).setZ(10)}this.animateIn=function(){$this.visible();_text.animateIn();$icon.transform({y:10}).css({opacity:0}).tween({opacity:1,y:0},500,"easeOutCubic")};this.animateOut=function(){$this.tween({opacity:0},700,"easeInOutSine",function(){$this.hide();$this.remove()})}});Class(function Overlay(){Inherit(this,Controller);var _this=this;var $container,$bg;var _card,_carousel;(function(){initContainer();addListeners()}());function initContainer(){$container=_this.container;$container.size("100%").hide().setZ(190).enable3D();$bg=$container.create(".bg");$bg.size("100%").bg("#03060c").css({opacity:0}).setZ(0);$bg.inner=$bg.create(".inner");$bg.inner.size("100%").bg(Global.UI_COLOR).css({opacity:.4});$bg.transform({z:-10});Stage.add($container)}function addListeners(){$bg.interact(null,close)}function close(){if(_carousel&&_carousel.visible)_this.animateOut();if(_card&&_card.visible)_this.animateOut()}function createCarousel(params){let all,sort=[];if(params.arry)all=params.arry;else all=function(){if(params.type==="teams")return Data.Roles.getData();if(params.type==="ranks")return Data.Ranks.getData();return Data.Achievements.getData()}();if(params.type==="achievements"){all.forEach(item=>{sort.push(item)})}_carousel=_this.initClass(OverlayCarousel,params,sort.length>0?sort:all,$container);defer(()=>{_carousel.animateIn()})}function createCard(params){_card=_this.initClass(OverlaySingle,params,$container);defer(()=>{_card.animateIn()})}this.animateIn=function(params){if(params.carousel)createCarousel(params);else createCard(params);$container.show();$bg.inner.bg(Global.UI_COLOR);Global.INFO_OVERLAY_VISIBLE=true;$bg.css({opacity:0}).tween({opacity:.85},1e3,"easeOutSine");AudioController.onOverlayIn()};this.animateOut=function(){AudioController.onOverlayOut();if(_card)_card.animateOut();if(_carousel)_carousel.animateOut();Global.INFO_OVERLAY_VISIBLE=false;$bg.tween({opacity:0},1e3,"easeInSine",function(){$container.hide();if(_card)_card=_card.destroy();if(_carousel)_carousel=_carousel.destroy()})}},"Singleton");Class(function OverlayCarousel(_params,_all,_parent){Inherit(this,View);var _this=this;var $this,$wrapper,$rotate;var _current,_close,_left,_right,_next,_prev;var _index=0;var _type=_params.type==="teams"?"Career":"Achievement";var _cls=`Overlay${_type}Card`;var _width=700;var _height=400;var _mouse=new Vector2;var _tracking=_params.tracking;var _initial=true;var _closePos={x:0,y:0};(function(){initHTML();initCarousel();initArrows();initClose();addListeners();resizeHandler()}());function initHTML(){$this=_this.element;$this.size(_height,_width).setZ(200);$wrapper=$this.create(".wrapper");if(Device.browser.firefox)$wrapper.size("100%").css({perspective:2e3}).setZ(200).transform({z:1});else $wrapper.size("100%").enable3D(2e3).setZ(200).transform({z:1});$rotate=$wrapper.create(".wrapper");$rotate.size("100%").enable3D()}function initCarousel(){_all.forEach((item,i)=>{if(item.perma===_params.data.perma)_index=i});_current=_this.initClass(window[_cls],_params.data,_tracking,_params.type,_params.value,[$rotate])}function initArrows(){_left=_this.initClass(UIArrow,true);_right=_this.initClass(UIArrow,false)}function initClose(){_close=_this.initClass(UICloseButton,false,[_parent]);_close.transform({z:50});_close.element.enable3D().mouseEnabled(true)}function loop(){_mouse.lerp(Device.mobile?Mobile.Accelerometer:Mouse,.1);var x=_mouse.x;var y=_mouse.y;if(Device.mobile){x=Utils.convertRange(x,-5,5,Stage.width,0,true);y=Utils.convertRange(y,-10,10,0,Stage.height,true)}$rotate.rotationY=Utils.convertRange(x,0,Stage.width,-6,6);$rotate.rotationX=Utils.convertRange(y,0,Stage.height,-2,2);$rotate.transform();if(_current&&_current.bg){_current.bg.x=Utils.convertRange(x,0,Stage.width,_width*.05,-_width*.05);_current.bg.y=Utils.convertRange(y,0,Stage.height,_height*.025,-_height*.025);_current.bg.transform()}}function addListeners(){_this.events.subscribe(_close,HydraEvents.CLICK,close);_this.events.subscribe(_left,HydraEvents.CLICK,change);_this.events.subscribe(_right,HydraEvents.CLICK,change);_this.events.subscribe(HydraEvents.RESIZE,resizeHandler);_this.events.subscribe(KeyboardUtil.DOWN,keyDown)}function keyDown(e){switch(e.keyCode){case 37:change({direction:-1});break;case 39:change({direction:1});break}}function close(){Overlay.instance().animateOut()}function change(e){let next=_index+e.direction;let data=_all[next];_prev=_current;_current=_this.initClass(window[_cls],data,_tracking,_params.type,[$rotate]);if(next>0&&!_left.visible)_left.animateIn();if(next<_all.length&&!_right.visible)_right.animateIn();if(next===0)_left.animateOut();if(next>=_all.length-1)_right.animateOut();_index=next;resizeHandler();_initial=false;_close.element.stopTween().tween({x:_closePos.x,y:_closePos.y},800,"easeInOutCubic");_prev.animateOut(e.direction,()=>{_prev&&_prev.destroy();_prev=null});_current.animateIn(e.direction)}function resizeHandler(){let offsetX=-20;let offsetY=-30;_current.resize();_width=_current.width;_height=_current.height;let padding=25;if(Mobile.phone){_closePos.x=(Stage.width-_width)/2+_width+offsetX-20;_closePos.y=(Stage.height-_height)/2+offsetY;if(_initial)_close.element.transform({x:_closePos.x,y:_closePos.y});_left.css({left:-15,top:"50%",marginTop:-_left.size/2,zIndex:200});_right.css({right:-15,top:"50%",marginTop:-_right.size/2,zIndex:200});$this.css({width:Stage.width,height:Stage.height})}else{_closePos.x=(Stage.width-_width)/2+_width+offsetX-20;_closePos.y=(Stage.height-_height)/2+offsetY;if(_initial)_close.element.transform({x:_closePos.x,y:_closePos.y});$this.size(_width,_height).center();_left.css({left:-_left.size+padding,top:"50%",marginTop:-_left.size/2});_right.css({right:-_right.size+padding,top:"50%",marginTop:-_right.size/2})}}this.animateIn=function(){defer(function(){resizeHandler();_current.animateIn();_close.animateIn();_this.startRender(loop);if(_index>0)_left.animateIn();if(_index<_all.length-1)_right.animateIn();_initial=false;_this.delayedCall(function(){_this.visible=true},1e3)})};this.animateOut=function(){_this.visible=false;_current.animateOut();_close.animateOut();if(_index>0)_left.animateOut();_right.animateOut()};this.onDestroy=function(){_current=_current.destroy()}});Class(function OverlaySingle(_params,_parent){Inherit(this,View);var _this=this;var $this,$wrapper,$rotate;var _close,_view;var _type=_params.type==="teams"?"Career":"Achievement";var _cls=`Overlay${_type}Card`;var _width=700;var _height=400;var _mouse=new Vector2;var _initial=true;var _closePos={x:0,y:0};(function(){initHTML();initView();initClose();addListeners()}());function initHTML(){$this=_this.element;$this.size(_height,_width).setZ(200);$wrapper=$this.create(".wrapper");if(Device.browser.firefox)$wrapper.size("100%").css({perspective:2e3}).setZ(200).transform({z:1});else $wrapper.size("100%").enable3D(2e3).setZ(200).transform({z:1});$rotate=$wrapper.create(".rotate");$rotate.size("100%")}function initView(){_view=_this.initClass(window[_cls],_params.data,_params.tracking,_params.type,[$rotate])}function initClose(){_close=_this.initClass(UICloseButton,false,[_parent]);_close.transform({z:50});_close.element.enable3D().mouseEnabled(true)}function loop(){_mouse.lerp(Device.mobile?Mobile.Accelerometer:Mouse,.1);var x=_mouse.x;var y=_mouse.y;if(Device.mobile){x=Utils.convertRange(x,-5,5,Stage.width,0,true);y=Utils.convertRange(y,-10,10,0,Stage.height,true)}$rotate.rotationY=Utils.convertRange(x,0,Stage.width,-6,6);$rotate.rotationX=Utils.convertRange(y,0,Stage.height,-2,2);$rotate.transform();if(_view&&_view.bg){_view.bg.x=Utils.convertRange(x,0,Stage.width,_width*.05,-_width*.05);_view.bg.y=Utils.convertRange(y,0,Stage.height,_height*.025,-_height*.025);_view.bg.transform()}}function addListeners(){_this.events.subscribe(_close,HydraEvents.CLICK,close);_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){let offsetX=-20;let offsetY=-30;_view.resize();_width=_view.width;_height=_view.height;if(Mobile.phone){_closePos.x=(Stage.width-_width)/2+_width+offsetX-20;_closePos.y=(Stage.height-_height)/2+offsetY;if(_initial)_close.element.transform({x:_closePos.x,y:_closePos.y});$this.css({width:Stage.width,height:Stage.height})}else{_closePos.x=(Stage.width-_width)/2+_width+offsetX-20;_closePos.y=(Stage.height-_height)/2+offsetY;if(_initial)_close.element.transform({x:_closePos.x,y:_closePos.y});$this.size(_width,_height).center()}}function close(){Overlay.instance().animateOut()}this.animateIn=function(){defer(function(){resizeHandler();_view.animateIn();_close.animateIn();_this.startRender(loop);_initial=false;_this.delayedCall(function(){_this.visible=true},1e3)})};this.animateOut=function(){_this.visible=false;_view.animateOut();_close.animateOut()};this.onDestroy=function(){_view=_view.destroy()}});Class(function OverlayAchievementCard(_data,_tracking,_type){Inherit(this,View);var _this=this;var $this,$title,$text,$bg,$content,$xp,$icon,$info,$wrapper,$share;var _unlock,_tw,_fb,_titleText;var _width=750;var _iconSize=function(){if(Mobile.phone){if(Stage.width<500)return 125;return 140}return 190}();var _height=350;var _padding=50;var _offset=Mobile.phone?45:80;var _blue="#0e182d";var _locked=function(){if(_data.hasOwnProperty("unlocked")&&_data.unlocked===false)return true;if(_data.hasOwnProperty("locked")&&_data.locked===true)return true;return false}();var _xp=_data.xp||"1000";var _dy=new DynamicObject({num:_xp/4});(function(){initHTML();initUnlock();initTitle();initText();initXP();if(!_locked)initShare()}());function initHTML(){$this=_this.element;$this.size(_width,450).center().invisible().enable3D().setZ(91);$wrapper=$this.create(".wrapper");$wrapper.size("100%").enable3D().mouseEnabled(true);$wrapper.inner=$wrapper.create(".inner");$wrapper.inner.size("100%").css({overflow:"hidden"}).bg(Global.UI_COLOR).enable3D();$bg=$wrapper.inner.create(".bg");$bg.size("100%");$bg.inner=$bg.create(".inner");$bg.inner.size("100%").bg(_data.bgImage).css({opacity:.05,backgroundRepeat:"no-repeat",backgroundSize:"cover"});$content=$wrapper.inner.create(".wrapper");Mobile.overflowScroll($content,{x:0,y:1});let img=_data.icon;$icon=$content.create(".icon");$icon.bg(img,"contain");$info=$content.create("info");_this.bg=$bg;_this.wrapper=$wrapper}function initUnlock(){let text=_type==="ranks"?"RANK UNLOCKED":"ACHIEVEMENT UNLOCKED";if(_type==="achievements"&&_locked)text="ACHIEVEMENT LOCKED";if(_type==="ranks"&&_locked)text="RANK LOCKED";_unlock=_this.initClass(FlashText,{quick:true,text:text,color:_blue,size:Mobile.phone?12:16,fill:true,fillColor:"#fff"},[$info])}function initTitle(){_titleText=_data.title.toUpperCase();if(_data.classified&&_data.locked)_titleText="CLASSIFIED";var size=Math.round(Utils.convertRange(_titleText.length,8,15,64,48,true));if(Mobile.phone){if(Stage.width<500)size*=.5;else size*=.6}$title=$info.create("title");$title.fontStyle("StratumBold",size,"#fff");$title.css({width:"100%",lineHeight:size,marginBottom:5,letterSpacing:0,textAlign:"left",position:"relative",display:"block"});$title.text(_titleText)}function initText(){var size=function(){if(Mobile.phone){if(Stage.width<500)return 13;return 14}return 16}();$text=$info.create(".text");$text.fontStyle("DIN",size,"#fff");$text.css({width:"100%",fontWeight:"normal",lineHeight:size*1.4,letterSpacing:0,textAlign:"left",position:"relative",display:"block"});let text=_data.description;if(_data.classified&&_data.locked)text="Keep playing to unlock this classified achievement";$text.text(text)}function initXP(){var size=function(){if(Mobile.phone){if(Stage.width<500)return 12;return 14}return 15}();$xp=$info.create("xp");$xp.digits=$xp.create("points");$xp.copy=$xp.create("points copy");$xp.copy.text(`POINTS`);$xp.digits.text(0);$xp.digits.fontStyle("Digital7",size*2,"#fff");$xp.copy.fontStyle("StratumBold",size,"#fff");$xp.css({width:"100%",fontWeight:"bold",lineHeight:size*1.4,letterSpacing:1,marginBottom:10,marginTop:20,textAlign:"left",position:"relative",display:"block"});$xp.digits.css({position:"relative",display:"inline-block",marginRight:5});$xp.copy.css({position:"relative",display:"inline-block"})}function initShare(){var size=Mobile.phone?15:10;$share=$this.create("share-buttons");$share.mouseEnabled(true);$share.wrapper=$share.create("wrapper");$share.copy=$share.wrapper.create("share-copy");$share.copy.text("SHARE");$share.copy.fontStyle("StratumBold",size,"#fff");$share.copy.css({marginRight:15,opacity:.6,letterSpacing:1,position:"relative",display:"inline-block"});_tw=_this.initClass(ShareIcon,"tw",{size:Mobile.phone?30:20,img:_data.share_image,copy:_data.twitter_share_copy},{category:"achievement",label:_data.perma},[$share.wrapper]);_fb=_this.initClass(ShareIcon,"fb",{size:Mobile.phone?30:20,img:_data.share_image,copy:_data.facebook_share_copy},{category:"achievement",label:_data.perma},[$share.wrapper]);_tw.css({position:"relative",display:"inline-block",marginRight:5,top:Mobile.phone?10:7});_fb.css({position:"relative",display:"inline-block",top:Mobile.phone?10:7})}this.resize=function(){let padding=Mobile.phone?20:50;let infoWidth=Mobile.phone?Utils.range(_titleText.length,8,15,200,260,true):Utils.range(_titleText.length,8,15,350,425,true);_unlock.element.css({left:0,marginLeft:0,position:"relative",marginBottom:Mobile.phone?10:15});if(Mobile.phone){_width=Stage.width-_offset*4;_height=Stage.height-_offset*2;$this.size(_width,_height).css({marginLeft:"",marginTop:"",left:_offset*2,top:_offset});let scale=Utils.range(Stage.width,480,700,.5,.75,true);_unlock.resize(scale);let width=_iconSize+infoWidth+padding*3;$icon.css({width:_iconSize,height:_iconSize,left:padding+10,top:"50%",marginTop:-_iconSize/2});$title.css({width:infoWidth});$info.css({width:infoWidth,right:padding});let containerHeight=$info.div.offsetHeight;$content.css({width:width,height:containerHeight,top:"50%",marginTop:-containerHeight/2,left:"50%",marginLeft:-width/2});if($share){$share.css({bottom:50,width:135,right:5,left:""});$share.wrapper.css({width:135})}$bg.size(_width*1.2,_height*1.1).center()}else{let width=_iconSize+infoWidth+padding*3;$icon.css({width:_iconSize,height:_iconSize,left:padding+10,top:"50%",marginTop:-_iconSize/2});$title.css({width:infoWidth});$info.css({width:infoWidth,right:padding+10});let containerHeight=$info.div.offsetHeight;$content.css({width:width,height:containerHeight,top:"50%",marginTop:-containerHeight/2,left:"50%",marginLeft:-width/2});if($share){$share.css({bottom:-25,width:125,left:"50%",marginLeft:-100/2});$share.wrapper.css({width:125})}$this.size(width,_height).center();$bg.size(width*1.2,_height*1.1).center()}_this.width=_width;_this.height=_height};this.animateIn=function(dir,callback){defer(function(){let left=dir===-1;$this.visible();_unlock.element.css({left:0,marginLeft:0});_unlock.animateIn(150);if(dir)$wrapper.inner.transform({rotationY:left?-40:40,z:-200,x:left?-250:250}).css({opacity:0}).tween({z:0,rotationY:0,opacity:1,x:0},900,"easeOutCubic");else $wrapper.inner.transform({rotationY:-40,z:-200}).css({opacity:0}).tween({z:0,rotationY:0,opacity:1,x:0},900,"easeOutCubic");$bg.css({opacity:0}).tween({opacity:1},3e3,"easeOutSine");$bg.inner.css({opacity:.5}).transform({scale:1.15}).tween({opacity:.9,scale:1},3e3,"easeOutSine");$title.transform({y:15,z:50}).css({opacity:0}).tween({opacity:1,y:0,z:50},800,"easeOutCubic",200);$text.transform({y:15}).css({opacity:0}).tween({opacity:1,y:0},800,"easeOutCubic",400);$xp.css({opacity:0}).transform({y:15}).tween({opacity:1,y:0},800,"easeOutCubic",450);$xp.digits.text(Math.round(_xp));if($share){$share.css({opacity:0}).tween({opacity:1},800,"easeOutCubic",450);_tw.animateIn(500);_fb.animateIn(650)}_this.delayedCall(function(){_this.visible=true;if(callback)callback()},1e3)})};this.animateOut=function(dir,callback){let left=dir===-1;_this.visible=false;if(dir){$wrapper.inner.tween({z:-200,rotationY:left?40:-40,x:left?250:-250,opacity:0},500,"easeOutCubic",()=>{if(callback)callback()})}else $wrapper.inner.tween({rotationY:20,z:-200,opacity:0},500,"easeInCubic");if($share)$share.tween({opacity:0},500,"easeOutCubic")}});Class(function OverlayCareerCard(_data,_tracking,_value){Inherit(this,View);var _this=this;var $this,$title,$wrapper,$line,$solid,$text,$bg,$content;var _title,_close,_learn;var _width=700;var _height=400;var _offset=Mobile.phone?45:80;var _mouse=new Vector2;var _rotate=new Vector2;(function(){initHTML();initTitle();initText();initButton()}());function initHTML(){$this=_this.element;$this.size(_width,450).center().invisible().enable3D().setZ(91);$wrapper=$this.create(".wrapper");$wrapper.size("100%").enable3D();$wrapper.inner=$wrapper.create(".inner");$wrapper.inner.size("100%").css({overflow:"hidden"}).bg("#000").enable3D();$bg=$wrapper.inner.create(".bg");$bg.size("100%");$bg.inner=$bg.create(".inner");$bg.inner.size("100%").bg(_data.image,"cover").css({opacity:.5});$solid=$wrapper.inner.create(".solid");$solid.size("100%").bg(Global.IN_MISSION?Global.UI_COLOR:"#181f3f").css({opacity:.6}).setZ(0);$line=$wrapper.inner.create(".line");$line.size("100%",4).bg("#fff").transformPoint("0%","50%");$content=$wrapper.inner.create(".wrapper");$content.css({width:_width-_offset*2,top:_offset}).enable3D();if(Mobile.phone)$content.div.className+=" fade-bottom";Mobile.overflowScroll($content,{x:0,y:1});_this.bg=$bg;_this.wrapper=$wrapper.inner}function initTitle(){var size=Math.round(Utils.convertRange(_data.title.length,10,30,54,40,true));if(Mobile.phone)size*=.8;$title=$content.create(".text");$title.fontStyle("StratumBold",size,"#fff");$title.css({width:"100%",lineHeight:size,marginBottom:15,letterSpacing:0,textAlign:"left",position:"relative",display:"block"});$title.text(_data.title.toUpperCase())}function initText(){var size=Mobile.phone?13:15;$text=$content.create(".text");$text.fontStyle("DIN",size,"#fff");$text.css({width:"100%",fontWeight:"normal",lineHeight:size*1.4,letterSpacing:0,marginBottom:10,textAlign:"left",position:"relative",display:"block"});$text.text(_data.info)}function initButton(){_learn=_this.initClass(GhostButton,{text:"LEARN MORE",width:140,height:40,size:14,lockSize:true,reclickable:true},[$content]);_learn.element.css({position:"relative",display:"block",marginTop:Mobile.phone?10:20,marginBottom:15}).setZ(1e3).mouseEnabled(true).transform({z:20});_learn.events.add(HydraEvents.CLICK,function(){getURL(_data.link,"_blank");if(!_value)_value="";Tracking.event({category:_tracking,action:"teams-learn-more",label:_data.perma,value:_value})})}this.resize=function(){if(Mobile.phone){_width=Stage.width-_offset*2;_height=Stage.height-_offset*2;$this.size(_width,_height).css({marginLeft:"",marginTop:"",left:_offset,top:_offset});$content.size(_width-_offset*2,_height).css({paddingRight:_offset,left:_offset,top:0});_learn.element.css({position:"relative",display:"block",marginTop:Mobile.phone?10:20,marginBottom:_offset}).setZ(1);$title.css({marginTop:_offset})}else{var height=$content.div.offsetHeight;$content.size(_width-_offset*2,height-10).center();_height=height+_offset*2-10;$this.size(_width,_height).center();$bg.size(_width*1.2,_height*1.1).center()}_this.width=_width;_this.height=_height};this.animateIn=function(dir,callback){let left=dir===-1;defer(function(){$this.visible();if(dir)$wrapper.inner.transform({rotationY:left?-60:60,z:-200,x:left?-250:250}).css({opacity:0}).tween({z:0,rotationY:0,opacity:1,x:0},900,"easeOutCubic");else $wrapper.inner.transform({rotationY:-60,z:-200}).css({opacity:0}).tween({z:0,rotationY:0,opacity:1,x:0},900,"easeOutCubic");if(!left)$line.transformPoint("100% 50%");else $line.transformPoint("0% 50%");$line.transform({scaleX:0}).tween({scaleX:1},1e3,"easeInOutQuart");$bg.inner.css({opacity:.2}).transform({scale:1.15}).tween({opacity:.2,scale:1},3e3,"easeOutSine");$title.transform({y:15,z:50}).css({opacity:0}).tween({opacity:1,y:0,z:50},800,"easeOutCubic",400);$text.transform({y:15}).css({opacity:0}).tween({opacity:1,y:0},800,"easeOutCubic",600);_learn.animateIn(500);_this.delayedCall(function(){_this.visible=true;if(callback)callback()},1e3)})};this.animateOut=function(dir,callback){_this.visible=false;let left=dir===-1;if(dir){$wrapper.inner.tween({z:-200,rotationY:left?40:-40,x:left?250:-250,opacity:0},500,"easeOutCubic",()=>{if(callback)callback()})}else $wrapper.inner.tween({rotationY:20,z:-200,opacity:0},500,"easeInCubic");if(left)$line.transformPoint("100% 50%");else $line.transformPoint("0% 50%");$line.tween({scaleX:0},450,"easeOutQuart")}});Class(function SimulatorBG(){Inherit(this,Component);var _this=this;var _shader,_mesh;this.group=new THREE.Group;(function(){initMesh();_this.startRender(loop)}());function initMesh(){var geom=new THREE.IcosahedronGeometry(5e3,2);_shader=_this.initClass(Shader,"SimulatorBG");_shader.uniforms={time:MapUtil.time,color0:{type:"c",value:new THREE.Color(4612756)},color1:{type:"c",value:new THREE.Color(26938e1)},scale:{type:"f",value:.4},transition:{type:"f",value:2},darken:{type:"f",value:.8},dpr:MapUtil.dpr};_shader.material.side=THREE.BackSide;ShaderUIL.instance().push(_shader);_mesh=new THREE.Mesh(geom,_shader.material);_mesh.renderOrder=-5;_this.group.add(_mesh)}function loop(){_mesh.rotation.z+=.002}});Class(function SimulatorLanding(_group,_particles,_globe){Inherit(this,Component);var _this=this;var _camera,_text,_button,_hero0,_hero1,_hero2;var _hologramText=[];var _rotation=new Vector3;var _copy=new Vector3;var _mouse=new Vector2(Stage.width/2,Stage.height/2);var _strength=new DynamicObject({v:0});const SOCIAL_BROWSER=Tests.blockSocialBrowser();var _active=!Storage.get("simulator_landing")||SOCIAL_BROWSER;(function(){if(!_active)return;FX.ScreenComposite.instance().set("vignette",.4);initCamera();initText();initLanding();addListeners();_this.activated=true;_this.startRender(loop)}());function initCamera(){_camera=new THREE.PerspectiveCamera(45,1,1,1e3);_camera.position.x=_globe.group.position.x;_camera.position.y=_globe.group.position.y+350;_camera.position.z=295;let startCamera=new THREE.PerspectiveCamera(45,1,1,1e3);startCamera.position.copy(_camera.position);startCamera.position.z=0;startCamera.position.y+=30;Camera.instance().setCamera(_active?startCamera:_camera)}function initText(){if(Tests.blockSocialBrowser())return;let group=new THREE.Group;_group.add(group);_text=group;group.scale.setScalar(.8);group.position.copy(_camera.position);group.position.z=0;group.position.y+=40;let config=[{map:"welcome",width:424,height:83,scale:1,y:30,x:0},{map:"airman",width:706,height:172,scale:1,y:0},{map:"challenge",width:1024,height:172,scale:1,y:-35}];config.forEach(c=>{let text=_this.initClass(HologramText,`assets/images/landing/${c.map}.png`,c.width,c.height);group.add(text.mesh);text.mesh.position.y=c.y;text.mesh.position.x=c.x||0;text.mesh.scale.setScalar(.2*c.scale);_hologramText.push(text)})}function initLanding(){_globe.setEdge();_particles.closeUp();if(Tests.blockSocialBrowser())return;_button=_this.initClass(GhostButton,{text:"BEGIN",width:Mobile.phone?80:140,height:Mobile.phone?35:55},[Stage]);_button.element.center().css({marginTop:Mobile.phone?20:40});_button.events.add(HydraEvents.HOVER,buttonHover)}function loop(){if(Device.mobile||SOCIAL_BROWSER)return;_mouse.lerp(Mouse,.2);_rotation.y=Utils.toRadians(Utils.range(_mouse.x,0,Stage.width,-2,2)*_strength.v);_copy.copy(_globe.edge.group.rotation).lerp(_rotation,.07*.5);_copy.copyTo(_globe.edge.group.rotation);_rotation.y=Utils.toRadians(Utils.range(_mouse.x,0,Stage.width,-10,10)*_strength.v);_copy.copy(_text.rotation).lerp(_rotation,.04*.5);_copy.copyTo(_text.rotation)}function addListeners(){_button&&_button.events.add(HydraEvents.CLICK,click)}function buttonHover(e){if(e.action=="over")FX.ScreenComposite.instance().beginHover()}function click(){_button.events.remove(HydraEvents.CLICK,click);_button.animateOut();_strength.tween({v:0},500,"easeOutCubic");_this.parent.transitionToMissions();_hologramText.forEach((t,i)=>t.animateOut(1e3,i*100));_this.delayedCall(()=>{_group.remove(_text);HologramTextMask.instance().stop();Tracking.event({category:"landing",action:"begin-click"});_this.destroy()},7e3);Storage.set("simulator_landing",true)}this.animateIn=function(){_particles.animateIn();if(!_active)return _this.parent.transitionToMissions(true);Blocker.instance().ready().then(()=>{let v3=Camera.instance().worldCamera.position.clone();v3.x-=175;_particles.globePos(v3,.5,true);_globe.particles.show();Tracking.page("landing");Camera.instance().lerp=.02;Camera.instance().transition(_camera,9e3,"easeOutCubic",()=>{Camera.instance().lerp=.08});_button&&_this.delayedCall(()=>{_button.animateIn();addListeners()},77e2);_globe.edge.animateIn();_this.delayedCall(_globe.particles.fadeOut,4e3);_strength.tween({v:1},9e3,"easeOutSine");_this.delayedCall(function(){VOController.instance().playIntro()},3e3);_this.delayedCall(function(){_hologramText&&_hologramText.forEach((t,i)=>t.animateIn(5e3,700*i))},13e2)})}});Class(function Globe(){Inherit(this,Component);var _this=this;var _shader,_clouds,_regions,_glow,_edge;var _radius,_rotation,_pins,_rings,_mesh;this.group=new THREE.Group;(function(){initMesh();initControls();initViews()}());function initMesh(){_rotation=new THREE.Group;_this.group.add(_rotation);_shader=Globe.getShader();_shader.set("tDiffuse",Utils3D.getTexture(MapUtil.getRes("assets/images/globe/diffuse.jpg")));_shader.set("tNormal",Utils3D.getTexture("assets/images/globe/normal.jpg"));_shader.set("tOceanNormal",Utils3D.getRepeatTexture("assets/images/globe/ocean-normal.jpg"));_shader.set("tClouds",Utils3D.getRepeatTexture(MapUtil.getRes("assets/images/globe/clouds.jpg")));_shader.set("tSpecular",Utils3D.getTexture("assets/images/globe/specular.jpg"));_shader.set("tDistortion",Utils3D.getRepeatTexture("assets/images/vfx/digitaltransition.jpg"));_shader.set("rimColor",new THREE.Color(6529264));_shader.uniforms.time=MapUtil.time;_shader.uniforms.dpr=MapUtil.dpr;_shader.uniforms.resolution=MapUtil.resolution;_shader.uniforms.dOffset=FX.DigitalTransition.instance().pass.uniforms.dOffset;_shader.material.transparent=true;_shader.material.blending=THREE.AdditiveBlending;let geom=Globe.getGeometry();let mesh=new THREE.Mesh(geom,_shader.material);_rotation.add(mesh);_mesh=mesh;ShaderUIL.instance().push(_shader)}function initViews(){_clouds=_this.initClass(GlobeClouds);_rotation.add(_clouds.group);_regions=_this.initClass(GlobeRegions);_rotation.add(_regions.group);_glow=_this.initClass(GlobeGlow);_this.group.add(_glow.group);_this.glow=_glow;_radius=_this.initClass(GlobeRadius,_rotation);_this.group.add(_radius.group);if(!Tests.blockSocialBrowser()){_pins=_this.initClass(GlobePins,_this.controls);_rotation.add(_pins.group)}_rings=_this.initClass(GlobeRings);_this.group.add(_rings.group);_this.particles=_rings;_edge=_this.initClass(EarthEdge);_this.edge=_edge}function initControls(){_this.controls=_this.initClass(GlobeControls,_rotation,_shader.uniforms.velocity)}this.show=function(){_shader.set("transition",2);_clouds.show();_regions.show();_glow.show();_radius.show();_this.hidden=false;_this.controls.animateIn()};this.hide=function(){_shader.set("transition",-.2);_clouds.hide();_regions.hide();_glow.hide();_radius.hide();_this.hidden=true};this.animateIn=function(fromEdge){if(_this.active("animating"))return;_this.group.visible=true;_this.active("animating",true);if(!fromEdge)_this.group.rotation.y=Utils.toRadians(180);TweenManager.tween(_this.group.rotation,{y:0},35e2,"easeOutCubic");_this.controls.animateIn();let time=3e3;let ease="easeInOutCubic";_shader.tween("transition",2.5,time,ease,()=>{});_glow.animateIn(time,ease,1e3);_clouds.animateIn(time,ease,1e3);_regions.animateIn(time,ease,700);_radius.animateIn(time,ease,500,200);_this.delayedCall(_pins.animateIn,2e3);AudioController.globeIn();_this.hidden=false;_this.delayedCall(()=>_this.active("animating",false),25e2)};this.setEdge=function(){_this.group.visible=true;_shader.material.visible=false;_this.group.add(_edge.group)};this.animateToGlobe=function(){_this.controls.reset();_glow.animateOut();_edge.animateOut();_rings.fadeIn(25e2,"easeOutSine");_this.delayedCall(()=>{_this.animateIn(true);_rings.fadeOut();_edge.group.visible=false;_shader.material.visible=true},17e2)};this.animateOut=function(time=2e3,ease="easeInCubic",quick){_shader.tween("transition",-.2,time*1.1,ease);if(time>=2e3)_rings.animateOut(time,ease);_glow.animateOut(time*.7,ease);_clouds.animateOut(time*.7,ease);_regions.animateOut(time,ease);_radius.animateOut(time*.7,ease);_pins.animateOut(quick);_this.delayedCall(()=>{_this.group.visible=false,_this.controls.animateOut()},time*1.5);AudioController.globeOut(time);_this.hidden=true}},()=>{var _geom,_shader,_light;Globe.getGeometry=function(){if(!_geom)_geom=new THREE.SphereBufferGeometry(300,60,60);return _geom};Globe.getLight=function(){if(!_light){_light=new THREE.PointLight(16777215);_light.position.set(4e3,2e3,4e3)}return _light};Globe.getShader=function(){if(!_shader){_shader=new Shader("GlobeBase");_shader.uniforms={tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},tOceanNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tClouds:{type:"t",value:null},tDistortion:{type:"t",value:null},pShininess:{type:"f",value:1.61},sunStrength:{type:"f",value:.6},rimStrength:{type:"f",value:.46},rimColor:{type:"c",value:null},transition:{type:"f",value:0},velocity:{type:"f",value:0},time:MapUtil.time};_shader.receiveLight=true;_shader.lights.push(Globe.getLight())}return _shader.clone()}});Class(function GlobeControls(_root,_vel){Inherit(this,Component);var _this=this;var _input,_timer;const SCREEN_ROTATION=Device.mobile?130:100;const X_LIMIT=.4;const X_MAX=35;var _target=new Vector3;var _rotation=new Vector3;var _hold=new Vector3;var _velocity=new Vector3;var _prev=new Vector3;var _v3=new Vector3;(function(){initInput()}());function initInput(){_input=_this.initClass(Interaction.Input,Stage);_input.events.add(Interaction.START,touchStart);_input.events.add(Interaction.MOVE,touchMove);_input.events.add(Interaction.END,touchEnd)}function loop(){if(_velocity.y>180){_hold.y-=360;_velocity.y-=360;_target.y-=360;_rotation.y-=360}if(_velocity.y<-180){_hold.y+=360;_velocity.y+=360;_target.y+=360;_rotation.y+=360}_target.lerp(_velocity,.07);_rotation.lerp(_target,.4);_v3.subVectors(_rotation,_target);_vel.value=Utils.range(_v3.length(),4,20,0,1,true);_root.rotation.x=Utils.toRadians(_rotation.x);_root.rotation.y=Utils.toRadians(_rotation.y)}function touchStart(e){_velocity.y=_target.y;_hold.y=_target.y;_hold.x=_target.x}function touchMove(e){if(Global.SCROLL_TOUCHING)return;_target.y=_hold.y+e.delta.x/Stage.width*SCREEN_ROTATION;_target.x=_hold.x+e.delta.y/Stage.height*(SCREEN_ROTATION*X_LIMIT);_prev.copy(e);_velocity.y=_target.y;_velocity.x=_target.x}function touchEnd(e){let moveX=_input.velocity.x*200/Stage.width*SCREEN_ROTATION;let moveY=_input.velocity.y*200/Stage.height*(SCREEN_ROTATION*X_LIMIT);if(_prev&&_prev.length()>8){_velocity.y=_target.y+moveX;_velocity.x=Utils.clamp(_target.x+moveY,-X_MAX,X_MAX)}}this.center=function(lat,lng,snap){clearTimeout(_timer);_timer=_this.delayedCall(()=>{let y=-lng*Math.PI/180-Math.PI+Utils.toRadians(90);let x=lat*Math.PI/180;_velocity.y=Utils.toDegrees(y)-360*Math.floor(Math.abs(_velocity.y)/360);_velocity.x=Utils.toDegrees(x);if(_velocity.y-_rotation.y>180)_velocity.y-=360;if(_velocity.y-_rotation.y<-180)_velocity.y+=360},150)};this.animateIn=function(){_this.reset();_this.startRender(loop)};this.animateOut=function(){_this.stopRender(loop)};this.reset=function(){_velocity.x=0;_velocity.y=0;_target.x=0;_target.y=0;_rotation.x=0;_rotation.y=0}});Class(function EarthEdge(){Inherit(this,Component);var _this=this;var _shader,_mesh;this.group=new THREE.Group;(function(){initMesh()}());function initMesh(){let geom=EarthEdge.getGeometry();_shader=EarthEdge.getShader();_shader.set("tDiffuse",Utils3D.getTexture(MapUtil.getRes("assets/images/globe/diffuse.jpg")));_shader.set("tNormal",Utils3D.getTexture("assets/images/globe/normal.jpg"));_shader.set("tOceanNormal",Utils3D.getRepeatTexture("assets/images/globe/ocean-normal.jpg"));_shader.set("tClouds",Utils3D.getRepeatTexture(MapUtil.getRes("assets/images/globe/clouds.jpg")));_shader.set("tSpecular",Utils3D.getTexture("assets/images/globe/specular.jpg"));_shader.set("tDistortion",Utils3D.getRepeatTexture("assets/images/vfx/digitaltransition.jpg"));_shader.set("rimColor",new THREE.Color(6529264));_shader.set("darkColor",new THREE.Color(6529264));_shader.set("tMask",HologramTextMask.instance().texture);_shader.uniforms.time=MapUtil.time;_shader.uniforms.dpr=MapUtil.dpr;_shader.uniforms.dOffset=FX.DigitalTransition.instance().pass.uniforms.dOffset;_shader.uniforms.resolution=MapUtil.resolution;_shader.material.transparent=true;_shader.material.blending=THREE.AdditiveBlending;_shader.set("transition",2.05);ShaderUIL.instance().push(_shader);let mesh=new THREE.Mesh(geom,_shader.material);mesh.rotation.x=Utils.toRadians(-3);_this.group.add(mesh);_mesh=mesh}function initGlow(){let shader=_this.initClass(Shader,"EarthGlow");shader.material.transparent=true;shader.material.depthWrite=false;let geom=new THREE.PlaneBufferGeometry(1e3,1e3);let mesh=new THREE.Mesh(geom,shader.material);_this.group.add(mesh)}this.animateIn=function(){_mesh.rotation.y=Utils.toRadians(20);TweenManager.tween(_mesh.rotation,{y:0},1e4,"easeInOutCubic");_shader.set("transition",1);_shader.tween("transition",2.05,13e3,"easeOutCubic");_this.parent.glow.animateIn(1e4,"easeInCubic")};this.animateOut=function(){_shader.set("transition",2.05);AudioController.mainTitlesStop();_shader.tween("transition",1,2e3,"easeInOutCubic")}},()=>{var _geom,_shader;EarthEdge.getGeometry=function(){if(!_geom)_geom=new THREE.SphereBufferGeometry(300,32,32,0,Utils.toRadians(360),0,Utils.toRadians(50));return _geom};EarthEdge.getShader=function(){if(!_shader){_shader=new Shader("EarthEdge");_shader.uniforms={tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},tMask:{type:"t",value:null},tOceanNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tClouds:{type:"t",value:null},tDistortion:{type:"t",value:null},pShininess:{type:"f",value:1.61},sunStrength:{type:"f",value:.75},rimStrength:{type:"f",value:.46},rimColor:{type:"c",value:null},darkColor:{type:"c",value:null},transition:{type:"f",value:0},velocity:{type:"f",value:0},time:MapUtil.time};let light=new THREE.PointLight(16777215);light.position.set(0,2e3,0);_shader.receiveLight=true;_shader.lights.push(light)}return _shader.clone()}});Class(function GlobeClouds(){Inherit(this,Component);var _this=this;var _shader;(function(){initMesh();_this.startRender(loop)}());function initMesh(){let geom=GlobeClouds.getGeometry();_shader=GlobeClouds.getShader();_this.group=new THREE.Points(geom,_shader.material)}function loop(){_this.group.rotation.x+=.002;_this.group.rotation.z+=.002}this.animateIn=function(time=1e3,ease="easeInOutSine",delay=0){_shader.tween("transition",1,time*1.5,"easeOutSine",delay)};this.animateOut=function(time=1e3,ease="easeInOutSine",delay=0){_shader.tween("transition",0,time,ease,delay)};this.show=function(){_shader.set("transition",1)};this.hide=function(){_shader.set("transition",0)}},()=>{var _geom,_shader;GlobeClouds.getGeometry=function(){if(!_geom){let v=new Vector3;let geom=new THREE.BufferGeometry;let total=100;let position=new Float32Array(total*3);let attribs=new Float32Array(total*3);for(let i=0;i<total;i++){v.x=Utils.doRandom(-500,500,3);v.y=Utils.doRandom(-500,500,3);v.z=Utils.doRandom(-500,500,3);v.normalize().multiply(300);position[i*3+0]=v.x;position[i*3+1]=v.y;position[i*3+2]=v.z;attribs[i*3+0]=Utils.doRandom(.75,1.2,.4);attribs[i*3+1]=Utils.doRandom(.2,.5,.4);attribs[i*3+2]=Utils.toRadians(Utils.doRandom(0,360))}geom.addAttribute("position",new THREE.BufferAttribute(position,3));geom.addAttribute("attribs",new THREE.BufferAttribute(attribs,3));_geom=geom}return _geom};GlobeClouds.getShader=function(){if(!_shader){_shader=new Shader("GlobeClouds");_shader.uniforms={size:{type:"f",value:400*World.DPR},alpha:{type:"f",value:.01},transition:{type:"f",value:1},tMap:{type:"t",value:Utils3D.getTexture("assets/images/globe/cloud.png")}};_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.material.blending=THREE.AdditiveBlending}return _shader}});Class(function GlobeGlow(){Inherit(this,Component);var _this=this;var _shader;(function(){initMesh();addListeners();_this.startRender(loop)}());function initMesh(){let geom=GlobeGlow.getGeometry();_shader=GlobeGlow.getShader();let mesh=new THREE.Mesh(geom,_shader.material);_this.group=mesh;ShaderUIL.instance().push(_shader)}function loop(){_this.group.quaternion.copy(World.CAMERA.quaternion)}function addListeners(){_this.events.subscribe(AirmanEvents.MISSION_LIST_HOVER,missionHover)}function missionHover(e){switch(e.action){case"over":if(!_this.hovered){_this.hovered=true;_shader.tween("strength",.5,800,"easeOutSine")}break;case"out":if(_this.hovered){_this.hovered=false;_shader.tween("strength",.3,1e3,"easeOutSine")}break}}this.animateIn=function(time=1e3,ease="easeInOutSine",delay=0){_shader.tween("transition",1,time,ease,delay)};this.animateOut=function(time=1e3,ease="easeInOutSine",delay=0){_shader.tween("transition",0,time,ease,delay)};this.show=function(){_shader.set("transition",1)};this.hide=function(){_shader.set("transition",0)}},()=>{var _shader,_geom;GlobeGlow.getShader=function(){if(!_shader){_shader=new Shader("GlobeGlow");_shader.uniforms={glowColor:{type:"c",value:new THREE.Color(6529264)},strength:{type:"f",value:.3},transition:{type:"f",value:1},time:MapUtil.time}}_shader.material.depthWrite=false;_shader.material.transparent=true;return _shader};GlobeGlow.getGeometry=function(){if(!_geom)_geom=new THREE.PlaneBufferGeometry(1e3,1e3);return _geom}});Class(function GlobeRadius(_root){Inherit(this,Component);var _this=this;var _meshes;this.group=new THREE.Group;(function(){initMeshes();addListeners();_this.startRender(loop)}());function initMeshes(){let config=[{map:"radius0",scale:1.25},{map:"radius1",scale:1.85},{map:"radius2",scale:2.6}];_meshes=[];config.forEach((c,i)=>{let geom=Globe.getGeometry();let shader=GlobeRadius.getShader();shader.set("tMap",Utils3D.getTexture(`assets/images/globe/${c.map}.jpg`));shader.set("radiusColor",new THREE.Color);shader.set("tDistortion",Utils3D.getRepeatTexture("assets/images/vfx/digitaltransition.jpg"));shader.uniforms.dOffset=FX.DigitalTransition.instance().pass.uniforms.dOffset;shader.material.transparent=true;shader.material.blending=THREE.AdditiveBlending;shader.material.depthWrite=false;if(i==0)shader.set("opacity",.5);let mesh=new THREE.Mesh(geom,shader.material);mesh.scale.t=c.scale;mesh.shader=shader.material;mesh.scale.setScalar(c.scale);_this.group.add(mesh);_meshes.push(mesh)})}function addListeners(){_this.events.subscribe(AirmanEvents.MISSION_LIST_HOVER,missionHover)}function missionHover(e){switch(e.action){case"over":if(!_this.hovered){_this.hovered=true;for(var i=0;i<_meshes.length;i++){var mesh=_meshes[i];var scale=Utils.range(mesh.scale.t,1.25,2.5,1.21,2.3);TweenManager.tween(mesh.scale,{x:scale,y:scale,z:scale},800,"easeOutCubic")}}break;case"out":if(_this.hovered){_this.hovered=false;for(var i=0;i<_meshes.length;i++){var mesh=_meshes[i];TweenManager.tween(mesh.scale,{x:mesh.scale.t,y:mesh.scale.t,z:mesh.scale.t},1e3,"easeOutCubic")}}break}}function loop(){_this.group.rotation.z+=.0025;for(let i=0;i<_meshes.length;i++){_meshes[i].quaternion.slerp(_root.quaternion,.02*(.8*(1+i)))}}this.show=function(){_meshes.forEach(mesh=>{mesh.material.shader.set("transition",2)})};this.hide=function(){_meshes.forEach(mesh=>{mesh.scale.setScalar(mesh.scale.t*1.5);mesh.material.shader.set("transition",-.2)})};this.animateIn=function(time=1e3,ease="easeInOutSine",delay=0,offset=0){_meshes.forEach((mesh,i)=>{mesh.material.shader.tween("transition",2.2,time,ease,delay+offset*i);TweenManager.tween(mesh.scale,{x:mesh.scale.t,y:mesh.scale.t,z:mesh.scale.t},time*.75,ease,delay+offset*.75*i)})};this.animateOut=function(time=1e3,ease="easeInOutSine",delay=0,offset=0){_meshes.forEach((mesh,i)=>{mesh.material.shader.tween("transition",-.2,time,ease,delay+offset*(_meshes.length-i))})}},()=>{var _shader;GlobeRadius.getShader=function(){if(!_shader){_shader=new Shader("GlobeRadius");_shader.uniforms={tMap:{type:"t",value:null},tDistortion:{type:"t",value:null},radiusColor:{type:"c",value:null},opacity:{type:"f",value:.8},transition:{type:"f",value:.5},time:MapUtil.time}}return _shader.clone()}});Class(function GlobeRegions(){Inherit(this,Component);var _this=this;var _shader1,_shader2;var _mesh1,_mesh2;_this.group=new THREE.Group;var _meshes=[];(function(){initMesh();addListeners()}());function initMesh(){let geom=Globe.getGeometry();_shader1=GlobeRegions.getShader();_shader1.set("tMap",Utils3D.getTexture(MapUtil.getRes("assets/images/globe/regions.jpg")));_shader1.set("baseColor",new THREE.Color(6529264));_shader1.set("opacity",.3);_shader1.set("lightAffect",1);_mesh1=new THREE.Mesh(geom,_shader1.material);_mesh1.scale.setScalar(1.02);_this.group.add(_mesh1);_meshes.push(_mesh1);_shader2=GlobeRegions.getShader();_shader2.set("tMap",Utils3D.getTexture(MapUtil.getRes("assets/images/globe/regions.jpg")));_shader2.set("baseColor",new THREE.Color(16777215));_shader2.set("opacity",.14);_mesh2=new THREE.Mesh(geom,_shader2.material);_mesh2.scale.setScalar(1.2);_meshes.push(_mesh2)}function addListeners(){_this.events.subscribe(AirmanEvents.MISSION_LIST_HOVER,missionHover)}function missionHover(e){switch(e.action){case"over":if(!_this.hovered){_this.hovered=true;_shader1.tween("opacity",.9,800,"easeOutSine");_shader2.tween("opacity",0,800,"easeOutSine");let scale=1.08;TweenManager.tween(_mesh1.scale,{x:scale,y:scale,z:scale},600,"easeOutExpo");TweenManager.tween(_mesh2.scale,{x:scale,y:scale,z:scale},600,"easeOutExpo")}break;case"out":if(_this.hovered){_this.hovered=false;_shader1.tween("opacity",.3,1e3,"easeOutSine");_shader2.tween("opacity",.2,1e3,"easeOutSine");let scale=1.2;TweenManager.tween(_mesh1.scale,{x:1.02,y:1.02,z:1.02},1e3,"easeOutCubic");TweenManager.tween(_mesh2.scale,{x:scale,y:scale,z:scale},1e3,"easeOutCubic")}break}}this.show=function(){_meshes.forEach(mesh=>{mesh.material.shader.set("transition",2)})};this.hide=function(){_meshes.forEach(mesh=>{mesh.material.shader.set("transition",-.2)})};this.animateIn=function(time=1e3,ease="easeInOutSine",delay=0,offset=0){_meshes.forEach((mesh,i)=>{mesh.material.shader.tween("transition",2.2,time,ease,delay+offset*i)})};this.animateOut=function(time=1e3,ease="easeInOutSine",delay=0,offset=0){_meshes.forEach((mesh,i)=>{mesh.material.shader.tween("transition",-.2,time,ease,delay+offset*(_meshes.length-i))});_this.delayedCall(()=>missionHover({action:"out"}),time+delay)}},()=>{var _shader;GlobeRegions.getShader=function(){if(!_shader){_shader=new Shader("GlobeRegions");_shader.uniforms={tMap:{type:"t",value:null},baseColor:{type:"c",value:new THREE.Color(13889279)},opacity:{type:"f",value:.3},lightAffect:{type:"f",value:0},transition:{type:"f",value:1.2},time:MapUtil.time};_shader.receiveLight=true;_shader.lights.push(Globe.getLight());_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.material.blending=THREE.AdditiveBlending}return _shader.clone()}});Class(function GlobePin(_data,_controls){Inherit(this,Component);var _this=this;var _inner,_shader,_wrapper,_mesh,_item,_preventMove,_base;var _v3=new THREE.Vector3;var _v32=new THREE.Vector3;var _opacity=new Vector2(0,0);var _fade=new Vector2(0,0);this.group=new THREE.Group;this.data=_data;const cartesianToSpherical=require("CartesianToSpherical");(function(){_wrapper=new THREE.Group;_this.group.add(_wrapper);initMesh();initHit()}());function initMesh(){_mesh=GlobePin.getLight();_wrapper.add(_mesh);_shader=_mesh.material.shader;_shader.set("color",new THREE.Color(376572e1));let pos=cartesianToSpherical(_data.gps[0],_data.gps[1],300);_this.group.position.copy(pos);_wrapper.lookAt(pos);_mesh.rotation.x=Utils.toRadians(90);let base=MissionHangar.getBase(true);base.material.depthTest=true;base.rotation.x=Utils.toRadians(90);base.scale.setScalar(.75);base.position.y=0;base.material.shader.set("alpha",0);_wrapper.add(base);_base=base}function initHit(){let geom=GlobePin.getHitGeom();_this.hit=new THREE.Mesh(geom);_this.hit.lookAt(_this.group.position);_this.hit.pin=_this;_this.group.add(_this.hit);_this.hit.material.visible=false}this.link=function(item){_item=item};this.over=function(){_preventMove=true;_item&&_item.hoverIn&&_item.hoverIn(true);_preventMove=false};this.out=function(){_item&&_item.hoverOut&&_item.hoverOut()};this.click=function(){_item&&_item.click&&_item.click()};this.hoverIn=function(){if(_this.hovered)return;_shader.tween("fillWhite",1,400,"easeOutCubic");_shader.tween("transition",1,200,"easeOutSine");_base.material.shader.tween("colorMix",1,400,"easeOutCubic");TweenManager.tween(_base.scale,{x:2.4,y:2.4,z:2.4},500,"easeOutExpo");_base.material.shader.tween("scale0",.8,500,"easeOutCubic");_base.material.shader.tween("scale1",.8,500,"easeOutCubic",100);_base.material.shader.tween("scale2",.8,500,"easeOutCubic",200);if(!_preventMove){_controls.center(_data.gps[0],_data.gps[1])}_this.hovered=true;let v3=new THREE.Vector3;_this.group.localToWorld(v3);let v2=VFX.toScreenSpace(v3);Global.PIN_POSITION=v2;_this.events.fire(AirmanEvents.MISSION_SELECT_HOVER,{text:"SOME LOCATION",action:"over",pos:v2})};this.hoverOut=function(silent){if(!_this.hovered)return;_this.hovered=false;_shader.tween("transition",silent?0:.6,400,"easeOutSine");_shader.tween("fillWhite",0,400,"easeOutCubic");_base.material.shader.tween("colorMix",0,400,"easeOutCubic");TweenManager.tween(_base.scale,{x:.75,y:.75,z:.75},500,"easeOutExpo");_base.material.shader.tween("scale",0,500,"easeOutExpo");if(!silent)_this.events.fire(AirmanEvents.MISSION_SELECT_HOVER,{action:"out"});_base.material.shader.tween("scale0",1,500,"easeOutCubic");_base.material.shader.tween("scale1",1,500,"easeOutCubic");_base.material.shader.tween("scale2",1,500,"easeOutCubic")};this.select=function(){let v3=new THREE.Vector3;_this.group.localToWorld(v3);_this.events.fire(AirmanEvents.MISSION_SELECT,{data:_data,pos:v3})};this.animateIn=function(){_shader.tween("transition",.6,5e3,"easeOutSine");_base.material.shader.tween("alpha",1,5e3,"easeOutSine")};this.animateOut=function(quick){_this.delayedCall(function(){_shader.tween("transition",0,quick?0:500,"easeOutSine");_base.material.shader.tween("alpha",0,quick?0:500,"easeOutSine",()=>{_this.hoverOut(true)})},_this.hovered&&!quick?5e3:0)};this.hide=function(){_shader.set("transition",0);_base.material.shader.set("alpha",0)};this.connectList=function(){defer(()=>{Dispatch.find(UIMissionsList).link(_this)})};this.update=function(){_this.hit.getWorldPosition(_v3);_v3.normalize();_v32.copy(World.CAMERA.position).normalize();let dot=_v3.dot(_v32);_opacity.x=Utils.range(dot,.4,.2,1,0,true);_fade.lerp(_opacity,.15);_shader.set("opacity",_fade.x)}},()=>{var _base,_hit;GlobePin.getLight=function(){if(!_base){let height=90;let radius=3;let geom=new THREE.CylinderBufferGeometry(4,4,height,32);geom.rotateX(Utils.toRadians(-180));geom.translate(0,height/2,0);let shader=new Shader("GlobePin");shader.uniforms={color:{type:"c",value:null},height:{type:"f",value:height},transition:{type:"f",value:0},opacity:{type:"f",value:1},fillWhite:{type:"f",value:0},time:MapUtil.time};shader.receiveLight=true;shader.lights.push(Globe.getLight());shader.material.transparent=true;shader.material.depthWrite=false;shader.material.side=THREE.DoubleSide;shader.material.blending=THREE.AdditiveBlending;_base=new THREE.Mesh(geom,shader.material)}let clone=_base.clone();clone.material.shader=clone.material.shader.clone();clone.material=clone.material.shader.material;clone.material.shader.uniforms.time=MapUtil.time;return clone};GlobePin.getHitGeom=function(){if(!_hit){_hit=new THREE.BoxBufferGeometry(25,25,4);_hit.translate(0,0,2)}return _hit}});Class(function GlobePins(_controls){Inherit(this,Component);var _this=this;var _interaction,_timer;var _pins=[];var _meshes=[];this.group=new THREE.Group;(function(){initPins();initInteraction();addListeners()}());function initPins(){_this.group.visible=false;Data.Missions.getData().forEach((data,i)=>{let pin=_this.initClass(GlobePin,data,_controls);_this.group.add(pin.group);_pins.push(pin)});_pins[0].debug=true}function initInteraction(){if(!Device.mobile){_interaction=_this.initClass(Interaction3D,_meshes,World.CAMERA);_interaction.events.add(Interaction3D.HOVER,hover);_interaction.events.add(Interaction3D.CLICK,click)}}function addListeners(){_this.events.subscribe(UIMissionsList.CREATE,connectList);_this.events.subscribe(AirmanEvents.LOGGED_IN,loggedIn)}function loggedIn(){_this.delayedCall(setPins,1e3)}function setPins(hide){_meshes.length=0;var stories=Data.Story.getData();for(var i=0;i<_pins.length;i++){if(stories[i].locked){_pins[i].animateOut(hide)}else{_meshes.push(_pins[i].hit);_pins[i].animateIn()}}}function connectList(){_pins.forEach(p=>p.connectList())}function hover(e){if(e.action=="over"){_timer=_this.delayedCall(e.mesh.pin.over,100)}else{clearTimeout(_timer);e.mesh.pin.out()}}function click(e){e.mesh.pin.click()}function loop(){for(let i=0;i<_pins.length;i++)_pins[i].update()}this.update=function(){if(_interaction)_interaction.camera=Camera.instance().worldCamera};this.animateIn=function(){_this.startRender(loop);_this.group.visible=true;if(_interaction){_interaction.camera=World.CAMERA;_interaction.addListeners()}setPins(true)};this.animateOut=function(quick){if(_interaction)_interaction.removeListeners();_pins.forEach(p=>p.animateOut(quick));_this.delayedCall(()=>{_this.group.visible=false;_this.stopRender(loop)},4e3)}});Class(function GlobeRings(){Inherit(this,Component);var _this=this;var _shader,_mesh;this.group=new THREE.Group;(function(){initMesh();_this.startRender(loop)}());function initMesh(){let geom=Utils3D.loadBufferGeometry("globe");_shader=_this.initClass(Shader,"GlobeRings");_shader.uniforms={pointSize:{type:"f",value:2.5*World.DPR},transition:{type:"f",value:-.2},alpha:{type:"f",value:0},tMap:{type:"t",value:Utils3D.getTexture("assets/images/globe/particle.png")}};_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.material.depthTest=false;let mesh=new THREE.Points(geom,_shader.material);mesh.scale.setScalar(3.35);_this.group.add(mesh);_mesh=mesh}function loop(){_mesh.rotation.x-=.003}this.animateOut=function(time,ease){_shader.set("alpha",0);_shader.tween("alpha",.1,time*.6,"easeOutSine",()=>{_shader.tween("alpha",0,time,"easeOutSine")});_shader.tween("transition",1.5,time*.5,ease)};this.show=function(){_shader.set("transition",2);_shader.set("alpha",.1)};this.fadeOut=function(){_shader.tween("transition",0,2e3,"easeOutSine",1e3);_shader.tween("alpha",0,2e3,"easeOutSine",1e3)};this.fadeIn=function(time,ease){_shader.set("alpha",0);_shader.tween("alpha",.1,time*.6,"easeOutSine",()=>{});_shader.tween("transition",1.5,time*.5,ease)}});Class(function SimulatorParticles(_globe){Inherit(this,Component);var _this=this;var _engine,_system,_camera,_shader;var _strength=new DynamicObject({v:1});var _d=new DynamicObject({v:1});this.group=new THREE.Group;(function(){if(Tests.disableParticles())return;initBuffer().then(initEngine)}());function initBuffer(){let vertices=[];let reduce=Tests.particleReduce();let size=2e3;let inc=200*Utils.range(reduce,1,0,1,4);for(let x=0;x<size;x+=inc){for(let y=0;y<size;y+=inc){for(let z=0;z<size;z+=inc){vertices.push(x-size/2,y-size/2,-z)}}}vertices=new Float32Array(vertices);return Promise.resolve({vertices})}function initEngine(data){let interpolate=Device.mobile?.1:1;let pointSize=World.DPR*10;let threads=1;_engine=_this.initClass(ParticleEngine,data,"SimulatorParticles",ParticleEngineCPU,{threads,pointSize,simulateThread:Device.mobile});_system=_engine.system;_this.group.add(_engine.group);_system.importScript(Config.CDN+"assets/js/lib/three.min.js");_system.importClass(SimulatorParticleThread,SimulatorParticleBehavior,ScreenProjection,ParticleEngineCameraTransfer,TweenManager,TweenManager.Interpolation);_system.initialize("SimulatorParticleThread");_system.exec("SimulatorParticleThread","init",{mobile:Device.mobile});_shader=_system.shader;_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.uniforms.tMap={type:"t",value:Utils3D.getTexture("assets/images/globe/particle.png")};_shader.uniforms.color0={type:"c",value:new THREE.Color};_shader.uniforms.color1={type:"c",value:new THREE.Color};_shader.uniforms.globePos={type:"v3",value:new THREE.Vector3(_globe.x,_globe.y,_globe.z)};_shader.uniforms.globeScale={type:"f",value:1};_shader.uniforms.opacity={type:"f",value:.25};_shader.uniforms.fadeOut={type:"f",value:1};ShaderUIL.instance().push(_shader);_camera=_this.initClass(ParticleEngineCameraTransfer,World.CAMERA);_this.system=true}function loop(){if(!_camera||!_camera.obj)return;_camera.obj.strength=_strength.v;_system.exec("SimulatorParticleThread","updateCamera",_camera.obj);_camera.update();_system.update()}this.animateIn=function(){_this.wait(()=>{_this.startRender(loop);_this.group.visible=true;_shader.tween("opacity",.25,500,"easeOutSine")},_this,"system")};this.animateOut=function(){if(!_shader)return;_shader.tween("opacity",0,3e3,"easeInOutSine",()=>{_this.stopRender(loop);_this.group.visible=false})};this.hide=function(){if(!_shader)return;_shader.set("opacity",0);_this.stopRender(loop);_this.group.visible=false};this.fade=function(num){};this.closeUp=function(){_strength.v=.3};this.pullOut=function(){_strength.tween({v:1},3e3,"linear")};this.globePos=function(v3,scale=1,quick){if(!_shader)return;let time=quick?10:2e3;let origin=_shader.uniforms.globePos.value.clone();_d.v=0;_shader.tween("globeScale",scale,time,"easeOutSine");_d.tween({v:1},time,"easeInOutCubic",()=>{_shader.uniforms.globePos.value.copy(origin).lerp(v3,_d.v)})}});Class(function SimulatorParticleBehavior(_camera){Inherit(this,Component);var _this=this;const SPEED=3;var _dist=0;var _strength=0;var _radius=0;var _adjust=1;var _projection=_this.initClass(ScreenProjection,_camera.camera);var _v2=new Vector2;var _velocity=new Vector2;var _prev=new Vector2;var _screen=new Vector2;var _v3=new THREE.Vector3;var _v32=new THREE.Vector3;(function(){}());function init(p){p.target=(new Vector3).copy(p.pos);p.origin=(new Vector3).copy(p.pos)}this.update=function(){_screen.set(_camera.stage.width,_camera.stage.height);let screenLen=_screen.length();_radius=screenLen*.16;_dist=Math.pow(_radius,2);_velocity.subVectors(_camera.mouse,_prev);let len=_velocity.length();if(len>100)len=0;let strength=Utils.range(len,0,screenLen/40,0,1,true);_strength+=(strength-_strength)*.2;_prev.copy(_camera.mouse)};this.applyBehavior=function(p){if(!p.target)init(p);p.origin.z-=SPEED;_v3.copy(p.pos);let screen=_projection.project(_v3,_camera.stage);_v2.subVectors(screen,_camera.mouse);let lenSq=_v2.lengthSq();if(!Global.MOBILE){if(lenSq<_dist*_strength){let angle=Math.atan2(_v2.y,_v2.x);_v2.copy(p.origin).addAngleRadius(-angle,_radius*_strength*1.5*_adjust);p.target.set(_v2.x,_v2.y,p.origin.z)}else{p.target.lerp(p.origin,.1)}}else{p.target.lerp(p.origin,.1)}p.pos.interp(p.target,2.4,"easeInQuad");if(p.pos.z<-800){p.pos.z+=18e2;p.origin.z=p.pos.z;p.target.z=p.pos.z}};this.set("strength",v=>{_adjust=v})});Class(function SimulatorParticleThread(){Inherit(this,Component);var _this=this;var _behavior,_camera;var _system=Global.SYSTEM;var _converter=Global.CONVERTER;(function(){initParticles();initBehavior()}());function initParticles(){_system.skipIntegration=true;let p=_system.particles.start();while(p){p=_system.particles.next()}}function initBehavior(){_camera=_this.initClass(ParticleEngineCameraTransfer);_behavior=_this.initClass(SimulatorParticleBehavior,_camera);_system.addBehavior(_behavior);_system.onUpdate=_behavior.update}this.init=function(e){TweenManager.Interpolation=window.Interpolation;Global.MOBILE=e.mobile};this.updateCamera=function(e){_behavior.strength=e.strength;_camera.update(e)}});Class(function FlashText(_config){Inherit(this,View);var _this=this;var $this,$text,$bg;var _size=_config.size||16;var _letters;if(Mobile.phone&&!_config.lockSize)_size*=1.2;_this.width=600;_this.height=_size*_config.text.split("/").length;(function(){initHTML();initText();if(!Tests.noFlashText())splitText();if(_config.fill)defer(initFill)}());function initHTML(){$this=_this.element;$this.size(_this.width,_size).invisible();if(!_config.left)$this.center(1,0)}function initText(){$text=$this.create(".text");$text.fontStyle("StratumBold",_size,_config.color||"#fff");$text.css({whiteSpace:"nowrap",width:!_config.fill?"100%":"auto",lineHeight:_size,top:1,textAlign:_config.left&&Tests.noFlashText()?"left":"center",letterSpacing:_size*.05}).setZ(1);$text.text(_config.text.toUpperCase())}function splitText(){if(_this.out||!$this||!$this.visible)return;_letters=SplitTextfield.split($text);for(var i=0;i<_letters.length;i++){var $letter=_letters[i];if(!_config.left)$letter.css({position:"relative",float:"",cssFloat:"",styleFloat:"",display:"inline-block"});var html=_letters[i].div.innerHTML;$letter;if(html=="/"){$letter.html("");$letter.css({display:"block"})}else if(html!=="&nbsp;"){$letter.solid=$letter.create(".solid");$letter.solid.size("100%").bg(_config.color||"#fff").css({top:0,width:"85%",height:"80%"})}}}function initFill(){if(_this.out||!$this||!$this.visible)return;_this.width=$text.div.offsetWidth+16;$bg=$this.create(".bg");$bg.size("100%").bg(_config.fillColor||"#fff").setZ(0).css({opacity:1});$bg.add($text);$this.size(_this.width,_size+10);if(!_config.left)$this.center(1,0);$text.css({width:"100%",top:6,left:1})}this.animateIn=function(d,callback){if(_this.visible)return;_this.visible=true;$this.visible();d=d||0;if(!_letters)$text.css({opacity:0}).transform({y:_size*.5}).tween({opacity:1,y:0},800,"easeOutCubic",d);else $text.css({opacity:0}).tween({opacity:1},400,"easeOutSine",d);if($bg)$bg.transform({scaleY:0}).tween({scaleY:1},500,"easeOutCubic",d);if(_letters){for(var i=0;i<_letters.length;i++){var delay=d+Utils.doRandom(20,_config.quick?300:600);_letters[i].css({opacity:0}).tween({opacity:1},200,"easeOutSine",delay);if(_letters[i].solid)hideSolid(_letters[i],delay)}function hideSolid($letter,delay){var $solid=$letter.solid;$solid.visible().css({opacity:1}).tween({opacity:0},200,"easeOutSine",delay+150,function(){$solid.hide()});_this.delayedCall(function(){if(_this.visible)$solid.invisible();if(callback)callback()},delay+400)}}};this.animateOut=function(d){if(!_this.visible)return;_this.visible=false;d=d||0;$text.tween({opacity:0},500,"easeInOutSine",d,function(){$this.invisible&&$this.invisible()});if($bg)$bg.tween({scaleY:0},500,"easeInOutCubic",d);if(_letters){for(var i=0;i<_letters.length;i++){var delay=Utils.doRandom(0,200);_letters[i].tween({opacity:0},50,"easeOutSine",delay+d)}}};this.resize=function(scale){let size=_size*scale;if(_letters){_letters.forEach(letter=>{letter.css({fontSize:size,lineHeight:size*.95})})}_this.height=_size*.95*_config.text.split("/").length;return this}});Class(function HamburgerButton(){Inherit(this,View);var _this=this;var $this;var _lines;var _size=40;(function(){initContainer();initLines();addListeners();resizeHandler()}());function initContainer(){$this=_this.element;$this.size(_size*1.2,_size).css({top:Config.UI_OFFSET*1.2,right:Config.UI_OFFSET}).setZ(90).invisible()}function initLines(){_lines=[];for(var i=0;i<3;i++){var $line=$this.create(".line");$line.size(_size*.7,2).center().bg("#fff").css({marginTop:-8+6*i}).transform({skewX:15});_lines.push($line)}}function addListeners(){$this.interact(hover,click);$this.hit.mouseEnabled(true);_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){}function hover(){}function click(){_this.events.fire(HydraEvents.CLICK)}this.animateIn=function(){if(_this.visible)return;_this.visible=true;$this.visible();for(var i=0;i<_lines.length;i++){_lines[i].transformPoint("0%","50%").transform({scaleX:0,skewX:15}).tween({scaleX:1,skewX:15},600,"easeOutCubic",i*200+200)}};this.activate=function(){_lines[0].tween({rotation:40,y:-3,skewX:0},500,"easeOutCubic");_lines[1].tween({opacity:0,skewX:0,x:-10},500,"easeOutCubic");_lines[2].tween({rotation:-40,y:3,skewX:0},500,"easeOutCubic")};this.deactivate=function(){_lines[0].tween({rotation:0,y:0,skewX:15},500,"easeOutCubic");_lines[1].tween({opacity:1,skewX:15,x:0},500,"easeOutCubic");_lines[2].tween({rotation:0,y:0,skewX:15},500,"easeOutCubic")}});Class(function UILogo(scale){Inherit(this,View);var _this=this;var $this;var _scale=Mobile.phone?.31:.46;if(scale)_scale=scale;var _quick=scale||Storage.get("simulator_landing")||false;(function(){initHTML();addListeners()}());function initHTML(){$this=_this.element;$this.size(Math.round(180*_scale),Math.round(140*_scale)).css({top:Config.UI_OFFSET,left:Config.UI_OFFSET}).bg(Config.IMAGES+"ui/common/logo.png","cover").setZ(1001);$this.css({opacity:0}).tween({opacity:1},_quick?2e3:3e3,"easeInOutSine",_quick?1e3:3e3)}function addListeners(){$this.interact(hover,click);$this.hit.mouseEnabled(true);_this.events.subscribe(AirmanEvents.APTITUDE_ZOOM,aptitudeZoom)}function aptitudeZoom(e){switch(e.action){case"in":$this.tween({opacity:0},500,"easeOutSine");break;case"out":$this.tween({opacity:1},500,"easeOutSine");break}}function hover(e){switch(e.action){case"over":$this.tween({opacity:.7},100,"easeOutSine");break;case"out":$this.tween({opacity:1},300,"easeOutSine");break}}function click(){getURL("http://airforce.com","_blank");Tracking.event({category:"header",action:"logo-click"})}this.animateIn=function(){}});Class(function UIMenu(){Inherit(this,View);var _this=this;var $this,$bg,$title,$items;var _items,_hamburger,_buttons,_apply,_sound;var _active=-1;(function(){initHTML();if(Mobile.phone)initHamburger();initButtons();initItems();addListeners();resizeHandler()}());function initHTML(){$this=_this.element;$this.size("100%").setZ(1e3);$this.wrapper=$this.create(".wrapper");$this.wrapper.size("100%").mouseEnabled(false).setZ(2)}function initHamburger(){$bg=$this.wrapper.create(".bg");$bg.size("100%").bg("#030813").css({opacity:0});$title=$this.create(".title");$title.fontStyle("StratumBold",22,"#fff");$title.css({width:"100%",textAlign:"center",letterSpacing:1,opacity:0,top:Config.UI_OFFSET});$title.text("");_hamburger=_this.initClass(HamburgerButton,[$this.wrapper])}function initButtons(){_buttons=_this.initClass(UIMenuButtons);if(!Mobile.phone)_this.delayedCall(_buttons.animateIn,8e3)}function initItems(){$items=$this.wrapper.create(".items");$items.size("100%");var items=[{text:"MISSIONS",width:78},{text:"DASHBOARD",width:98},{text:"LEADERBOARD",width:117}];_items=[];var x=0;var offset=30;for(var i=0;i<items.length;i++){items[i].index=i;var item=_this.initClass(UIMenuItem,items[i],[$items]);item.text=items[i].text;item.css({left:x});item.events.add(HydraEvents.CLICK,itemClick);_items.push(item);x+=items[i].width+offset}x-=offset;$items.width=x}function addListeners(){if(_hamburger)_hamburger.events.add(HydraEvents.CLICK,burgerClick);_this.events.subscribe(AirmanEvents.MISSION_SELECT,clearSelects);_this.events.subscribe(AirmanEvents.NAV_CHANGE,navChange);_this.events.subscribe(HydraEvents.RESIZE,resizeHandler)}function resizeHandler(){if(Mobile.phone){$items.size($items.width,30).center();$items.scale=Utils.range(Stage.width,0,500,.4,1);$items.transform()}else{$items.size($items.width,50).css({top:Config.UI_OFFSET+12}).center(1,0)}}function clearSelects(){for(var i=0;i<_items.length;i++){_items[i].deactivate(-1)}}function navChange(e){var index=0;for(var i=0;i<_items.length;i++){if(e.text==_items[i].text)index=i}var dir=_active>index?1:-1;_active=index;for(var i=0;i<_items.length;i++){if(_active==i)_items[i].activate(dir);else _items[i].deactivate(dir)}if($title){if(_active>0)$title.text(_items[_active].text).css({opacity:0}).tween({opacity:1},2e3,"easeInOutSine",400);else $title.text("").css({opacity:0})}}function itemClick(e){_this.events.fire(AirmanEvents.NAV_CHANGE,e);Tracking.event({category:"header",action:`${_items[_active].text.toLowerCase()}-click`})}function animateIn(){if(_this.visible)return;_this.visible=true;for(let i=0;i<_items.length;i++){_items[i].animateIn(i*200)}if($bg)$bg.tween({opacity:1},500,"easeOutSine");_buttons.animateIn();if(_hamburger)_hamburger.activate()}function animateOut(){if(!_this.visible)return;_this.visible=false;for(let i=0;i<_items.length;i++){_items[i].animateOut(i*50)}_buttons.animateOut();if($bg)$bg.tween({opacity:0},500,"easeOutSine");if(_hamburger)_hamburger.deactivate()}function burgerClick(){if(!_this.visible){animateIn();Tracking.event({category:"header",action:`menu-open`})}else{animateOut();Tracking.event({category:"header",action:`menu-close`})}}this.animateIn=function(){_this.animatedIn=true;if(Mobile.phone){_hamburger.animateIn()}else{_this.delayedCall(animateIn,1e3)}};this.animateOut=animateOut});Class(function UIMenuButtons(){Inherit(this,View);var _this=this;var $this,$bg;var _loginout,_form,_apply,_sound;(function(){initHTML();initButton();initApply();initSound();addListeners();resizeHandler()}());function initHTML(){$this=_this.element;$this.size("100%").setZ(1e3).invisible()}function initButton(hasAccount){let state=Data.Account.hasLoggedIn()?"LOGOUT":"LOGIN";if(_this.logged==state)return;_this.logged=state;if(_loginout)_loginout=_loginout.destroy();_loginout=_this.initClass(GhostButton,{text:_this.logged,width:90,height:40,size:14,lockSize:true,reclickable:true},[$this.wrapper]);_loginout.events.add(HydraEvents.CLICK,buttonClick);_this.delayedCall(function(){if(_this.visible)_loginout.animateIn()},500);defer(resizeHandler)}function initApply(){_apply=_this.initClass(TextButton,{text:"APPLY NOW",width:75,height:21,size:13,url:"https://www.airforce.com/apply-now"},[$this.wrapper])}function initSound(){_sound=_this.initClass(SoundButton)}function addListeners(){_this.events.subscribe(AirmanEvents.LOGGED_IN,initButton);_this.events.subscribe(AirmanEvents.LOGGED_OUT,loggedOut);_this.events.subscribe(HydraEvents.RESIZE,resizeHandler);_this.events.subscribe(AirmanEvents.DISABLE_NAV,lockButtons)}function loggedOut(){_loginout.animateOut()}function lockButtons(e){if(!e.soft&&e.type==="disable"){_loginout.disabled=true}else{_loginout.disabled=false}}function resizeHandler(){if(Mobile.phone){_loginout&&_loginout.element.css({right:Config.UI_OFFSET+65,top:Config.UI_OFFSET}).setZ(1);_apply&&_apply.element.css({right:Config.UI_OFFSET+240,top:Config.UI_OFFSET+9}).setZ(1);_sound&&_sound.element.css({right:Config.UI_OFFSET+175,top:Config.UI_OFFSET}).setZ(1)}else{_loginout&&_loginout.element.css({right:Config.UI_OFFSET,top:Config.UI_OFFSET}).setZ(1);_apply&&_apply.element.css({right:Config.UI_OFFSET+175,top:Config.UI_OFFSET+9}).setZ(1);_sound&&_sound.element.css({right:Config.UI_OFFSET+110,top:Config.UI_OFFSET}).setZ(1);if(Stage.width<105e1){_apply&&_apply.element.css({right:Config.UI_OFFSET+8,top:Config.UI_OFFSET+50}).setZ(1)}}}function buttonClick(){if(Data.Account.hasLoggedIn()){_loginout.animateOut();Data.Account.logout();Tracking.event({category:"header",action:"log-out-click"})}else{Form.instance().create("login");Tracking.event({category:"header",action:"log-in-click"})}}function animateIn(){if(_this.visible)return;$this.visible();_loginout.animateIn();_apply.animateIn();_sound.animateIn();_loginout&&_loginout.element.mouseEnabled(true);_this.visible=true}function animateOut(){if(!_this.visible)return;_this.visible=false;_this.delayedCall(function(){$this.invisible()},700);_loginout.animateOut();_apply.animateOut();_sound.animateOut();_loginout.element.mouseEnabled(false)}this.animateIn=animateIn;this.animateOut=animateOut});Class(function UIMenuItem(_data){Inherit(this,View);var _this=this;var $this,$text,$line;_this.active=false;var _text;(function(){initHTML();initText();addListeners()}());function initHTML(){$this=_this.element;$this.size(_data.width,20).css({}).invisible();$line=$this.create(".line");$line.size(_data.width,3).bg("#fff").css({overflow:"hidden",bottom:-3,left:-1}).transform({scaleX:0})}function initText(){_text=_this.initClass(FlashText,{text:_data.text.toUpperCase(),size:17,color:"#fff",lockSize:true});_text.element.css({opacity:.5}).mouseEnabled(false)}function addListeners(){$this.interact(hover,click);$this.hit.size(_data.width+40,60).center();_this.events.subscribe(AirmanEvents.DISABLE_NAV,disableNav)}function hover(e){if(_this.active||_this.disabled)return;switch(e.action){case"over":_text.element.tween({opacity:1},200,"easeOutSine");AudioController.menuHover();break;case"out":_text.element.tween({opacity:.5},400,"easeOutSine");break}}function click(){if(_this.active||_this.disabled)return;_this.events.fire(HydraEvents.CLICK,_data);AudioController.menuClick(_data.text)}function disableNav(e){if(e.type=="disable")$this.hit.hide();else $this.hit.show();_this.disabled=e.type=="disable"}this.click=click;this.activate=function(dir){if(_this.active)return;_this.active=true;_text.element.tween({opacity:1},300,"easeOutSine");$line.transformPoint(dir<0?"0%":"100%","50%").transform({scaleX:0}).tween({scaleX:1},800,"easeOutQuint")};this.deactivate=function(dir){if(!_this.active)return;_this.active=false;_text.element.tween({opacity:.5},500,"easeOutSine");$line.stopTween().transformPoint(dir>0?"0%":"100%","50%").tween({scaleX:0},500,"easeOutQuint")};this.animateIn=function(delay){_text.animateIn();$this.mouseEnabled(true).visible().stopTween().transform({y:10}).css({opacity:0}).tween({opacity:1,y:0},700,"easeOutCubic",delay)};this.animateOut=function(delay){_text.animateOut();$this.mouseEnabled(false).tween({opacity:0,y:-5},700,"easeOutCubic",delay,function(){$this.visible()})}});FX.Class(function DigitalTransition(){Inherit(this,FXLayer);var _this=this;var _shader;var _meshes=[];(function(){_this.create(World.NUKE);_this.setDPR(1);initPass();addListeners();resizeHandler();_this.startRender(loop);Render.startRender(moveUV,24)}());function initPass(){_this.pass=_this.initClass(NukePass,"DigitalTransitionPass");_this.pass.uniforms={tDistortion:{type:"t",value:Utils3D.getRepeatTexture("assets/images/vfx/digitaltransition.jpg")},tMask:{type:"t",value:_this.rt.texture},dScale:{type:"f",value:1},dOffset:{type:"v2",value:new THREE.Vector2},dTransition:{type:"f",value:0}};_this.dOffset=_this.pass.uniforms.dOffset;_shader=_this.initClass(Shader,"DigitalMapMask")}function moveUV(){_this.pass.uniforms.dOffset.value.x=Utils.doRandom(-1,1,4);_this.pass.uniforms.dOffset.value.y=Utils.doRandom(-1,1,4);_this.draw()}function loop(){let color=World.RENDERER.getClearColor();World.RENDERER.setClearColor(0);_this.draw();World.RENDERER.setClearColor(color)}function addListeners(){_this.events.subscribe(HydraEvents.RESIZE,resizeHandler);_this.events.subscribe(AirmanEvents.CLEAR_LEVEL,clear)}function clear(){_meshes.forEach(mesh=>{_this.removeObject(mesh)});_meshes.length=0;_this.pass.set("dTransition",0)}function resizeHandler(){_this.pass.set("dScale",Stage.width/512*2)}this.add=function(mesh){let clone=this.addObject(mesh);let shader=_shader.clone();_shader.copyUniformsTo(shader);Shader.copyUniforms(shader,clone.material);clone.material=shader.material;_meshes.push(mesh)};this.addStatic=function(mesh){let clone=this.addObject(mesh);if(mesh.digitalTransitionMask){clone.material=mesh.digitalTransitionMask.material}else{clone.material=new THREE.MeshBasicMaterial({color:16777215})}};this.animateIn=function(time=2e3,ease="easeOutSine"){_this.pass.tween("dTransition",1,time,ease)};this.animateOut=function(time=2e3,ease="easeOutSine"){_this.pass.tween("dTransition",0,300,ease)};this.clear=function(){clear()}},"singleton");FX.Class(function ScreenComposite(){Inherit(this,NukePass);var _this=this;_this.danger=0;_this.uniforms={blurStrength:{type:"f",value:1},blurDistance:{type:"f",value:.3},rgbStrength:{type:"f",value:1.5},digiStrength:{type:"f",value:0},digiScale:{type:"f",value:1},refraction:{type:"f",value:.2},redStrength:{type:"f",value:0},errorGlitch:{type:"f",value:0},vignette:{type:"f",value:.5},tDigital:{type:"t",value:Utils3D.getRepeatTexture("assets/images/vfx/digitaltransition.jpg")},resolution:MapUtil.resolution,dOffset:FX.DigitalTransition.instance().dOffset,time:MapUtil.time};(function(){_this.init();ShaderUIL.instance().push(_this);_this.startRender(loop)}());function loop(){_this.uniforms.redStrength.value+=(_this.danger-_this.uniforms.redStrength.value)*.07}this.digiAnimateIn=function(){_this.set("digiScale",4);_this.tween("digiStrength",.3,200,"linear",()=>{_this.tween("digiStrength",0,2e3,"easeOutSine",15e2)})};this.digiAnimateOut=function(fail){if(!fail)return;_this.errorGlitch();_this.set("digiScale",2);_this.tween("digiScale",1,500,"linear");_this.tween("digiStrength",3,400,"easeInOutSine",()=>{_this.tween("digiStrength",0,500,"easeOutSine")})};this.errorGlitch=function(){_this.tween("errorGlitch",1,400,"easeInOutSine",()=>{_this.tween("errorGlitch",0,500,"easeOutSine")})};this.globeTransition=function(fail){};this.beginHover=function(){_this.set("digiScale",2);_this.tween("digiScale",1,500,"linear");_this.tween("rgbStrength",3.3,10,"easeInOutSine");_this.tween("digiStrength",.08,10,"easeInOutSine",()=>{_this.tween("digiStrength",0,500,"easeOutSine");_this.tween("rgbStrength",1.5,500,"easeOutSine")})}},"singleton");Class(function Main(){Inherit(this,Component);var _this=this;var _loader;(function(){if(!Device.graphics.webgl)return window.location="./fallback.html";if(Tests.blockSocialBrowser())SocialBrowser.instance();if(Device.browser.ie){Device.tween.css3d=false;if(Device.browser.version<=11)XHR.ignoreReject=true}if(Tests.fontSmoothing())CSS.style("*",{"-webkit-font-smoothing":"antialiased"});else CSS.style("*",{"-webkit-font-smoothing":"none"});if(Hydra.HASH.strpos("dynamicShare"))return initShare();Hydra.CDN=Config.CDN;Utils3D.PATH=Config.CDN;Service.offline=false;Mobile.Accelerometer.capture();Global.UI_SCALE=1;Global.UI_COLOR="#131720";Mouse.capture();Mobile.Accelerometer.capture();initLoader();if(Device.mobile)Blocker.instance();if(Mobile.isPWA())Tracking.page("pwa");if(!Hydra.LOCAL){Dev.alertErrors(["staging","preview","dev"]);Utils3D.disableWarnings();if(location.hostname.strpos("airforce.com")&&!location.hostname.strpos("staging")&&window.console)window.console.log=function(){}}if(Mobile.os=="Android"){if(!Mobile.isPWA()||Mobile.browserVersion<58)Mobile.fullscreen();Mobile.setOrientation("landscape")}}());function initShare(){let type=Hydra.HASH.substr(Hydra.HASH.indexOf("?")+1,Hydra.HASH.length);let id=Hydra.HASH.substr(Hydra.HASH.indexOf("/")+1,Hydra.HASH.length);console.log(id,type);ShareDynamic.create(id,type)}function initLoader(){_loader=_this.initClass(Loader);_loader.events.add(HydraEvents.COMPLETE,loadComplete)}function loadComplete(){_loader=_loader.destroy();if(Hydra.HASH.strpos("playground")){Playground.instance()}else{Container.instance()}if(Mobile.os=="Android"&&!location.hostname.strpos("local")){Mobile.fullscreen();Mobile.setOrientation("landscape")}}})
window._MINIFIED_ = true;
window._BUILT_ = true;
